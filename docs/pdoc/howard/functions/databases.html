<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.1"/>
    <title>howard.functions.databases API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../functions.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;howard.functions</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#generate_databases_param">generate_databases_param</a>
            </li>
            <li>
                    <a class="function" href="#query_and_concatenate_columns">query_and_concatenate_columns</a>
            </li>
            <li>
                    <a class="function" href="#databases_infos">databases_infos</a>
            </li>
            <li>
                    <a class="function" href="#databases_param">databases_param</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_annovar">databases_download_annovar</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_snpeff">databases_download_snpeff</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_genomes">databases_download_genomes</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_refseq">databases_download_refseq</a>
            </li>
            <li>
                    <a class="function" href="#databases_format_refseq">databases_format_refseq</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_dbnsfp">databases_download_dbnsfp</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_alphamissense">databases_download_alphamissense</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_exomiser">databases_download_exomiser</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_dbsnp">databases_download_dbsnp</a>
            </li>
            <li>
                    <a class="function" href="#databases_download_hgmd">databases_download_hgmd</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../howard.html">howard</a><wbr>.<a href="./../functions.html">functions</a><wbr>.databases    </h1>

                
                        <input id="mod-databases-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-databases-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span> <span class="nn">argparse</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">multiprocessing</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span> <span class="nn">pyarrow.parquet</span> <span class="k">as</span> <span class="nn">pq</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span> <span class="nn">pyarrow</span> <span class="k">as</span> <span class="nn">pa</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">pyarrow</span> <span class="kn">import</span> <span class="n">csv</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">duckdb</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">Bio.bgzf</span> <span class="k">as</span> <span class="nn">bgzf</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span> <span class="nn">concurrent.futures</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cpu_count</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">logging</span> <span class="k">as</span> <span class="nn">log</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span> <span class="nn">fnmatch</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span> <span class="nn">glob</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">import</span> <span class="nn">zipfile</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">import</span> <span class="nn">gzip</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">from</span> <span class="nn">jproperties</span> <span class="kn">import</span> <span class="n">Properties</span>  <span class="c1"># jproperties 2.1.1</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="kn">from</span> <span class="nn">howard.functions.commons</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">from</span> <span class="nn">howard.objects.variants</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="k">def</span> <span class="nf">generate_databases_param</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">    This function generates database parameters based on specified arguments and assemblies.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">    :param args: The `args` parameter in the `generate_databases_param` function is expected to be an</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    instance of the `argparse` module, which is commonly used for parsing command-line arguments. This</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">    parameter is used to retrieve various arguments and options provided by the user when running the</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    script or program</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">    :type args: argparse</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    :param assemblies: The `assemblies` parameter is a list containing the assemblies for which</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">    databases will be generated. The function `generate_databases_param` takes various arguments using</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    the `argparse` module and generates database parameters based on these inputs. If the</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">    `generate_param` argument is provided and set to True,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">    :return: None</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="c1"># Param</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="k">if</span> <span class="s2">&quot;generate_param&quot;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param</span><span class="p">:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generate param config&quot;</span><span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">generate_param</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>            <span class="n">generate_param_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>            <span class="n">generate_param_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        <span class="k">if</span> <span class="s2">&quot;generate_param_description&quot;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>                <span class="n">generate_param_description_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>                <span class="n">generate_param_description_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="n">generate_param_description_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>        <span class="c1"># Check assembly</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assemblies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>            <span class="n">assembly</span> <span class="o">=</span> <span class="n">assemblies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: choose one uniq assembly &#39;</span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: choose one uniq assembly &#39;</span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>        <span class="c1"># Databases releases</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_releases</span><span class="p">:</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>            <span class="n">generate_param_releases</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>                <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_releases</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>            <span class="p">]</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>            <span class="n">generate_param_releases</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="c1"># Databases formats</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_formats</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="n">generate_param_formats</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>                <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_formats</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="p">]</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>            <span class="n">generate_param_formats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="c1"># databases infos</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="n">databases_infos_dict</span> <span class="o">=</span> <span class="n">databases_infos</span><span class="p">(</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>            <span class="n">database_folder_releases</span><span class="o">=</span><span class="n">generate_param_releases</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>            <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>            <span class="n">database_formats</span><span class="o">=</span><span class="n">generate_param_formats</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="n">databases_param_stats</span> <span class="o">=</span> <span class="n">databases_param</span><span class="p">(</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>            <span class="n">databases_infos_dict</span><span class="o">=</span><span class="n">databases_infos_dict</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>            <span class="n">bcftools_preference</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">generate_param_bcftools</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="n">output</span><span class="o">=</span><span class="n">generate_param_file</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="n">output_description</span><span class="o">=</span><span class="n">generate_param_description_file</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="c1"># Show param (3 levels of param)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>        <span class="k">for</span> <span class="n">databases_param_stat</span> <span class="ow">in</span> <span class="n">databases_param_stats</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">databases_param_stat</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>                <span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">databases_param_stat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>                <span class="k">for</span> <span class="n">databases_param_substat</span> <span class="ow">in</span> <span class="n">databases_param_stats</span><span class="p">[</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>                    <span class="n">databases_param_stat</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>                <span class="p">]:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>                        <span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">][</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>                            <span class="n">databases_param_substat</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>                        <span class="p">],</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>                        <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>                    <span class="p">):</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>                            <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">databases_param_substat</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">][</span><span class="n">databases_param_substat</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>                        <span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">databases_param_substat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>                        <span class="k">for</span> <span class="n">databases_param_subsubstat</span> <span class="ow">in</span> <span class="n">databases_param_stats</span><span class="p">[</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>                            <span class="n">databases_param_stat</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>                        <span class="p">][</span><span class="n">databases_param_substat</span><span class="p">]:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>                                <span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">databases_param_subsubstat</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">][</span><span class="n">databases_param_substat</span><span class="p">][</span><span class="n">databases_param_subsubstat</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>                            <span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="k">def</span> <span class="nf">query_and_concatenate_columns</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">    This function performs an SQL query on a large Parquet file and concatenates multiple columns (if not empty),</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">    including the column name in the concatenation.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">    :param parquet_file: The path to the Parquet file</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">    :type parquet_file: str</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">    :param output_file: The path to the output file where the concatenated data will be written</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">    :type output_file: str</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">    :param columns: The list of columns to concatenate</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">    :type columns: list</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="n">parquet_reader</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>    <span class="n">num_rows</span> <span class="o">=</span> <span class="n">parquet_reader</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">num_rows</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># Adjust the chunk size as per your memory constraints</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="n">table</span> <span class="o">=</span> <span class="n">parquet_reader</span><span class="o">.</span><span class="n">read_row_group</span><span class="p">(</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">skip_rows</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="n">chunk_size</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>            <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>                <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])]</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>                <span class="p">),</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>            <span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>            <span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="c1"># Export the concatenated data to a CSV file</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>    <span class="n">concatenated_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="n">concatenated_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="k">def</span> <span class="nf">databases_infos</span><span class="p">(</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="n">database_folders</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>    <span class="n">database_folder_releases</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;current&quot;</span><span class="p">],</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>    <span class="n">assembly</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hg19&quot;</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="n">database_formats</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">    The `databases_infos` function scans database folders and retrieves information about the databases</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">    found, including their folder, release, assembly, subdatabase, format, header, and parameters.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">    :param database_folders: A list of folders where the databases are located</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">    :type database_folders: list</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">    :param database_folder_releases: A list of specific releases of the database folders to include in</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">    the search. If None, all releases will be included</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">    :type database_folder_releases: list</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">    :param assembly: The `assembly` parameter is a string that specifies the assembly version of the</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">    databases to be searched. It is used to filter the databases based on their assembly version. The</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">    default value is &quot;hg19&quot;, defaults to hg19</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">    :type assembly: str (optional)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">    :param database_formats: The `database_formats` parameter is a list that specifies the formats of</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">    the databases to include in the results. If this parameter is not provided or is set to `None`, all</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">    database formats will be included</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">    :type database_formats: list</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">    :param config: The `config` parameter is a dictionary that contains configuration settings for the</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">    function. It has the following structure:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">    :type config: dict</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">    :return: The `databases_infos` function returns a dictionary containing information about the</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">    databases found in the specified database folders. The keys of the dictionary are the paths to the</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">    database files, and the values are dictionaries containing the following information: folder,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">    release, assembly, subdatabase, format, header, and parameters.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>    <span class="c1"># Init Database object</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>    <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>    <span class="n">vcfdata_obj</span> <span class="o">=</span> <span class="n">Database</span><span class="p">()</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>    <span class="c1"># Init results</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>    <span class="n">infos</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>    <span class="c1"># Check databases folders from config</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">database_folders</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="n">config_database_folders</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;folders&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;databases&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>        <span class="k">for</span> <span class="n">config_database_folder</span> <span class="ow">in</span> <span class="n">config_database_folders</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>            <span class="n">config_database_folder_dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/*$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">config_database_folder</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;config_database_folder: </span><span class="si">{</span><span class="n">config_database_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>                <span class="sa">f</span><span class="s2">&quot;   config_database_folder_dirname: </span><span class="si">{</span><span class="n">config_database_folder_dirname</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="n">database_folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_database_folder_dirname</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="c1"># Find all databases folders</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">database_folders</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="n">database_folders</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="n">default_database_folder</span> <span class="o">=</span> <span class="n">DEFAULT_DATABASE_FOLDER</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="n">database_folders_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">default_database_folder</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="k">for</span> <span class="n">database_folder</span> <span class="ow">in</span> <span class="n">database_folders_list</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_database_folder</span><span class="p">,</span> <span class="n">database_folder</span><span class="p">)):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>                <span class="n">database_folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_database_folder</span><span class="p">,</span> <span class="n">database_folder</span><span class="p">)</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>                <span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;database_folders: </span><span class="si">{</span><span class="n">database_folders</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>    <span class="c1"># Scan database folders</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>    <span class="k">for</span> <span class="n">database_folder</span> <span class="ow">in</span> <span class="n">database_folders</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="c1"># Database folder name</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="n">database_folder_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_folder</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="c1"># Scan all folder with allowed structure in database folder (&lt;release&gt;/&lt;assembly&gt;)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">followlinks</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>            <span class="c1"># database structure and level</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="n">database_subfolder</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">database_folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>            <span class="n">database_subfolder_structure</span> <span class="o">=</span> <span class="n">database_subfolder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">database_subfolder</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="c1"># Level as correct structure</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>                <span class="c1"># If &quot;(&lt;release&gt;/&lt;assembly&gt;&quot; is a folder</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                    <span class="c1"># Database infos (release and assembly)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                    <span class="n">database_release</span> <span class="o">=</span> <span class="n">database_subfolder_structure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                    <span class="n">database_assembly</span> <span class="o">=</span> <span class="n">database_subfolder_structure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                    <span class="c1"># Filter with input release and assembly</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>                        <span class="ow">not</span> <span class="n">database_folder_releases</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>                        <span class="ow">or</span> <span class="n">database_release</span> <span class="ow">in</span> <span class="n">database_folder_releases</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                    <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">database_assembly</span> <span class="o">==</span> <span class="n">assembly</span><span class="p">):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                        <span class="c1"># List files within the folder</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                        <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>                        <span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                        <span class="c1"># List file as a database (to check)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>                        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">list_of_files</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                            <span class="c1"># Check if file exists (ERROR woth glob.glob???)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                            <span class="n">database</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">database</span><span class="p">):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                                <span class="c1"># Format of the database</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                                <span class="n">database_format</span> <span class="o">=</span> <span class="n">vcfdata_obj</span><span class="o">.</span><span class="n">get_format</span><span class="p">(</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                                    <span class="n">database</span><span class="o">=</span><span class="n">database</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                                <span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                                <span class="c1"># Check if it is a database (header exists as file or within vcf)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                                <span class="c1"># Filter with input database format</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>                                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">.hdr&quot;</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                                    <span class="ow">or</span> <span class="p">(</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                                        <span class="ow">and</span> <span class="n">database</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                                            <span class="p">(</span><span class="s2">&quot;vcf&quot;</span><span class="p">,</span> <span class="s2">&quot;vcf.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;vcf.bgz&quot;</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                                        <span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                                    <span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                                <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>                                    <span class="ow">not</span> <span class="n">database_formats</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>                                    <span class="ow">or</span> <span class="n">database_format</span> <span class="ow">in</span> <span class="n">database_formats</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                                <span class="p">):</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>                                    <span class="c1"># Database subfolder (allow files in subfolder, such as database versions)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                                    <span class="n">database_subfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                                        <span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>                                    <span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>                                    <span class="c1"># Database header</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>                                    <span class="n">database_header</span> <span class="o">=</span> <span class="n">vcfdata_obj</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>                                        <span class="n">database</span><span class="o">=</span><span class="n">database</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                                    <span class="p">)</span><span class="o">.</span><span class="n">infos</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>                                    <span class="c1"># Init</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>                                    <span class="n">header_infos_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>                                    <span class="n">header_infos_dict_param</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>                                    <span class="c1"># List header infos</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">database_header</span><span class="p">):</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>                                        <span class="c1"># Init</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>                                        <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                                        <span class="n">header_infos_dict_param</span><span class="p">[</span><span class="n">info</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                                        <span class="c1"># ID</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                                        <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>                                        <span class="c1"># num</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                                        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                                            <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">num</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                                            <span class="ow">in</span> <span class="n">GENOTYPE_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                                        <span class="p">):</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                                                <span class="n">GENOTYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                                                    <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">num</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                                                <span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                                            <span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                                                <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">num</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                                            <span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                                        <span class="c1"># type</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                                        <span class="k">if</span> <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                                                <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                                            <span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                                        <span class="c1"># desc</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                                        <span class="k">if</span> <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">desc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>                                                <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">desc</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>                                            <span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                                    <span class="c1"># Add database to dict</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                                    <span class="k">if</span> <span class="n">header_infos_dict</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                                        <span class="n">infos</span><span class="p">[</span><span class="n">database</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                                            <span class="s2">&quot;folder&quot;</span><span class="p">:</span> <span class="n">database_folder_name</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                                            <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">database_release</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                                            <span class="s2">&quot;assembly&quot;</span><span class="p">:</span> <span class="n">database_assembly</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                                            <span class="s2">&quot;subdatabase&quot;</span><span class="p">:</span> <span class="n">database_subfolder</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                                            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">database_format</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                                            <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header_infos_dict</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                                            <span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="n">header_infos_dict_param</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                                        <span class="p">}</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                                        <span class="c1"># Log</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;database: </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>                                            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                                                <span class="p">{</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                                                    <span class="s2">&quot;folder&quot;</span><span class="p">:</span> <span class="n">database_folder_name</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                                                    <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">database_release</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                                                    <span class="s2">&quot;assembly&quot;</span><span class="p">:</span> <span class="n">database_assembly</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>                                                    <span class="s2">&quot;subdatabase&quot;</span><span class="p">:</span> <span class="n">database_subfolder</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>                                                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">database_format</span><span class="p">,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                                                    <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_infos_dict</span><span class="p">),</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>                                                    <span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>                                                        <span class="n">header_infos_dict_param</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>                                                    <span class="p">),</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>                                                <span class="p">},</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>                                                <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>                                            <span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>                                        <span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="k">return</span> <span class="n">infos</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="k">def</span> <span class="nf">databases_param</span><span class="p">(</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>    <span class="n">databases_infos_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="n">output_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="n">bcftools_preference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">    The `databases_param` function takes in a dictionary of database information, an optional output</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">    file path, and a boolean flag for bcftools preference, and returns a dictionary containing the</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">    parameters for parquet and bcftools annotations.</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">    :param databases_infos_dict: A dictionary containing information about databases. Each key in the</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">    dictionary represents the name of a database, and the corresponding value is another dictionary</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">    containing information about the database, such as its format and parameters</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">    :type databases_infos_dict: dict</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">    :param output: The `output` parameter is a string that specifies the path and filename of the output</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">    file where the generated JSON object will be written. If this parameter is not provided or is set to</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">    `None`, the JSON object will not be written to a file</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">    :type output: str</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">    :param output_description: The `output_description` parameter is a string that specifies the path</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">    and filename of the output file where the description of the databases will be written. If this</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">    parameter is not provided or is set to `None`, the description will not be written to a file</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">    :type output_description: str</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">    :param bcftools_preference: The `bcftools_preference` parameter is a boolean flag that determines</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">    whether to prioritize databases in the BCFTOOLS format. If `bcftools_preference` is set to `True`,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">    databases in the BCFTOOLS format will be given priority over other formats. If `bcftools, defaults</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">    to False</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">    :type bcftools_preference: bool (optional)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">    :return: The function `databases_param` returns a dictionary object named &quot;param_stats_show&quot;.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>    <span class="c1"># Full path</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>    <span class="n">output_description</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">output_description</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    <span class="c1"># Init</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>    <span class="n">param_parquet</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>    <span class="n">param_bcftools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="n">param_stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="s2">&quot;assembly&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="s2">&quot;databases&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="s2">&quot;releases&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="s2">&quot;formats&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>    <span class="p">}</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>    <span class="n">param_stats_show</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>    <span class="c1"># If None (not empty) dict in input, check by default</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="k">if</span> <span class="n">databases_infos_dict</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">databases_infos_dict</span> <span class="o">=</span> <span class="n">databases_infos</span><span class="p">()</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>    <span class="c1"># List databases</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>    <span class="k">for</span> <span class="n">database_infos</span> <span class="ow">in</span> <span class="n">databases_infos_dict</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="n">database_format</span> <span class="o">=</span> <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="c1"># If preference for bcftools</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>        <span class="k">if</span> <span class="n">bcftools_preference</span> <span class="ow">and</span> <span class="n">database_format</span> <span class="ow">in</span> <span class="n">BCFTOOLS_FORMAT</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="n">param_bcftools</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span> <span class="o">=</span> <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="s2">&quot;param&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>            <span class="n">param_parquet</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span> <span class="o">=</span> <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                <span class="s2">&quot;param&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>            <span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="c1"># Stats</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;assembly&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;assembly&quot;</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_infos</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;releases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;formats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="c1"># Stats</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Assembly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;assembly&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Number of databases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]))</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Releases of databases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;releases&quot;</span><span class="p">]))</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Formats of databases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;formats&quot;</span><span class="p">]))</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Number of Annotation fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]))</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>    <span class="c1"># Add parquet annotations to param</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="k">if</span> <span class="n">param_parquet</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">][</span><span class="s2">&quot;parquet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;annotations&quot;</span><span class="p">:</span> <span class="n">param_parquet</span><span class="p">}</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>    <span class="c1"># Add bcftools annotations to param</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="k">if</span> <span class="n">bcftools_preference</span> <span class="ow">and</span> <span class="n">param_bcftools</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">][</span><span class="s2">&quot;bcftools&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;annotations&quot;</span><span class="p">:</span> <span class="n">param_bcftools</span><span class="p">}</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>    <span class="c1"># Output</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="c1"># Create json object</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="n">json_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">)):</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="c1"># Write output file</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_object</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>    <span class="c1"># Output description</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>    <span class="k">if</span> <span class="n">output_description</span><span class="p">:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="c1"># Create json object</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="n">json_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">databases_infos_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_description</span><span class="p">)):</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_description</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="c1"># Write output file</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_description</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_object</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>    <span class="k">return</span> <span class="n">param_stats_show</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="k">def</span> <span class="nf">databases_download_annovar</span><span class="p">(</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>    <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hg19&quot;</span><span class="p">],</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>    <span class="n">annovar_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;http://www.openbioinformatics.org/annovar/download&quot;</span><span class="p">,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">    This function downloads and extracts Annovar databases for specified assemblies and files.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">    :param folder: The folder where the Annovar databases will be downloaded to</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">    :type folder: str</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">    :param files: The `files` parameter is a list of specific Annovar database files to download. If not</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">    provided, only the mandatory files will be downloaded. If set to &quot;ALL&quot;, all available files will be</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">    downloaded</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">    :type files: list</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">    :param assemblies: A list of genome assemblies for which Annovar databases will be downloaded.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">    Default is [&quot;hg19&quot;]</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">    :param annovar_url: The URL where Annovar databases can be downloaded from, defaults to</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">    http://www.openbioinformatics.org/annovar/download</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">    :type annovar_url: str (optional)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">    :param threads: The &quot;threads&quot; parameter specifies the number of threads (parallel processes) to use</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">    for download and extract/uncompress files. Default: 1</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>    <span class="c1"># Full path</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>    <span class="n">folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>    <span class="c1"># Minimum files to download</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>    <span class="n">files_minimum</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;refGene*&quot;</span><span class="p">]</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar for assembly &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="n">folder_assembly</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">):</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases in folder &#39;</span><span class="si">{</span><span class="n">folder_assembly</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Only mandatory files will be downloaded&quot;</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="n">patterns_file_to_check</span> <span class="o">=</span> <span class="n">files_minimum</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="k">elif</span> <span class="n">files</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;ALL&quot;</span><span class="p">]:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;All files will be downloaded&quot;</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>            <span class="n">patterns_file_to_check</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="n">patterns_file_to_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">files</span> <span class="o">+</span> <span class="n">files_minimum</span><span class="p">))</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Following files will be downloaded: </span><span class="si">{</span><span class="n">patterns_file_to_check</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download list of Annovar files from Annovar URL&quot;</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="n">avdblist_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_avdblist.txt&quot;</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="n">avdblist_url_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">annovar_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">avdblist_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">avdblist_folder_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_assembly</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">avdblist_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="sa">f</span><span class="s2">&quot;Download list of Annovar files </span><span class="si">{</span><span class="n">avdblist_file</span><span class="si">}</span><span class="s2"> from Annovar URL </span><span class="si">{</span><span class="n">avdblist_url_file</span><span class="si">}</span><span class="s2"> to Annovar folder </span><span class="si">{</span><span class="n">avdblist_folder_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="n">download_file</span><span class="p">(</span><span class="n">avdblist_url_file</span><span class="p">,</span> <span class="n">avdblist_folder_file</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">avdblist_folder_file</span><span class="p">):</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                <span class="sa">f</span><span class="s2">&quot;Download list of Annovar files from Annovar URL: </span><span class="si">{</span><span class="n">avdblist_url_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annovar Database list: </span><span class="si">{</span><span class="n">avdblist_folder_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annovar Database list: </span><span class="si">{</span><span class="n">avdblist_folder_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="c1"># Open file</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">avdblist_folder_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="c1"># Dataframe</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="c1"># Create list of files associated to Annovar code</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="n">files_to_download</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">patterns_file_to_check</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>                <span class="n">files_to_download</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">patterns_file_to_check</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.txt.gz&quot;</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.txt.idx.gz&quot;</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.fa.gz&quot;</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="c1"># Found if files exists in folder</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="n">list_files_in_folder</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="n">list_files_in_folder_size</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="c1"># Loop through each file in the list</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                <span class="c1"># Get a list of files in the folder that match the pattern</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                <span class="n">files_in_folder</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                <span class="k">if</span> <span class="n">files_in_folder</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>                    <span class="c1"># If the file exists, add it</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                    <span class="n">list_files_in_folder</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_in_folder</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                    <span class="p">]</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_in_folder</span><span class="p">:</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                        <span class="n">list_files_in_folder_size</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>                        <span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="c1"># List of files in folder</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List of file in Annovar folder: </span><span class="si">{</span><span class="n">list_files_in_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                <span class="sa">f</span><span class="s2">&quot;List of file in Annovar folder with size: </span><span class="si">{</span><span class="n">list_files_in_folder_size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>            <span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            <span class="c1"># Found if files exists in url</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="n">matched_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="c1"># for pattern in list_files_in_folder:</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                <span class="n">matched_files</span> <span class="o">+=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span> <span class="n">pattern</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>            <span class="c1"># deduplicate</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="n">matched_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matched_files</span><span class="p">))</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="c1"># List of files available</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List of file available in Annovar URL: </span><span class="si">{</span><span class="n">matched_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="c1"># Find files in url but not in folder</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="n">files_to_download</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">matched_files</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="n">file_url_size</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>                    <span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span> <span class="n">file</span><span class="p">)),</span> <span class="kc">None</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                <span class="n">file_folder_size</span> <span class="o">=</span> <span class="n">list_files_in_folder_size</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_files_in_folder</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_url_size</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                    <span class="n">file_folder_size</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                <span class="p">):</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>            <span class="c1"># List of files to download</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List of file to download: </span><span class="si">{</span><span class="n">files_to_download</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="c1"># Dowload and extract files</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="k">if</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - file &#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39; Downloading...&quot;</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>                    <span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>                    <span class="n">file_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annovar_url</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>                    <span class="n">download_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">folder_assembly</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                    <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - already exists&quot;</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="k">def</span> <span class="nf">databases_download_snpeff</span><span class="p">(</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hg19&quot;</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">    The `databases_download_snpeff` function downloads and extracts snpEff databases for specified</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">    genome assemblies.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">    :param folder: The `folder` parameter is a string that specifies the folder where the snpEff</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">    databases will be downloaded and stored. If the folder does not exist, it will be created</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">    :type folder: str</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">    :param assemblies: The `assemblies` parameter is a list of genome assemblies for which the snpEff</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">    databases need to be downloaded. It specifies the genome assemblies for which you want to download</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">    the snpEff databases. For example, if you want to download the snpEff databases for the human genome</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">    assembly hg</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">    :param config: The `config` parameter is a dictionary that contains information about the tools and</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">    their configurations. It is used to retrieve the path to the Java binary and the path to the snpEff</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">    binary</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">    :type config: dict</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to be used for downloading</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">    the snpEff databases. It determines the parallelism of the download process, allowing multiple files</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">    to be downloaded simultaneously, defaults to 1</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>    <span class="c1"># Full path</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>    <span class="n">folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>    <span class="c1"># Java bin and snpEff jar</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>    <span class="n">snpeff_bin</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;snpeff&quot;</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;snpEff.jar&quot;</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>        <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;jar&quot;</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="n">default_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_TOOLS_FOLDER</span><span class="si">}</span><span class="s2">/snpeff&quot;</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>    <span class="p">)</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>    <span class="n">java_bin</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;java&quot;</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;java&quot;</span><span class="p">,</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>        <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>        <span class="n">default_folder</span><span class="o">=</span><span class="s2">&quot;/usr/bin&quot;</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>    <span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>    <span class="c1"># database list</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>    <span class="n">snpeff_databases_list</span> <span class="o">=</span> <span class="s2">&quot;snpeff_databases.list&quot;</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>    <span class="n">snpeff_databases_list_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">snpeff_databases_list</span><span class="p">)</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>    <span class="c1"># create folder if not exists</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>    <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>    <span class="c1"># For each assembly</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="c1"># Destination folder</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="n">folder_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="c1"># Check if destination folder exists (already downloaded)</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">):</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>            <span class="c1"># Download list of databases if file does not exists</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>                <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            <span class="p">):</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>                    <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                <span class="p">):</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - list of databases empty - download &#39;</span><span class="si">{</span><span class="n">snpeff_databases_list_path</span><span class="si">}</span><span class="s2">&#39; required&quot;</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                    <span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                <span class="n">snpeff_command_list_databases</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span><span class="si">{</span><span class="n">java_bin</span><span class="si">}</span><span class="s2"> -jar </span><span class="si">{</span><span class="n">snpeff_bin</span><span class="si">}</span><span class="s2"> databases &gt; </span><span class="si">{</span><span class="n">snpeff_databases_list_path</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - list of databases...&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>                <span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                    <span class="sa">f</span><span class="s2">&quot;snpEff databases downloading - list of databases: </span><span class="si">{</span><span class="n">snpeff_command_list_databases</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                <span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                <span class="n">command</span><span class="p">(</span><span class="n">snpeff_command_list_databases</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="c1"># Open list of databases and create list of url</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="n">snpeff_list_databases</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                    <span class="n">cols</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                    <span class="n">snpeff_list_databases</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                    <span class="c1"># Last 2 infos on file. Fix from snpEff between release 5.0 and 5.1</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                    <span class="n">snpeff_list_databases</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                        <span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                    <span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                    <span class="n">snpeff_list_databases</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                        <span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                    <span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">snpeff_list_databases</span><span class="p">:</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                <span class="n">msg_err</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - list of databases empty - check file &#39;</span><span class="si">{</span><span class="n">snpeff_databases_list_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            <span class="c1"># Start download</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - downloading...&quot;</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="c1"># Try to download files</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="n">file_url</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">snpeff_list_databases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="c1"># File to be downloaded</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_url</span><span class="p">))</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                <span class="c1"># Check if file already downloaded</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                    <span class="k">break</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                    <span class="c1"># try to download</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>                        <span class="c1"># Download file</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                        <span class="k">if</span> <span class="n">download_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">):</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                            <span class="k">break</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                    <span class="c1"># If fail, just pass to next url</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>            <span class="c1"># If download file exists</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                <span class="n">file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>                <span class="ow">and</span> <span class="n">file_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>            <span class="p">):</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - extracting...&quot;</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                <span class="c1"># Extract file</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                <span class="c1"># Move to destination folder</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                <span class="n">extracted_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">extracted_folder</span><span class="p">,</span> <span class="n">folder_assembly</span><span class="p">)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - already exists&quot;</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="k">def</span> <span class="nf">databases_download_genomes</span><span class="p">(</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span><span class="p">,</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>    <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UCSC&quot;</span><span class="p">,</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>    <span class="n">contig_regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">    This function downloads genome assemblies using genomepy package with options to specify genome</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">    folder, provider, contig regex, and number of threads.</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">    :param assemblies: a list of genome assembly names to download</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">    :param genomes_folder: The folder where the downloaded genome files will be saved. If no folder is</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">    specified, the default folder will be used</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">    :param provider: The provider parameter specifies the source of the genome data. In this case, the</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">    default provider is set to &quot;UCSC&quot;, which refers to the University of California, Santa Cruz Genome</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">    Browser. Other possible providers could include NCBI or Ensembl, defaults to UCSC</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">    :type provider: str (optional)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">    :param contig_regex: The contig_regex parameter is a regular expression used to filter the contigs</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">    (chromosomes or scaffolds) to be downloaded for a given genome assembly. It allows users to download</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">    only a subset of the available contigs, based on their names or other characteristics. If</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">    contig_regex is not specified</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">    :type contig_regex: str</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">    :param threads: The &quot;threads&quot; parameter specifies the number of threads (parallel processes) to use</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">    for downloading the genomes. This can speed up the process if the computer has multiple cores or</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">    processors. The default value is 1, meaning that the download will be done using a single thread,</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">    defaults to 1</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="sd">    :return: None is being returned.</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Genomes </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>    <span class="kn">import</span> <span class="nn">genomepy</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="c1"># Full path</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">):</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="n">installed_genomes</span> <span class="o">=</span> <span class="n">genomepy</span><span class="o">.</span><span class="n">list_installed_genomes</span><span class="p">(</span><span class="n">genomes_dir</span><span class="o">=</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="n">installed_genomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>        <span class="k">if</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">installed_genomes</span><span class="p">:</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Genomes </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - already exists&quot;</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Genomes </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> downloading...&quot;</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="n">genomepy</span><span class="o">.</span><span class="n">install_genome</span><span class="p">(</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                <span class="n">assembly</span><span class="p">,</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="n">annotation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                <span class="n">provider</span><span class="o">=</span><span class="n">provider</span><span class="p">,</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                <span class="n">genomes_dir</span><span class="o">=</span><span class="n">genomes_folder</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                <span class="n">regex</span><span class="o">=</span><span class="n">contig_regex</span><span class="p">,</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>            <span class="p">)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="k">def</span> <span class="nf">databases_download_refseq</span><span class="p">(</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>    <span class="n">refseq_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>    <span class="n">refseq_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>    <span class="n">refseq_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ncbiRefSeq&quot;</span><span class="p">,</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>    <span class="n">refseq_files</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ncbiRefSeq.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;ncbiRefSeqLink.txt&quot;</span><span class="p">],</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>    <span class="n">refseq_format_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ncbiRefSeq.txt&quot;</span><span class="p">,</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="n">refseq_format_file_output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>    <span class="n">include_utr_5</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>    <span class="n">include_utr_3</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>    <span class="n">include_chrM</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>    <span class="n">include_non_canonical_chr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    <span class="n">include_non_coding_transcripts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>    <span class="n">include_transcript_ver</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">    The `databases_download_refseq` function downloads RefSeq files for a list of assemblies and returns</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">    a dictionary of installed RefSeq files for each assembly.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">    :param assemblies: A list of assemblies for which the RefSeq files need to be downloaded. Each</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">    assembly is represented as a string</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">    :param refseq_folder: The `refseq_folder` parameter is a string that specifies the folder where the</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">    RefSeq files will be downloaded and stored. If this parameter is not provided, a default folder will</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">    be used</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">    :type refseq_folder: str</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">    :param refseq_url: The `refseq_url` parameter is a string that represents the URL where the RefSeq</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">    files can be downloaded from</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">    :type refseq_url: str</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">    :param refseq_prefix: The `refseq_prefix` parameter is a string that specifies the prefix for the</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">    downloaded RefSeq files. By default, it is set to &quot;ncbiRefSeq&quot;. This prefix is used to identify the</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">    RefSeq files for each assembly. For example, if the prefix is set to &quot;ncbi, defaults to ncbiRefSeq</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">    :type refseq_prefix: str (optional)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">    :param refseq_files: The `refseq_files` parameter is a list of filenames that need to be downloaded</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">    for each assembly. The default value is `[&quot;ncbiRefSeq.txt&quot;, &quot;ncbiRefSeqLink.txt&quot;]`, but you can</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">    provide your own list of filenames if needed</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">    :type refseq_files: List</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">    :param refseq_format_file: The `refseq_format_file` parameter is a string that specifies the</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">    filename of the RefSeq file that needs to be formatted. This file will be used as input for the</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">    `databases_format_refseq` function. By default, the value is set to &quot;ncbiRefSeq.txt&quot;, defaults to</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">    ncbiRefSeq.txt</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">    :type refseq_format_file: str (optional)</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">    :param refseq_format_file_output: The `refseq_format_file_output` parameter is a string that</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">    specifies the output file path for the formatted RefSeq file. This file will be generated by the</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">    `databases_format_refseq` function and will contain the formatted RefSeq data. If this parameter is</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">    not provided, the formatted RefSeq</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">    :type refseq_format_file_output: str</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">    :param include_utr_5: A boolean parameter that specifies whether to include the 5&#39; untranslated</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">    region (UTR) in the downloaded RefSeq files. If set to True, the 5&#39; UTR will be included. If set to</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">    False, the 5&#39; UTR will be excluded, defaults to True</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">    :type include_utr_5: bool (optional)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">    :param include_utr_3: The `include_utr_3` parameter is a boolean value that specifies whether to</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">    include the 3&#39; untranslated region (UTR) in the downloaded RefSeq files. If set to `True`, the 3&#39;</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">    UTR will be included. If set to `False`, the 3, defaults to True</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">    :type include_utr_3: bool (optional)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">    :param include_chrM: The `include_chrM` parameter is a boolean value that determines whether to</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">    include the mitochondrial chromosome (chrM) in the downloaded RefSeq files. If set to True, the chrM</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">    will be included; if set to False, it will be excluded, defaults to True</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">    :type include_chrM: bool (optional)</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">    :param include_non_canonical_chr: The `include_non_canonical_chr` parameter is a boolean value that</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">    determines whether or not to include non-canonical chromosomes in the downloaded RefSeq files. If</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">    set to `True`, non-canonical chromosomes will be included. If set to `False`, non-canonical</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">    chromosomes will be excluded, defaults to True</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">    :type include_non_canonical_chr: bool (optional)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">    :param include_non_coding_transcripts: The `include_non_coding_transcripts` parameter is a boolean</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">    flag that determines whether non-coding transcripts should be included in the downloaded RefSeq</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">    files. If set to `True`, non-coding transcripts will be included. If set to `False`, non-coding</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">    transcripts will be excluded, defaults to True</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">    :type include_non_coding_transcripts: bool (optional)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">    :param include_transcript_ver: The `include_transcript_ver` parameter is a boolean value that</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">    determines whether to include the transcript version in the downloaded RefSeq files. If set to</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">    `True`, the transcript version will be included. If set to `False`, the transcript version will be</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">    excluded, defaults to True</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">    :type include_transcript_ver: bool (optional)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for downloading and</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">    extracting the RefSeq files. It determines the level of parallelism in the download and extraction</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">    process. By default, it is set to 1, which means that the download and extraction will be performed</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">    sequentially. If you want, defaults to 1</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of max memory (in Gb) to use for sorting.</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">    defaults to 1</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">    :return: The function `databases_download_refseq` returns a dictionary `installed_refseq` which</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">    contains information about the downloaded RefSeq files for each assembly. The keys of the dictionary</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">    are the assembly names, and the values are lists of the installed RefSeq files for each assembly.</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>    <span class="c1"># Log</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>    <span class="c1"># Default refSeq Folder</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">refseq_folder</span><span class="p">:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="n">refseq_folder</span> <span class="o">=</span> <span class="n">DEFAULT_REFSEQ_FOLDER</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="c1"># Full path</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>    <span class="n">refseq_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">)</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>    <span class="c1"># Default refSeq URL</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">refseq_url</span><span class="p">:</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="n">refseq_url</span> <span class="o">=</span> <span class="n">DEFAULT_REFSEQ_URL</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">):</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">)</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>    <span class="c1"># Installed refSeq files</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>    <span class="n">installed_refseq</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="c1"># Strat download needed files</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="n">installed_refseq</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">):</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="n">existing_files_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="n">existing_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_files_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_prefix</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>            <span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            <span class="c1"># For refSeq files to download</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="k">for</span> <span class="n">refseq_file</span> <span class="ow">in</span> <span class="n">refseq_files</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                <span class="n">new_refseq_file</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                <span class="c1"># If refSeq file exists</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_files_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">existing_files</span><span class="p">:</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                    <span class="p">)</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                    <span class="n">installed_refseq</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refseq_file</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="c1"># If refSeq file need to be downloaded</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                    <span class="c1"># files to download</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                    <span class="n">file_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/database/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                    <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                    <span class="c1"># try to download</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                            <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; downloading...&quot;</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                        <span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                        <span class="c1"># Download file</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                        <span class="n">download_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                        <span class="c1"># Extract file</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                        <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>                        <span class="c1"># add to installed files</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                        <span class="n">installed_refseq</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refseq_file</span><span class="p">)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                        <span class="n">new_refseq_file</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                    <span class="c1"># If fail, just pass to next url</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                            <span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39; - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; downloading failed&quot;</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>                        <span class="p">)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                            <span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39; - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; downloading failed&quot;</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>                        <span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>                <span class="c1"># format refSeq</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                <span class="k">if</span> <span class="n">refseq_format_file_output</span><span class="p">:</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                    <span class="n">file_path_bed</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_format_file_output</span><span class="si">}</span><span class="s2">.uncompress.txt&quot;</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                    <span class="n">file_path_bed_compressed</span> <span class="o">=</span> <span class="n">refseq_format_file_output</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                    <span class="n">file_path_bed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;txt$&quot;</span><span class="p">,</span> <span class="s2">&quot;bed&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                    <span class="n">file_path_bed_compressed</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path_bed</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                <span class="n">file_path_bed_hdr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path_bed</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="n">file_path_bed_compressed_hdr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path_bed_compressed</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                <span class="n">file_path_bed_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path_bed</span><span class="p">)</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="n">file_path_bed_compressed_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                    <span class="n">file_path_bed_compressed</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                <span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                <span class="k">if</span> <span class="n">refseq_file</span> <span class="o">==</span> <span class="n">refseq_format_file</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                    <span class="n">new_refseq_file</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path_bed</span><span class="p">)</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                <span class="p">):</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; formatting to &#39;</span><span class="si">{</span><span class="n">file_path_bed_basename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>                    <span class="p">)</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>                    <span class="c1"># Format refSeq in BED format</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                    <span class="n">databases_format_refseq</span><span class="p">(</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                        <span class="n">refseq_file</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                        <span class="n">output_file</span><span class="o">=</span><span class="n">file_path_bed</span><span class="p">,</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                        <span class="n">include_utr_5</span><span class="o">=</span><span class="n">include_utr_5</span><span class="p">,</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>                        <span class="n">include_utr_3</span><span class="o">=</span><span class="n">include_utr_3</span><span class="p">,</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                        <span class="n">include_chrM</span><span class="o">=</span><span class="n">include_chrM</span><span class="p">,</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                        <span class="n">include_non_canonical_chr</span><span class="o">=</span><span class="n">include_non_canonical_chr</span><span class="p">,</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                        <span class="n">include_non_coding_transcripts</span><span class="o">=</span><span class="n">include_non_coding_transcripts</span><span class="p">,</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                        <span class="n">include_transcript_ver</span><span class="o">=</span><span class="n">include_transcript_ver</span><span class="p">,</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                        <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                        <span class="n">header_first_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>                    <span class="p">)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                    <span class="c1"># compress file</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">file_path_bed_basename</span><span class="si">}</span><span class="s2">&#39; compressing to &#39;</span><span class="si">{</span><span class="n">file_path_bed_compressed_basename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                    <span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                    <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                        <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">file_path_bed</span><span class="p">],</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>                        <span class="n">output_file</span><span class="o">=</span><span class="n">file_path_bed_compressed</span><span class="p">,</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                        <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                        <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>                        <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;bgzip&quot;</span><span class="p">,</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                        <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                        <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                    <span class="p">)</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path_bed_hdr</span><span class="p">,</span> <span class="n">file_path_bed_compressed_hdr</span><span class="p">)</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>    <span class="c1"># Log</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;installed_refseq: </span><span class="si">{</span><span class="n">installed_refseq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>    <span class="k">return</span> <span class="n">installed_refseq</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="k">def</span> <span class="nf">databases_format_refseq</span><span class="p">(</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="n">refseq_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>    <span class="n">include_utr_5</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>    <span class="n">include_utr_3</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="n">include_chrM</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>    <span class="n">include_non_canonical_chr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>    <span class="n">include_non_coding_transcripts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>    <span class="n">include_transcript_ver</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>    <span class="n">sort</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>    <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>    <span class="n">header_first_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">    The `databases_format_refseq` function takes a RefSeq file as input, formats it according to</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">    specified criteria, and outputs the formatted file.</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">    :param refseq_file: The `refseq_file` parameter is a string that represents the path to the input</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">    RefSeq file. This file contains information about gene annotations, including chromosome, start and</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">    end positions, strand, and other details</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">    :type refseq_file: str</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">    :param output_file: The `output_file` parameter is a string that represents the name of the file</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">    where the formatted data will be written</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">    :type output_file: str</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">    :param include_utr_5: The `include_utr_5` parameter is a boolean that determines whether to include</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">    the 5&#39; UTR (untranslated region) in the output file. If set to `True`, the 5&#39; UTR will be included.</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">    If set to `False`, the 5&#39; U, defaults to True</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">    :type include_utr_5: bool (optional)</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">    :param include_utr_3: A boolean parameter that determines whether to include the 3&#39; UTR</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">    (untranslated region) in the output. If set to True, the 3&#39; UTR will be included. If set to False,</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">    the 3&#39; UTR will be excluded, defaults to True</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">    :type include_utr_3: bool (optional)</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">    :param include_chrM: The `include_chrM` parameter is a boolean that determines whether to include</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">    transcripts from the mitochondrial chromosome (chrM or chrMT) in the output file. If set to True,</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">    transcripts from the mitochondrial chromosome will be included. If set to False, transcripts from</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">    the mitochondrial chromosome will be excluded, defaults to True</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">    :type include_chrM: bool (optional)</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">    :param include_non_canonical_chr: The parameter `include_non_canonical_chr` determines whether or</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">    not to include non-canonical chromosomes in the output. If set to `True`, non-canonical chromosomes</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">    will be included. If set to `False`, non-canonical chromosomes will be excluded, defaults to True</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">    :type include_non_canonical_chr: bool (optional)</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">    :param include_non_coding_transcripts: The parameter `include_non_coding_transcripts` determines</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">    whether non-coding transcripts should be included in the output file. If set to `True`, non-coding</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">    transcripts will be included. If set to `False`, non-coding transcripts will be excluded, defaults</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">    to True</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">    :type include_non_coding_transcripts: bool (optional)</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">    :param include_transcript_ver: The `include_transcript_ver` parameter determines whether to include</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">    the transcript version in the output file. If set to `True`, the transcript version will be included</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">    in the output file. If set to `False`, the transcript version will be removed from the output file.</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">    The default value is `True, defaults to True</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">    :type include_transcript_ver: bool (optional)</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">    :param sort: The `sort` parameter determines whether to sort the output file in ascending order</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">    based on the chromosome and start position. If set to `True`, the file will be sorted. If set to</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">    `False`, the file will not be sorted. The default value is `False`, defaults to False</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">    :type sort: bool (optional)</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">    :param header: The `header` parameter is a boolean that determines whether to include a header line</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">    in the output file. If set to `True`, a header line will be included. If set to `False`, no header</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">    line will be included. The default value is `False`, defaults to False</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">    :type header: bool (optional)</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">    :param header_first_line: The `header_first_line` parameter is a boolean that determines whether to</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">    include the header line as the first line in the output file. If set to `True`, the header line will</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">    be included as the first line. If set to `False`, the header line will not be included as the first,</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">    defaults to True</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">    :type header_first_line: bool (optional)</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">    :return: The function `databases_format_refseq` returns the path of the output file.</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>    <span class="c1"># Header</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>    <span class="n">header_line</span> <span class="o">=</span> <span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">START</span><span class="se">\t</span><span class="s2">END</span><span class="se">\t</span><span class="s2">name</span><span class="se">\t</span><span class="s2">transcript</span><span class="se">\t</span><span class="s2">strand</span><span class="se">\t</span><span class="s2">exon&quot;</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>    <span class="c1"># Open refSeq file</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">refseq_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>        <span class="c1"># Open refSeq output file</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fo</span><span class="p">:</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="c1"># Write haeder line</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="k">if</span> <span class="n">header_first_line</span><span class="p">:</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header_line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>            <span class="c1"># For each line</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">fi</span><span class="p">:</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>                <span class="c1"># Header</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                    <span class="c1"># line</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>                    <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>                    <span class="c1"># check non-coding transcripts or unwanted chr</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>                    <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>                        <span class="n">include_non_coding_transcripts</span> <span class="ow">or</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;NM_&quot;</span><span class="p">)</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>                    <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>                        <span class="p">(</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>                            <span class="n">include_non_canonical_chr</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>                            <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^chr([0-9]*|X|Y)$&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>                        <span class="p">)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>                        <span class="ow">or</span> <span class="p">(</span><span class="n">include_chrM</span> <span class="ow">and</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;chrM&quot;</span><span class="p">,</span> <span class="s2">&quot;chrMT&quot;</span><span class="p">})</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>                    <span class="p">)</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>                    <span class="c1"># include transcript</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>                    <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                        <span class="c1"># Transcript version</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_transcript_ver</span><span class="p">:</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                        <span class="c1"># Exon to write (depending on utr)</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                        <span class="c1"># packing exons together to be able to number them (need to start from the end if negative strand, if using IGV as standard)</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                        <span class="n">exon_starts</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>                        <span class="n">exon_ends</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>                        <span class="n">exons_to_write</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">)):</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>                            <span class="k">if</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>                                <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>                                    <span class="p">[</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>                                        <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>                                        <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>                                    <span class="p">]</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>                                <span class="p">)</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>                            <span class="k">elif</span> <span class="ow">not</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]):</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>                                    <span class="p">)</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>                                        <span class="p">[</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>                                            <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>                                            <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                                        <span class="p">]</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>                                    <span class="p">)</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>                            <span class="k">elif</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                                    <span class="p">)</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                                        <span class="p">[</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>                                            <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                                            <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                                        <span class="p">]</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                                    <span class="p">)</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>                            <span class="k">elif</span> <span class="ow">not</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>                                    <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>                                <span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>                                        <span class="p">[</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>                                            <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>                                            <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>                                        <span class="p">]</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>                                    <span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>                                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>                                    <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                                <span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>                                    <span class="p">)</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>                                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>                                    <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>                                <span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>                                    <span class="p">)</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>                                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>                                    <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>                                <span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>                                    <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>                                <span class="p">):</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>                                    <span class="p">)</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>                        <span class="c1"># Write exon (depending on strand)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                        <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>                            <span class="n">exon_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exons_to_write</span><span class="p">)</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>                            <span class="n">exon_num_incrementation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>                            <span class="n">exon_num</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>                            <span class="n">exon_num_incrementation</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exons_to_write</span><span class="p">)):</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>                            <span class="n">exons_to_write</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;exon&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exon_num</span><span class="p">))</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>                            <span class="n">exon_num</span> <span class="o">+=</span> <span class="n">exon_num_incrementation</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>                            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exons_to_write</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>    <span class="c1"># Sort BED file</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>        <span class="n">bed_sort</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>    <span class="c1"># Create header</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>        <span class="c1"># Header file</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>        <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>        <span class="c1"># VCF header dict</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>        <span class="n">header_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Name of the refSeq Gene&quot;</span><span class="p">,</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>            <span class="p">},</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>            <span class="s2">&quot;transcript&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Name of the refSeq Transcript&quot;</span><span class="p">,</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>            <span class="p">},</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>            <span class="s2">&quot;strand&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;DNA strand orientation&quot;</span><span class="p">,</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>            <span class="p">},</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>            <span class="s2">&quot;exon&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Name of the refSeq Exon&quot;</span><span class="p">,</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>            <span class="p">},</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>        <span class="p">}</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>        <span class="c1"># Create header</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>        <span class="n">header_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;##fileformat=VCFv4.2&quot;</span><span class="p">,</span> <span class="n">header_line</span><span class="p">]</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>        <span class="n">header_vcf</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_list</span><span class="p">)))</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>        <span class="c1"># List of header annotations</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>        <span class="k">for</span> <span class="n">annotation_name</span> <span class="ow">in</span> <span class="n">header_dict</span><span class="p">:</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>            <span class="n">header_vcf</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_Info</span><span class="p">(</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>                <span class="n">annotation_name</span><span class="p">,</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">],</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>                <span class="n">code_type_map</span><span class="p">[</span><span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]],</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>            <span class="p">)</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>        <span class="c1"># Write file</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>        <span class="n">vcf</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">header_vcf</span><span class="p">)</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>    <span class="k">return</span> <span class="n">output_file</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="k">def</span> <span class="nf">databases_download_dbnsfp</span><span class="p">(</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>    <span class="n">dbnsfp_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>    <span class="n">dbnsfp_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>    <span class="n">dbnsfp_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.4a&quot;</span><span class="p">,</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>    <span class="n">parquet_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>    <span class="n">generate_parquet_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>    <span class="n">generate_sub_databases</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>    <span class="n">generate_vcf_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>    <span class="n">not_generate_files_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>    <span class="n">add_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>    <span class="n">only_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>    <span class="n">row_group_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>    <span class="n">uniquify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">    The `databases_download_dbnsfp` function is used to download and process dbNSFP databases for</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">    specified genome assemblies, generating Parquet and VCF files based on the provided configurations.</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">    :param assemblies: A list of genome assemblies for which to download and process dbNSFP data. Each</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">    assembly should be specified as a string</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">    :param dbnsfp_folder: The `dbnsfp_folder` parameter is a string that specifies the folder where the</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">    dbNSFP database files are located. If this parameter is not provided, the function will attempt to</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">    download the dbNSFP database files from the `dbnsfp_url` parameter</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">    :type dbnsfp_folder: str</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">    :param dbnsfp_url: The `dbnsfp_url` parameter represents the URL from which the dbNSFP database</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">    files can be downloaded. This URL is used by the function to fetch the necessary database files for</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">    processing</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">    :type dbnsfp_url: str</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">    :param dbnsfp_release: The `dbnsfp_release` parameter specifies the version of the dbNSFP database</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">    to be used. The default value is &quot;4.4a&quot;, but you can specify a different version if needed, defaults</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">    to 4.4a</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">    :type dbnsfp_release: str (optional)</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for parallel</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">    processing. Increasing the number of threads can potentially speed up the execution time of the</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">    function, especially if there are multiple cores available on the machine. It determines how many</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">    tasks can be executed simultaneously</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">    :type threads: int</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of maximum memory (in gigabytes) to use</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">    for sorting. It is used in the context of processing and sorting data efficiently. The default value</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">    for this parameter is set to 1, meaning that 1 gigabyte of memory will be allocated for sorting</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">    operations, defaults to 1</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">    :param parquet_size: The `parquet_size` parameter specifies the maximum size (in megabytes) of data</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">    files in the Parquet folder. It determines the size at which the Parquet files will be split or</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">    generated. The value should be an integer representing the size in megabytes, defaults to 100</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">    :type parquet_size: int (optional)</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">    :param generate_parquet_file: The `generate_parquet_file` parameter in the</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">    `databases_download_dbnsfp` function is a boolean flag that indicates whether to generate a Parquet</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="sd">    file or not. If set to `True`, the function will create Parquet files based on the specified</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">    parameters and data. If set to `, defaults to False</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">    :type generate_parquet_file: bool (optional)</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">    :param generate_sub_databases: The `generate_sub_databases` parameter in the</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">    `databases_download_dbnsfp` function determines whether to generate sub-databases based on the</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="sd">    assemblies provided. If set to `True`, the function will create sub-databases based on the specified</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a><span class="sd">    genome assemblies. If set to `False`, the function, defaults to False</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a><span class="sd">    :type generate_sub_databases: bool (optional)</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a><span class="sd">    :param generate_vcf_file: The `generate_vcf_file` parameter in the `databases_download_dbnsfp`</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a><span class="sd">    function is a boolean flag that indicates whether to generate a VCF file based on the specified</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="sd">    parameters and data. If set to `True`, the function will generate a VCF file. If set to `False,</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a><span class="sd">    defaults to False</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a><span class="sd">    :type generate_vcf_file: bool (optional)</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a><span class="sd">    :param not_generate_files_all: The `not_generate_files_all` parameter in the</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="sd">    `databases_download_dbnsfp` function is a boolean flag that indicates whether to skip generating</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a><span class="sd">    database Parquet/VCF files for the entire database. If set to `True`, the function will not generate</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a><span class="sd">    files for the entire database. If set to, defaults to False</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a><span class="sd">    :type not_generate_files_all: bool (optional)</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a><span class="sd">    :param genomes_folder: The `genomes_folder` parameter specifies the folder where the genome files</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a><span class="sd">    are located. It is a string that represents the path to the folder containing genome assemblies</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a><span class="sd">    :param add_info: The `add_info` parameter in the `databases_download_dbnsfp` function is a boolean</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a><span class="sd">    flag that determines whether to include an &quot;INFO&quot; column in the Parquet folder/file. If set to</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a><span class="sd">    `True`, the function will add an INFO column to the generated Parquet files. This INFO, defaults to</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a><span class="sd">    False</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a><span class="sd">    :type add_info: bool (optional)</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a><span class="sd">    :param only_info: The `only_info` parameter in the `databases_download_dbnsfp` function is a boolean</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a><span class="sd">    flag that, when set to `True`, indicates that only the &quot;INFO&quot; column should be included in the</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a><span class="sd">    output. This parameter is used to control whether to include only the &quot;INFO&quot; column in, defaults to</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="sd">    False</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="sd">    :type only_info: bool (optional)</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="sd">    :param row_group_size: The `row_group_size` parameter specifies the row group size to generate the</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a><span class="sd">    Parquet folder and file. It is used to control the size of row groups in the Parquet file. This</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a><span class="sd">    parameter affects the organization of data within the Parquet file and can impact performance and</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="sd">    memory usage during processing. The, defaults to 100000</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="sd">    :type row_group_size: int (optional)</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">    :param uniquify: The `uniquify` parameter in the `databases_download_dbnsfp` function is a boolean</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">    flag that determines whether to generate unique values for each annotation in the Parquet file. When</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">    set to `True`, the function will ensure that each annotation column contains only unique values.</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">    This can be, defaults to False</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">    :type uniquify: bool (optional)</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">    :return: The function `databases_download_dbnsfp` returns a boolean value indicating whether the</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">    process of downloading and processing dbNSFP databases for specified genome assemblies was</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">    successful or not.</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>    <span class="k">def</span> <span class="nf">get_database_files</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a><span class="sd">        The function `get_database_files` returns a list of database files that match a given pattern,</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">        sorted by file size in descending order.</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a><span class="sd">        :param pattern: The pattern parameter is a string that represents the file pattern to search</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="sd">        for. It can include wildcards such as &quot;*&quot;, which matches any number of characters, and &quot;?&quot;,</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">        which matches any single character. The pattern is used to search for files in a specific</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a><span class="sd">        directory or directories</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a><span class="sd">        :type pattern: str</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a><span class="sd">        :return: a list of database files that match the given pattern.</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        <span class="n">database_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="k">return</span> <span class="n">database_files</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>    <span class="k">def</span> <span class="nf">get_columns_structure</span><span class="p">(</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>        <span class="n">database_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a><span class="sd">        The `get_columns_structure` function retrieves the column structure of a database file by</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">        creating a view and analyzing a sample of rows, returning a dictionary with column names and</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">        data types.</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">        :param database_file: The `database_file` parameter is a string that represents the path to the</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">        database file from which you want to retrieve the column structure. It should be a valid file</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a><span class="sd">        path pointing to the database file you want to analyze</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a><span class="sd">        :type database_file: str</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">        :param sample_size: The `sample_size` parameter in the `get_columns_structure` function</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a><span class="sd">        specifies the number of rows to sample from the database file in order to determine the</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a><span class="sd">        structure of the columns. By default, it is set to 1,000,000. This means that the function will</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="sd">        read a sample of, defaults to 1000000</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">        :type sample_size: int (optional)</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="sd">        :param threads: The `threads` parameter in the `get_columns_structure` function specifies the</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="sd">        number of threads to use for parallel processing. Increasing the number of threads can</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="sd">        potentially speed up the execution time of the function, especially if there are multiple cores</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a><span class="sd">        available on the machine. By default, this parameter is set to, defaults to 1</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a><span class="sd">        :type threads: int (optional)</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a><span class="sd">        :return: The `get_columns_structure` function returns a dictionary named `columns_structure`</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a><span class="sd">        which contains the column names and their corresponding data types from the database file.</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>        <span class="c1"># Check columns structure</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure...&quot;</span><span class="p">)</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>        <span class="c1"># Connexion for structure</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>        <span class="n">db_structure</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>        <span class="c1"># Create view and retrive structure</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="s2">            CREATE TABLE view_for_structure AS</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="s2">                (</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a><span class="s2">                    SELECT *</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a><span class="s2">                    FROM read_csv_auto(&#39;</span><span class="si">{</span><span class="n">database_file</span><span class="si">}</span><span class="s2">&#39;, compression=gzip, ALL_VARCHAR=0, delim=&#39;</span><span class="se">\t</span><span class="s2">&#39;, nullstr=&#39;.&#39;, sample_size=</span><span class="si">{</span><span class="n">sample_size</span><span class="si">}</span><span class="s2">)</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a><span class="s2">                    LIMIT </span><span class="si">{</span><span class="n">sample_size</span><span class="si">}</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a><span class="s2">                )</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Create view...&quot;</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>        <span class="p">)</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>        <span class="n">db_structure</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>        <span class="c1"># Retrieve structure</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Retrieve database structure...&quot;</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>        <span class="p">)</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>        <span class="n">res_structure</span> <span class="o">=</span> <span class="n">db_structure</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;PRAGMA table_info(&#39;view_for_structure&#39;);&quot;</span><span class="p">)</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>        <span class="c1"># Constructure structure dict</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>        <span class="n">columns_structure</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DB&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;Number&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>        <span class="c1"># Determine type for duckDB</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Construct DB structure dict...&quot;</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>        <span class="p">)</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">res_structure</span><span class="o">.</span><span class="n">df</span><span class="p">()</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>            <span class="n">column_name</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>            <span class="n">data_type</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>            <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">][</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>        <span class="c1"># Determine type for VCF</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Construct VCF structure dict (Type and Number)...&quot;</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="p">)</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]:</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="n">db_structure</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; FROM view_for_structure;&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>            <span class="c1"># Type</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>            <span class="n">column_type</span> <span class="o">=</span> <span class="n">determine_column_types</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="n">column</span><span class="p">]))</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>            <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_type</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>            <span class="c1"># Number</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>            <span class="n">column_number</span> <span class="o">=</span> <span class="n">determine_column_number</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="n">column</span><span class="p">]))</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>            <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;Number&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_number</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>        <span class="c1"># Log</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">columns_structure</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns found&quot;</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>        <span class="p">)</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>        <span class="n">db_structure</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - No database structure found&quot;</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>            <span class="p">)</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - No database structure found&quot;</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>            <span class="p">)</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Database structure generated&quot;</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>            <span class="p">)</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>        <span class="k">return</span> <span class="n">columns_structure</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>    <span class="k">def</span> <span class="nf">clean_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a><span class="sd">        The clean_name function replaces hyphens and plus signs in a string with underscores.</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a><span class="sd">        :param name: The `name` parameter is a string that represents a name</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a><span class="sd">        :type name: str</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a><span class="sd">        :return: The function `clean_name` returns a string.</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>        <span class="n">mapping_table</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">({</span><span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span><span class="p">})</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mapping_table</span><span class="p">)</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>    <span class="k">def</span> <span class="nf">get_columns_select_clause</span><span class="p">(</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>        <span class="n">columns_structure</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>        <span class="n">assembly</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hg19&quot;</span><span class="p">,</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>        <span class="n">for_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>        <span class="n">sub_database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>        <span class="n">null_if_no_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>        <span class="n">print_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>        <span class="n">add_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>        <span class="n">only_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>        <span class="n">uniquify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a><span class="sd">        The `get_columns_select_clause` function generates SELECT and WHERE clauses for a SQL query</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a><span class="sd">        based on input columns structure, assembly, sub-database, and other optional parameters.</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a><span class="sd">        :param columns_structure: The `columns_structure` parameter is a dictionary that represents the</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a><span class="sd">        structure of the columns. Each key in the dictionary is a column name, and the corresponding</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a><span class="sd">        value is the column type. This parameter provides the information needed to generate the SELECT</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a><span class="sd">        and WHERE clauses for a SQL query based on the specified columns</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a><span class="sd">        :type columns_structure: dict</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a><span class="sd">        :param assembly: The `assembly` parameter specifies the genome assembly version. It can take</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a><span class="sd">        values like &quot;hg19&quot;, &quot;hg38&quot;, or &quot;hg18&quot;. By default, it is set to &quot;hg19&quot;, defaults to hg19</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a><span class="sd">        :type assembly: str (optional)</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a><span class="sd">        :param for_parquet: The `for_parquet` parameter is a boolean flag that determines whether the</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a><span class="sd">        SQL query is being generated for a Parquet file. If `for_parquet` is set to `True`, the function</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a><span class="sd">        will include the position and REF/ALT columns in the SELECT clause, regardless of whether they</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a><span class="sd">        are specified, defaults to False</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a><span class="sd">        :type for_parquet: bool (optional)</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="sd">        :param sub_database: The `sub_database` parameter is an optional parameter that specifies a</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a><span class="sd">        sub-database within the main database. It is used to filter the columns based on the specified</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a><span class="sd">        sub-database. If a sub-database is provided, only columns that belong to that sub-database or</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a><span class="sd">        start with the sub-database</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a><span class="sd">        :type sub_database: str</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a><span class="sd">        :param null_if_no_annotation: The `null_if_no_annotation` parameter in the</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a><span class="sd">        `get_columns_select_clause` function is a boolean parameter that determines whether to return</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a><span class="sd">        null if there are no annotations found. If this parameter is set to `True`, the function will</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a><span class="sd">        return null if there are no annotations found. This parameter helps handle cases, defaults to</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a><span class="sd">        True</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a><span class="sd">        :type null_if_no_annotation: bool (optional)</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a><span class="sd">        :param print_log: The `print_log` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a><span class="sd">        boolean flag that determines whether to enable logging or not. If set to `True`, the function</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a><span class="sd">        will log debug messages during execution. If set to `False`, logging will be disabled. By</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a><span class="sd">        default, this parameter is, defaults to True</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a><span class="sd">        :type print_log: bool (optional)</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a><span class="sd">        :param add_info: The `add_info` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="sd">        boolean flag that determines whether to include an &quot;INFO&quot; column in the Parquet folder/file. If</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">        `add_info` is set to `True`, the function will concatenate and format the selected annotations</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">        into an &quot;INFO, defaults to False</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">        :type add_info: bool (optional)</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">        :param only_info: The `only_info` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">        boolean flag that, when set to `True`, indicates that only the &quot;INFO&quot; column should be included</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a><span class="sd">        in the output. This parameter is used to control whether to include only the &quot;INFO&quot; column in</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a><span class="sd">        the SELECT, defaults to False</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a><span class="sd">        :type only_info: bool (optional)</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a><span class="sd">        :param uniquify: The `uniquify` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="sd">        boolean flag that determines whether to include unique values for each annotation column. When</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a><span class="sd">        set to `True`, the function will ensure that each annotation column contains only unique values.</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a><span class="sd">        This can be useful when you want to avoid, defaults to False</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a><span class="sd">        :type uniquify: bool (optional)</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a><span class="sd">        :return: The `get_columns_select_clause` function returns a dictionary containing the following</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a><span class="sd">        keys and their corresponding values:</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a><span class="sd">        - &quot;select&quot;: A string representing the SELECT clause for a SQL query based on the input columns</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a><span class="sd">        structure, assembly, and other parameters.</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="sd">        - &quot;where&quot;: A string representing the WHERE clause for a SQL query based on the input columns</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">        structure, assembly, and other parameters.</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">        - &quot;annotations&quot;: A dictionary</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>        <span class="c1"># Only INFO</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>        <span class="k">if</span> <span class="n">only_info</span><span class="p">:</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>            <span class="n">add_info</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>        <span class="c1"># Init</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>        <span class="n">columns_select_position</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>        <span class="n">columns_select_ref_alt</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>        <span class="n">columns_select_info</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>        <span class="n">columns_select_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>        <span class="n">columns_where_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>        <span class="n">columns_list_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>        <span class="n">columns_info_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>        <span class="n">variant_position_columns</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>            <span class="s2">&quot;hg38&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>                <span class="s2">&quot;#chr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;chr&quot;</span><span class="p">},</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>                <span class="s2">&quot;pos(1-based)&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BIGINT&quot;</span><span class="p">},</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>            <span class="p">},</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>            <span class="s2">&quot;hg19&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>                <span class="s2">&quot;hg19_chr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;chr&quot;</span><span class="p">},</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>                <span class="s2">&quot;hg19_pos(1-based)&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BIGINT&quot;</span><span class="p">},</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>            <span class="p">},</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>            <span class="s2">&quot;hg18&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>                <span class="s2">&quot;hg18_chr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;chr&quot;</span><span class="p">},</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>                <span class="s2">&quot;hg18_pos(1-based)&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BIGINT&quot;</span><span class="p">},</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>            <span class="p">},</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>        <span class="p">}</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>            <span class="c1"># REF/ALT columns</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>            <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">,</span> <span class="s2">&quot;alt&quot;</span><span class="p">]:</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>                <span class="n">column_alias</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>                <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>                <span class="n">columns_select_ref_alt</span><span class="p">[</span><span class="n">column_key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VARCHAR&quot;</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>            <span class="c1"># Keep assembly position columns</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>            <span class="k">elif</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>                <span class="n">column_prefix</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>                <span class="p">)</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>                <span class="n">column_alias</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alias&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>                <span class="p">)</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>                <span class="n">column_type</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>                <span class="p">)</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>                <span class="k">if</span> <span class="n">column_prefix</span><span class="p">:</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>                    <span class="n">column_prefix_concat</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &#39;</span><span class="si">{</span><span class="n">column_prefix</span><span class="si">}</span><span class="s2">&#39; ||  &quot;&quot;&quot;</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>                    <span class="n">column_prefix_concat</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>                <span class="n">column_key</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span><span class="si">{</span><span class="n">column_prefix_concat</span><span class="si">}</span><span class="s2"> &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>                <span class="p">)</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>                <span class="n">columns_select_position</span><span class="p">[</span><span class="n">column_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_type</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>                <span class="c1"># Force type on structure</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>                <span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>                <span class="p">)</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>                <span class="n">column_to_remove</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>                <span class="c1"># Remove other assemby position columns</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>                <span class="k">for</span> <span class="n">other_assembly</span> <span class="ow">in</span> <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>                        <span class="n">column</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>                        <span class="ow">in</span> <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">other_assembly</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>                    <span class="p">):</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>                        <span class="c1"># Force type on structure</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>                        <span class="n">column_type</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>                            <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">other_assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>                            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>                            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>                        <span class="p">)</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>                        <span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_type</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>                        <span class="n">column_to_remove</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>                <span class="c1"># other columns - annotations</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">column_to_remove</span><span class="p">:</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>                    <span class="n">column_alias</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>                        <span class="n">sub_database</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>                        <span class="ow">or</span> <span class="n">sub_database</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ALL&quot;</span><span class="p">]</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>                        <span class="ow">or</span> <span class="n">column</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">sub_database</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>                        <span class="ow">or</span> <span class="n">column_alias</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">)</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>                    <span class="p">):</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>                        <span class="k">if</span> <span class="n">for_parquet</span><span class="p">:</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>                            <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>                            <span class="n">column_where</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL &quot;&quot;&quot;</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>                            <span class="n">column_info_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a><span class="s2">                                CASE</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a><span class="s2">                                    WHEN &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a><span class="s2">                                    THEN </span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a><span class="s2">                                        concat(</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a><span class="s2">                                            &#39;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">=&#39;,</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a><span class="s2">                                            replace(CAST(&quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;),</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a><span class="s2">                                            &#39;;&#39;</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a><span class="s2">                                        )</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a><span class="s2">                                    ELSE &#39;&#39;</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a><span class="s2">                                END</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>                            <span class="k">if</span> <span class="n">uniquify</span><span class="p">:</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>                                <span class="c1"># columns for each annotation</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>                                <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a><span class="s2">                                    list_aggregate(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;)), &#39;string_agg&#39;, &#39;,&#39;)::</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="si">}</span><span class="s2"> AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>                                <span class="c1"># columns for INFO clumn</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>                                <span class="n">column_info_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a><span class="s2">                                    CASE</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="s2">                                        WHEN len(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;))) &gt; 0</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="s2">                                        THEN </span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a><span class="s2">                                            concat(</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a><span class="s2">                                                &#39;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">=&#39;,</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a><span class="s2">                                                list_aggregate(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;)), &#39;string_agg&#39;, &#39;,&#39;),</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a><span class="s2">                                                &#39;;&#39;</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a><span class="s2">                                            )</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a><span class="s2">                                        ELSE &#39;&#39;</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a><span class="s2">                                    END</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>                                <span class="c1"># columns for each annotation</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>                                <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a><span class="s2">                                    replace(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;)::</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="si">}</span><span class="s2"> AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>                                <span class="c1"># columns for INFO clumn</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>                                <span class="n">column_info_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a><span class="s2">                                    CASE</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a><span class="s2">                                        WHEN len(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;))) &gt; 0</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a><span class="s2">                                        THEN </span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a><span class="s2">                                            concat(</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a><span class="s2">                                                &#39;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">=&#39;,</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a><span class="s2">                                                replace(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;),</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a><span class="s2">                                                &#39;;&#39;</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a><span class="s2">                                            )</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a><span class="s2">                                        ELSE &#39;&#39;</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a><span class="s2">                                    END</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>                            <span class="n">column_where</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL &quot;&quot;&quot;</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>                        <span class="n">columns_info_annotations</span><span class="p">[</span><span class="n">column_info_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>                        <span class="n">columns_select_annotations</span><span class="p">[</span><span class="n">column_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>                            <span class="n">column</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>                        <span class="p">]</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>                        <span class="n">columns_where_annotations</span><span class="p">[</span><span class="n">column_where</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>                            <span class="n">column</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>                        <span class="p">]</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>                        <span class="n">columns_list_annotations</span><span class="p">[</span><span class="n">column_alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>                            <span class="n">column</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>                        <span class="p">]</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>        <span class="c1"># Force position and ref/alt if parquet</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>        <span class="k">if</span> <span class="n">for_parquet</span><span class="p">:</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>            <span class="n">columns_select_position</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&quot;#CHROM&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;POS&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">}</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>            <span class="n">columns_select_ref_alt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&quot;REF&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;REF&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;ALT&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;ALT&quot;</span><span class="p">}</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>        <span class="c1"># Add INFO</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>        <span class="k">if</span> <span class="n">add_info</span><span class="p">:</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>            <span class="n">info_concat</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a><span class="s2">                regexp_replace(</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a><span class="s2">                    replace(</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a><span class="s2">                        concat(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">columns_info_annotations</span><span class="p">))</span><span class="si">}</span><span class="s2">),</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a><span class="s2">                        &#39;&quot;&#39;, &#39;&#39;),</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a><span class="s2">                    &#39;;$&#39;, &#39;&#39;)</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a><span class="s2">                AS &quot;INFO&quot;</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>            <span class="n">columns_select_info</span><span class="p">[</span><span class="n">info_concat</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>            <span class="n">columns_list_annotations</span><span class="p">[</span><span class="s2">&quot;INFO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VARCHAR&quot;</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>            <span class="k">if</span> <span class="n">only_info</span><span class="p">:</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>                <span class="n">columns_select_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">info_concat</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">}</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>        <span class="c1"># Create select clause</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>        <span class="n">columns_select</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_position</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_ref_alt</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>        <span class="p">)</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>        <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns_select</span><span class="p">)</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>        <span class="c1"># Create where clause</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>        <span class="n">columns_where</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_where_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>        <span class="n">columns_where_clause</span> <span class="o">=</span> <span class="s2">&quot; OR &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns_where</span><span class="p">)</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>        <span class="c1"># log</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>        <span class="k">if</span> <span class="n">print_log</span><span class="p">:</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Check database structure - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">columns_select_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="si">}</span><span class="s2"> annotations found&quot;&quot;&quot;</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>            <span class="p">)</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>        <span class="c1"># If no annotation found (usually for sub_database ref, alt, pos...)</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>        <span class="k">if</span> <span class="n">null_if_no_annotation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">columns_select_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>            <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>        <span class="c1"># Create output</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>        <span class="n">clauses</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>            <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="n">columns_select_clause</span><span class="p">,</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>            <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">columns_where_clause</span><span class="p">,</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>            <span class="s2">&quot;annotations&quot;</span><span class="p">:</span> <span class="n">columns_list_annotations</span><span class="p">,</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>        <span class="p">}</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>        <span class="k">return</span> <span class="n">clauses</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>    <span class="k">def</span> <span class="nf">get_annotation_description</span><span class="p">(</span><span class="n">readme</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a><span class="sd">        The function `get_annotation_description` reads a README file and extracts annotation</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a><span class="sd">        descriptions from it, storing them in a dictionary.</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a><span class="sd">        :param readme: The `readme` parameter is a string that represents the file path to a README</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a><span class="sd">        file. This function reads the contents of the README file and extracts information about</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a><span class="sd">        annotation descriptions</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a><span class="sd">        :type readme: str</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">readme</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>        <span class="n">line_in_variant</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>        <span class="n">annotation_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Columns of dbNSFP_variant&quot;</span><span class="p">):</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>                <span class="n">line_in_variant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>                <span class="n">line_in_variant</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>            <span class="k">elif</span> <span class="n">line_in_variant</span><span class="p">:</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>                <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>                <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>                    <span class="n">line_name</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>                    <span class="n">line_desc</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>                    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>                        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>                        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>                    <span class="n">line_desc</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">sep</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>                <span class="n">annotation_dict</span><span class="p">[</span><span class="n">line_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_desc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>        <span class="k">return</span> <span class="n">annotation_dict</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>    <span class="c1"># Log</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>    <span class="c1"># genomes folder</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>    <span class="c1"># Full path</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>    <span class="c1"># Default refSeq Folder</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dbnsfp_folder</span><span class="p">:</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>        <span class="n">dbnsfp_folder</span> <span class="o">=</span> <span class="n">DEFAULT_DBNSFP_FOLDER</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>    <span class="c1"># Full path</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>    <span class="n">dbnsfp_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">)</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>    <span class="c1"># Default refSeq URL</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dbnsfp_url</span><span class="p">:</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>        <span class="n">dbnsfp_url</span> <span class="o">=</span> <span class="n">DEFAULT_DBNSFP_URL</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">):</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>    <span class="c1"># Files for dbNSFP</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>    <span class="c1"># https://dbnsfp.s3.amazonaws.com/dbNSFP4.4a.zip</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>    <span class="n">dbnsfp_zip</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">.zip&quot;</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>    <span class="n">dbnsfp_readme</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">.readme.txt&quot;</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>    <span class="n">dbnsfp_zip_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbnsfp_url</span><span class="p">,</span> <span class="n">dbnsfp_zip</span><span class="p">)</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>    <span class="n">dbnsfp_zip_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">,</span> <span class="n">dbnsfp_zip</span><span class="p">)</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>    <span class="n">dbnsfp_readme_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">,</span> <span class="n">dbnsfp_readme</span><span class="p">)</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>    <span class="n">dbnsfp_zip_dest_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbnsfp_zip_dest</span><span class="p">)</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>    <span class="c1"># Download dbNSFP</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbnsfp_zip_dest</span><span class="p">):</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>        <span class="n">download_file</span><span class="p">(</span><span class="n">dbnsfp_zip_url</span><span class="p">,</span> <span class="n">dbnsfp_zip_dest</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>        <span class="p">)</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>    <span class="c1"># Extract dbNSFP</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbnsfp_readme_dest</span><span class="p">):</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Extract &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>        <span class="n">extract_file</span><span class="p">(</span><span class="n">dbnsfp_zip_dest</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39; already extracted&quot;</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>        <span class="p">)</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>        <span class="n">header_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>        <span class="n">dbnsfp_readme_dest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>        <span class="n">columns_structure</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>        <span class="n">annotations</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>        <span class="n">readme_annotations_description</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a><span class="sd">        The function `get_header` generates a VCF header based on provided annotations and writes it to</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a><span class="sd">        a file.</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a><span class="sd">        :param header_file: The path to the output file where the VCF header will be written</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a><span class="sd">        :type header_file: str</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a><span class="sd">        :param dbnsfp_readme_dest: The `dbnsfp_readme_dest` parameter is a string that represents the</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a><span class="sd">        destination file path for the dbNSFP readme file. This file contains the description of the</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a><span class="sd">        annotations present in the dbNSFP database</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a><span class="sd">        :type dbnsfp_readme_dest: str</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a><span class="sd">        :param columns_structure: The `columns_structure` parameter is a dictionary that maps annotation</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a><span class="sd">        names to their corresponding column types in a database. The keys of the dictionary are the</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a><span class="sd">        annotation names, and the values are the column types</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a><span class="sd">        :type columns_structure: dict</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a><span class="sd">        :param annotations: The `annotations` parameter is a list of strings that represents the</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a><span class="sd">        annotations to be included in the VCF header</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a><span class="sd">        :type annotations: list</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a><span class="sd">        :return: a boolean value indicating whether the header file was successfully created.</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>        <span class="c1"># Full path</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>        <span class="n">header_file</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">header_file</span><span class="p">)</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>        <span class="c1"># Default VCF header</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>        <span class="n">default_header_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>            <span class="s2">&quot;##fileformat=VCFv4.2&quot;</span><span class="p">,</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>            <span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">POS</span><span class="se">\t</span><span class="s2">REF</span><span class="se">\t</span><span class="s2">ALT</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotations</span><span class="p">),</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>        <span class="p">]</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>        <span class="n">header_vcf</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_header_list</span><span class="p">)))</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>        <span class="n">code_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Integer&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;String&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Float&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Flag&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>        <span class="n">code_type_map_from_sql</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>            <span class="s2">&quot;BIGINT&quot;</span><span class="p">:</span> <span class="s2">&quot;Integer&quot;</span><span class="p">,</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>            <span class="s2">&quot;VARCHAR&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>            <span class="s2">&quot;DOUBLE&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span><span class="p">,</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>            <span class="s2">&quot;BOOLEAN&quot;</span><span class="p">:</span> <span class="s2">&quot;Integer&quot;</span><span class="p">,</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>        <span class="p">}</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>        <span class="c1"># Extract annotation description</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>            <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="n">get_annotation_description</span><span class="p">(</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>                <span class="n">dbnsfp_readme_dest</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>            <span class="p">)</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>        <span class="c1"># Number of annotations</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>        <span class="c1"># log.debug(f&quot;&quot;&quot;{len(readme_annotations_description)} annotations found &quot;&quot;&quot;)</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>        <span class="c1"># Add annotations to header</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>        <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>            <span class="n">annotation_name</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>            <span class="k">if</span> <span class="n">annotation_name</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>                <span class="n">vcf_header_infos_number</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Number&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>                    <span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>                <span class="p">)</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>                <span class="n">vcf_header_infos_type</span> <span class="o">=</span> <span class="n">code_type_map_from_sql</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>                    <span class="n">columns_structure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">),</span> <span class="s2">&quot;String&quot;</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>                <span class="p">)</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>                <span class="n">vcf_header_infos_description</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>                    <span class="n">readme_annotations_description</span><span class="p">[</span><span class="n">annotation</span><span class="p">]</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; [dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>                <span class="p">)</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>                <span class="n">vcf_header_infos_source</span> <span class="o">=</span> <span class="n">dbnsfp_release</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>                <span class="n">vcf_header_infos_version</span> <span class="o">=</span> <span class="n">dbnsfp_release</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>                <span class="n">header_vcf</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_Info</span><span class="p">(</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>                    <span class="n">annotation_name</span><span class="p">,</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>                    <span class="n">vcf_header_infos_number</span><span class="p">,</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>                    <span class="n">vcf_header_infos_type</span><span class="p">,</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>                    <span class="n">vcf_header_infos_description</span><span class="p">,</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>                    <span class="n">vcf_header_infos_source</span><span class="p">,</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>                    <span class="n">vcf_header_infos_version</span><span class="p">,</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>                    <span class="n">code_type_map</span><span class="p">[</span><span class="n">vcf_header_infos_type</span><span class="p">],</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>                <span class="p">)</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>        <span class="n">vcf</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">header_vcf</span><span class="p">)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">header_file</span><span class="p">)</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>    <span class="k">def</span> <span class="nf">size_to_mb</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a><span class="sd">        The function `size_to_mb` converts a given size in megabytes to bytes.</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a><span class="sd">        :param size: The size parameter represents the size of a partition in megabytes</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a><span class="sd">        :type size: int</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a><span class="sd">        :return: the partition size in megabytes as an integer.</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>        <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>            <span class="n">byte</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>            <span class="n">kilobytes</span> <span class="o">=</span> <span class="n">byte</span> <span class="o">*</span> <span class="mi">1024</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>            <span class="n">megabytes</span> <span class="o">=</span> <span class="n">kilobytes</span> <span class="o">*</span> <span class="mi">1024</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="n">megabytes</span><span class="p">)</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>    <span class="c1"># Init</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>    <span class="n">partition_size</span> <span class="o">=</span> <span class="n">size_to_mb</span><span class="p">(</span><span class="n">parquet_size</span><span class="p">)</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>    <span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000000</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>    <span class="n">database_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>    <span class="n">columns_structure</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>    <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">threads</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>        <span class="n">threads</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>    <span class="n">threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>    <span class="c1"># Create duckdb connexion</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>    <span class="n">db</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>    <span class="n">parquet_partition_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>    <span class="n">parquet_partition_already_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>    <span class="n">parquet_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>    <span class="n">parquet_already_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>    <span class="n">vcf_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>    <span class="n">vcf_already_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>        <span class="n">output_assembly</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_assembly</span><span class="p">):</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet folder already exists&quot;</span><span class="p">)</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>            <span class="k">continue</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>            <span class="c1"># Create output chromosome</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">output_assembly</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>        <span class="c1"># Check database files</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files...&quot;</span><span class="p">)</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>        <span class="n">database_files</span> <span class="o">=</span> <span class="n">get_database_files</span><span class="p">(</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_zip_dest_folder</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">_variant.chr*.gz&quot;</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>        <span class="p">)</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">database_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files&quot;</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>        <span class="p">)</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">database_files</span><span class="p">:</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files - No files found&quot;</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>            <span class="p">)</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files - No files found&quot;</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>            <span class="p">)</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>        <span class="c1"># Database structure</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>            <span class="n">columns_structure</span> <span class="o">=</span> <span class="n">get_columns_structure</span><span class="p">(</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>                <span class="n">database_file</span><span class="o">=</span><span class="n">database_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>                <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>            <span class="p">)</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>        <span class="c1"># Output prefix</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>        <span class="n">output_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>        <span class="c1"># Sub database</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>        <span class="n">sub_database</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>        <span class="c1"># Create clauses (select and where)</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>        <span class="n">columns_clauses</span> <span class="o">=</span> <span class="n">get_columns_select_clause</span><span class="p">(</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>            <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">],</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>            <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>            <span class="n">sub_database</span><span class="o">=</span><span class="n">sub_database</span><span class="p">,</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>            <span class="n">add_info</span><span class="o">=</span><span class="n">add_info</span><span class="p">,</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>            <span class="n">only_info</span><span class="o">=</span><span class="n">only_info</span><span class="p">,</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>            <span class="n">uniquify</span><span class="o">=</span><span class="n">uniquify</span><span class="p">,</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>        <span class="p">)</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>        <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">)</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>        <span class="n">columns_annotations</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">)</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>        <span class="c1"># If clause select not empty</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>        <span class="k">if</span> <span class="n">columns_select_clause</span><span class="p">:</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet folder generation&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>            <span class="c1"># Process database files</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>            <span class="k">for</span> <span class="n">database_file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>                <span class="n">database_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>            <span class="p">):</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;&quot;&quot;</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>                <span class="p">)</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>                <span class="c1"># Chromosome</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Check chomosome...&quot;&quot;&quot;</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>                <span class="p">)</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a><span class="s2">                            SELECT &quot;#chr&quot;</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a><span class="s2">                            FROM read_csv_auto(&#39;</span><span class="si">{</span><span class="n">database_file</span><span class="si">}</span><span class="s2">&#39;, compression=gzip, ALL_VARCHAR=1, delim=&#39;</span><span class="se">\t</span><span class="s2">&#39;, nullstr=&#39;.&#39;, SAMPLE_SIZE=10)</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a><span class="s2">                            WHERE </span><span class="se">\&quot;</span><span class="s2">#chr</span><span class="se">\&quot;</span><span class="s2"> IS NOT NULL</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a><span class="s2">                            LIMIT 1</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>                <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>                <span class="n">chromosome</span> <span class="o">=</span> <span class="s2">&quot;chr&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;#chr&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Found chromosome &#39;</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>                <span class="p">)</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>                <span class="c1"># Output</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.partition.parquet&quot;</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>                    <span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>                <span class="n">output_parquet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;#CHROM=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>                <span class="c1"># Query</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a><span class="s2">                        COPY (</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a><span class="s2">                            SELECT </span><span class="si">{</span><span class="n">columns_select_clause</span><span class="si">}</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a><span class="s2">                            FROM read_csv_auto(</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a><span class="s2">                                &#39;</span><span class="si">{</span><span class="n">database_file</span><span class="si">}</span><span class="s2">&#39;,</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a><span class="s2">                                header=1,</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a><span class="s2">                                delim=&#39;</span><span class="se">\t</span><span class="s2">&#39;,</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a><span class="s2">                                compression=gzip,</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a><span class="s2">                                nullstr=&#39;.&#39;,</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a><span class="s2">                                columns=</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a><span class="s2">                                types=</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]</span><span class="si">}</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a><span class="s2">                                )</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a><span class="s2">                            WHERE </span><span class="se">\&quot;</span><span class="s2">#CHROM</span><span class="se">\&quot;</span><span class="s2"> IS NOT NULL</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a><span class="s2">                            )</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a><span class="s2">                        TO &#39;</span><span class="si">{</span><span class="n">output_parquet</span><span class="si">}</span><span class="s2">&#39; WITH (FORMAT PARQUET, PER_THREAD_OUTPUT TRUE, ROW_GROUP_SIZE </span><span class="si">{</span><span class="n">row_group_size</span><span class="si">}</span><span class="s2">)</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>                <span class="c1"># Log</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Write parquet files...&quot;&quot;&quot;</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>                <span class="p">)</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_parquet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Parquet file already exists&quot;&quot;&quot;</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>                    <span class="p">)</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>                    <span class="c1"># Query</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>                    <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>                    <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>                    <span class="n">db_copy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>                    <span class="c1"># # Split parquet to max size</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a>                    <span class="k">if</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Split parquet files...&quot;&quot;&quot;</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>                        <span class="p">)</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a>                        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">):</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>                            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>                            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>                            <span class="n">file_base</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Split parquet files [&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;]...&quot;&quot;&quot;</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>                            <span class="p">)</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>                            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>                                <span class="n">schema</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">schema_arrow</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>                                <span class="n">dd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a>                                    <span class="n">partition_size</span><span class="o">=</span><span class="n">partition_size</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>                                <span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a>                                    <span class="n">output_parquet</span><span class="p">,</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>                                    <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>                                    <span class="n">name_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_base</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">,</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>                                <span class="p">)</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>                                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>                                <span class="n">new_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>                                    <span class="n">output_parquet</span><span class="p">,</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>                                    <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;-0.parquet&quot;</span><span class="p">),</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>                                <span class="p">)</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>                                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_file_name</span><span class="p">)</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>                    <span class="c1"># Log</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Write parquet file - done.&quot;&quot;&quot;</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>                    <span class="p">)</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>            <span class="c1"># Header</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>            <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">header_file</span><span class="p">):</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>                    <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="n">get_annotation_description</span><span class="p">(</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>                        <span class="n">dbnsfp_readme_dest</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>                    <span class="p">)</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>                <span class="k">if</span> <span class="n">get_header</span><span class="p">(</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>                    <span class="n">header_file</span><span class="o">=</span><span class="n">header_file</span><span class="p">,</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>                    <span class="n">dbnsfp_readme_dest</span><span class="o">=</span><span class="n">dbnsfp_readme_dest</span><span class="p">,</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>                    <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">,</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>                    <span class="n">annotations</span><span class="o">=</span><span class="n">columns_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>                    <span class="n">readme_annotations_description</span><span class="o">=</span><span class="n">readme_annotations_description</span><span class="p">,</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>                <span class="p">):</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Write header&quot;</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>                    <span class="p">)</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Write header failed&quot;</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>                    <span class="p">)</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Write header failed&quot;</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>                    <span class="p">)</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>    <span class="k">if</span> <span class="n">generate_sub_databases</span><span class="p">:</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet folders generation&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>        <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>            <span class="c1"># Find database structure</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">database_files</span><span class="p">:</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>                <span class="n">database_files</span> <span class="o">=</span> <span class="n">get_database_files</span><span class="p">(</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_zip_dest_folder</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">_variant.chr*.gz&quot;</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>                <span class="p">)</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">database_files</span><span class="p">):</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>                <span class="n">columns_structure</span> <span class="o">=</span> <span class="n">get_columns_structure</span><span class="p">(</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>                    <span class="n">database_file</span><span class="o">=</span><span class="n">database_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>                    <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>                <span class="p">)</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>                <span class="c1"># columns_structure_vcf = get_columns_structure(</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>                <span class="c1">#     database_file=database_files[0],</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>                <span class="c1">#     sample_size=sample_size,</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>                <span class="c1">#     threads=threads,</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>                <span class="c1">#     output_type=&quot;VCF&quot;,</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>                <span class="c1"># )</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>            <span class="n">output_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>            <span class="n">parquet_all_annotation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.ALL.partition.parquet/*/*.parquet&quot;</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>            <span class="p">)</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>            <span class="n">sub_databases_structure</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>            <span class="c1"># Find sub databases</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]:</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>                <span class="n">sub_database</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>                <span class="k">if</span> <span class="n">sub_database</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sub_databases_structure</span><span class="p">:</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>                    <span class="n">sub_databases_structure</span><span class="p">[</span><span class="n">sub_database</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>                <span class="n">sub_databases_structure</span><span class="p">[</span><span class="n">sub_database</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">][</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>                    <span class="n">column</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>                <span class="p">]</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>            <span class="c1"># Chromosomes</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>            <span class="n">chromosomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>            <span class="c1"># for each sub database</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>            <span class="k">for</span> <span class="n">sub_database</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">sub_databases_structure</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a>            <span class="p">):</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>                <span class="c1"># Clauses</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>                <span class="n">columns_clauses</span> <span class="o">=</span> <span class="n">get_columns_select_clause</span><span class="p">(</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>                    <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">],</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>                    <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>                    <span class="n">for_parquet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>                    <span class="n">sub_database</span><span class="o">=</span><span class="n">sub_database</span><span class="p">,</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>                    <span class="n">null_if_no_annotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>                    <span class="n">print_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>                    <span class="n">add_info</span><span class="o">=</span><span class="n">add_info</span><span class="p">,</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>                    <span class="n">only_info</span><span class="o">=</span><span class="n">only_info</span><span class="p">,</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>                    <span class="n">uniquify</span><span class="o">=</span><span class="n">uniquify</span><span class="p">,</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>                <span class="p">)</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>                <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">)</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>                <span class="n">columns_where_clause</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;where&quot;</span><span class="p">)</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>                <span class="n">columns_annotations</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">)</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a>                <span class="c1"># Clean sub database name</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>                <span class="n">sub_database_name</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>                <span class="c1"># Parquet folder</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>                <span class="n">parquet_sub_database_annotation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">.partition.parquet&quot;</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>                <span class="p">)</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>                <span class="k">if</span> <span class="n">columns_select_clause</span><span class="p">:</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>                    <span class="c1"># Parquet Folder</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parquet_sub_database_annotation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder already exists&quot;&quot;&quot;</span>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a>                        <span class="p">)</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a>                        <span class="n">parquet_partition_already_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder...&quot;&quot;&quot;</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>                        <span class="p">)</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>                        <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a>                            <span class="n">query_chromosomes</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a><span class="s2">                                SELECT distinct &quot;#CHROM&quot;</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="s2">                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_all_annotation</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a>                            <span class="n">res</span> <span class="o">=</span> <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a>                            <span class="n">chromosomes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;#CHROM&quot;</span><span class="p">]))</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>                        <span class="c1"># Generate folder by chromosome</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a>                        <span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>                            <span class="n">parquet_sub_database_annotation_chromosome</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>                                <span class="n">parquet_sub_database_annotation</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;#CHROM=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>                            <span class="p">)</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>                            <span class="n">Path</span><span class="p">(</span><span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>                                <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>                            <span class="p">)</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>                            <span class="n">query_copy</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a><span class="s2">                                COPY (</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a><span class="s2">                                    SELECT </span><span class="si">{</span><span class="n">columns_select_clause</span><span class="si">}</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a><span class="s2">                                        FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_all_annotation</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a><span class="s2">                                        WHERE &quot;#CHROM&quot; in (&#39;</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a><span class="s2">                                            AND (</span><span class="si">{</span><span class="n">columns_where_clause</span><span class="si">}</span><span class="s2">)</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a><span class="s2">                                    )</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a><span class="s2">                                TO &#39;</span><span class="si">{</span><span class="n">parquet_sub_database_annotation_chromosome</span><span class="si">}</span><span class="s2">&#39; WITH (FORMAT PARQUET, PER_THREAD_OUTPUT TRUE, ROW_GROUP_SIZE </span><span class="si">{</span><span class="n">row_group_size</span><span class="si">}</span><span class="s2">)</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>                            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_copy</span><span class="p">)</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>                            <span class="c1"># Split parquet to max size</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>                            <span class="k">if</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>                                <span class="c1"># log.debug(f&quot;&quot;&quot;Download dbNSFP [&#39;{assembly}&#39;] - Database &#39;{sub_database}&#39; - Parquet folder [&#39;{sub_database_name}&#39;] generation - Split parquet files...&quot;&quot;&quot;)</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>                                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>                                    <span class="n">parquet_sub_database_annotation_chromosome</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>                                <span class="p">):</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Split parquet files [&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;]...&quot;&quot;&quot;</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>                                    <span class="p">)</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>                                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>                                        <span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">,</span> <span class="n">file</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>                                    <span class="p">)</span>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>                                    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>                                    <span class="n">file_base</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>                                    <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>                                        <span class="n">schema</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">schema_arrow</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>                                        <span class="n">dd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>                                            <span class="n">partition_size</span><span class="o">=</span><span class="n">partition_size</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>                                        <span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>                                            <span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">,</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>                                            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>                                            <span class="n">name_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_base</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">,</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>                                        <span class="p">)</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>                                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>                                        <span class="n">new_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>                                            <span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">,</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>                                            <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;-0.parquet&quot;</span><span class="p">),</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>                                        <span class="p">)</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>                                        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_file_name</span><span class="p">)</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>                        <span class="n">db_copy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>                        <span class="n">parquet_partition_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - done.&quot;&quot;&quot;</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>                        <span class="p">)</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a>                    <span class="c1"># Header</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a>                    <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parquet_sub_database_annotation</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">header_file</span><span class="p">):</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>                            <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="n">get_annotation_description</span><span class="p">(</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>                                <span class="n">dbnsfp_readme_dest</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>                            <span class="p">)</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>                        <span class="k">if</span> <span class="n">get_header</span><span class="p">(</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>                            <span class="n">header_file</span><span class="o">=</span><span class="n">header_file</span><span class="p">,</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>                            <span class="n">dbnsfp_readme_dest</span><span class="o">=</span><span class="n">dbnsfp_readme_dest</span><span class="p">,</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>                            <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">,</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>                            <span class="n">annotations</span><span class="o">=</span><span class="n">columns_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>                            <span class="n">readme_annotations_description</span><span class="o">=</span><span class="n">readme_annotations_description</span><span class="p">,</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>                        <span class="p">):</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Write header&quot;</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>                            <span class="p">)</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Write header&quot;</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>                            <span class="p">)</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Write header&quot;</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>                            <span class="p">)</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a>    <span class="c1"># Full DB</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a>    <span class="k">if</span> <span class="n">generate_parquet_file</span> <span class="ow">or</span> <span class="n">generate_vcf_file</span><span class="p">:</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a>        <span class="c1"># Init</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a>        <span class="n">genomes_sizes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a>        <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">)</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet/VCF files generation&quot;</span><span class="p">)</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>            <span class="n">output_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>            <span class="n">partition_parquet_folder_all</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.ALL.partition.parquet&quot;</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>            <span class="n">partition_parquet_folders</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>                <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.*.partition.parquet&quot;</span><span class="p">),</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>                <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a>            <span class="p">)</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a>            <span class="k">if</span> <span class="n">partition_parquet_folders</span><span class="p">:</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a>                <span class="n">partition_parquet_folders</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">partition_parquet_folder_all</span><span class="p">)</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>            <span class="k">for</span> <span class="n">partition_parquet_folder</span> <span class="ow">in</span> <span class="p">[</span><span class="n">partition_parquet_folder_all</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>                <span class="n">partition_parquet_folders</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>            <span class="p">):</span>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>                <span class="c1"># sub database</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>                <span class="n">sub_database</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">partition_parquet_folder</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>                <span class="c1"># Input Parquet folder</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>                <span class="n">input_partition_parquet</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.partition.parquet&quot;</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>                <span class="p">)</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>                <span class="n">input_partition_parquet_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_partition_parquet</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>                <span class="c1"># Input Parquet files</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>                <span class="n">input_parquet_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>                    <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_partition_parquet</span><span class="si">}</span><span class="s2">/*/*parquet&quot;</span><span class="p">),</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>                    <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">,</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>                    <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>                <span class="p">)</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>                <span class="c1"># Skip ALL sub database</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>                <span class="k">if</span> <span class="n">sub_database</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ALL&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">not_generate_files_all</span><span class="p">:</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>                    <span class="k">continue</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>                <span class="c1"># Parquet file</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>                <span class="k">if</span> <span class="n">generate_parquet_file</span><span class="p">:</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>                    <span class="c1"># Output</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>                    <span class="n">output_parquet</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.parquet&quot;</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>                    <span class="n">output_header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_parquet</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>                    <span class="c1"># Parquet file</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">):</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>                        <span class="k">if</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>                            <span class="c1"># Log</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file...&quot;&quot;&quot;</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>                            <span class="p">)</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>                            <span class="c1"># Generate Parquet files</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>                            <span class="c1"># log.debug(pq.ParquetFile(input_parquet_files[0]).schema_arrow)</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>                            <span class="k">with</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetWriter</span><span class="p">(</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>                                <span class="n">output_parquet</span><span class="p">,</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>                                <span class="n">schema</span><span class="o">=</span><span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>                                    <span class="n">input_parquet_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>                                <span class="p">)</span><span class="o">.</span><span class="n">schema_arrow</span><span class="p">,</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>                            <span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>                                <span class="n">chromosome_folder_previous</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>                                <span class="k">for</span> <span class="n">parquet_file</span> <span class="ow">in</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>                                    <span class="n">chromosome_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>                                    <span class="k">if</span> <span class="n">chromosome_folder</span> <span class="o">!=</span> <span class="n">chromosome_folder_previous</span><span class="p">:</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>                                        <span class="n">chromosome_folder_previous</span> <span class="o">=</span> <span class="n">chromosome_folder</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>                                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Process &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">/*&#39; files...&quot;&quot;&quot;</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>                                        <span class="p">)</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Process &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; file...&quot;&quot;&quot;</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>                                    <span class="p">)</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>                                    <span class="c1"># log.debug(pq.ParquetFile(parquet_file).schema_arrow)</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>                                    <span class="n">writer</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>                            <span class="n">parquet_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>                            <span class="p">)</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>                            <span class="p">)</span>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>                        <span class="c1"># Log</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file already generated&quot;&quot;&quot;</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>                        <span class="p">)</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>                        <span class="n">parquet_already_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>                    <span class="c1"># Header</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_header_file</span><span class="p">):</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_partition_parquet_header</span><span class="p">):</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>                            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>                                <span class="n">input_partition_parquet_header</span><span class="p">,</span> <span class="n">output_header_file</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>                            <span class="p">)</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Write header&quot;</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>                            <span class="p">)</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Write header failed&quot;</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>                            <span class="p">)</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Write header failed&quot;</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>                            <span class="p">)</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a>                <span class="k">if</span> <span class="n">generate_vcf_file</span><span class="p">:</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a>                    <span class="c1"># Output VCF</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>                    <span class="n">output_vcf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.vcf.gz&quot;</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>                    <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_vcf</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a>                    <span class="c1"># Chromosome sizes</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_sizes</span><span class="p">:</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>                        <span class="n">genomes_sizes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>                            <span class="n">genomes_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.fa.sizes&quot;</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a>                        <span class="p">)</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">):</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>                                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>                                    <span class="n">genomes_sizes</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>                                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>                                    <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>                            <span class="n">genomes_sizes</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>                    <span class="c1"># VCF file</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">):</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>                        <span class="k">if</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a>                            <span class="c1"># Init</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>                            <span class="n">list_of_queries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>                            <span class="n">list_for_vcf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>                            <span class="c1"># Log</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file...&quot;&quot;&quot;</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>                            <span class="p">)</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a>                            <span class="c1"># Find database structure</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">database_files</span><span class="p">:</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>                                <span class="n">database_files</span> <span class="o">=</span> <span class="n">get_database_files</span><span class="p">(</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_zip_dest_folder</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">_variant.chr*.gz&quot;</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a>                                <span class="p">)</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>                                <span class="n">columns_structure</span> <span class="o">=</span> <span class="n">get_columns_structure</span><span class="p">(</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>                                    <span class="n">database_file</span><span class="o">=</span><span class="n">database_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>                                    <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>                                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>                                <span class="p">)</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>                            <span class="n">columns_clauses</span> <span class="o">=</span> <span class="n">get_columns_select_clause</span><span class="p">(</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>                                <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">],</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>                                <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>                                <span class="n">for_parquet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>                                <span class="n">sub_database</span><span class="o">=</span><span class="n">sub_database</span><span class="p">,</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>                                <span class="n">null_if_no_annotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>                                <span class="n">print_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>                                <span class="n">add_info</span><span class="o">=</span><span class="n">add_info</span><span class="p">,</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>                                <span class="n">only_info</span><span class="o">=</span><span class="n">only_info</span><span class="p">,</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>                                <span class="n">uniquify</span><span class="o">=</span><span class="n">uniquify</span><span class="p">,</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>                            <span class="p">)</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>                            <span class="n">columns_annotations</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">)</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>                            <span class="c1"># Generate columns concat for INFO column</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>                            <span class="n">column_info</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>                            <span class="c1"># INFO column check</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>                            <span class="n">query_info_check</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a><span class="s2">                                    SELECT *</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a><span class="s2">                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">input_parquet_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>                            <span class="n">columns_info_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_info_check</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">())</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>                            <span class="c1"># If INFO column exists</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>                            <span class="k">if</span> <span class="s2">&quot;INFO&quot;</span> <span class="ow">in</span> <span class="n">columns_info_check</span><span class="p">:</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>                                <span class="n">column_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot; &quot;INFO&quot; &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>                                <span class="k">for</span> <span class="n">column_annotation</span> <span class="ow">in</span> <span class="n">columns_annotations</span><span class="p">:</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>                                    <span class="n">column_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a><span class="s2">                                    CASE</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a><span class="s2">                                        WHEN &quot;</span><span class="si">{</span><span class="n">column_annotation</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a><span class="s2">                                        THEN concat(&#39;</span><span class="si">{</span><span class="n">column_annotation</span><span class="si">}</span><span class="s2">=&#39;, replace(CAST(&quot;</span><span class="si">{</span><span class="n">column_annotation</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;), &#39;;&#39;)</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a><span class="s2">                                        ELSE &#39;&#39;</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a><span class="s2">                                    END</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a><span class="s2">                                    &quot;&quot;&quot;</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a>                                    <span class="p">)</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>                            <span class="k">if</span> <span class="n">column_info</span><span class="p">:</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a>                                <span class="c1"># Generate VCF files within tmp folder</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>                                <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">output_assembly</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>                                    <span class="c1"># Init</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a>                                    <span class="n">file_num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a>                                    <span class="c1"># Create duckDB connexion</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>                                    <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>                                        <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">}</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>                                    <span class="p">)</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>                                    <span class="c1"># Set max expression depth for big sub databases (e.g. gnomAD, ALL)</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a>                                    <span class="n">db_copy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET max_expression_depth TO 10000&quot;</span><span class="p">)</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>                                    <span class="c1"># Log</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Check chomosomes and number of variants...&quot;&quot;&quot;</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>                                    <span class="p">)</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>                                    <span class="c1"># Check chomosomes and total number of variants</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>                                    <span class="n">query_chromosomes</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a><span class="s2">                                                SELECT distinct &quot;#CHROM&quot; AS chromosome, count(*) AS nb_variants</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a><span class="s2">                                                FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">input_partition_parquet</span><span class="si">}</span><span class="s2">/*/*parquet&#39;)</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a><span class="s2">                                                GROUP BY &quot;#CHROM&quot;</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a><span class="s2">                                            &quot;&quot;&quot;</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>                                    <span class="n">chromosomes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>                                        <span class="nb">list</span><span class="p">(</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>                                            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>                                                <span class="s2">&quot;chromosome&quot;</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>                                            <span class="p">]</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>                                        <span class="p">)</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>                                    <span class="p">)</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>                                    <span class="n">nb_variants</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>                                        <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>                                            <span class="s2">&quot;nb_variants&quot;</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>                                        <span class="p">]</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>                                    <span class="p">)</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>                                    <span class="c1"># Log</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chromosomes</span><span class="p">)</span><span class="si">}</span><span class="s2"> chromosomes&quot;&quot;&quot;</span>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>                                    <span class="p">)</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Found </span><span class="si">{</span><span class="n">nb_variants</span><span class="si">}</span><span class="s2"> variants&quot;&quot;&quot;</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>                                    <span class="p">)</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Generate files...&quot;&quot;&quot;</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>                                    <span class="p">)</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>                                    <span class="k">for</span> <span class="n">parquet_file</span> <span class="ow">in</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>                                        <span class="c1"># Check number of variant for parquet file</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>                                        <span class="n">query_nb_variants</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a><span class="s2">                                                    SELECT count(*) AS nb_variants</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a><span class="s2">                                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_file</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a><span class="s2">                                                &quot;&quot;&quot;</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>                                        <span class="n">parquet_file_nb_variants</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>                                            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_nb_variants</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>                                                <span class="s2">&quot;nb_variants&quot;</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>                                            <span class="p">]</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a>                                        <span class="p">)</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>                                        <span class="c1"># Log</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>                                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Process &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; file [</span><span class="si">{</span><span class="n">parquet_file_nb_variants</span><span class="si">}</span><span class="s2"> variants]...&quot;&quot;&quot;</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>                                        <span class="p">)</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>                                        <span class="c1"># Query for parquet file</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>                                        <span class="n">file_num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>                                        <span class="n">vcf_file_gz</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>                                            <span class="n">tmp_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;variants.</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>                                        <span class="p">)</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>                                        <span class="n">query_copy</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a><span class="s2">                                                COPY (</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a><span class="s2">                                                    SELECT &quot;#CHROM&quot;, POS, &#39;.&#39; AS ID, REF, ALT, 0 AS QUAL, &#39;PASS&#39; AS FILTER, regexp_replace(replace(concat(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">column_info</span><span class="p">)</span><span class="si">}</span><span class="s2">),&#39;&quot;&#39;, &#39;&#39;), &#39;;$&#39;, &#39;&#39;) AS INFO</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a><span class="s2">                                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_file</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a><span class="s2">                                                    )</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a><span class="s2">                                                TO &#39;</span><span class="si">{</span><span class="n">vcf_file_gz</span><span class="si">}</span><span class="s2">&#39; WITH (FORMAT CSV, DELIM &#39;</span><span class="se">\t</span><span class="s2">&#39;, HEADER 0, QUOTE &#39;&#39;, COMPRESSION &#39;gzip&#39;)</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a><span class="s2">                                                &quot;&quot;&quot;</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>                                        <span class="c1"># Query</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>                                        <span class="n">list_of_queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query_copy</span><span class="p">)</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>                                        <span class="c1"># db_copy.execute(query_copy)</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>                                        <span class="n">list_for_vcf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcf_file_gz</span><span class="p">)</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>                                    <span class="c1"># Log</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_for_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2"> files process in parallel [</span><span class="si">{</span><span class="n">threads</span><span class="si">}</span><span class="s2"> threads]...&quot;&quot;&quot;</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>                                    <span class="p">)</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>                                    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>                                        <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">duckdb_execute</span><span class="p">,</span> <span class="n">list_of_queries</span><span class="p">)</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>                                    <span class="c1"># Log</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_for_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2"> files generated&quot;&quot;&quot;</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>                                    <span class="p">)</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>                                    <span class="c1"># Header</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>                                    <span class="c1"># Init</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>                                    <span class="n">header_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>                                    <span class="c1"># Temporary header file for INFO fields</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>                                    <span class="n">header_file_tmp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>                                        <span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;header.hdr&quot;</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>                                    <span class="p">)</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>                                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_partition_parquet_header</span><span class="p">):</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>                                        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>                                            <span class="n">input_partition_parquet_header</span><span class="p">,</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>                                            <span class="n">header_file_tmp</span><span class="p">,</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>                                        <span class="p">)</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>                                            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Write header&quot;</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>                                        <span class="p">)</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>                                            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Write header failed&quot;</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>                                        <span class="p">)</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>                                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>                                            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Write header failed&quot;</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>                                        <span class="p">)</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>                                    <span class="c1"># Read header file to dict</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>                                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>                                            <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>                                    <span class="c1"># Remove last line with #CHROM</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>                                    <span class="n">header_list</span> <span class="o">=</span> <span class="n">header_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>                                    <span class="c1"># Append FILTER PASS</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>                                    <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>                                        <span class="s1">&#39;##FILTER=&lt;ID=PASS,Description=&quot;All filters passed&quot;&gt;&#39;</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>                                    <span class="p">)</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>                                    <span class="c1"># Add chromosomes</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>                                    <span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a>                                        <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a>                                            <span class="sa">f</span><span class="s2">&quot;##contig=&lt;ID=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">,length=</span><span class="si">{</span><span class="n">genomes_sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chromosome</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">,assembly=</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a>                                        <span class="p">)</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a>                                    <span class="c1"># Add last line with #CHROM</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a>                                    <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a>                                        <span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">POS</span><span class="se">\t</span><span class="s2">ID</span><span class="se">\t</span><span class="s2">REF</span><span class="se">\t</span><span class="s2">ALT</span><span class="se">\t</span><span class="s2">QUAL</span><span class="se">\t</span><span class="s2">FILTER</span><span class="se">\t</span><span class="s2">INFO&quot;</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a>                                    <span class="p">)</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a>                                    <span class="c1"># Write header</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>                                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">header_list</span><span class="p">:</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>                                            <span class="c1"># write each item on a new line</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>                                            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>                                    <span class="c1"># Insert header to lists of files to concat</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>                                    <span class="n">list_for_vcf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">header_file</span><span class="p">)</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>                                    <span class="c1"># Log</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a>                                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Concate and Compress files...&quot;</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>                                    <span class="p">)</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>                                    <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>                                        <span class="n">input_files</span><span class="o">=</span><span class="n">list_for_vcf</span><span class="p">,</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>                                        <span class="n">output_file</span><span class="o">=</span><span class="n">output_vcf</span><span class="p">,</span>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a>                                        <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a>                                        <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>                                        <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>                                        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>                                    <span class="p">)</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>                                    <span class="n">db_copy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a>                                    <span class="n">vcf_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>                                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No INFO columns found&quot;&quot;&quot;</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>                                <span class="p">)</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a>                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>                                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No INFO columns found&quot;&quot;&quot;</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a>                                <span class="p">)</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>                            <span class="p">)</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>                            <span class="p">)</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>                        <span class="n">vcf_already_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>    <span class="c1"># Log</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>    <span class="k">if</span> <span class="n">parquet_partition_generated_list</span><span class="p">:</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet folders generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>        <span class="p">)</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>    <span class="k">if</span> <span class="n">parquet_partition_already_generated_list</span><span class="p">:</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet folders already generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>        <span class="p">)</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>    <span class="k">if</span> <span class="n">parquet_generated_list</span><span class="p">:</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet files generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>        <span class="p">)</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>    <span class="k">if</span> <span class="n">parquet_already_generated_list</span><span class="p">:</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet files already generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>        <span class="p">)</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>    <span class="k">if</span> <span class="n">vcf_generated_list</span><span class="p">:</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> VCF files generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>        <span class="p">)</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>    <span class="k">if</span> <span class="n">vcf_already_generated_list</span><span class="p">:</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> VCF files already generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>        <span class="p">)</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>    <span class="c1"># Close duckdb connexion</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>    <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a><span class="k">def</span> <span class="nf">databases_download_alphamissense</span><span class="p">(</span>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a>    <span class="n">alphamissense_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATIONS_FOLDER</span><span class="p">,</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a>    <span class="n">alphamissense_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ALPHAMISSENSE_URL</span><span class="p">,</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a><span class="sd">    The `databases_download_alphamissense` function downloads and converts AlphaMissense databases for a</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a><span class="sd">    list of assemblies.</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a><span class="sd">    :param assemblies: `assemblies` is a list of assemblies for which the AlphaMissense database needs</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a><span class="sd">    to be downloaded. Each assembly represents a specific genome or genetic sequence</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a><span class="sd">    :param alphamissense_folder: The `alphamissense_folder` parameter is a string that specifies the</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a><span class="sd">    folder where the AlphaMissense files will be downloaded and stored. It is set to</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a><span class="sd">    `DEFAULT_ANNOTATIONS_FOLDER` by default, which is likely a predefined constant or variable in your</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a><span class="sd">    code</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a><span class="sd">    :type alphamissense_folder: str</span>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a><span class="sd">    :param alphamissense_url: The `alphamissense_url` parameter is a string that specifies the URL where</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a><span class="sd">    the AlphaMissense files are located. It is used to construct the download URL for each assembly&#39;s</span>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a><span class="sd">    AlphaMissense file</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a><span class="sd">    :type alphamissense_url: str</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a><span class="sd">    :param threads: The `threads` parameter is an optional parameter that specifies the number of</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a><span class="sd">    threads to use for the conversion process. It determines the level of parallelism when converting</span>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a><span class="sd">    the AlphaMissense TSV file to the Parquet format. If not specified, the default value will be used</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a><span class="sd">    :type threads: int</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a><span class="sd">    :return: The function `databases_download_alphamissense` returns a boolean value `True`.</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>    <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a>    <span class="c1"># Log</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a>    <span class="c1"># Full path</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a>    <span class="n">alphamissense_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">alphamissense_folder</span><span class="p">)</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a>        <span class="c1"># Files for AlphaMissense</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a>        <span class="n">alphamissense_tsv</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AlphaMissense_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a>        <span class="n">alphamissense_tsv_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alphamissense_url</span><span class="p">,</span> <span class="n">alphamissense_tsv</span><span class="p">)</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>        <span class="n">alphamissense_tsv_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>            <span class="n">alphamissense_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="n">alphamissense_tsv</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>        <span class="p">)</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>        <span class="n">alphamissense_tsv_dest_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">alphamissense_tsv_dest</span><span class="p">)</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>        <span class="n">alphamissense_parquet</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AlphaMissense.parquet&quot;</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>        <span class="n">alphamissense_parquet_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>            <span class="n">alphamissense_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="n">alphamissense_parquet</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>        <span class="p">)</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_tsv_dest_folder</span><span class="p">):</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">alphamissense_tsv_dest_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alphamissense_tsv_url</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alphamissense_tsv_dest</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alphamissense_tsv_dest_folder</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>        <span class="p">)</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>        <span class="c1"># Download AlphaMissense</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_tsv_dest</span><span class="p">):</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>                <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download &#39;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>            <span class="p">)</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>                <span class="n">alphamissense_tsv_url</span><span class="p">,</span> <span class="n">alphamissense_tsv_dest</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>            <span class="p">)</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>                <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>            <span class="p">)</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a>        <span class="c1"># Convert to Parquet</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_tsv_dest</span><span class="p">):</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_parquet_dest</span><span class="p">):</span>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Convert to &#39;</span><span class="si">{</span><span class="n">alphamissense_parquet</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a>                <span class="p">)</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a>                <span class="n">alphamissense_database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a>                    <span class="n">database</span><span class="o">=</span><span class="n">alphamissense_tsv_dest</span><span class="p">,</span> <span class="n">conn_config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">}</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>                <span class="p">)</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>                <span class="n">alphamissense_database</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a>                    <span class="n">output_database</span><span class="o">=</span><span class="n">alphamissense_parquet_dest</span><span class="p">,</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>                    <span class="n">output_header</span><span class="o">=</span><span class="n">alphamissense_parquet_dest</span> <span class="o">+</span> <span class="s2">&quot;.hdr&quot;</span><span class="p">,</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a>                <span class="p">)</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">alphamissense_parquet</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a>                <span class="p">)</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>                <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">&#39; DOES NOT exists&quot;</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>            <span class="p">)</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a><span class="k">def</span> <span class="nf">databases_download_exomiser</span><span class="p">(</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a>    <span class="n">exomiser_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_EXOMISER_FOLDER</span><span class="p">,</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a>    <span class="n">exomiser_application_properties</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a>    <span class="n">exomiser_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_EXOMISER_URL</span><span class="p">,</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a>    <span class="n">exomiser_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a>    <span class="n">exomiser_phenotype_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a>    <span class="n">exomiser_remm_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a>    <span class="n">exomiser_remm_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://kircherlab.bihealth.org/download/ReMM&quot;</span><span class="p">,</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a>    <span class="n">exomiser_cadd_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a>    <span class="n">exomiser_cadd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://kircherlab.bihealth.org/download/CADD&quot;</span><span class="p">,</span>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a>    <span class="n">exomiser_cadd_url_snv_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whole_genome_SNVs.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a>    <span class="n">exomiser_cadd_url_indel_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;InDels.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a><span class="sd">    The `databases_download_exomiser` function downloads and sets up the Exomiser database for the</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a><span class="sd">    specified assemblies.</span>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a><span class="sd">    :param assemblies: A list of assemblies for which to download Exomiser databases. Each assembly is a</span>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a><span class="sd">    string representing a genome build, such as &quot;GRCh37&quot; or &quot;GRCh38&quot;</span>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a><span class="sd">    :param exomiser_folder: The `exomiser_folder` parameter is a string that specifies the folder where</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a><span class="sd">    the Exomiser databases will be downloaded and stored. If the folder does not exist, it will be</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a><span class="sd">    created</span>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a><span class="sd">    :type exomiser_folder: str</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a><span class="sd">    :param exomiser_application_properties: The `exomiser_application_properties` parameter is a string</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a><span class="sd">    representing the path to the Exomiser application properties file. This file contains configuration</span>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a><span class="sd">    settings for the Exomiser tool. If this parameter is not provided, the function will attempt to</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a><span class="sd">    locate the application properties file automatically based on the Exomiser</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a><span class="sd">    :type exomiser_application_properties: str</span>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a><span class="sd">    :param exomiser_url: The `exomiser_url` parameter is the URL where the Exomiser database files can</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a><span class="sd">    be downloaded from. It is used to construct the download URLs for the phenotype and assembly files</span>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a><span class="sd">    :type exomiser_url: str</span>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a><span class="sd">    :param exomiser_release: The `exomiser_release` parameter is used to specify the version of the</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a><span class="sd">    Exomiser data to download. If it is set to &quot;default&quot;, &quot;auto&quot;, or &quot;config&quot;, the function will attempt</span>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a><span class="sd">    to retrieve the version from the `exomiser.application.properties` file. If it is</span>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a><span class="sd">    :type exomiser_release: str</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a><span class="sd">    :param exomiser_phenotype_release: The `exomiser_phenotype_release` parameter is used to specify the</span>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a><span class="sd">    release version of the Exomiser phenotype database. If not provided, it will default to the value</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a><span class="sd">    specified in the `application.properties` file or the latest available release</span>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a><span class="sd">    :type exomiser_phenotype_release: str</span>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a><span class="sd">    :param exomiser_remm_release: The `exomiser_remm_release` parameter is used to specify the version</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a><span class="sd">    of the ReMM (Regulatory Mendelian Mutation) database to download. If the value is set to &quot;default&quot;,</span>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a><span class="sd">    &quot;auto&quot;, or &quot;config&quot;, it will try to retrieve the version from the `application.properties`</span>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a><span class="sd">    :type exomiser_remm_release: str</span>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a><span class="sd">    :param exomiser_remm_url: The `exomiser_remm_url` parameter is the URL where the ReMM (Regulatory</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a><span class="sd">    Mendelian Mutation) database can be downloaded from. It is used in the function to construct the</span>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a><span class="sd">    download URL for the ReMM database files, defaults to https://kircherlab.bihealth.org/download/ReMM</span>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a><span class="sd">    :type exomiser_remm_url: str (optional)</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a><span class="sd">    :param exomiser_cadd_release: The `exomiser_cadd_release` parameter is used to specify the version</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a><span class="sd">    of the CADD (Combined Annotation Dependent Depletion) database to download. If the value is set to</span>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a><span class="sd">    &quot;default&quot;, &quot;auto&quot;, or &quot;config&quot;, it will try to retrieve the version from the `exom</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a><span class="sd">    :type exomiser_cadd_release: str</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a><span class="sd">    :param exomiser_cadd_url: The `exomiser_cadd_url` parameter is the URL where the CADD (Combined</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a><span class="sd">    Annotation Dependent Depletion) database files can be downloaded from. It is used to construct the</span>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a><span class="sd">    download URLs for the CADD database files, defaults to https://kircherlab.bihealth.org/download/CADD</span>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a><span class="sd">    :type exomiser_cadd_url: str (optional)</span>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a><span class="sd">    :param exomiser_cadd_url_snv_file: The parameter `exomiser_cadd_url_snv_file` is the name of the</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a><span class="sd">    file containing the SNV (Single Nucleotide Variant) data for the CADD (Combined Annotation Dependent</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a><span class="sd">    Depletion) database, defaults to whole_genome_SNVs.tsv.gz</span>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a><span class="sd">    :type exomiser_cadd_url_snv_file: str (optional)</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a><span class="sd">    :param exomiser_cadd_url_indel_file: The parameter `exomiser_cadd_url_indel_file` is the name of the</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a><span class="sd">    INDEL file that will be downloaded from the CADD database, defaults to InDels.tsv.gz</span>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a><span class="sd">    :type exomiser_cadd_url_indel_file: str (optional)</span>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for parallel</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a><span class="sd">    processing. It determines how many tasks can be executed simultaneously. Increasing the number of</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a><span class="sd">    threads can potentially speed up the execution time of the function, especially if there are</span>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a><span class="sd">    multiple cores available on the machine</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a>    <span class="c1"># Variables</span>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a>    <span class="n">transcript_source_default</span> <span class="o">=</span> <span class="s2">&quot;refseq&quot;</span>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a>    <span class="n">exomiser_release_default</span> <span class="o">=</span> <span class="s2">&quot;2402&quot;</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a>    <span class="c1"># Full Path</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a>    <span class="n">exomiser_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">)</span>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a>    <span class="n">exomiser_application_properties</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">exomiser_application_properties</span><span class="p">)</span>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_folder=</span><span class="si">{</span><span class="n">exomiser_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_application_properties=</span><span class="si">{</span><span class="n">exomiser_application_properties</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">):</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">)</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a>        <span class="c1"># application.properties as dict</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a>        <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">exomiser_application_properties</span>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a>        <span class="n">exomiser_application_properties_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>        <span class="c1"># Find exomiser_application_properties</span>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_application_properties_assembly</span><span class="p">:</span>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>            <span class="c1"># Find application.properties on assembly folder</span>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span><span class="p">)</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a>            <span class="p">):</span>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a>                <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a>                    <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a>                <span class="p">)</span>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a>            <span class="c1"># Find application.properties with exomizer Jar</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>                <span class="n">exomiser_jar</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a>                    <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;exomiser-cli*.jar&quot;</span><span class="p">,</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>                    <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;exomiser&quot;</span><span class="p">,</span>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>                    <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;jar&quot;</span><span class="p">,</span>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>                    <span class="n">default_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_TOOLS_FOLDER</span><span class="si">}</span><span class="s2">/exomiser/current&quot;</span><span class="p">,</span>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a>                <span class="p">)</span>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_jar</span><span class="p">:</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a>                    <span class="n">exomiser_jar</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a>                        <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;exomiser-cli*.jar&quot;</span><span class="p">,</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>                        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;exomiser&quot;</span><span class="p">,</span>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a>                        <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;jar&quot;</span><span class="p">,</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a>                        <span class="n">default_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_TOOLS_FOLDER</span><span class="si">}</span><span class="s2">/exomiser&quot;</span><span class="p">,</span>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a>                    <span class="p">)</span>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_jar=</span><span class="si">{</span><span class="n">exomiser_jar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a>                <span class="k">if</span> <span class="n">exomiser_jar</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_jar</span><span class="p">):</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>                    <span class="n">exomiser_jar_dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">exomiser_jar</span><span class="p">)</span>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a>                    <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>                        <span class="n">exomiser_jar_dirname</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>                    <span class="p">)</span>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser_application_properties_assembly=</span><span class="si">{</span><span class="n">exomiser_application_properties_assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>        <span class="p">)</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>        <span class="k">if</span> <span class="n">exomiser_application_properties_assembly</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>            <span class="n">exomiser_application_properties_assembly</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>        <span class="p">):</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>            <span class="n">configs</span> <span class="o">=</span> <span class="n">Properties</span><span class="p">()</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">exomiser_application_properties_assembly</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">read_prop</span><span class="p">:</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">read_prop</span><span class="p">)</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a>                <span class="n">exomiser_application_properties_dict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser_application_properties_dict=</span><span class="si">{</span><span class="n">exomiser_application_properties_dict</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a>        <span class="p">)</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_release</span> <span class="ow">or</span> <span class="n">exomiser_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a>            <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a>            <span class="s2">&quot;config&quot;</span><span class="p">,</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a>        <span class="p">]:</span>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a>            <span class="n">exomiser_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.data-version&quot;</span><span class="p">,</span> <span class="n">exomiser_release_default</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a>            <span class="p">)</span>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a>            <span class="n">exomiser_release_found</span> <span class="o">=</span> <span class="n">exomiser_release</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_phenotype_release</span> <span class="ow">or</span> <span class="n">exomiser_phenotype_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a>            <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a>            <span class="s2">&quot;config&quot;</span><span class="p">,</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a>        <span class="p">]:</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a>            <span class="n">exomiser_phenotype_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.phenotype.data-version&quot;</span><span class="p">,</span> <span class="n">exomiser_release_found</span>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a>            <span class="p">)</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a>            <span class="n">exomiser_phenotype_release_found</span> <span class="o">=</span> <span class="n">exomiser_phenotype_release</span>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_release: </span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_phenotype_release: </span><span class="si">{</span><span class="n">exomiser_phenotype_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a>        <span class="c1"># Phenotype</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a>        <span class="n">exomiser_phenotype_filename</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_phenotype_release_found</span><span class="si">}</span><span class="s2">_phenotype.zip&quot;</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a>        <span class="p">)</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a>        <span class="n">exomiser_phenotype_filename_base</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_phenotype_release_found</span><span class="si">}</span><span class="s2">_phenotype&quot;</span>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a>        <span class="p">)</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a>        <span class="n">exomiser_phenotype_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a>            <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>        <span class="p">)</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>        <span class="n">exomiser_phenotype_file_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>            <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename_base</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>        <span class="p">)</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>        <span class="n">exomiser_download_phenotype_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>            <span class="n">exomiser_url</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>        <span class="p">)</span>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a>        <span class="c1"># Download Zip file</span>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_phenotype_file</span><span class="p">):</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a>            <span class="p">)</span>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_phenotype_url</span><span class="p">,</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_phenotype_file</span><span class="p">,</span>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>            <span class="p">)</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a>            <span class="p">)</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a>        <span class="c1"># Extract Zip file</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_phenotype_file_base</span><span class="p">):</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Extract Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a>            <span class="p">)</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a>            <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">exomiser_phenotype_file</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39; already extracted&quot;</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a>            <span class="p">)</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>        <span class="c1"># Assembly</span>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a>        <span class="n">exomiser_assembly_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.zip&quot;</span>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a>        <span class="n">exomiser_assembly_filename_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>        <span class="n">exomiser_assembly_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a>            <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">exomiser_assembly_filename</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a>        <span class="p">)</span>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a>        <span class="n">exomiser_assembly_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a>        <span class="n">exomiser_download_assembly_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a>            <span class="n">exomiser_url</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">exomiser_assembly_filename</span>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a>        <span class="p">)</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a>        <span class="c1"># Download Zip file</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_assembly_file</span><span class="p">):</span>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a>            <span class="p">)</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_url</span><span class="p">,</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_assembly_file</span><span class="p">,</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>            <span class="p">)</span>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a>            <span class="p">)</span>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a>        <span class="c1"># Extract Zip file</span>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="n">exomiser_assembly_filename_base</span><span class="p">)</span>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a>        <span class="p">):</span>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Extract Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a>            <span class="p">)</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a>            <span class="n">extract_file</span><span class="p">(</span>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>                <span class="n">file_path</span><span class="o">=</span><span class="n">exomiser_assembly_file</span><span class="p">,</span>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a>            <span class="p">)</span>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39; already extracted&quot;</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a>            <span class="p">)</span>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a>        <span class="c1"># Link Phenotype to assembly</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a>        <span class="n">phenotype_assembly_link_src</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../</span><span class="si">{</span><span class="n">exomiser_phenotype_filename_base</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a>        <span class="n">phenotype_assembly_link_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a>            <span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename_base</span>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a>        <span class="p">)</span>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">phenotype_assembly_link_dest</span><span class="p">):</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Create Data &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">phenotype_assembly_link_dest</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; Phenotype link...&quot;</span>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a>            <span class="p">)</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">phenotype_assembly_link_src</span><span class="p">,</span> <span class="n">phenotype_assembly_link_dest</span><span class="p">)</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Data &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">phenotype_assembly_link_dest</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; Phenotype link already created&quot;</span>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a>            <span class="p">)</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a>        <span class="c1"># Generate properties for assembly</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>        <span class="n">exomiser_application_properties_assembly_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>            <span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>        <span class="p">)</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>        <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">Properties</span><span class="p">()</span>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>        <span class="c1"># data directory</span>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="s2">&quot;exomiser.data-directory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a>            <span class="n">exomiser_assembly_folder</span>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a>        <span class="p">)</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a>        <span class="c1"># data version</span>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.data-version&quot;</span>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="n">exomiser_release_found</span>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a>        <span class="c1"># phenotype data version</span>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;exomiser.phenotype.data-version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a>            <span class="n">exomiser_phenotype_release_found</span>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a>        <span class="p">)</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a>        <span class="c1"># variant-white-list-path</span>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a>        <span class="n">variant_white_list_file</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_clinvar_whitelist.tsv.gz&quot;</span>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a>        <span class="p">)</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="n">variant_white_list_file</span><span class="p">)</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a>        <span class="p">):</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.variant-white-list-path&quot;</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_clinvar_whitelist.tsv.gz&quot;</span>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a>        <span class="c1"># transcript source</span>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.transcript-source&quot;</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="n">transcript_source_default</span>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a>        <span class="c1"># REMM</span>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a>        <span class="n">exomiser_remm_download</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a>        <span class="k">if</span> <span class="n">exomiser_remm_release</span><span class="p">:</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a>            <span class="c1"># Search release if autodetection</span>
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a>            <span class="k">if</span> <span class="n">exomiser_remm_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]:</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a>                <span class="n">exomiser_remm_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a>                    <span class="s2">&quot;remm.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a>                <span class="p">)</span>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_remm_release found: </span><span class="si">{</span><span class="n">exomiser_remm_release</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a>                <span class="n">exomiser_remm_release_found</span> <span class="o">=</span> <span class="n">exomiser_remm_release</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a>            <span class="c1"># Force create of path and download</span>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a>            <span class="n">exomiser_remm_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>            <span class="c1"># Check REMM release</span>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>            <span class="n">exomiser_remm_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>                <span class="s2">&quot;remm.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>            <span class="p">)</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>        <span class="c1"># Check if path is mandatory in application.properties</span>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a>        <span class="k">if</span> <span class="n">exomiser_remm_release_found</span> <span class="ow">and</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.remm-path&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a>        <span class="p">):</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a>            <span class="n">exomiser_remm_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a>        <span class="n">exomiser_assembly_remm_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="s2">&quot;remm&quot;</span><span class="p">)</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a>        <span class="n">exomiser_remm_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a>            <span class="n">exomiser_assembly_remm_folder</span><span class="p">,</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a>            <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a>        <span class="p">)</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a>        <span class="k">if</span> <span class="n">exomiser_remm_download</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">):</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_assembly_remm_folder</span><span class="p">):</span>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_assembly_remm_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a>            <span class="n">exomiser_remm_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_remm_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a>            <span class="n">exomiser_remm_path_md5</span> <span class="o">=</span> <span class="n">exomiser_remm_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tsv.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;.md5&quot;</span><span class="p">)</span>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download REMM database &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a>            <span class="p">)</span>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a>            <span class="n">exomiser_download_assembly_remm_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a>                <span class="n">exomiser_remm_url</span><span class="p">,</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a>                <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>            <span class="p">)</span>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a>            <span class="n">exomiser_download_assembly_remm_tbi_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a>                <span class="n">exomiser_remm_url</span><span class="p">,</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a>                <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz.tbi&quot;</span><span class="p">,</span>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>            <span class="p">)</span>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a>            <span class="n">exomiser_download_assembly_remm_md5_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a>                <span class="n">exomiser_remm_url</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.md5&quot;</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a>            <span class="p">)</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_remm_url</span><span class="p">,</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_remm_path</span><span class="p">,</span>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a>            <span class="p">)</span>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_remm_tbi_url</span><span class="p">,</span>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_remm_path_tbi</span><span class="p">,</span>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>            <span class="p">)</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_remm_md5_url</span><span class="p">,</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_remm_path_md5</span><span class="p">,</span>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>            <span class="p">)</span>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database REMM not downloaded&quot;</span><span class="p">)</span>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">exomiser_remm_path</span><span class="si">}</span><span class="s2"> and os.path.exists(</span><span class="si">{</span><span class="n">exomiser_remm_path</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a>        <span class="p">)</span>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a>            <span class="n">exomiser_remm_release_found</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a>            <span class="ow">and</span> <span class="n">exomiser_remm_path</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">)</span>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a>        <span class="p">):</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database REMM &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a>            <span class="p">)</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="s2">&quot;remm.version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a>                <span class="n">exomiser_remm_release_found</span>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a>            <span class="p">)</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.remm-path&quot;</span>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a>                <span class="p">[</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a>                    <span class="s2">&quot;${exomiser.data-directory}&quot;</span><span class="p">,</span>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a>                    <span class="s2">&quot;remm&quot;</span><span class="p">,</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a>                    <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a>                <span class="p">]</span>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a>            <span class="p">)</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a>        <span class="c1"># CADD</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a>        <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a>        <span class="k">if</span> <span class="n">exomiser_cadd_release</span><span class="p">:</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a>            <span class="k">if</span> <span class="n">exomiser_cadd_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]:</span>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a>                <span class="n">exomiser_cadd_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>                    <span class="s2">&quot;cadd.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>                <span class="p">)</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_cadd_release found: </span><span class="si">{</span><span class="n">exomiser_cadd_release</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>                <span class="n">exomiser_cadd_release_found</span> <span class="o">=</span> <span class="n">exomiser_cadd_release</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>            <span class="c1"># Force create of path and download</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>            <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>            <span class="c1"># Check CADD release</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>            <span class="n">exomiser_cadd_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>                <span class="s2">&quot;cadd.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>            <span class="p">)</span>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_cadd_release: </span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>        <span class="c1"># Check if path is mandatory in application.properties</span>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a>            <span class="n">exomiser_cadd_release_found</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a>            <span class="ow">and</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-snv-path&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a>            <span class="p">)</span>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a>            <span class="ow">and</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-in-del-path&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a>            <span class="p">)</span>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a>        <span class="p">):</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a>            <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a>        <span class="k">if</span> <span class="n">exomiser_cadd_release_found</span><span class="p">:</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a>            <span class="n">exomiser_assembly_cadd_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a>                <span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="s2">&quot;cadd&quot;</span><span class="p">,</span> <span class="n">exomiser_cadd_release_found</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a>            <span class="p">)</span>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a>            <span class="n">exomiser_cadd_snv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a>                <span class="n">exomiser_assembly_cadd_folder</span><span class="p">,</span> <span class="n">exomiser_cadd_url_snv_file</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a>            <span class="p">)</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a>            <span class="n">exomiser_cadd_indel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a>                <span class="n">exomiser_assembly_cadd_folder</span><span class="p">,</span> <span class="n">exomiser_cadd_url_indel_file</span>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a>            <span class="p">)</span>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a>            <span class="n">exomiser_cadd_snv_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a>            <span class="n">exomiser_cadd_indel_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a>            <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a>        <span class="k">if</span> <span class="n">exomiser_cadd_download</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a>            <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a>        <span class="p">):</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_assembly_cadd_folder</span><span class="p">):</span>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_assembly_cadd_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a>            <span class="c1"># Genome build from gencode</span>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Search for assembly &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39; into gencode...&quot;</span>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a>            <span class="p">)</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a>            <span class="n">genome_build_switch_to_gencode</span> <span class="o">=</span> <span class="n">genome_build_switch</span><span class="p">(</span><span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">)</span>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a>            <span class="c1"># SNV</span>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">):</span>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a>                <span class="n">exomiser_cadd_snv_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_snv_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download CADD database &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a>                <span class="p">)</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a>                <span class="n">exomiser_download_assembly_cadd_snv_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a>                    <span class="n">exomiser_cadd_url_snv_file</span><span class="p">,</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a>                <span class="p">)</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a>                <span class="n">exomiser_download_assembly_cadd_snv_tbi_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_url_snv_file</span><span class="si">}</span><span class="s2">.tbi&quot;</span><span class="p">,</span>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a>                <span class="p">)</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_snv_url</span><span class="p">,</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_snv_path</span><span class="p">,</span>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a>                <span class="p">)</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_snv_tbi_url</span><span class="p">,</span>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_snv_path_tbi</span><span class="p">,</span>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>                <span class="p">)</span>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a>
</span><span id="L-3488"><a href="#L-3488"><span class="linenos">3488</span></a>            <span class="c1"># INDEL</span>
</span><span id="L-3489"><a href="#L-3489"><span class="linenos">3489</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">):</span>
</span><span id="L-3490"><a href="#L-3490"><span class="linenos">3490</span></a>                <span class="n">exomiser_cadd_indel_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_indel_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="L-3491"><a href="#L-3491"><span class="linenos">3491</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3492"><a href="#L-3492"><span class="linenos">3492</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download CADD database &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3493"><a href="#L-3493"><span class="linenos">3493</span></a>                <span class="p">)</span>
</span><span id="L-3494"><a href="#L-3494"><span class="linenos">3494</span></a>                <span class="n">exomiser_download_assembly_cadd_indel_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3495"><a href="#L-3495"><span class="linenos">3495</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="L-3496"><a href="#L-3496"><span class="linenos">3496</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3497"><a href="#L-3497"><span class="linenos">3497</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="L-3498"><a href="#L-3498"><span class="linenos">3498</span></a>                    <span class="n">exomiser_cadd_url_indel_file</span><span class="p">,</span>
</span><span id="L-3499"><a href="#L-3499"><span class="linenos">3499</span></a>                <span class="p">)</span>
</span><span id="L-3500"><a href="#L-3500"><span class="linenos">3500</span></a>                <span class="n">exomiser_download_assembly_cadd_indel_tbi_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3501"><a href="#L-3501"><span class="linenos">3501</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="L-3502"><a href="#L-3502"><span class="linenos">3502</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3503"><a href="#L-3503"><span class="linenos">3503</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="L-3504"><a href="#L-3504"><span class="linenos">3504</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_url_indel_file</span><span class="si">}</span><span class="s2">.gz.tbi&quot;</span><span class="p">,</span>
</span><span id="L-3505"><a href="#L-3505"><span class="linenos">3505</span></a>                <span class="p">)</span>
</span><span id="L-3506"><a href="#L-3506"><span class="linenos">3506</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3507"><a href="#L-3507"><span class="linenos">3507</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_indel_url</span><span class="p">,</span>
</span><span id="L-3508"><a href="#L-3508"><span class="linenos">3508</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_indel_path</span><span class="p">,</span>
</span><span id="L-3509"><a href="#L-3509"><span class="linenos">3509</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3510"><a href="#L-3510"><span class="linenos">3510</span></a>                <span class="p">)</span>
</span><span id="L-3511"><a href="#L-3511"><span class="linenos">3511</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3512"><a href="#L-3512"><span class="linenos">3512</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_indel_tbi_url</span><span class="p">,</span>
</span><span id="L-3513"><a href="#L-3513"><span class="linenos">3513</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_indel_path_tbi</span><span class="p">,</span>
</span><span id="L-3514"><a href="#L-3514"><span class="linenos">3514</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3515"><a href="#L-3515"><span class="linenos">3515</span></a>                <span class="p">)</span>
</span><span id="L-3516"><a href="#L-3516"><span class="linenos">3516</span></a>
</span><span id="L-3517"><a href="#L-3517"><span class="linenos">3517</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3518"><a href="#L-3518"><span class="linenos">3518</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database CADD not downloaded&quot;</span><span class="p">)</span>
</span><span id="L-3519"><a href="#L-3519"><span class="linenos">3519</span></a>
</span><span id="L-3520"><a href="#L-3520"><span class="linenos">3520</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-3521"><a href="#L-3521"><span class="linenos">3521</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">exomiser_cadd_snv_path</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">exomiser_cadd_indel_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3522"><a href="#L-3522"><span class="linenos">3522</span></a>        <span class="p">)</span>
</span><span id="L-3523"><a href="#L-3523"><span class="linenos">3523</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3524"><a href="#L-3524"><span class="linenos">3524</span></a>            <span class="n">exomiser_cadd_release_found</span>
</span><span id="L-3525"><a href="#L-3525"><span class="linenos">3525</span></a>            <span class="ow">and</span> <span class="n">exomiser_cadd_snv_path</span>
</span><span id="L-3526"><a href="#L-3526"><span class="linenos">3526</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span>
</span><span id="L-3527"><a href="#L-3527"><span class="linenos">3527</span></a>            <span class="ow">and</span> <span class="n">exomiser_cadd_indel_path</span>
</span><span id="L-3528"><a href="#L-3528"><span class="linenos">3528</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span>
</span><span id="L-3529"><a href="#L-3529"><span class="linenos">3529</span></a>        <span class="p">):</span>
</span><span id="L-3530"><a href="#L-3530"><span class="linenos">3530</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3531"><a href="#L-3531"><span class="linenos">3531</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database CADD &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-3532"><a href="#L-3532"><span class="linenos">3532</span></a>            <span class="p">)</span>
</span><span id="L-3533"><a href="#L-3533"><span class="linenos">3533</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3534"><a href="#L-3534"><span class="linenos">3534</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database CADD &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-3535"><a href="#L-3535"><span class="linenos">3535</span></a>            <span class="p">)</span>
</span><span id="L-3536"><a href="#L-3536"><span class="linenos">3536</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="s2">&quot;cadd.version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3537"><a href="#L-3537"><span class="linenos">3537</span></a>                <span class="n">exomiser_cadd_release_found</span>
</span><span id="L-3538"><a href="#L-3538"><span class="linenos">3538</span></a>            <span class="p">)</span>
</span><span id="L-3539"><a href="#L-3539"><span class="linenos">3539</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="L-3540"><a href="#L-3540"><span class="linenos">3540</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-snv-path&quot;</span>
</span><span id="L-3541"><a href="#L-3541"><span class="linenos">3541</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3542"><a href="#L-3542"><span class="linenos">3542</span></a>                <span class="p">[</span>
</span><span id="L-3543"><a href="#L-3543"><span class="linenos">3543</span></a>                    <span class="s2">&quot;${exomiser.data-directory}&quot;</span><span class="p">,</span>
</span><span id="L-3544"><a href="#L-3544"><span class="linenos">3544</span></a>                    <span class="s2">&quot;cadd&quot;</span><span class="p">,</span>
</span><span id="L-3545"><a href="#L-3545"><span class="linenos">3545</span></a>                    <span class="n">exomiser_cadd_release_found</span><span class="p">,</span>
</span><span id="L-3546"><a href="#L-3546"><span class="linenos">3546</span></a>                    <span class="n">exomiser_cadd_url_snv_file</span><span class="p">,</span>
</span><span id="L-3547"><a href="#L-3547"><span class="linenos">3547</span></a>                <span class="p">]</span>
</span><span id="L-3548"><a href="#L-3548"><span class="linenos">3548</span></a>            <span class="p">)</span>
</span><span id="L-3549"><a href="#L-3549"><span class="linenos">3549</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="L-3550"><a href="#L-3550"><span class="linenos">3550</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-in-del-path&quot;</span>
</span><span id="L-3551"><a href="#L-3551"><span class="linenos">3551</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3552"><a href="#L-3552"><span class="linenos">3552</span></a>                <span class="p">[</span>
</span><span id="L-3553"><a href="#L-3553"><span class="linenos">3553</span></a>                    <span class="s2">&quot;${exomiser.data-directory}&quot;</span><span class="p">,</span>
</span><span id="L-3554"><a href="#L-3554"><span class="linenos">3554</span></a>                    <span class="s2">&quot;cadd&quot;</span><span class="p">,</span>
</span><span id="L-3555"><a href="#L-3555"><span class="linenos">3555</span></a>                    <span class="n">exomiser_cadd_release_found</span><span class="p">,</span>
</span><span id="L-3556"><a href="#L-3556"><span class="linenos">3556</span></a>                    <span class="n">exomiser_cadd_url_indel_file</span><span class="p">,</span>
</span><span id="L-3557"><a href="#L-3557"><span class="linenos">3557</span></a>                <span class="p">]</span>
</span><span id="L-3558"><a href="#L-3558"><span class="linenos">3558</span></a>            <span class="p">)</span>
</span><span id="L-3559"><a href="#L-3559"><span class="linenos">3559</span></a>
</span><span id="L-3560"><a href="#L-3560"><span class="linenos">3560</span></a>        <span class="c1"># Create application.properties</span>
</span><span id="L-3561"><a href="#L-3561"><span class="linenos">3561</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_application_properties_assembly_file</span><span class="p">):</span>
</span><span id="L-3562"><a href="#L-3562"><span class="linenos">3562</span></a>            <span class="k">if</span> <span class="n">exomiser_assembly_folder</span><span class="p">:</span>
</span><span id="L-3563"><a href="#L-3563"><span class="linenos">3563</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3564"><a href="#L-3564"><span class="linenos">3564</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">exomiser_application_properties_assembly_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-3565"><a href="#L-3565"><span class="linenos">3565</span></a>                <span class="n">exomiser_application_properties_assembly</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-3566"><a href="#L-3566"><span class="linenos">3566</span></a>
</span><span id="L-3567"><a href="#L-3567"><span class="linenos">3567</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-3568"><a href="#L-3568"><span class="linenos">3568</span></a>
</span><span id="L-3569"><a href="#L-3569"><span class="linenos">3569</span></a>
</span><span id="L-3570"><a href="#L-3570"><span class="linenos">3570</span></a><span class="k">def</span> <span class="nf">databases_download_dbsnp</span><span class="p">(</span>
</span><span id="L-3571"><a href="#L-3571"><span class="linenos">3571</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-3572"><a href="#L-3572"><span class="linenos">3572</span></a>    <span class="n">dbsnp_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_DBSNP_FOLDER</span><span class="p">,</span>
</span><span id="L-3573"><a href="#L-3573"><span class="linenos">3573</span></a>    <span class="n">dbsnp_releases</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;b156&quot;</span><span class="p">],</span>
</span><span id="L-3574"><a href="#L-3574"><span class="linenos">3574</span></a>    <span class="n">dbsnp_release_default</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3575"><a href="#L-3575"><span class="linenos">3575</span></a>    <span class="n">dbsnp_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_DBSNP_URL</span><span class="p">,</span>
</span><span id="L-3576"><a href="#L-3576"><span class="linenos">3576</span></a>    <span class="n">dbsnp_url_files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3577"><a href="#L-3577"><span class="linenos">3577</span></a>    <span class="n">dbsnp_url_files_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GCF_000001405&quot;</span><span class="p">,</span>
</span><span id="L-3578"><a href="#L-3578"><span class="linenos">3578</span></a>    <span class="n">dbsnp_assemblies_map</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hg19&quot;</span><span class="p">:</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;hg38&quot;</span><span class="p">:</span> <span class="s2">&quot;40&quot;</span><span class="p">},</span>
</span><span id="L-3579"><a href="#L-3579"><span class="linenos">3579</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span><span class="p">,</span>
</span><span id="L-3580"><a href="#L-3580"><span class="linenos">3580</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-3581"><a href="#L-3581"><span class="linenos">3581</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-3582"><a href="#L-3582"><span class="linenos">3582</span></a>    <span class="n">dbsnp_vcf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3583"><a href="#L-3583"><span class="linenos">3583</span></a>    <span class="n">dbsnp_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3584"><a href="#L-3584"><span class="linenos">3584</span></a>    <span class="n">dbsnp_parquet_explode_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-3585"><a href="#L-3585"><span class="linenos">3585</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3586"><a href="#L-3586"><span class="linenos">3586</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3587"><a href="#L-3587"><span class="linenos">3587</span></a><span class="sd">    The function `databases_download_dbsnp` downloads dbSNP files, generates VCF files, and converts</span>
</span><span id="L-3588"><a href="#L-3588"><span class="linenos">3588</span></a><span class="sd">    them to Parquet format.</span>
</span><span id="L-3589"><a href="#L-3589"><span class="linenos">3589</span></a>
</span><span id="L-3590"><a href="#L-3590"><span class="linenos">3590</span></a><span class="sd">    :param assemblies: A list of genome assemblies for which to download dbSNP data</span>
</span><span id="L-3591"><a href="#L-3591"><span class="linenos">3591</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-3592"><a href="#L-3592"><span class="linenos">3592</span></a><span class="sd">    :param dbsnp_folder: The folder where the dbSNP files will be downloaded and stored</span>
</span><span id="L-3593"><a href="#L-3593"><span class="linenos">3593</span></a><span class="sd">    :type dbsnp_folder: str</span>
</span><span id="L-3594"><a href="#L-3594"><span class="linenos">3594</span></a><span class="sd">    :param dbsnp_releases: List of releases to download. Default:[&quot;b156&quot;]</span>
</span><span id="L-3595"><a href="#L-3595"><span class="linenos">3595</span></a><span class="sd">    :type dbsnp_releases: list</span>
</span><span id="L-3596"><a href="#L-3596"><span class="linenos">3596</span></a><span class="sd">    :param dbsnp_release_default: Default release to link in default folder. Default: first release in dbsnp_releases</span>
</span><span id="L-3597"><a href="#L-3597"><span class="linenos">3597</span></a><span class="sd">    :type dbsnp_release_default: str</span>
</span><span id="L-3598"><a href="#L-3598"><span class="linenos">3598</span></a><span class="sd">    :param dbsnp_url: The `dbsnp_url` parameter is a string that represents the base URL where the dbSNP</span>
</span><span id="L-3599"><a href="#L-3599"><span class="linenos">3599</span></a><span class="sd">    files are located. This URL is used to construct the full URL for downloading the dbSNP files</span>
</span><span id="L-3600"><a href="#L-3600"><span class="linenos">3600</span></a><span class="sd">    :type dbsnp_url: str</span>
</span><span id="L-3601"><a href="#L-3601"><span class="linenos">3601</span></a><span class="sd">    :param dbsnp_url_files: The `dbsnp_url_files` parameter is a dictionary that maps assembly names to</span>
</span><span id="L-3602"><a href="#L-3602"><span class="linenos">3602</span></a><span class="sd">    specific dbSNP URL files. It allows you to provide custom dbSNP URL files for specific assemblies</span>
</span><span id="L-3603"><a href="#L-3603"><span class="linenos">3603</span></a><span class="sd">    instead of using the default file naming convention</span>
</span><span id="L-3604"><a href="#L-3604"><span class="linenos">3604</span></a><span class="sd">    :type dbsnp_url_files: dict</span>
</span><span id="L-3605"><a href="#L-3605"><span class="linenos">3605</span></a><span class="sd">    :param dbsnp_url_files_prefix: The `dbsnp_url_files_prefix` parameter is a string that represents the</span>
</span><span id="L-3606"><a href="#L-3606"><span class="linenos">3606</span></a><span class="sd">    prefix of the dbSNP file name for a specific assembly. It is used to construct the full URL of the</span>
</span><span id="L-3607"><a href="#L-3607"><span class="linenos">3607</span></a><span class="sd">    dbSNP file to be downloaded. By default, the value is set to &quot;GCF_000001405&quot;</span>
</span><span id="L-3608"><a href="#L-3608"><span class="linenos">3608</span></a><span class="sd">    :type dbsnp_url_files_prefix: str (optional)</span>
</span><span id="L-3609"><a href="#L-3609"><span class="linenos">3609</span></a><span class="sd">    :param dbsnp_assemblies_map: The `dbsnp_assemblies_map` parameter is a dictionary that maps assembly</span>
</span><span id="L-3610"><a href="#L-3610"><span class="linenos">3610</span></a><span class="sd">    names to their corresponding dbSNP versions. It is used to construct the dbSNP file name based on</span>
</span><span id="L-3611"><a href="#L-3611"><span class="linenos">3611</span></a><span class="sd">    the assembly name. For example, if the assembly is &quot;hg19&quot;, the corresponding dbSNP version is &quot;</span>
</span><span id="L-3612"><a href="#L-3612"><span class="linenos">3612</span></a><span class="sd">    :type dbsnp_assemblies_map: dict</span>
</span><span id="L-3613"><a href="#L-3613"><span class="linenos">3613</span></a><span class="sd">    :param genomes_folder: The `genomes_folder` parameter is a string that specifies the folder where the</span>
</span><span id="L-3614"><a href="#L-3614"><span class="linenos">3614</span></a><span class="sd">    genome index files are located. These index files are used for generating the VCF file from the</span>
</span><span id="L-3615"><a href="#L-3615"><span class="linenos">3615</span></a><span class="sd">    downloaded dbSNP file</span>
</span><span id="L-3616"><a href="#L-3616"><span class="linenos">3616</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="L-3617"><a href="#L-3617"><span class="linenos">3617</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for downloading and</span>
</span><span id="L-3618"><a href="#L-3618"><span class="linenos">3618</span></a><span class="sd">    processing the dbSNP files, defaults to 1</span>
</span><span id="L-3619"><a href="#L-3619"><span class="linenos">3619</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="L-3620"><a href="#L-3620"><span class="linenos">3620</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of max memory (in Gb) to use for sorting.</span>
</span><span id="L-3621"><a href="#L-3621"><span class="linenos">3621</span></a><span class="sd">    defaults to 1</span>
</span><span id="L-3622"><a href="#L-3622"><span class="linenos">3622</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="L-3623"><a href="#L-3623"><span class="linenos">3623</span></a><span class="sd">    :param dbsnp_vcf: A boolean flag indicating whether to generate a VCF file from the downloaded</span>
</span><span id="L-3624"><a href="#L-3624"><span class="linenos">3624</span></a><span class="sd">    dbSNP data. If set to True, the function will generate a VCF file. If set to False, the function</span>
</span><span id="L-3625"><a href="#L-3625"><span class="linenos">3625</span></a><span class="sd">    will not generate a VCF file, defaults to False</span>
</span><span id="L-3626"><a href="#L-3626"><span class="linenos">3626</span></a><span class="sd">    :type dbsnp_vcf: bool (optional)</span>
</span><span id="L-3627"><a href="#L-3627"><span class="linenos">3627</span></a><span class="sd">    :param dbsnpparquet: A boolean flag indicating whether to generate a Parquet file from the</span>
</span><span id="L-3628"><a href="#L-3628"><span class="linenos">3628</span></a><span class="sd">    downloaded dbSNP data. If set to True, a Parquet file will be generated; if set to False, no Parquet</span>
</span><span id="L-3629"><a href="#L-3629"><span class="linenos">3629</span></a><span class="sd">    file will be generated, defaults to False</span>
</span><span id="L-3630"><a href="#L-3630"><span class="linenos">3630</span></a><span class="sd">    :type dbsnp_parquet: bool (optional)</span>
</span><span id="L-3631"><a href="#L-3631"><span class="linenos">3631</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3632"><a href="#L-3632"><span class="linenos">3632</span></a>
</span><span id="L-3633"><a href="#L-3633"><span class="linenos">3633</span></a>    <span class="c1"># Import Database object</span>
</span><span id="L-3634"><a href="#L-3634"><span class="linenos">3634</span></a>    <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="L-3635"><a href="#L-3635"><span class="linenos">3635</span></a>
</span><span id="L-3636"><a href="#L-3636"><span class="linenos">3636</span></a>    <span class="c1"># Log</span>
</span><span id="L-3637"><a href="#L-3637"><span class="linenos">3637</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3638"><a href="#L-3638"><span class="linenos">3638</span></a>
</span><span id="L-3639"><a href="#L-3639"><span class="linenos">3639</span></a>    <span class="c1"># Database config</span>
</span><span id="L-3640"><a href="#L-3640"><span class="linenos">3640</span></a>    <span class="n">conn_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">}</span>
</span><span id="L-3641"><a href="#L-3641"><span class="linenos">3641</span></a>
</span><span id="L-3642"><a href="#L-3642"><span class="linenos">3642</span></a>    <span class="c1"># Genomes folder</span>
</span><span id="L-3643"><a href="#L-3643"><span class="linenos">3643</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="L-3644"><a href="#L-3644"><span class="linenos">3644</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="L-3645"><a href="#L-3645"><span class="linenos">3645</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;genomes_folder: </span><span class="si">{</span><span class="n">genomes_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3646"><a href="#L-3646"><span class="linenos">3646</span></a>
</span><span id="L-3647"><a href="#L-3647"><span class="linenos">3647</span></a>    <span class="c1"># Full path</span>
</span><span id="L-3648"><a href="#L-3648"><span class="linenos">3648</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="L-3649"><a href="#L-3649"><span class="linenos">3649</span></a>    <span class="n">dbsnp_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">dbsnp_folder</span><span class="p">)</span>
</span><span id="L-3650"><a href="#L-3650"><span class="linenos">3650</span></a>
</span><span id="L-3651"><a href="#L-3651"><span class="linenos">3651</span></a>    <span class="c1"># Default release</span>
</span><span id="L-3652"><a href="#L-3652"><span class="linenos">3652</span></a>    <span class="n">dbsnp_release_default_found</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3653"><a href="#L-3653"><span class="linenos">3653</span></a>    <span class="k">if</span> <span class="n">dbsnp_release_default</span><span class="p">:</span>
</span><span id="L-3654"><a href="#L-3654"><span class="linenos">3654</span></a>        <span class="n">dbsnp_release_default_found</span> <span class="o">=</span> <span class="n">dbsnp_release_default</span>
</span><span id="L-3655"><a href="#L-3655"><span class="linenos">3655</span></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbsnp_releases</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3656"><a href="#L-3656"><span class="linenos">3656</span></a>        <span class="n">dbsnp_release_default_found</span> <span class="o">=</span> <span class="n">dbsnp_releases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3657"><a href="#L-3657"><span class="linenos">3657</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_release_default_found: </span><span class="si">{</span><span class="n">dbsnp_release_default_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3658"><a href="#L-3658"><span class="linenos">3658</span></a>
</span><span id="L-3659"><a href="#L-3659"><span class="linenos">3659</span></a>    <span class="c1"># dbSNP assemblies map</span>
</span><span id="L-3660"><a href="#L-3660"><span class="linenos">3660</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbsnp_assemblies_map</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-3661"><a href="#L-3661"><span class="linenos">3661</span></a>        <span class="n">dbsnp_assemblies_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dbsnp_assemblies_map</span><span class="p">)</span>
</span><span id="L-3662"><a href="#L-3662"><span class="linenos">3662</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_assemblies_map: </span><span class="si">{</span><span class="n">dbsnp_assemblies_map</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3663"><a href="#L-3663"><span class="linenos">3663</span></a>
</span><span id="L-3664"><a href="#L-3664"><span class="linenos">3664</span></a>    <span class="c1"># dbSNP URL files</span>
</span><span id="L-3665"><a href="#L-3665"><span class="linenos">3665</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbsnp_url_files</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-3666"><a href="#L-3666"><span class="linenos">3666</span></a>        <span class="n">dbsnp_url_files</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dbsnp_url_files</span><span class="p">)</span>
</span><span id="L-3667"><a href="#L-3667"><span class="linenos">3667</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_url_files: </span><span class="si">{</span><span class="n">dbsnp_url_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3668"><a href="#L-3668"><span class="linenos">3668</span></a>
</span><span id="L-3669"><a href="#L-3669"><span class="linenos">3669</span></a>    <span class="c1"># Files to generate</span>
</span><span id="L-3670"><a href="#L-3670"><span class="linenos">3670</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_vcf: </span><span class="si">{</span><span class="n">dbsnp_vcf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3671"><a href="#L-3671"><span class="linenos">3671</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_parquet: </span><span class="si">{</span><span class="n">dbsnp_parquet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3672"><a href="#L-3672"><span class="linenos">3672</span></a>
</span><span id="L-3673"><a href="#L-3673"><span class="linenos">3673</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="L-3674"><a href="#L-3674"><span class="linenos">3674</span></a>
</span><span id="L-3675"><a href="#L-3675"><span class="linenos">3675</span></a>        <span class="c1"># Log</span>
</span><span id="L-3676"><a href="#L-3676"><span class="linenos">3676</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3677"><a href="#L-3677"><span class="linenos">3677</span></a>
</span><span id="L-3678"><a href="#L-3678"><span class="linenos">3678</span></a>        <span class="c1"># Folder</span>
</span><span id="L-3679"><a href="#L-3679"><span class="linenos">3679</span></a>        <span class="n">dbsnp_folder_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbsnp_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="L-3680"><a href="#L-3680"><span class="linenos">3680</span></a>
</span><span id="L-3681"><a href="#L-3681"><span class="linenos">3681</span></a>        <span class="k">for</span> <span class="n">dbsnp_release</span> <span class="ow">in</span> <span class="n">dbsnp_releases</span><span class="p">:</span>
</span><span id="L-3682"><a href="#L-3682"><span class="linenos">3682</span></a>
</span><span id="L-3683"><a href="#L-3683"><span class="linenos">3683</span></a>            <span class="c1"># Log</span>
</span><span id="L-3684"><a href="#L-3684"><span class="linenos">3684</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3685"><a href="#L-3685"><span class="linenos">3685</span></a>
</span><span id="L-3686"><a href="#L-3686"><span class="linenos">3686</span></a>            <span class="c1"># Folder</span>
</span><span id="L-3687"><a href="#L-3687"><span class="linenos">3687</span></a>            <span class="n">dbsnp_folder_assembly_release</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3688"><a href="#L-3688"><span class="linenos">3688</span></a>                <span class="n">dbsnp_folder_assembly</span><span class="p">,</span> <span class="n">dbsnp_release</span>
</span><span id="L-3689"><a href="#L-3689"><span class="linenos">3689</span></a>            <span class="p">)</span>
</span><span id="L-3690"><a href="#L-3690"><span class="linenos">3690</span></a>
</span><span id="L-3691"><a href="#L-3691"><span class="linenos">3691</span></a>            <span class="c1"># Create folder if not exists</span>
</span><span id="L-3692"><a href="#L-3692"><span class="linenos">3692</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_folder_assembly_release</span><span class="p">):</span>
</span><span id="L-3693"><a href="#L-3693"><span class="linenos">3693</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">dbsnp_folder_assembly_release</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3694"><a href="#L-3694"><span class="linenos">3694</span></a>
</span><span id="L-3695"><a href="#L-3695"><span class="linenos">3695</span></a>            <span class="c1"># Construct URL</span>
</span><span id="L-3696"><a href="#L-3696"><span class="linenos">3696</span></a>            <span class="k">if</span> <span class="n">dbsnp_url_files</span> <span class="ow">and</span> <span class="n">dbsnp_url_files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3697"><a href="#L-3697"><span class="linenos">3697</span></a>                <span class="n">dbsnp_url_file</span> <span class="o">=</span> <span class="n">dbsnp_url_files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span>
</span><span id="L-3698"><a href="#L-3698"><span class="linenos">3698</span></a>            <span class="k">elif</span> <span class="n">dbsnp_assemblies_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3699"><a href="#L-3699"><span class="linenos">3699</span></a>                <span class="n">dbsnp_url_file</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3700"><a href="#L-3700"><span class="linenos">3700</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_url_files_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dbsnp_assemblies_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="L-3701"><a href="#L-3701"><span class="linenos">3701</span></a>                <span class="p">)</span>
</span><span id="L-3702"><a href="#L-3702"><span class="linenos">3702</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3703"><a href="#L-3703"><span class="linenos">3703</span></a>                <span class="n">dbsnp_url_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3704"><a href="#L-3704"><span class="linenos">3704</span></a>
</span><span id="L-3705"><a href="#L-3705"><span class="linenos">3705</span></a>            <span class="k">if</span> <span class="n">dbsnp_url_file</span><span class="p">:</span>
</span><span id="L-3706"><a href="#L-3706"><span class="linenos">3706</span></a>                <span class="n">dbsnp_url_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3707"><a href="#L-3707"><span class="linenos">3707</span></a>                    <span class="n">dbsnp_url</span><span class="p">,</span> <span class="n">dbsnp_release</span><span class="p">,</span> <span class="s2">&quot;VCF&quot;</span><span class="p">,</span> <span class="n">dbsnp_url_file</span>
</span><span id="L-3708"><a href="#L-3708"><span class="linenos">3708</span></a>                <span class="p">)</span>
</span><span id="L-3709"><a href="#L-3709"><span class="linenos">3709</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3710"><a href="#L-3710"><span class="linenos">3710</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No dbSNP file from URL provided&quot;</span><span class="p">)</span>
</span><span id="L-3711"><a href="#L-3711"><span class="linenos">3711</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No dbSNP file from URL provided&quot;</span><span class="p">)</span>
</span><span id="L-3712"><a href="#L-3712"><span class="linenos">3712</span></a>
</span><span id="L-3713"><a href="#L-3713"><span class="linenos">3713</span></a>            <span class="c1"># Construct File</span>
</span><span id="L-3714"><a href="#L-3714"><span class="linenos">3714</span></a>            <span class="n">dbsnp_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3715"><a href="#L-3715"><span class="linenos">3715</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_url_path</span><span class="p">)</span>
</span><span id="L-3716"><a href="#L-3716"><span class="linenos">3716</span></a>            <span class="p">)</span>
</span><span id="L-3717"><a href="#L-3717"><span class="linenos">3717</span></a>
</span><span id="L-3718"><a href="#L-3718"><span class="linenos">3718</span></a>            <span class="c1">### Download dbSNP</span>
</span><span id="L-3719"><a href="#L-3719"><span class="linenos">3719</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">):</span>
</span><span id="L-3720"><a href="#L-3720"><span class="linenos">3720</span></a>
</span><span id="L-3721"><a href="#L-3721"><span class="linenos">3721</span></a>                <span class="c1"># Log</span>
</span><span id="L-3722"><a href="#L-3722"><span class="linenos">3722</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3723"><a href="#L-3723"><span class="linenos">3723</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Download &#39;</span><span class="si">{</span><span class="n">dbsnp_url_file</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="L-3724"><a href="#L-3724"><span class="linenos">3724</span></a>                <span class="p">)</span>
</span><span id="L-3725"><a href="#L-3725"><span class="linenos">3725</span></a>
</span><span id="L-3726"><a href="#L-3726"><span class="linenos">3726</span></a>                <span class="c1"># Create folder if not exists</span>
</span><span id="L-3727"><a href="#L-3727"><span class="linenos">3727</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">)):</span>
</span><span id="L-3728"><a href="#L-3728"><span class="linenos">3728</span></a>                    <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3729"><a href="#L-3729"><span class="linenos">3729</span></a>
</span><span id="L-3730"><a href="#L-3730"><span class="linenos">3730</span></a>                <span class="c1"># Download file</span>
</span><span id="L-3731"><a href="#L-3731"><span class="linenos">3731</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3732"><a href="#L-3732"><span class="linenos">3732</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">dbsnp_url_path</span><span class="p">,</span> <span class="n">dest_file_path</span><span class="o">=</span><span class="n">dbsnp_file</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span>
</span><span id="L-3733"><a href="#L-3733"><span class="linenos">3733</span></a>                <span class="p">)</span>
</span><span id="L-3734"><a href="#L-3734"><span class="linenos">3734</span></a>
</span><span id="L-3735"><a href="#L-3735"><span class="linenos">3735</span></a>                <span class="c1"># Index tbi</span>
</span><span id="L-3736"><a href="#L-3736"><span class="linenos">3736</span></a>                <span class="n">dbsnp_url_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_url_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="L-3737"><a href="#L-3737"><span class="linenos">3737</span></a>                <span class="n">dbsnp_file_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_file</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="L-3738"><a href="#L-3738"><span class="linenos">3738</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="L-3739"><a href="#L-3739"><span class="linenos">3739</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">dbsnp_url_path_tbi</span><span class="p">,</span>
</span><span id="L-3740"><a href="#L-3740"><span class="linenos">3740</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">dbsnp_file_tbi</span><span class="p">,</span>
</span><span id="L-3741"><a href="#L-3741"><span class="linenos">3741</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3742"><a href="#L-3742"><span class="linenos">3742</span></a>                <span class="p">)</span>
</span><span id="L-3743"><a href="#L-3743"><span class="linenos">3743</span></a>
</span><span id="L-3744"><a href="#L-3744"><span class="linenos">3744</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3745"><a href="#L-3745"><span class="linenos">3745</span></a>
</span><span id="L-3746"><a href="#L-3746"><span class="linenos">3746</span></a>                <span class="c1"># Log</span>
</span><span id="L-3747"><a href="#L-3747"><span class="linenos">3747</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3748"><a href="#L-3748"><span class="linenos">3748</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Database </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">)</span><span class="si">}</span><span class="s2"> already downloaded&quot;</span>
</span><span id="L-3749"><a href="#L-3749"><span class="linenos">3749</span></a>                <span class="p">)</span>
</span><span id="L-3750"><a href="#L-3750"><span class="linenos">3750</span></a>
</span><span id="L-3751"><a href="#L-3751"><span class="linenos">3751</span></a>            <span class="c1">### Generate VCF and/or Parquet</span>
</span><span id="L-3752"><a href="#L-3752"><span class="linenos">3752</span></a>
</span><span id="L-3753"><a href="#L-3753"><span class="linenos">3753</span></a>            <span class="c1"># Construct VCF File</span>
</span><span id="L-3754"><a href="#L-3754"><span class="linenos">3754</span></a>            <span class="n">dbsnp_vcf_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.vcf.gz&quot;</span><span class="p">)</span>
</span><span id="L-3755"><a href="#L-3755"><span class="linenos">3755</span></a>            <span class="n">dbsnp_vcf_file_buffer</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3756"><a href="#L-3756"><span class="linenos">3756</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.buffer.vcf.gz&quot;</span>
</span><span id="L-3757"><a href="#L-3757"><span class="linenos">3757</span></a>            <span class="p">)</span>
</span><span id="L-3758"><a href="#L-3758"><span class="linenos">3758</span></a>
</span><span id="L-3759"><a href="#L-3759"><span class="linenos">3759</span></a>            <span class="c1"># Construct File</span>
</span><span id="L-3760"><a href="#L-3760"><span class="linenos">3760</span></a>            <span class="n">dbsnp_parquet_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3761"><a href="#L-3761"><span class="linenos">3761</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.parquet&quot;</span>
</span><span id="L-3762"><a href="#L-3762"><span class="linenos">3762</span></a>            <span class="p">)</span>
</span><span id="L-3763"><a href="#L-3763"><span class="linenos">3763</span></a>            <span class="n">dbsnp_parquet_file_buffer</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3764"><a href="#L-3764"><span class="linenos">3764</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.buffer.parquet&quot;</span>
</span><span id="L-3765"><a href="#L-3765"><span class="linenos">3765</span></a>            <span class="p">)</span>
</span><span id="L-3766"><a href="#L-3766"><span class="linenos">3766</span></a>            <span class="n">dbsnp_parquet_hdr_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3767"><a href="#L-3767"><span class="linenos">3767</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.parquet.hdr&quot;</span>
</span><span id="L-3768"><a href="#L-3768"><span class="linenos">3768</span></a>            <span class="p">)</span>
</span><span id="L-3769"><a href="#L-3769"><span class="linenos">3769</span></a>
</span><span id="L-3770"><a href="#L-3770"><span class="linenos">3770</span></a>            <span class="c1"># Files to generate or already generated</span>
</span><span id="L-3771"><a href="#L-3771"><span class="linenos">3771</span></a>            <span class="n">dbsnp_files_to_generate</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3772"><a href="#L-3772"><span class="linenos">3772</span></a>            <span class="n">dbsnp_files_already_generated</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3773"><a href="#L-3773"><span class="linenos">3773</span></a>
</span><span id="L-3774"><a href="#L-3774"><span class="linenos">3774</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3775"><a href="#L-3775"><span class="linenos">3775</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">)</span>
</span><span id="L-3776"><a href="#L-3776"><span class="linenos">3776</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">dbsnp_vcf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">))</span>
</span><span id="L-3777"><a href="#L-3777"><span class="linenos">3777</span></a>                <span class="ow">or</span> <span class="p">(</span><span class="n">dbsnp_parquet</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">))</span>
</span><span id="L-3778"><a href="#L-3778"><span class="linenos">3778</span></a>            <span class="p">):</span>
</span><span id="L-3779"><a href="#L-3779"><span class="linenos">3779</span></a>
</span><span id="L-3780"><a href="#L-3780"><span class="linenos">3780</span></a>                <span class="k">if</span> <span class="n">dbsnp_vcf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">):</span>
</span><span id="L-3781"><a href="#L-3781"><span class="linenos">3781</span></a>                    <span class="n">write_vcf</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3782"><a href="#L-3782"><span class="linenos">3782</span></a>                    <span class="n">dbsnp_files_to_generate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">))</span>
</span><span id="L-3783"><a href="#L-3783"><span class="linenos">3783</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-3784"><a href="#L-3784"><span class="linenos">3784</span></a>                    <span class="n">write_vcf</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3785"><a href="#L-3785"><span class="linenos">3785</span></a>                    <span class="k">if</span> <span class="n">dbsnp_vcf</span><span class="p">:</span>
</span><span id="L-3786"><a href="#L-3786"><span class="linenos">3786</span></a>                        <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-3787"><a href="#L-3787"><span class="linenos">3787</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">)</span>
</span><span id="L-3788"><a href="#L-3788"><span class="linenos">3788</span></a>                        <span class="p">)</span>
</span><span id="L-3789"><a href="#L-3789"><span class="linenos">3789</span></a>
</span><span id="L-3790"><a href="#L-3790"><span class="linenos">3790</span></a>                <span class="k">if</span> <span class="n">dbsnp_parquet</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">):</span>
</span><span id="L-3791"><a href="#L-3791"><span class="linenos">3791</span></a>                    <span class="n">write_parquet</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3792"><a href="#L-3792"><span class="linenos">3792</span></a>                    <span class="n">dbsnp_files_to_generate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">))</span>
</span><span id="L-3793"><a href="#L-3793"><span class="linenos">3793</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-3794"><a href="#L-3794"><span class="linenos">3794</span></a>                    <span class="n">write_parquet</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3795"><a href="#L-3795"><span class="linenos">3795</span></a>                    <span class="k">if</span> <span class="n">dbsnp_parquet</span><span class="p">:</span>
</span><span id="L-3796"><a href="#L-3796"><span class="linenos">3796</span></a>                        <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-3797"><a href="#L-3797"><span class="linenos">3797</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">)</span>
</span><span id="L-3798"><a href="#L-3798"><span class="linenos">3798</span></a>                        <span class="p">)</span>
</span><span id="L-3799"><a href="#L-3799"><span class="linenos">3799</span></a>
</span><span id="L-3800"><a href="#L-3800"><span class="linenos">3800</span></a>                <span class="c1"># Log</span>
</span><span id="L-3801"><a href="#L-3801"><span class="linenos">3801</span></a>                <span class="k">if</span> <span class="n">dbsnp_files_already_generated</span><span class="p">:</span>
</span><span id="L-3802"><a href="#L-3802"><span class="linenos">3802</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3803"><a href="#L-3803"><span class="linenos">3803</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Files </span><span class="si">{</span><span class="n">dbsnp_files_already_generated</span><span class="si">}</span><span class="s2"> already generated&quot;</span>
</span><span id="L-3804"><a href="#L-3804"><span class="linenos">3804</span></a>                    <span class="p">)</span>
</span><span id="L-3805"><a href="#L-3805"><span class="linenos">3805</span></a>                <span class="k">if</span> <span class="n">dbsnp_files_to_generate</span><span class="p">:</span>
</span><span id="L-3806"><a href="#L-3806"><span class="linenos">3806</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-3807"><a href="#L-3807"><span class="linenos">3807</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Files </span><span class="si">{</span><span class="n">dbsnp_files_to_generate</span><span class="si">}</span><span class="s2"> generation...&quot;</span>
</span><span id="L-3808"><a href="#L-3808"><span class="linenos">3808</span></a>                    <span class="p">)</span>
</span><span id="L-3809"><a href="#L-3809"><span class="linenos">3809</span></a>
</span><span id="L-3810"><a href="#L-3810"><span class="linenos">3810</span></a>                <span class="c1"># Generate Header</span>
</span><span id="L-3811"><a href="#L-3811"><span class="linenos">3811</span></a>
</span><span id="L-3812"><a href="#L-3812"><span class="linenos">3812</span></a>                <span class="c1"># Genome index</span>
</span><span id="L-3813"><a href="#L-3813"><span class="linenos">3813</span></a>                <span class="n">genome_index</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3814"><a href="#L-3814"><span class="linenos">3814</span></a>                    <span class="n">genomes_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.fa.fai&quot;</span>
</span><span id="L-3815"><a href="#L-3815"><span class="linenos">3815</span></a>                <span class="p">)</span>
</span><span id="L-3816"><a href="#L-3816"><span class="linenos">3816</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genome_index</span><span class="p">):</span>
</span><span id="L-3817"><a href="#L-3817"><span class="linenos">3817</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No genome index&quot;</span><span class="p">)</span>
</span><span id="L-3818"><a href="#L-3818"><span class="linenos">3818</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No genome index&quot;</span><span class="p">)</span>
</span><span id="L-3819"><a href="#L-3819"><span class="linenos">3819</span></a>
</span><span id="L-3820"><a href="#L-3820"><span class="linenos">3820</span></a>                <span class="c1"># Database</span>
</span><span id="L-3821"><a href="#L-3821"><span class="linenos">3821</span></a>                <span class="n">conn_config_db</span> <span class="o">=</span> <span class="n">conn_config</span>
</span><span id="L-3822"><a href="#L-3822"><span class="linenos">3822</span></a>                <span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span>
</span><span id="L-3823"><a href="#L-3823"><span class="linenos">3823</span></a>                    <span class="n">database</span><span class="o">=</span><span class="n">dbsnp_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;vcf&quot;</span><span class="p">,</span> <span class="n">conn_config</span><span class="o">=</span><span class="n">conn_config_db</span>
</span><span id="L-3824"><a href="#L-3824"><span class="linenos">3824</span></a>                <span class="p">)</span>
</span><span id="L-3825"><a href="#L-3825"><span class="linenos">3825</span></a>
</span><span id="L-3826"><a href="#L-3826"><span class="linenos">3826</span></a>                <span class="c1"># Header</span>
</span><span id="L-3827"><a href="#L-3827"><span class="linenos">3827</span></a>                <span class="n">header_file_tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_file</span><span class="si">}</span><span class="s2">.tmp.hdr&quot;</span>
</span><span id="L-3828"><a href="#L-3828"><span class="linenos">3828</span></a>                <span class="n">db_header</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">header_file</span><span class="o">=</span><span class="n">header_file_tmp</span><span class="p">)</span>
</span><span id="L-3829"><a href="#L-3829"><span class="linenos">3829</span></a>                <span class="n">db_header_file</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_header_file</span><span class="p">(</span><span class="n">header_file</span><span class="o">=</span><span class="n">header_file_tmp</span><span class="p">)</span>
</span><span id="L-3830"><a href="#L-3830"><span class="linenos">3830</span></a>                <span class="n">db_header_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_header_file</span><span class="p">(</span><span class="n">header_file</span><span class="o">=</span><span class="n">db_header_file</span><span class="p">)</span>
</span><span id="L-3831"><a href="#L-3831"><span class="linenos">3831</span></a>
</span><span id="L-3832"><a href="#L-3832"><span class="linenos">3832</span></a>                <span class="c1"># Header info/format...</span>
</span><span id="L-3833"><a href="#L-3833"><span class="linenos">3833</span></a>                <span class="n">db_header_list_new</span> <span class="o">=</span> <span class="n">db_header_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-3834"><a href="#L-3834"><span class="linenos">3834</span></a>                <span class="c1"># Header #CHROM line</span>
</span><span id="L-3835"><a href="#L-3835"><span class="linenos">3835</span></a>                <span class="n">db_header_list_chrom</span> <span class="o">=</span> <span class="p">[</span><span class="n">db_header_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-3836"><a href="#L-3836"><span class="linenos">3836</span></a>                <span class="c1"># Header Contig</span>
</span><span id="L-3837"><a href="#L-3837"><span class="linenos">3837</span></a>                <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span id="L-3838"><a href="#L-3838"><span class="linenos">3838</span></a>                    <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-3839"><a href="#L-3839"><span class="linenos">3839</span></a><span class="s2">                            SELECT</span>
</span><span id="L-3840"><a href="#L-3840"><span class="linenos">3840</span></a><span class="s2">                                    column0 AS chr,</span>
</span><span id="L-3841"><a href="#L-3841"><span class="linenos">3841</span></a><span class="s2">                                    concat(</span>
</span><span id="L-3842"><a href="#L-3842"><span class="linenos">3842</span></a><span class="s2">                                        &#39;##contig=&lt;ID=&#39;,</span>
</span><span id="L-3843"><a href="#L-3843"><span class="linenos">3843</span></a><span class="s2">                                        column0,</span>
</span><span id="L-3844"><a href="#L-3844"><span class="linenos">3844</span></a><span class="s2">                                        &#39;,length=&#39;,</span>
</span><span id="L-3845"><a href="#L-3845"><span class="linenos">3845</span></a><span class="s2">                                        column1,</span>
</span><span id="L-3846"><a href="#L-3846"><span class="linenos">3846</span></a><span class="s2">                                        &#39;&gt;</span><span class="se">\n</span><span class="s2">&#39;</span>
</span><span id="L-3847"><a href="#L-3847"><span class="linenos">3847</span></a><span class="s2">                                    ) AS contig</span>
</span><span id="L-3848"><a href="#L-3848"><span class="linenos">3848</span></a><span class="s2">                            FROM read_csv_auto(&#39;</span><span class="si">{</span><span class="n">genome_index</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="L-3849"><a href="#L-3849"><span class="linenos">3849</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="L-3850"><a href="#L-3850"><span class="linenos">3850</span></a>                <span class="p">)</span>
</span><span id="L-3851"><a href="#L-3851"><span class="linenos">3851</span></a>                <span class="n">db_header_list_chrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;chr&quot;</span><span class="p">])</span>
</span><span id="L-3852"><a href="#L-3852"><span class="linenos">3852</span></a>                <span class="n">db_header_list_contigs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;contig&quot;</span><span class="p">])</span>
</span><span id="L-3853"><a href="#L-3853"><span class="linenos">3853</span></a>
</span><span id="L-3854"><a href="#L-3854"><span class="linenos">3854</span></a>                <span class="c1"># Write new heaer with contigs</span>
</span><span id="L-3855"><a href="#L-3855"><span class="linenos">3855</span></a>                <span class="n">db_header_new</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_header_from_list</span><span class="p">(</span>
</span><span id="L-3856"><a href="#L-3856"><span class="linenos">3856</span></a>                    <span class="n">header_list</span><span class="o">=</span><span class="n">db_header_list_new</span>
</span><span id="L-3857"><a href="#L-3857"><span class="linenos">3857</span></a>                    <span class="o">+</span> <span class="n">db_header_list_contigs</span>
</span><span id="L-3858"><a href="#L-3858"><span class="linenos">3858</span></a>                    <span class="o">+</span> <span class="n">db_header_list_chrom</span>
</span><span id="L-3859"><a href="#L-3859"><span class="linenos">3859</span></a>                <span class="p">)</span>
</span><span id="L-3860"><a href="#L-3860"><span class="linenos">3860</span></a>                <span class="n">vcf</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">db_header_new</span><span class="p">)</span>
</span><span id="L-3861"><a href="#L-3861"><span class="linenos">3861</span></a>
</span><span id="L-3862"><a href="#L-3862"><span class="linenos">3862</span></a>                <span class="c1"># Header</span>
</span><span id="L-3863"><a href="#L-3863"><span class="linenos">3863</span></a>                <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_vcf_file</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="L-3864"><a href="#L-3864"><span class="linenos">3864</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">header_file</span><span class="p">)</span>
</span><span id="L-3865"><a href="#L-3865"><span class="linenos">3865</span></a>
</span><span id="L-3866"><a href="#L-3866"><span class="linenos">3866</span></a>                <span class="c1"># INFO fields</span>
</span><span id="L-3867"><a href="#L-3867"><span class="linenos">3867</span></a>                <span class="n">query_select_info_fields_array</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3868"><a href="#L-3868"><span class="linenos">3868</span></a>                <span class="k">if</span> <span class="n">write_parquet</span> <span class="ow">and</span> <span class="n">dbsnp_parquet_explode_infos</span><span class="p">:</span>
</span><span id="L-3869"><a href="#L-3869"><span class="linenos">3869</span></a>                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">db_header</span><span class="o">.</span><span class="n">infos</span><span class="p">:</span>
</span><span id="L-3870"><a href="#L-3870"><span class="linenos">3870</span></a>                        <span class="k">if</span> <span class="n">db_header</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Flag&quot;</span><span class="p">:</span>
</span><span id="L-3871"><a href="#L-3871"><span class="linenos">3871</span></a>                            <span class="n">query_select_info_fields_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-3872"><a href="#L-3872"><span class="linenos">3872</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-3873"><a href="#L-3873"><span class="linenos">3873</span></a><span class="s2">                                concat(&#39;;&#39;, INFO, &#39;;&#39;) LIKE &#39;%;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">;%&#39;</span>
</span><span id="L-3874"><a href="#L-3874"><span class="linenos">3874</span></a><span class="s2">                                AS </span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">                             </span>
</span><span id="L-3875"><a href="#L-3875"><span class="linenos">3875</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="L-3876"><a href="#L-3876"><span class="linenos">3876</span></a>                            <span class="p">)</span>
</span><span id="L-3877"><a href="#L-3877"><span class="linenos">3877</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3878"><a href="#L-3878"><span class="linenos">3878</span></a>                            <span class="n">query_select_info_fields_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-3879"><a href="#L-3879"><span class="linenos">3879</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-3880"><a href="#L-3880"><span class="linenos">3880</span></a><span class="s2">                                CASE</span>
</span><span id="L-3881"><a href="#L-3881"><span class="linenos">3881</span></a><span class="s2">                                    WHEN concat(&#39;;&#39;, INFO) NOT LIKE &#39;%;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">=%&#39; THEN NULL</span>
</span><span id="L-3882"><a href="#L-3882"><span class="linenos">3882</span></a><span class="s2">                                    ELSE REGEXP_EXTRACT(concat(&#39;;&#39;, INFO), &#39;;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">=([^;]*)&#39;,1)</span>
</span><span id="L-3883"><a href="#L-3883"><span class="linenos">3883</span></a><span class="s2">                                END AS </span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">                             </span>
</span><span id="L-3884"><a href="#L-3884"><span class="linenos">3884</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="L-3885"><a href="#L-3885"><span class="linenos">3885</span></a>                            <span class="p">)</span>
</span><span id="L-3886"><a href="#L-3886"><span class="linenos">3886</span></a>                <span class="n">query_select_info_fields</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">query_select_info_fields_array</span><span class="p">)</span>
</span><span id="L-3887"><a href="#L-3887"><span class="linenos">3887</span></a>
</span><span id="L-3888"><a href="#L-3888"><span class="linenos">3888</span></a>                <span class="c1"># Chunk CSV</span>
</span><span id="L-3889"><a href="#L-3889"><span class="linenos">3889</span></a>                <span class="n">chunksize</span> <span class="o">=</span> <span class="mi">1000000</span>
</span><span id="L-3890"><a href="#L-3890"><span class="linenos">3890</span></a>                <span class="n">skiprows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db_header_list</span><span class="p">)</span>
</span><span id="L-3891"><a href="#L-3891"><span class="linenos">3891</span></a>                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3892"><a href="#L-3892"><span class="linenos">3892</span></a>                    <span class="s2">&quot;CHROM_OLD&quot;</span><span class="p">,</span>
</span><span id="L-3893"><a href="#L-3893"><span class="linenos">3893</span></a>                    <span class="s2">&quot;POS&quot;</span><span class="p">,</span>
</span><span id="L-3894"><a href="#L-3894"><span class="linenos">3894</span></a>                    <span class="s2">&quot;ID&quot;</span><span class="p">,</span>
</span><span id="L-3895"><a href="#L-3895"><span class="linenos">3895</span></a>                    <span class="s2">&quot;REF&quot;</span><span class="p">,</span>
</span><span id="L-3896"><a href="#L-3896"><span class="linenos">3896</span></a>                    <span class="s2">&quot;ALT&quot;</span><span class="p">,</span>
</span><span id="L-3897"><a href="#L-3897"><span class="linenos">3897</span></a>                    <span class="s2">&quot;QUAL&quot;</span><span class="p">,</span>
</span><span id="L-3898"><a href="#L-3898"><span class="linenos">3898</span></a>                    <span class="s2">&quot;FILTER&quot;</span><span class="p">,</span>
</span><span id="L-3899"><a href="#L-3899"><span class="linenos">3899</span></a>                    <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
</span><span id="L-3900"><a href="#L-3900"><span class="linenos">3900</span></a>                <span class="p">]</span>
</span><span id="L-3901"><a href="#L-3901"><span class="linenos">3901</span></a>                <span class="n">chunk_csv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-3902"><a href="#L-3902"><span class="linenos">3902</span></a>                    <span class="n">dbsnp_file</span><span class="p">,</span>
</span><span id="L-3903"><a href="#L-3903"><span class="linenos">3903</span></a>                    <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-3904"><a href="#L-3904"><span class="linenos">3904</span></a>                    <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
</span><span id="L-3905"><a href="#L-3905"><span class="linenos">3905</span></a>                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3906"><a href="#L-3906"><span class="linenos">3906</span></a>                    <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span>
</span><span id="L-3907"><a href="#L-3907"><span class="linenos">3907</span></a>                    <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
</span><span id="L-3908"><a href="#L-3908"><span class="linenos">3908</span></a>                <span class="p">)</span>
</span><span id="L-3909"><a href="#L-3909"><span class="linenos">3909</span></a>                <span class="n">chunk_i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3910"><a href="#L-3910"><span class="linenos">3910</span></a>
</span><span id="L-3911"><a href="#L-3911"><span class="linenos">3911</span></a>                <span class="c1"># Open CSV filewith pgzip compression</span>
</span><span id="L-3912"><a href="#L-3912"><span class="linenos">3912</span></a>                <span class="k">with</span> <span class="n">pgzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dbsnp_vcf_file_buffer</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">thread</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-3913"><a href="#L-3913"><span class="linenos">3913</span></a>
</span><span id="L-3914"><a href="#L-3914"><span class="linenos">3914</span></a>                    <span class="c1"># fetch chunk</span>
</span><span id="L-3915"><a href="#L-3915"><span class="linenos">3915</span></a>                    <span class="k">for</span> <span class="n">df_chunk</span> <span class="ow">in</span> <span class="n">chunk_csv</span><span class="p">:</span>
</span><span id="L-3916"><a href="#L-3916"><span class="linenos">3916</span></a>
</span><span id="L-3917"><a href="#L-3917"><span class="linenos">3917</span></a>                        <span class="c1"># Chunk i</span>
</span><span id="L-3918"><a href="#L-3918"><span class="linenos">3918</span></a>                        <span class="n">chunk_i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3919"><a href="#L-3919"><span class="linenos">3919</span></a>
</span><span id="L-3920"><a href="#L-3920"><span class="linenos">3920</span></a>                        <span class="c1"># Write CSV</span>
</span><span id="L-3921"><a href="#L-3921"><span class="linenos">3921</span></a>                        <span class="k">if</span> <span class="n">write_vcf</span><span class="p">:</span>
</span><span id="L-3922"><a href="#L-3922"><span class="linenos">3922</span></a>                            <span class="c1"># Query</span>
</span><span id="L-3923"><a href="#L-3923"><span class="linenos">3923</span></a>                            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-3924"><a href="#L-3924"><span class="linenos">3924</span></a><span class="s2">                                SELECT </span>
</span><span id="L-3925"><a href="#L-3925"><span class="linenos">3925</span></a><span class="s2">                                        concat(</span>
</span><span id="L-3926"><a href="#L-3926"><span class="linenos">3926</span></a><span class="s2">                                            &#39;chr&#39;,</span>
</span><span id="L-3927"><a href="#L-3927"><span class="linenos">3927</span></a><span class="s2">                                            replace(replace(replace(regexp_extract(&quot;CHROM_OLD&quot;, &#39;NC_[0]*([0-9]*)_?&#39;, 1), &#39;23&#39;, &#39;X&#39;), &#39;24&#39;, &#39;Y&#39;), &#39;25&#39;, &#39;M&#39;)</span>
</span><span id="L-3928"><a href="#L-3928"><span class="linenos">3928</span></a><span class="s2">                                        ) AS &#39;#CHROM&#39;,</span>
</span><span id="L-3929"><a href="#L-3929"><span class="linenos">3929</span></a><span class="s2">                                        &quot;POS&quot;, &quot;ID&quot;, &quot;REF&quot;,</span>
</span><span id="L-3930"><a href="#L-3930"><span class="linenos">3930</span></a><span class="s2">                                        UNNEST(string_split(CAST(&quot;ALT&quot; AS VARCHAR), &#39;,&#39;)) AS &#39;ALT&#39;,</span>
</span><span id="L-3931"><a href="#L-3931"><span class="linenos">3931</span></a><span class="s2">                                        &quot;QUAL&quot;, &quot;FILTER&quot;, &quot;INFO&quot;</span>
</span><span id="L-3932"><a href="#L-3932"><span class="linenos">3932</span></a><span class="s2">                                FROM df_chunk</span>
</span><span id="L-3933"><a href="#L-3933"><span class="linenos">3933</span></a><span class="s2">                                WHERE list_contains(</span><span class="si">{</span><span class="n">db_header_list_chrs</span><span class="si">}</span><span class="s2">, &quot;#CHROM&quot;)</span>
</span><span id="L-3934"><a href="#L-3934"><span class="linenos">3934</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-3935"><a href="#L-3935"><span class="linenos">3935</span></a>                            <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-3936"><a href="#L-3936"><span class="linenos">3936</span></a>                            <span class="c1"># Use polars to parallelize csv write and an infile with pgzip to parallelise compression</span>
</span><span id="L-3937"><a href="#L-3937"><span class="linenos">3937</span></a>                            <span class="n">res</span><span class="o">.</span><span class="n">pl</span><span class="p">()</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">include_header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3938"><a href="#L-3938"><span class="linenos">3938</span></a>
</span><span id="L-3939"><a href="#L-3939"><span class="linenos">3939</span></a>                        <span class="c1"># Write Parquet</span>
</span><span id="L-3940"><a href="#L-3940"><span class="linenos">3940</span></a>                        <span class="k">if</span> <span class="n">write_parquet</span><span class="p">:</span>
</span><span id="L-3941"><a href="#L-3941"><span class="linenos">3941</span></a>                            <span class="c1"># Query</span>
</span><span id="L-3942"><a href="#L-3942"><span class="linenos">3942</span></a>                            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-3943"><a href="#L-3943"><span class="linenos">3943</span></a><span class="s2">                                SELECT </span>
</span><span id="L-3944"><a href="#L-3944"><span class="linenos">3944</span></a><span class="s2">                                        concat(</span>
</span><span id="L-3945"><a href="#L-3945"><span class="linenos">3945</span></a><span class="s2">                                            &#39;chr&#39;,</span>
</span><span id="L-3946"><a href="#L-3946"><span class="linenos">3946</span></a><span class="s2">                                            replace(replace(replace(regexp_extract(&quot;CHROM_OLD&quot;, &#39;NC_[0]*([0-9]*)_?&#39;, 1), &#39;23&#39;, &#39;X&#39;), &#39;24&#39;, &#39;Y&#39;), &#39;25&#39;, &#39;M&#39;)</span>
</span><span id="L-3947"><a href="#L-3947"><span class="linenos">3947</span></a><span class="s2">                                        ) AS &#39;#CHROM&#39;,</span>
</span><span id="L-3948"><a href="#L-3948"><span class="linenos">3948</span></a><span class="s2">                                        &quot;POS&quot;, &quot;ID&quot;, &quot;REF&quot;,</span>
</span><span id="L-3949"><a href="#L-3949"><span class="linenos">3949</span></a><span class="s2">                                        UNNEST(string_split(CAST(&quot;ALT&quot; AS VARCHAR), &#39;,&#39;)) AS &#39;ALT&#39;,</span>
</span><span id="L-3950"><a href="#L-3950"><span class="linenos">3950</span></a><span class="s2">                                        &quot;QUAL&quot;, &quot;FILTER&quot;, &quot;INFO&quot;,</span>
</span><span id="L-3951"><a href="#L-3951"><span class="linenos">3951</span></a><span class="s2">                                        </span><span class="si">{</span><span class="n">query_select_info_fields</span><span class="si">}</span>
</span><span id="L-3952"><a href="#L-3952"><span class="linenos">3952</span></a><span class="s2">                                FROM df_chunk</span>
</span><span id="L-3953"><a href="#L-3953"><span class="linenos">3953</span></a><span class="s2">                                WHERE list_contains(</span><span class="si">{</span><span class="n">db_header_list_chrs</span><span class="si">}</span><span class="s2">, &quot;#CHROM&quot;)</span>
</span><span id="L-3954"><a href="#L-3954"><span class="linenos">3954</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="L-3955"><a href="#L-3955"><span class="linenos">3955</span></a>                            <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-3956"><a href="#L-3956"><span class="linenos">3956</span></a>                            <span class="c1"># Use pandas an to_parquet with append option ans fastparquet engine (no append with other df like polars or pyarrow)</span>
</span><span id="L-3957"><a href="#L-3957"><span class="linenos">3957</span></a>                            <span class="k">if</span> <span class="n">chunk_i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-3958"><a href="#L-3958"><span class="linenos">3958</span></a>                                <span class="n">append</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3959"><a href="#L-3959"><span class="linenos">3959</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3960"><a href="#L-3960"><span class="linenos">3960</span></a>                                <span class="n">append</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3961"><a href="#L-3961"><span class="linenos">3961</span></a>                            <span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="L-3962"><a href="#L-3962"><span class="linenos">3962</span></a>                                <span class="n">dbsnp_parquet_file_buffer</span><span class="p">,</span>
</span><span id="L-3963"><a href="#L-3963"><span class="linenos">3963</span></a>                                <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;fastparquet&quot;</span><span class="p">,</span>
</span><span id="L-3964"><a href="#L-3964"><span class="linenos">3964</span></a>                                <span class="n">append</span><span class="o">=</span><span class="n">append</span><span class="p">,</span>
</span><span id="L-3965"><a href="#L-3965"><span class="linenos">3965</span></a>                            <span class="p">)</span>
</span><span id="L-3966"><a href="#L-3966"><span class="linenos">3966</span></a>
</span><span id="L-3967"><a href="#L-3967"><span class="linenos">3967</span></a>                        <span class="c1"># Log</span>
</span><span id="L-3968"><a href="#L-3968"><span class="linenos">3968</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-3969"><a href="#L-3969"><span class="linenos">3969</span></a>                            <span class="sa">f</span><span class="s2">&quot;chunk </span><span class="si">{</span><span class="n">chunk_i</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chunksize</span><span class="o">*</span><span class="n">chunk_i</span><span class="si">}</span><span class="s2"> lines processed&quot;</span>
</span><span id="L-3970"><a href="#L-3970"><span class="linenos">3970</span></a>                        <span class="p">)</span>
</span><span id="L-3971"><a href="#L-3971"><span class="linenos">3971</span></a>
</span><span id="L-3972"><a href="#L-3972"><span class="linenos">3972</span></a>                <span class="c1"># Header</span>
</span><span id="L-3973"><a href="#L-3973"><span class="linenos">3973</span></a>
</span><span id="L-3974"><a href="#L-3974"><span class="linenos">3974</span></a>                <span class="k">if</span> <span class="n">write_vcf</span><span class="p">:</span>
</span><span id="L-3975"><a href="#L-3975"><span class="linenos">3975</span></a>                    <span class="c1"># Concat and Compress CSV with header to VCF in BGZIP compression type</span>
</span><span id="L-3976"><a href="#L-3976"><span class="linenos">3976</span></a>                    <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="L-3977"><a href="#L-3977"><span class="linenos">3977</span></a>                        <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="n">dbsnp_vcf_file_buffer</span><span class="p">],</span>
</span><span id="L-3978"><a href="#L-3978"><span class="linenos">3978</span></a>                        <span class="n">output_file</span><span class="o">=</span><span class="n">dbsnp_vcf_file</span><span class="p">,</span>
</span><span id="L-3979"><a href="#L-3979"><span class="linenos">3979</span></a>                        <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-3980"><a href="#L-3980"><span class="linenos">3980</span></a>                        <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="L-3981"><a href="#L-3981"><span class="linenos">3981</span></a>                        <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;bgzip&quot;</span><span class="p">,</span>
</span><span id="L-3982"><a href="#L-3982"><span class="linenos">3982</span></a>                        <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-3983"><a href="#L-3983"><span class="linenos">3983</span></a>                        <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-3984"><a href="#L-3984"><span class="linenos">3984</span></a>                    <span class="p">)</span>
</span><span id="L-3985"><a href="#L-3985"><span class="linenos">3985</span></a>
</span><span id="L-3986"><a href="#L-3986"><span class="linenos">3986</span></a>                <span class="k">if</span> <span class="n">write_parquet</span><span class="p">:</span>
</span><span id="L-3987"><a href="#L-3987"><span class="linenos">3987</span></a>                    <span class="c1"># Move Parquet buffer to Parquet</span>
</span><span id="L-3988"><a href="#L-3988"><span class="linenos">3988</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">dbsnp_parquet_file_buffer</span><span class="p">,</span> <span class="n">dbsnp_parquet_file</span><span class="p">)</span>
</span><span id="L-3989"><a href="#L-3989"><span class="linenos">3989</span></a>                    <span class="c1"># Copy header file</span>
</span><span id="L-3990"><a href="#L-3990"><span class="linenos">3990</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">header_file</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">dbsnp_parquet_hdr_file</span><span class="p">)</span>
</span><span id="L-3991"><a href="#L-3991"><span class="linenos">3991</span></a>
</span><span id="L-3992"><a href="#L-3992"><span class="linenos">3992</span></a>                <span class="c1"># Clean</span>
</span><span id="L-3993"><a href="#L-3993"><span class="linenos">3993</span></a>                <span class="n">remove_if_exists</span><span class="p">([</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="n">dbsnp_vcf_file_buffer</span><span class="p">])</span>
</span><span id="L-3994"><a href="#L-3994"><span class="linenos">3994</span></a>
</span><span id="L-3995"><a href="#L-3995"><span class="linenos">3995</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3996"><a href="#L-3996"><span class="linenos">3996</span></a>
</span><span id="L-3997"><a href="#L-3997"><span class="linenos">3997</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">):</span>
</span><span id="L-3998"><a href="#L-3998"><span class="linenos">3998</span></a>                    <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-3999"><a href="#L-3999"><span class="linenos">3999</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">)</span>
</span><span id="L-4000"><a href="#L-4000"><span class="linenos">4000</span></a>                    <span class="p">)</span>
</span><span id="L-4001"><a href="#L-4001"><span class="linenos">4001</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">):</span>
</span><span id="L-4002"><a href="#L-4002"><span class="linenos">4002</span></a>                    <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-4003"><a href="#L-4003"><span class="linenos">4003</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">)</span>
</span><span id="L-4004"><a href="#L-4004"><span class="linenos">4004</span></a>                    <span class="p">)</span>
</span><span id="L-4005"><a href="#L-4005"><span class="linenos">4005</span></a>                <span class="k">if</span> <span class="n">dbsnp_files_already_generated</span><span class="p">:</span>
</span><span id="L-4006"><a href="#L-4006"><span class="linenos">4006</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4007"><a href="#L-4007"><span class="linenos">4007</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Files </span><span class="si">{</span><span class="n">dbsnp_files_already_generated</span><span class="si">}</span><span class="s2"> already generated&quot;</span>
</span><span id="L-4008"><a href="#L-4008"><span class="linenos">4008</span></a>                    <span class="p">)</span>
</span><span id="L-4009"><a href="#L-4009"><span class="linenos">4009</span></a>
</span><span id="L-4010"><a href="#L-4010"><span class="linenos">4010</span></a>        <span class="c1"># Generate default release link</span>
</span><span id="L-4011"><a href="#L-4011"><span class="linenos">4011</span></a>        <span class="k">if</span> <span class="n">dbsnp_release_default_found</span><span class="p">:</span>
</span><span id="L-4012"><a href="#L-4012"><span class="linenos">4012</span></a>            <span class="n">dbsnp_release_default_link_src</span> <span class="o">=</span> <span class="n">dbsnp_release_default_found</span>
</span><span id="L-4013"><a href="#L-4013"><span class="linenos">4013</span></a>            <span class="n">dbsnp_release_default_link_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4014"><a href="#L-4014"><span class="linenos">4014</span></a>                <span class="n">dbsnp_folder_assembly</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span>
</span><span id="L-4015"><a href="#L-4015"><span class="linenos">4015</span></a>            <span class="p">)</span>
</span><span id="L-4016"><a href="#L-4016"><span class="linenos">4016</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-4017"><a href="#L-4017"><span class="linenos">4017</span></a>                <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">)</span>
</span><span id="L-4018"><a href="#L-4018"><span class="linenos">4018</span></a>                <span class="ow">or</span> <span class="n">dbsnp_release_default</span>
</span><span id="L-4019"><a href="#L-4019"><span class="linenos">4019</span></a>            <span class="p">):</span>
</span><span id="L-4020"><a href="#L-4020"><span class="linenos">4020</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4021"><a href="#L-4021"><span class="linenos">4021</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release_default_found</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Defined as default&quot;</span>
</span><span id="L-4022"><a href="#L-4022"><span class="linenos">4022</span></a>                <span class="p">)</span>
</span><span id="L-4023"><a href="#L-4023"><span class="linenos">4023</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-4024"><a href="#L-4024"><span class="linenos">4024</span></a>                    <span class="n">dbsnp_release_default_link_dest</span>
</span><span id="L-4025"><a href="#L-4025"><span class="linenos">4025</span></a>                <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">):</span>
</span><span id="L-4026"><a href="#L-4026"><span class="linenos">4026</span></a>                    <span class="n">remove_if_exists</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">)</span>
</span><span id="L-4027"><a href="#L-4027"><span class="linenos">4027</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span>
</span><span id="L-4028"><a href="#L-4028"><span class="linenos">4028</span></a>                        <span class="n">dbsnp_release_default_link_src</span><span class="p">,</span> <span class="n">dbsnp_release_default_link_dest</span>
</span><span id="L-4029"><a href="#L-4029"><span class="linenos">4029</span></a>                    <span class="p">)</span>
</span><span id="L-4030"><a href="#L-4030"><span class="linenos">4030</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-4031"><a href="#L-4031"><span class="linenos">4031</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-4032"><a href="#L-4032"><span class="linenos">4032</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Default release path is not a symlink. Change not allowed&quot;</span>
</span><span id="L-4033"><a href="#L-4033"><span class="linenos">4033</span></a>                    <span class="p">)</span>
</span><span id="L-4034"><a href="#L-4034"><span class="linenos">4034</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-4035"><a href="#L-4035"><span class="linenos">4035</span></a>                <span class="n">dbsnp_release_default_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
</span><span id="L-4036"><a href="#L-4036"><span class="linenos">4036</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">)</span>
</span><span id="L-4037"><a href="#L-4037"><span class="linenos">4037</span></a>                <span class="p">)</span>
</span><span id="L-4038"><a href="#L-4038"><span class="linenos">4038</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4039"><a href="#L-4039"><span class="linenos">4039</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release_default_already</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Already defined as default&quot;</span>
</span><span id="L-4040"><a href="#L-4040"><span class="linenos">4040</span></a>                <span class="p">)</span>
</span><span id="L-4041"><a href="#L-4041"><span class="linenos">4041</span></a>
</span><span id="L-4042"><a href="#L-4042"><span class="linenos">4042</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-4043"><a href="#L-4043"><span class="linenos">4043</span></a>
</span><span id="L-4044"><a href="#L-4044"><span class="linenos">4044</span></a>
</span><span id="L-4045"><a href="#L-4045"><span class="linenos">4045</span></a><span class="k">def</span> <span class="nf">databases_download_hgmd</span><span class="p">(</span>
</span><span id="L-4046"><a href="#L-4046"><span class="linenos">4046</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-4047"><a href="#L-4047"><span class="linenos">4047</span></a>    <span class="n">hgmd_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4048"><a href="#L-4048"><span class="linenos">4048</span></a>    <span class="n">hgmd_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATIONS_FOLDER</span><span class="p">,</span>
</span><span id="L-4049"><a href="#L-4049"><span class="linenos">4049</span></a>    <span class="n">output_basename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4050"><a href="#L-4050"><span class="linenos">4050</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4051"><a href="#L-4051"><span class="linenos">4051</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-4052"><a href="#L-4052"><span class="linenos">4052</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4053"><a href="#L-4053"><span class="linenos">4053</span></a>    <span class="n">to_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-4054"><a href="#L-4054"><span class="linenos">4054</span></a>    <span class="n">to_tsv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-4055"><a href="#L-4055"><span class="linenos">4055</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-4056"><a href="#L-4056"><span class="linenos">4056</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4057"><a href="#L-4057"><span class="linenos">4057</span></a><span class="sd">    The `databases_download_hgmd` function converts an HGMD database file into VCF, Parquet, and TSV</span>
</span><span id="L-4058"><a href="#L-4058"><span class="linenos">4058</span></a><span class="sd">    formats.</span>
</span><span id="L-4059"><a href="#L-4059"><span class="linenos">4059</span></a>
</span><span id="L-4060"><a href="#L-4060"><span class="linenos">4060</span></a><span class="sd">    :param assemblies: A list of assemblies for which the HGMD database should be downloaded and</span>
</span><span id="L-4061"><a href="#L-4061"><span class="linenos">4061</span></a><span class="sd">    converted. Only one assembly can be specified</span>
</span><span id="L-4062"><a href="#L-4062"><span class="linenos">4062</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="L-4063"><a href="#L-4063"><span class="linenos">4063</span></a><span class="sd">    :param hgmd_file: The `hgmd_file` parameter is a string that represents the path to the HGMD</span>
</span><span id="L-4064"><a href="#L-4064"><span class="linenos">4064</span></a><span class="sd">    database file in VCF format. This file contains the variants and their associated information</span>
</span><span id="L-4065"><a href="#L-4065"><span class="linenos">4065</span></a><span class="sd">    :type hgmd_file: str</span>
</span><span id="L-4066"><a href="#L-4066"><span class="linenos">4066</span></a><span class="sd">    :param hgmd_folder: The `hgmd_folder` parameter is a string that represents the path to the folder</span>
</span><span id="L-4067"><a href="#L-4067"><span class="linenos">4067</span></a><span class="sd">    where the HGMD database files will be stored. If no value is provided, it will use the</span>
</span><span id="L-4068"><a href="#L-4068"><span class="linenos">4068</span></a><span class="sd">    `DEFAULT_ANNOTATIONS_FOLDER` constant as the default value</span>
</span><span id="L-4069"><a href="#L-4069"><span class="linenos">4069</span></a><span class="sd">    :type hgmd_folder: str</span>
</span><span id="L-4070"><a href="#L-4070"><span class="linenos">4070</span></a><span class="sd">    :param output_basename: The `output_basename` parameter is a string that specifies the base name for</span>
</span><span id="L-4071"><a href="#L-4071"><span class="linenos">4071</span></a><span class="sd">    the output files. If not provided, it will be set as the base name of the input HGMD file without</span>
</span><span id="L-4072"><a href="#L-4072"><span class="linenos">4072</span></a><span class="sd">    the assembly information</span>
</span><span id="L-4073"><a href="#L-4073"><span class="linenos">4073</span></a><span class="sd">    :type output_basename: str</span>
</span><span id="L-4074"><a href="#L-4074"><span class="linenos">4074</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for processing the</span>
</span><span id="L-4075"><a href="#L-4075"><span class="linenos">4075</span></a><span class="sd">    HGMD database. It determines the level of parallelism and can help speed up the conversion process</span>
</span><span id="L-4076"><a href="#L-4076"><span class="linenos">4076</span></a><span class="sd">    :type threads: int</span>
</span><span id="L-4077"><a href="#L-4077"><span class="linenos">4077</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of max memory (in Gb) to use for sorting.</span>
</span><span id="L-4078"><a href="#L-4078"><span class="linenos">4078</span></a><span class="sd">    defaults to 1</span>
</span><span id="L-4079"><a href="#L-4079"><span class="linenos">4079</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="L-4080"><a href="#L-4080"><span class="linenos">4080</span></a><span class="sd">    :param genomes_folder: The `genomes_folder` parameter is a string that specifies the folder where</span>
</span><span id="L-4081"><a href="#L-4081"><span class="linenos">4081</span></a><span class="sd">    the genome files are located. If this parameter is not provided, it will default to a constant value</span>
</span><span id="L-4082"><a href="#L-4082"><span class="linenos">4082</span></a><span class="sd">    `DEFAULT_GENOME_FOLDER`</span>
</span><span id="L-4083"><a href="#L-4083"><span class="linenos">4083</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="L-4084"><a href="#L-4084"><span class="linenos">4084</span></a><span class="sd">    :param to_parquet: The `to_parquet` parameter is a boolean value that specifies whether the HGMD</span>
</span><span id="L-4085"><a href="#L-4085"><span class="linenos">4085</span></a><span class="sd">    database should be converted to the Parquet format or not. If set to `True`, the database will be</span>
</span><span id="L-4086"><a href="#L-4086"><span class="linenos">4086</span></a><span class="sd">    converted to Parquet format. If set to `False`, the conversion will be skipped, defaults to True</span>
</span><span id="L-4087"><a href="#L-4087"><span class="linenos">4087</span></a><span class="sd">    :type to_parquet: bool (optional)</span>
</span><span id="L-4088"><a href="#L-4088"><span class="linenos">4088</span></a><span class="sd">    :param to_tsv: The `to_tsv` parameter is a boolean value that specifies whether the HGMD database</span>
</span><span id="L-4089"><a href="#L-4089"><span class="linenos">4089</span></a><span class="sd">    should be converted to TSV format or not. If set to `True`, the function will generate a TSV file</span>
</span><span id="L-4090"><a href="#L-4090"><span class="linenos">4090</span></a><span class="sd">    from the HGMD database. If set to `False`, the TSV conversion will be, defaults to True</span>
</span><span id="L-4091"><a href="#L-4091"><span class="linenos">4091</span></a><span class="sd">    :type to_tsv: bool (optional)</span>
</span><span id="L-4092"><a href="#L-4092"><span class="linenos">4092</span></a><span class="sd">    :return: a boolean value indicating whether the HGMD database conversion was successful or not.</span>
</span><span id="L-4093"><a href="#L-4093"><span class="linenos">4093</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-4094"><a href="#L-4094"><span class="linenos">4094</span></a>
</span><span id="L-4095"><a href="#L-4095"><span class="linenos">4095</span></a>    <span class="c1"># Check assemblies</span>
</span><span id="L-4096"><a href="#L-4096"><span class="linenos">4096</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">assemblies</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">assemblies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">assemblies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-4097"><a href="#L-4097"><span class="linenos">4097</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Uniq assembly is mandatory&quot;</span><span class="p">)</span>
</span><span id="L-4098"><a href="#L-4098"><span class="linenos">4098</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Uniq assembly is mandatory&quot;</span><span class="p">)</span>
</span><span id="L-4099"><a href="#L-4099"><span class="linenos">4099</span></a>
</span><span id="L-4100"><a href="#L-4100"><span class="linenos">4100</span></a>    <span class="c1"># Threads</span>
</span><span id="L-4101"><a href="#L-4101"><span class="linenos">4101</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">threads</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-4102"><a href="#L-4102"><span class="linenos">4102</span></a>        <span class="n">threads</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
</span><span id="L-4103"><a href="#L-4103"><span class="linenos">4103</span></a>    <span class="n">threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
</span><span id="L-4104"><a href="#L-4104"><span class="linenos">4104</span></a>
</span><span id="L-4105"><a href="#L-4105"><span class="linenos">4105</span></a>    <span class="c1"># Full path</span>
</span><span id="L-4106"><a href="#L-4106"><span class="linenos">4106</span></a>    <span class="n">hgmd_file</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">)</span>
</span><span id="L-4107"><a href="#L-4107"><span class="linenos">4107</span></a>    <span class="n">hgmd_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">hgmd_folder</span><span class="p">)</span>
</span><span id="L-4108"><a href="#L-4108"><span class="linenos">4108</span></a>
</span><span id="L-4109"><a href="#L-4109"><span class="linenos">4109</span></a>    <span class="c1"># Check HGMD file</span>
</span><span id="L-4110"><a href="#L-4110"><span class="linenos">4110</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">hgmd_file</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">):</span>
</span><span id="L-4111"><a href="#L-4111"><span class="linenos">4111</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HGMD file DOES NOT exist &#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-4112"><a href="#L-4112"><span class="linenos">4112</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HGMD file DOES NOT exist &#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-4113"><a href="#L-4113"><span class="linenos">4113</span></a>
</span><span id="L-4114"><a href="#L-4114"><span class="linenos">4114</span></a>    <span class="c1"># Log</span>
</span><span id="L-4115"><a href="#L-4115"><span class="linenos">4115</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Convert HGMD database </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4116"><a href="#L-4116"><span class="linenos">4116</span></a>
</span><span id="L-4117"><a href="#L-4117"><span class="linenos">4117</span></a>    <span class="c1"># genomes folder</span>
</span><span id="L-4118"><a href="#L-4118"><span class="linenos">4118</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="L-4119"><a href="#L-4119"><span class="linenos">4119</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="L-4120"><a href="#L-4120"><span class="linenos">4120</span></a>
</span><span id="L-4121"><a href="#L-4121"><span class="linenos">4121</span></a>    <span class="c1"># Full path</span>
</span><span id="L-4122"><a href="#L-4122"><span class="linenos">4122</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="L-4123"><a href="#L-4123"><span class="linenos">4123</span></a>
</span><span id="L-4124"><a href="#L-4124"><span class="linenos">4124</span></a>    <span class="c1"># Assembly</span>
</span><span id="L-4125"><a href="#L-4125"><span class="linenos">4125</span></a>    <span class="n">assembly</span> <span class="o">=</span> <span class="n">assemblies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4126"><a href="#L-4126"><span class="linenos">4126</span></a>
</span><span id="L-4127"><a href="#L-4127"><span class="linenos">4127</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="L-4128"><a href="#L-4128"><span class="linenos">4128</span></a>    <span class="n">hgmd_folder_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hgmd_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="L-4129"><a href="#L-4129"><span class="linenos">4129</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">hgmd_folder_assembly</span><span class="p">):</span>
</span><span id="L-4130"><a href="#L-4130"><span class="linenos">4130</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">hgmd_folder_assembly</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-4131"><a href="#L-4131"><span class="linenos">4131</span></a>
</span><span id="L-4132"><a href="#L-4132"><span class="linenos">4132</span></a>    <span class="c1"># Output basename</span>
</span><span id="L-4133"><a href="#L-4133"><span class="linenos">4133</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">output_basename</span><span class="p">:</span>
</span><span id="L-4134"><a href="#L-4134"><span class="linenos">4134</span></a>        <span class="n">output_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.vcf.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-4135"><a href="#L-4135"><span class="linenos">4135</span></a>
</span><span id="L-4136"><a href="#L-4136"><span class="linenos">4136</span></a>    <span class="n">output_vcf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hgmd_folder_assembly</span><span class="p">,</span> <span class="n">output_basename</span> <span class="o">+</span> <span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span>
</span><span id="L-4137"><a href="#L-4137"><span class="linenos">4137</span></a>
</span><span id="L-4138"><a href="#L-4138"><span class="linenos">4138</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">):</span>
</span><span id="L-4139"><a href="#L-4139"><span class="linenos">4139</span></a>
</span><span id="L-4140"><a href="#L-4140"><span class="linenos">4140</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4141"><a href="#L-4141"><span class="linenos">4141</span></a>            <span class="sa">f</span><span class="s2">&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - File &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="L-4142"><a href="#L-4142"><span class="linenos">4142</span></a>        <span class="p">)</span>
</span><span id="L-4143"><a href="#L-4143"><span class="linenos">4143</span></a>
</span><span id="L-4144"><a href="#L-4144"><span class="linenos">4144</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-4145"><a href="#L-4145"><span class="linenos">4145</span></a>
</span><span id="L-4146"><a href="#L-4146"><span class="linenos">4146</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4147"><a href="#L-4147"><span class="linenos">4147</span></a>            <span class="sa">f</span><span class="s2">&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - File &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; processing...&quot;</span>
</span><span id="L-4148"><a href="#L-4148"><span class="linenos">4148</span></a>        <span class="p">)</span>
</span><span id="L-4149"><a href="#L-4149"><span class="linenos">4149</span></a>
</span><span id="L-4150"><a href="#L-4150"><span class="linenos">4150</span></a>        <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
</span><span id="L-4151"><a href="#L-4151"><span class="linenos">4151</span></a>
</span><span id="L-4152"><a href="#L-4152"><span class="linenos">4152</span></a>            <span class="c1"># Import Database object</span>
</span><span id="L-4153"><a href="#L-4153"><span class="linenos">4153</span></a>            <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="L-4154"><a href="#L-4154"><span class="linenos">4154</span></a>            <span class="kn">from</span> <span class="nn">howard.objects.variants</span> <span class="kn">import</span> <span class="n">Variants</span>
</span><span id="L-4155"><a href="#L-4155"><span class="linenos">4155</span></a>
</span><span id="L-4156"><a href="#L-4156"><span class="linenos">4156</span></a>            <span class="c1"># Database</span>
</span><span id="L-4157"><a href="#L-4157"><span class="linenos">4157</span></a>            <span class="n">database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">hgmd_file</span><span class="p">,</span> <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">)</span>
</span><span id="L-4158"><a href="#L-4158"><span class="linenos">4158</span></a>
</span><span id="L-4159"><a href="#L-4159"><span class="linenos">4159</span></a>            <span class="c1"># Create duckDB connexion</span>
</span><span id="L-4160"><a href="#L-4160"><span class="linenos">4160</span></a>            <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="L-4161"><a href="#L-4161"><span class="linenos">4161</span></a>
</span><span id="L-4162"><a href="#L-4162"><span class="linenos">4162</span></a>            <span class="c1"># Set max expression depth for big sub databases (e.g. gnomAD, ALL)</span>
</span><span id="L-4163"><a href="#L-4163"><span class="linenos">4163</span></a>            <span class="n">db_copy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET max_expression_depth TO 10000&quot;</span><span class="p">)</span>
</span><span id="L-4164"><a href="#L-4164"><span class="linenos">4164</span></a>
</span><span id="L-4165"><a href="#L-4165"><span class="linenos">4165</span></a>            <span class="c1"># Log</span>
</span><span id="L-4166"><a href="#L-4166"><span class="linenos">4166</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-4167"><a href="#L-4167"><span class="linenos">4167</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Check chromosomes and number of variants...&quot;&quot;&quot;</span>
</span><span id="L-4168"><a href="#L-4168"><span class="linenos">4168</span></a>            <span class="p">)</span>
</span><span id="L-4169"><a href="#L-4169"><span class="linenos">4169</span></a>
</span><span id="L-4170"><a href="#L-4170"><span class="linenos">4170</span></a>            <span class="c1"># Check chomosomes and total number of variants</span>
</span><span id="L-4171"><a href="#L-4171"><span class="linenos">4171</span></a>            <span class="n">query_chromosomes</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-4172"><a href="#L-4172"><span class="linenos">4172</span></a><span class="s2">                        SELECT distinct concat(&#39;chr&#39;, &quot;#CHROM&quot;) AS chromosome, count(*) AS nb_variants</span>
</span><span id="L-4173"><a href="#L-4173"><span class="linenos">4173</span></a><span class="s2">                        FROM read_csv(&#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;, AUTO_DETECT=TRUE, ALL_VARCHAR=1, SEP=&#39;</span><span class="se">\t</span><span class="s2">&#39;)</span>
</span><span id="L-4174"><a href="#L-4174"><span class="linenos">4174</span></a><span class="s2">                        GROUP BY &quot;#CHROM&quot;</span>
</span><span id="L-4175"><a href="#L-4175"><span class="linenos">4175</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="L-4176"><a href="#L-4176"><span class="linenos">4176</span></a>            <span class="n">chromosomes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-4177"><a href="#L-4177"><span class="linenos">4177</span></a>                <span class="nb">list</span><span class="p">(</span><span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;chromosome&quot;</span><span class="p">])</span>
</span><span id="L-4178"><a href="#L-4178"><span class="linenos">4178</span></a>            <span class="p">)</span>
</span><span id="L-4179"><a href="#L-4179"><span class="linenos">4179</span></a>            <span class="n">nb_variants</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;nb_variants&quot;</span><span class="p">])</span>
</span><span id="L-4180"><a href="#L-4180"><span class="linenos">4180</span></a>
</span><span id="L-4181"><a href="#L-4181"><span class="linenos">4181</span></a>            <span class="c1"># Log</span>
</span><span id="L-4182"><a href="#L-4182"><span class="linenos">4182</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-4183"><a href="#L-4183"><span class="linenos">4183</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chromosomes</span><span class="p">)</span><span class="si">}</span><span class="s2"> chromosomes&quot;&quot;&quot;</span>
</span><span id="L-4184"><a href="#L-4184"><span class="linenos">4184</span></a>            <span class="p">)</span>
</span><span id="L-4185"><a href="#L-4185"><span class="linenos">4185</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-4186"><a href="#L-4186"><span class="linenos">4186</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Found </span><span class="si">{</span><span class="n">nb_variants</span><span class="si">}</span><span class="s2"> variants&quot;&quot;&quot;</span>
</span><span id="L-4187"><a href="#L-4187"><span class="linenos">4187</span></a>            <span class="p">)</span>
</span><span id="L-4188"><a href="#L-4188"><span class="linenos">4188</span></a>
</span><span id="L-4189"><a href="#L-4189"><span class="linenos">4189</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate files...&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-4190"><a href="#L-4190"><span class="linenos">4190</span></a>
</span><span id="L-4191"><a href="#L-4191"><span class="linenos">4191</span></a>            <span class="c1"># Chromosome sizes</span>
</span><span id="L-4192"><a href="#L-4192"><span class="linenos">4192</span></a>            <span class="n">genomes_sizes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-4193"><a href="#L-4193"><span class="linenos">4193</span></a>            <span class="n">genomes_sizes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4194"><a href="#L-4194"><span class="linenos">4194</span></a>                <span class="n">genomes_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.fa.sizes&quot;</span>
</span><span id="L-4195"><a href="#L-4195"><span class="linenos">4195</span></a>            <span class="p">)</span>
</span><span id="L-4196"><a href="#L-4196"><span class="linenos">4196</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">):</span>
</span><span id="L-4197"><a href="#L-4197"><span class="linenos">4197</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-4198"><a href="#L-4198"><span class="linenos">4198</span></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-4199"><a href="#L-4199"><span class="linenos">4199</span></a>                        <span class="n">genomes_sizes</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-4200"><a href="#L-4200"><span class="linenos">4200</span></a>
</span><span id="L-4201"><a href="#L-4201"><span class="linenos">4201</span></a>            <span class="c1">### Header</span>
</span><span id="L-4202"><a href="#L-4202"><span class="linenos">4202</span></a>
</span><span id="L-4203"><a href="#L-4203"><span class="linenos">4203</span></a>            <span class="c1"># Init</span>
</span><span id="L-4204"><a href="#L-4204"><span class="linenos">4204</span></a>            <span class="n">header_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4205"><a href="#L-4205"><span class="linenos">4205</span></a>            <span class="n">header_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;header.hdr&quot;</span><span class="p">)</span>
</span><span id="L-4206"><a href="#L-4206"><span class="linenos">4206</span></a>            <span class="n">database_header</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get_header_file</span><span class="p">()</span>
</span><span id="L-4207"><a href="#L-4207"><span class="linenos">4207</span></a>
</span><span id="L-4208"><a href="#L-4208"><span class="linenos">4208</span></a>            <span class="c1"># Read header file to dict</span>
</span><span id="L-4209"><a href="#L-4209"><span class="linenos">4209</span></a>            <span class="k">with</span> <span class="n">mgzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">database_header</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-4210"><a href="#L-4210"><span class="linenos">4210</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-4211"><a href="#L-4211"><span class="linenos">4211</span></a>                    <span class="c1"># log.debug(line)</span>
</span><span id="L-4212"><a href="#L-4212"><span class="linenos">4212</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
</span><span id="L-4213"><a href="#L-4213"><span class="linenos">4213</span></a>                        <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="L-4214"><a href="#L-4214"><span class="linenos">4214</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-4215"><a href="#L-4215"><span class="linenos">4215</span></a>                        <span class="k">break</span>
</span><span id="L-4216"><a href="#L-4216"><span class="linenos">4216</span></a>
</span><span id="L-4217"><a href="#L-4217"><span class="linenos">4217</span></a>            <span class="c1"># Remove last line with #CHROM</span>
</span><span id="L-4218"><a href="#L-4218"><span class="linenos">4218</span></a>            <span class="n">header_list</span> <span class="o">=</span> <span class="n">header_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-4219"><a href="#L-4219"><span class="linenos">4219</span></a>
</span><span id="L-4220"><a href="#L-4220"><span class="linenos">4220</span></a>            <span class="c1"># Append INFO MC</span>
</span><span id="L-4221"><a href="#L-4221"><span class="linenos">4221</span></a>            <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-4222"><a href="#L-4222"><span class="linenos">4222</span></a>                <span class="s1">&#39;##INFO=&lt;ID=MC,Number=1,Type=String,Description=&quot;HGMD Accession number&quot;&gt;&#39;</span>
</span><span id="L-4223"><a href="#L-4223"><span class="linenos">4223</span></a>            <span class="p">)</span>
</span><span id="L-4224"><a href="#L-4224"><span class="linenos">4224</span></a>
</span><span id="L-4225"><a href="#L-4225"><span class="linenos">4225</span></a>            <span class="c1"># Add chromosomes</span>
</span><span id="L-4226"><a href="#L-4226"><span class="linenos">4226</span></a>            <span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="L-4227"><a href="#L-4227"><span class="linenos">4227</span></a>                <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-4228"><a href="#L-4228"><span class="linenos">4228</span></a>                    <span class="sa">f</span><span class="s2">&quot;##contig=&lt;ID=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">,length=</span><span class="si">{</span><span class="n">genomes_sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chromosome</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">,assembly=</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="L-4229"><a href="#L-4229"><span class="linenos">4229</span></a>                <span class="p">)</span>
</span><span id="L-4230"><a href="#L-4230"><span class="linenos">4230</span></a>
</span><span id="L-4231"><a href="#L-4231"><span class="linenos">4231</span></a>            <span class="c1"># Add last line with #CHROM</span>
</span><span id="L-4232"><a href="#L-4232"><span class="linenos">4232</span></a>            <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">POS</span><span class="se">\t</span><span class="s2">ID</span><span class="se">\t</span><span class="s2">REF</span><span class="se">\t</span><span class="s2">ALT</span><span class="se">\t</span><span class="s2">QUAL</span><span class="se">\t</span><span class="s2">FILTER</span><span class="se">\t</span><span class="s2">INFO&quot;</span><span class="p">)</span>
</span><span id="L-4233"><a href="#L-4233"><span class="linenos">4233</span></a>
</span><span id="L-4234"><a href="#L-4234"><span class="linenos">4234</span></a>            <span class="c1"># Write header</span>
</span><span id="L-4235"><a href="#L-4235"><span class="linenos">4235</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="L-4236"><a href="#L-4236"><span class="linenos">4236</span></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">header_list</span><span class="p">:</span>
</span><span id="L-4237"><a href="#L-4237"><span class="linenos">4237</span></a>                    <span class="c1"># write each item on a new line</span>
</span><span id="L-4238"><a href="#L-4238"><span class="linenos">4238</span></a>                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
</span><span id="L-4239"><a href="#L-4239"><span class="linenos">4239</span></a>
</span><span id="L-4240"><a href="#L-4240"><span class="linenos">4240</span></a>            <span class="c1">### Variants</span>
</span><span id="L-4241"><a href="#L-4241"><span class="linenos">4241</span></a>
</span><span id="L-4242"><a href="#L-4242"><span class="linenos">4242</span></a>            <span class="c1"># Init</span>
</span><span id="L-4243"><a href="#L-4243"><span class="linenos">4243</span></a>            <span class="n">variants_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;variants.vcf&quot;</span><span class="p">)</span>
</span><span id="L-4244"><a href="#L-4244"><span class="linenos">4244</span></a>
</span><span id="L-4245"><a href="#L-4245"><span class="linenos">4245</span></a>            <span class="c1"># Query COPY TO</span>
</span><span id="L-4246"><a href="#L-4246"><span class="linenos">4246</span></a>            <span class="n">query_variants</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-4247"><a href="#L-4247"><span class="linenos">4247</span></a><span class="s2">                COPY (</span>
</span><span id="L-4248"><a href="#L-4248"><span class="linenos">4248</span></a><span class="s2">                        SELECT</span>
</span><span id="L-4249"><a href="#L-4249"><span class="linenos">4249</span></a><span class="s2">                            concat(&#39;chr&#39;, &quot;#CHROM&quot;) AS &#39;#CHROM&#39;,</span>
</span><span id="L-4250"><a href="#L-4250"><span class="linenos">4250</span></a><span class="s2">                            POS,</span>
</span><span id="L-4251"><a href="#L-4251"><span class="linenos">4251</span></a><span class="s2">                            ID,</span>
</span><span id="L-4252"><a href="#L-4252"><span class="linenos">4252</span></a><span class="s2">                            REF,</span>
</span><span id="L-4253"><a href="#L-4253"><span class="linenos">4253</span></a><span class="s2">                            ALT,</span>
</span><span id="L-4254"><a href="#L-4254"><span class="linenos">4254</span></a><span class="s2">                            QUAL,</span>
</span><span id="L-4255"><a href="#L-4255"><span class="linenos">4255</span></a><span class="s2">                            FILTER,</span>
</span><span id="L-4256"><a href="#L-4256"><span class="linenos">4256</span></a><span class="s2">                            concat(</span>
</span><span id="L-4257"><a href="#L-4257"><span class="linenos">4257</span></a><span class="s2">                                replace(INFO, &#39;&quot;&#39;, &#39;&#39;),</span>
</span><span id="L-4258"><a href="#L-4258"><span class="linenos">4258</span></a><span class="s2">                                &#39;;&#39;,</span>
</span><span id="L-4259"><a href="#L-4259"><span class="linenos">4259</span></a><span class="s2">                                &#39;MC=&#39;,</span>
</span><span id="L-4260"><a href="#L-4260"><span class="linenos">4260</span></a><span class="s2">                                ID</span>
</span><span id="L-4261"><a href="#L-4261"><span class="linenos">4261</span></a><span class="s2">                                ) AS &#39;INFO&#39;</span>
</span><span id="L-4262"><a href="#L-4262"><span class="linenos">4262</span></a><span class="s2">                        FROM read_csv(&#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;, AUTO_DETECT=TRUE, ALL_VARCHAR=1, SEP=&#39;</span><span class="se">\t</span><span class="s2">&#39;, SAMPLE_SIZE=10000000)</span>
</span><span id="L-4263"><a href="#L-4263"><span class="linenos">4263</span></a><span class="s2">                    )</span>
</span><span id="L-4264"><a href="#L-4264"><span class="linenos">4264</span></a><span class="s2">                TO &#39;</span><span class="si">{</span><span class="n">variants_file</span><span class="si">}</span><span class="s2">&#39; (FORMAT csv, delimiter &#39;</span><span class="se">\t</span><span class="s2">&#39;, HEADER 0)</span>
</span><span id="L-4265"><a href="#L-4265"><span class="linenos">4265</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="L-4266"><a href="#L-4266"><span class="linenos">4266</span></a>            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_variants</span><span class="p">)</span>
</span><span id="L-4267"><a href="#L-4267"><span class="linenos">4267</span></a>
</span><span id="L-4268"><a href="#L-4268"><span class="linenos">4268</span></a>            <span class="c1"># Create HGMD VCF</span>
</span><span id="L-4269"><a href="#L-4269"><span class="linenos">4269</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4270"><a href="#L-4270"><span class="linenos">4270</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate VCF file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="L-4271"><a href="#L-4271"><span class="linenos">4271</span></a>            <span class="p">)</span>
</span><span id="L-4272"><a href="#L-4272"><span class="linenos">4272</span></a>            <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="L-4273"><a href="#L-4273"><span class="linenos">4273</span></a>                <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">header_file</span><span class="p">,</span> <span class="n">variants_file</span><span class="p">],</span>
</span><span id="L-4274"><a href="#L-4274"><span class="linenos">4274</span></a>                <span class="n">output_file</span><span class="o">=</span><span class="n">output_vcf</span><span class="p">,</span>
</span><span id="L-4275"><a href="#L-4275"><span class="linenos">4275</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-4276"><a href="#L-4276"><span class="linenos">4276</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-4277"><a href="#L-4277"><span class="linenos">4277</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="L-4278"><a href="#L-4278"><span class="linenos">4278</span></a>                <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-4279"><a href="#L-4279"><span class="linenos">4279</span></a>                <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;bgzip&quot;</span><span class="p">,</span>
</span><span id="L-4280"><a href="#L-4280"><span class="linenos">4280</span></a>            <span class="p">)</span>
</span><span id="L-4281"><a href="#L-4281"><span class="linenos">4281</span></a>
</span><span id="L-4282"><a href="#L-4282"><span class="linenos">4282</span></a>            <span class="c1"># Create HGMD Parquet</span>
</span><span id="L-4283"><a href="#L-4283"><span class="linenos">4283</span></a>            <span class="k">if</span> <span class="n">to_parquet</span> <span class="ow">or</span> <span class="n">to_tsv</span><span class="p">:</span>
</span><span id="L-4284"><a href="#L-4284"><span class="linenos">4284</span></a>                <span class="n">output_parquet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4285"><a href="#L-4285"><span class="linenos">4285</span></a>                    <span class="n">hgmd_folder_assembly</span><span class="p">,</span> <span class="n">output_basename</span> <span class="o">+</span> <span class="s2">&quot;.parquet&quot;</span>
</span><span id="L-4286"><a href="#L-4286"><span class="linenos">4286</span></a>                <span class="p">)</span>
</span><span id="L-4287"><a href="#L-4287"><span class="linenos">4287</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4288"><a href="#L-4288"><span class="linenos">4288</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate Parquet file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="L-4289"><a href="#L-4289"><span class="linenos">4289</span></a>                <span class="p">)</span>
</span><span id="L-4290"><a href="#L-4290"><span class="linenos">4290</span></a>                <span class="n">hgmd_database_to_parquet</span> <span class="o">=</span> <span class="n">Variants</span><span class="p">(</span>
</span><span id="L-4291"><a href="#L-4291"><span class="linenos">4291</span></a>                    <span class="nb">input</span><span class="o">=</span><span class="n">output_vcf</span><span class="p">,</span>
</span><span id="L-4292"><a href="#L-4292"><span class="linenos">4292</span></a>                    <span class="n">output</span><span class="o">=</span><span class="n">output_parquet</span><span class="p">,</span>
</span><span id="L-4293"><a href="#L-4293"><span class="linenos">4293</span></a>                    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">},</span>
</span><span id="L-4294"><a href="#L-4294"><span class="linenos">4294</span></a>                    <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;explode_infos&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="L-4295"><a href="#L-4295"><span class="linenos">4295</span></a>                    <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-4296"><a href="#L-4296"><span class="linenos">4296</span></a>                <span class="p">)</span>
</span><span id="L-4297"><a href="#L-4297"><span class="linenos">4297</span></a>                <span class="n">hgmd_database_to_parquet</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-4298"><a href="#L-4298"><span class="linenos">4298</span></a>                <span class="n">hgmd_database_to_parquet</span><span class="o">.</span><span class="n">export_output</span><span class="p">(</span><span class="n">export_header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-4299"><a href="#L-4299"><span class="linenos">4299</span></a>
</span><span id="L-4300"><a href="#L-4300"><span class="linenos">4300</span></a>            <span class="c1"># Create HGMD TSV</span>
</span><span id="L-4301"><a href="#L-4301"><span class="linenos">4301</span></a>            <span class="k">if</span> <span class="n">to_tsv</span><span class="p">:</span>
</span><span id="L-4302"><a href="#L-4302"><span class="linenos">4302</span></a>                <span class="n">output_tsv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4303"><a href="#L-4303"><span class="linenos">4303</span></a>                    <span class="n">hgmd_folder_assembly</span><span class="p">,</span> <span class="n">output_basename</span> <span class="o">+</span> <span class="s2">&quot;.tsv&quot;</span>
</span><span id="L-4304"><a href="#L-4304"><span class="linenos">4304</span></a>                <span class="p">)</span>
</span><span id="L-4305"><a href="#L-4305"><span class="linenos">4305</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-4306"><a href="#L-4306"><span class="linenos">4306</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate TSV file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="L-4307"><a href="#L-4307"><span class="linenos">4307</span></a>                <span class="p">)</span>
</span><span id="L-4308"><a href="#L-4308"><span class="linenos">4308</span></a>                <span class="n">hgmd_database_to_tsv</span> <span class="o">=</span> <span class="n">Variants</span><span class="p">(</span>
</span><span id="L-4309"><a href="#L-4309"><span class="linenos">4309</span></a>                    <span class="nb">input</span><span class="o">=</span><span class="n">output_parquet</span><span class="p">,</span>
</span><span id="L-4310"><a href="#L-4310"><span class="linenos">4310</span></a>                    <span class="n">output</span><span class="o">=</span><span class="n">output_tsv</span><span class="p">,</span>
</span><span id="L-4311"><a href="#L-4311"><span class="linenos">4311</span></a>                    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">},</span>
</span><span id="L-4312"><a href="#L-4312"><span class="linenos">4312</span></a>                    <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;explode_infos&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="L-4313"><a href="#L-4313"><span class="linenos">4313</span></a>                    <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-4314"><a href="#L-4314"><span class="linenos">4314</span></a>                <span class="p">)</span>
</span><span id="L-4315"><a href="#L-4315"><span class="linenos">4315</span></a>                <span class="n">hgmd_database_to_tsv</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-4316"><a href="#L-4316"><span class="linenos">4316</span></a>                <span class="n">hgmd_database_to_tsv</span><span class="o">.</span><span class="n">export_output</span><span class="p">(</span><span class="n">export_header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-4317"><a href="#L-4317"><span class="linenos">4317</span></a>
</span><span id="L-4318"><a href="#L-4318"><span class="linenos">4318</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            </section>
                <section id="generate_databases_param">
                            <input id="generate_databases_param-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_databases_param</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">args</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;argparse&#39;</span> <span class="kn">from</span> <span class="s1">&#39;/usr/local/Caskroom/miniconda/base/envs/howard_devel/lib/python3.10/argparse.py&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="generate_databases_param-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generate_databases_param"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generate_databases_param-41"><a href="#generate_databases_param-41"><span class="linenos"> 41</span></a><span class="k">def</span> <span class="nf">generate_databases_param</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="p">,</span> <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="generate_databases_param-42"><a href="#generate_databases_param-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="generate_databases_param-43"><a href="#generate_databases_param-43"><span class="linenos"> 43</span></a><span class="sd">    This function generates database parameters based on specified arguments and assemblies.</span>
</span><span id="generate_databases_param-44"><a href="#generate_databases_param-44"><span class="linenos"> 44</span></a>
</span><span id="generate_databases_param-45"><a href="#generate_databases_param-45"><span class="linenos"> 45</span></a><span class="sd">    :param args: The `args` parameter in the `generate_databases_param` function is expected to be an</span>
</span><span id="generate_databases_param-46"><a href="#generate_databases_param-46"><span class="linenos"> 46</span></a><span class="sd">    instance of the `argparse` module, which is commonly used for parsing command-line arguments. This</span>
</span><span id="generate_databases_param-47"><a href="#generate_databases_param-47"><span class="linenos"> 47</span></a><span class="sd">    parameter is used to retrieve various arguments and options provided by the user when running the</span>
</span><span id="generate_databases_param-48"><a href="#generate_databases_param-48"><span class="linenos"> 48</span></a><span class="sd">    script or program</span>
</span><span id="generate_databases_param-49"><a href="#generate_databases_param-49"><span class="linenos"> 49</span></a><span class="sd">    :type args: argparse</span>
</span><span id="generate_databases_param-50"><a href="#generate_databases_param-50"><span class="linenos"> 50</span></a><span class="sd">    :param assemblies: The `assemblies` parameter is a list containing the assemblies for which</span>
</span><span id="generate_databases_param-51"><a href="#generate_databases_param-51"><span class="linenos"> 51</span></a><span class="sd">    databases will be generated. The function `generate_databases_param` takes various arguments using</span>
</span><span id="generate_databases_param-52"><a href="#generate_databases_param-52"><span class="linenos"> 52</span></a><span class="sd">    the `argparse` module and generates database parameters based on these inputs. If the</span>
</span><span id="generate_databases_param-53"><a href="#generate_databases_param-53"><span class="linenos"> 53</span></a><span class="sd">    `generate_param` argument is provided and set to True,</span>
</span><span id="generate_databases_param-54"><a href="#generate_databases_param-54"><span class="linenos"> 54</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="generate_databases_param-55"><a href="#generate_databases_param-55"><span class="linenos"> 55</span></a><span class="sd">    :return: None</span>
</span><span id="generate_databases_param-56"><a href="#generate_databases_param-56"><span class="linenos"> 56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="generate_databases_param-57"><a href="#generate_databases_param-57"><span class="linenos"> 57</span></a>
</span><span id="generate_databases_param-58"><a href="#generate_databases_param-58"><span class="linenos"> 58</span></a>    <span class="c1"># Param</span>
</span><span id="generate_databases_param-59"><a href="#generate_databases_param-59"><span class="linenos"> 59</span></a>    <span class="k">if</span> <span class="s2">&quot;generate_param&quot;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param</span><span class="p">:</span>
</span><span id="generate_databases_param-60"><a href="#generate_databases_param-60"><span class="linenos"> 60</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generate param config&quot;</span><span class="p">)</span>
</span><span id="generate_databases_param-61"><a href="#generate_databases_param-61"><span class="linenos"> 61</span></a>
</span><span id="generate_databases_param-62"><a href="#generate_databases_param-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">generate_param</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="generate_databases_param-63"><a href="#generate_databases_param-63"><span class="linenos"> 63</span></a>            <span class="n">generate_param_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param</span>
</span><span id="generate_databases_param-64"><a href="#generate_databases_param-64"><span class="linenos"> 64</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-65"><a href="#generate_databases_param-65"><span class="linenos"> 65</span></a>            <span class="n">generate_param_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param</span><span class="o">.</span><span class="n">name</span>
</span><span id="generate_databases_param-66"><a href="#generate_databases_param-66"><span class="linenos"> 66</span></a>
</span><span id="generate_databases_param-67"><a href="#generate_databases_param-67"><span class="linenos"> 67</span></a>        <span class="k">if</span> <span class="s2">&quot;generate_param_description&quot;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span><span class="p">:</span>
</span><span id="generate_databases_param-68"><a href="#generate_databases_param-68"><span class="linenos"> 68</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="generate_databases_param-69"><a href="#generate_databases_param-69"><span class="linenos"> 69</span></a>                <span class="n">generate_param_description_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span>
</span><span id="generate_databases_param-70"><a href="#generate_databases_param-70"><span class="linenos"> 70</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-71"><a href="#generate_databases_param-71"><span class="linenos"> 71</span></a>                <span class="n">generate_param_description_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_description</span><span class="o">.</span><span class="n">name</span>
</span><span id="generate_databases_param-72"><a href="#generate_databases_param-72"><span class="linenos"> 72</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-73"><a href="#generate_databases_param-73"><span class="linenos"> 73</span></a>            <span class="n">generate_param_description_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="generate_databases_param-74"><a href="#generate_databases_param-74"><span class="linenos"> 74</span></a>
</span><span id="generate_databases_param-75"><a href="#generate_databases_param-75"><span class="linenos"> 75</span></a>        <span class="c1"># Check assembly</span>
</span><span id="generate_databases_param-76"><a href="#generate_databases_param-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assemblies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="generate_databases_param-77"><a href="#generate_databases_param-77"><span class="linenos"> 77</span></a>            <span class="n">assembly</span> <span class="o">=</span> <span class="n">assemblies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="generate_databases_param-78"><a href="#generate_databases_param-78"><span class="linenos"> 78</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-79"><a href="#generate_databases_param-79"><span class="linenos"> 79</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: choose one uniq assembly &#39;</span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="generate_databases_param-80"><a href="#generate_databases_param-80"><span class="linenos"> 80</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: choose one uniq assembly &#39;</span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="generate_databases_param-81"><a href="#generate_databases_param-81"><span class="linenos"> 81</span></a>
</span><span id="generate_databases_param-82"><a href="#generate_databases_param-82"><span class="linenos"> 82</span></a>        <span class="c1"># Databases releases</span>
</span><span id="generate_databases_param-83"><a href="#generate_databases_param-83"><span class="linenos"> 83</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_releases</span><span class="p">:</span>
</span><span id="generate_databases_param-84"><a href="#generate_databases_param-84"><span class="linenos"> 84</span></a>            <span class="n">generate_param_releases</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="generate_databases_param-85"><a href="#generate_databases_param-85"><span class="linenos"> 85</span></a>                <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_releases</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="generate_databases_param-86"><a href="#generate_databases_param-86"><span class="linenos"> 86</span></a>            <span class="p">]</span>
</span><span id="generate_databases_param-87"><a href="#generate_databases_param-87"><span class="linenos"> 87</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-88"><a href="#generate_databases_param-88"><span class="linenos"> 88</span></a>            <span class="n">generate_param_releases</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="generate_databases_param-89"><a href="#generate_databases_param-89"><span class="linenos"> 89</span></a>
</span><span id="generate_databases_param-90"><a href="#generate_databases_param-90"><span class="linenos"> 90</span></a>        <span class="c1"># Databases formats</span>
</span><span id="generate_databases_param-91"><a href="#generate_databases_param-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_formats</span><span class="p">:</span>
</span><span id="generate_databases_param-92"><a href="#generate_databases_param-92"><span class="linenos"> 92</span></a>            <span class="n">generate_param_formats</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="generate_databases_param-93"><a href="#generate_databases_param-93"><span class="linenos"> 93</span></a>                <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">generate_param_formats</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="generate_databases_param-94"><a href="#generate_databases_param-94"><span class="linenos"> 94</span></a>            <span class="p">]</span>
</span><span id="generate_databases_param-95"><a href="#generate_databases_param-95"><span class="linenos"> 95</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-96"><a href="#generate_databases_param-96"><span class="linenos"> 96</span></a>            <span class="n">generate_param_formats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="generate_databases_param-97"><a href="#generate_databases_param-97"><span class="linenos"> 97</span></a>
</span><span id="generate_databases_param-98"><a href="#generate_databases_param-98"><span class="linenos"> 98</span></a>        <span class="c1"># databases infos</span>
</span><span id="generate_databases_param-99"><a href="#generate_databases_param-99"><span class="linenos"> 99</span></a>        <span class="n">databases_infos_dict</span> <span class="o">=</span> <span class="n">databases_infos</span><span class="p">(</span>
</span><span id="generate_databases_param-100"><a href="#generate_databases_param-100"><span class="linenos">100</span></a>            <span class="n">database_folder_releases</span><span class="o">=</span><span class="n">generate_param_releases</span><span class="p">,</span>
</span><span id="generate_databases_param-101"><a href="#generate_databases_param-101"><span class="linenos">101</span></a>            <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="generate_databases_param-102"><a href="#generate_databases_param-102"><span class="linenos">102</span></a>            <span class="n">database_formats</span><span class="o">=</span><span class="n">generate_param_formats</span><span class="p">,</span>
</span><span id="generate_databases_param-103"><a href="#generate_databases_param-103"><span class="linenos">103</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
</span><span id="generate_databases_param-104"><a href="#generate_databases_param-104"><span class="linenos">104</span></a>        <span class="p">)</span>
</span><span id="generate_databases_param-105"><a href="#generate_databases_param-105"><span class="linenos">105</span></a>        <span class="n">databases_param_stats</span> <span class="o">=</span> <span class="n">databases_param</span><span class="p">(</span>
</span><span id="generate_databases_param-106"><a href="#generate_databases_param-106"><span class="linenos">106</span></a>            <span class="n">databases_infos_dict</span><span class="o">=</span><span class="n">databases_infos_dict</span><span class="p">,</span>
</span><span id="generate_databases_param-107"><a href="#generate_databases_param-107"><span class="linenos">107</span></a>            <span class="n">bcftools_preference</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">generate_param_bcftools</span><span class="p">,</span>
</span><span id="generate_databases_param-108"><a href="#generate_databases_param-108"><span class="linenos">108</span></a>            <span class="n">output</span><span class="o">=</span><span class="n">generate_param_file</span><span class="p">,</span>
</span><span id="generate_databases_param-109"><a href="#generate_databases_param-109"><span class="linenos">109</span></a>            <span class="n">output_description</span><span class="o">=</span><span class="n">generate_param_description_file</span><span class="p">,</span>
</span><span id="generate_databases_param-110"><a href="#generate_databases_param-110"><span class="linenos">110</span></a>        <span class="p">)</span>
</span><span id="generate_databases_param-111"><a href="#generate_databases_param-111"><span class="linenos">111</span></a>
</span><span id="generate_databases_param-112"><a href="#generate_databases_param-112"><span class="linenos">112</span></a>        <span class="c1"># Show param (3 levels of param)</span>
</span><span id="generate_databases_param-113"><a href="#generate_databases_param-113"><span class="linenos">113</span></a>        <span class="k">for</span> <span class="n">databases_param_stat</span> <span class="ow">in</span> <span class="n">databases_param_stats</span><span class="p">:</span>
</span><span id="generate_databases_param-114"><a href="#generate_databases_param-114"><span class="linenos">114</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="generate_databases_param-115"><a href="#generate_databases_param-115"><span class="linenos">115</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="generate_databases_param-116"><a href="#generate_databases_param-116"><span class="linenos">116</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">databases_param_stat</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="generate_databases_param-117"><a href="#generate_databases_param-117"><span class="linenos">117</span></a>                <span class="p">)</span>
</span><span id="generate_databases_param-118"><a href="#generate_databases_param-118"><span class="linenos">118</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-119"><a href="#generate_databases_param-119"><span class="linenos">119</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">databases_param_stat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="generate_databases_param-120"><a href="#generate_databases_param-120"><span class="linenos">120</span></a>                <span class="k">for</span> <span class="n">databases_param_substat</span> <span class="ow">in</span> <span class="n">databases_param_stats</span><span class="p">[</span>
</span><span id="generate_databases_param-121"><a href="#generate_databases_param-121"><span class="linenos">121</span></a>                    <span class="n">databases_param_stat</span>
</span><span id="generate_databases_param-122"><a href="#generate_databases_param-122"><span class="linenos">122</span></a>                <span class="p">]:</span>
</span><span id="generate_databases_param-123"><a href="#generate_databases_param-123"><span class="linenos">123</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="generate_databases_param-124"><a href="#generate_databases_param-124"><span class="linenos">124</span></a>                        <span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">][</span>
</span><span id="generate_databases_param-125"><a href="#generate_databases_param-125"><span class="linenos">125</span></a>                            <span class="n">databases_param_substat</span>
</span><span id="generate_databases_param-126"><a href="#generate_databases_param-126"><span class="linenos">126</span></a>                        <span class="p">],</span>
</span><span id="generate_databases_param-127"><a href="#generate_databases_param-127"><span class="linenos">127</span></a>                        <span class="nb">dict</span><span class="p">,</span>
</span><span id="generate_databases_param-128"><a href="#generate_databases_param-128"><span class="linenos">128</span></a>                    <span class="p">):</span>
</span><span id="generate_databases_param-129"><a href="#generate_databases_param-129"><span class="linenos">129</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="generate_databases_param-130"><a href="#generate_databases_param-130"><span class="linenos">130</span></a>                            <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">databases_param_substat</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">][</span><span class="n">databases_param_substat</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="generate_databases_param-131"><a href="#generate_databases_param-131"><span class="linenos">131</span></a>                        <span class="p">)</span>
</span><span id="generate_databases_param-132"><a href="#generate_databases_param-132"><span class="linenos">132</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="generate_databases_param-133"><a href="#generate_databases_param-133"><span class="linenos">133</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">databases_param_substat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="generate_databases_param-134"><a href="#generate_databases_param-134"><span class="linenos">134</span></a>                        <span class="k">for</span> <span class="n">databases_param_subsubstat</span> <span class="ow">in</span> <span class="n">databases_param_stats</span><span class="p">[</span>
</span><span id="generate_databases_param-135"><a href="#generate_databases_param-135"><span class="linenos">135</span></a>                            <span class="n">databases_param_stat</span>
</span><span id="generate_databases_param-136"><a href="#generate_databases_param-136"><span class="linenos">136</span></a>                        <span class="p">][</span><span class="n">databases_param_substat</span><span class="p">]:</span>
</span><span id="generate_databases_param-137"><a href="#generate_databases_param-137"><span class="linenos">137</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="generate_databases_param-138"><a href="#generate_databases_param-138"><span class="linenos">138</span></a>                                <span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">databases_param_subsubstat</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">databases_param_stats</span><span class="p">[</span><span class="n">databases_param_stat</span><span class="p">][</span><span class="n">databases_param_substat</span><span class="p">][</span><span class="n">databases_param_subsubstat</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="generate_databases_param-139"><a href="#generate_databases_param-139"><span class="linenos">139</span></a>                            <span class="p">)</span>
</span><span id="generate_databases_param-140"><a href="#generate_databases_param-140"><span class="linenos">140</span></a>
</span><span id="generate_databases_param-141"><a href="#generate_databases_param-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>This function generates database parameters based on specified arguments and assemblies.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>args</strong>:  The <code>args</code> parameter in the <code><a href="#generate_databases_param">generate_databases_param</a></code> function is expected to be an
instance of the <code>argparse</code> module, which is commonly used for parsing command-line arguments. This
parameter is used to retrieve various arguments and options provided by the user when running the
script or program</li>
<li><strong>assemblies</strong>:  The <code>assemblies</code> parameter is a list containing the assemblies for which
databases will be generated. The function <code><a href="#generate_databases_param">generate_databases_param</a></code> takes various arguments using
the <code>argparse</code> module and generates database parameters based on these inputs. If the
<code>generate_param</code> argument is provided and set to True,</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="query_and_concatenate_columns">
                            <input id="query_and_concatenate_columns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">query_and_concatenate_columns</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">parquet_file</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">columns</span><span class="p">:</span> <span class="nb">list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="query_and_concatenate_columns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#query_and_concatenate_columns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="query_and_concatenate_columns-144"><a href="#query_and_concatenate_columns-144"><span class="linenos">144</span></a><span class="k">def</span> <span class="nf">query_and_concatenate_columns</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="query_and_concatenate_columns-145"><a href="#query_and_concatenate_columns-145"><span class="linenos">145</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="query_and_concatenate_columns-146"><a href="#query_and_concatenate_columns-146"><span class="linenos">146</span></a><span class="sd">    This function performs an SQL query on a large Parquet file and concatenates multiple columns (if not empty),</span>
</span><span id="query_and_concatenate_columns-147"><a href="#query_and_concatenate_columns-147"><span class="linenos">147</span></a><span class="sd">    including the column name in the concatenation.</span>
</span><span id="query_and_concatenate_columns-148"><a href="#query_and_concatenate_columns-148"><span class="linenos">148</span></a>
</span><span id="query_and_concatenate_columns-149"><a href="#query_and_concatenate_columns-149"><span class="linenos">149</span></a><span class="sd">    :param parquet_file: The path to the Parquet file</span>
</span><span id="query_and_concatenate_columns-150"><a href="#query_and_concatenate_columns-150"><span class="linenos">150</span></a><span class="sd">    :type parquet_file: str</span>
</span><span id="query_and_concatenate_columns-151"><a href="#query_and_concatenate_columns-151"><span class="linenos">151</span></a><span class="sd">    :param output_file: The path to the output file where the concatenated data will be written</span>
</span><span id="query_and_concatenate_columns-152"><a href="#query_and_concatenate_columns-152"><span class="linenos">152</span></a><span class="sd">    :type output_file: str</span>
</span><span id="query_and_concatenate_columns-153"><a href="#query_and_concatenate_columns-153"><span class="linenos">153</span></a><span class="sd">    :param columns: The list of columns to concatenate</span>
</span><span id="query_and_concatenate_columns-154"><a href="#query_and_concatenate_columns-154"><span class="linenos">154</span></a><span class="sd">    :type columns: list</span>
</span><span id="query_and_concatenate_columns-155"><a href="#query_and_concatenate_columns-155"><span class="linenos">155</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="query_and_concatenate_columns-156"><a href="#query_and_concatenate_columns-156"><span class="linenos">156</span></a>    <span class="n">parquet_reader</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">)</span>
</span><span id="query_and_concatenate_columns-157"><a href="#query_and_concatenate_columns-157"><span class="linenos">157</span></a>    <span class="n">num_rows</span> <span class="o">=</span> <span class="n">parquet_reader</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">num_rows</span>
</span><span id="query_and_concatenate_columns-158"><a href="#query_and_concatenate_columns-158"><span class="linenos">158</span></a>
</span><span id="query_and_concatenate_columns-159"><a href="#query_and_concatenate_columns-159"><span class="linenos">159</span></a>    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># Adjust the chunk size as per your memory constraints</span>
</span><span id="query_and_concatenate_columns-160"><a href="#query_and_concatenate_columns-160"><span class="linenos">160</span></a>
</span><span id="query_and_concatenate_columns-161"><a href="#query_and_concatenate_columns-161"><span class="linenos">161</span></a>    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
</span><span id="query_and_concatenate_columns-162"><a href="#query_and_concatenate_columns-162"><span class="linenos">162</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
</span><span id="query_and_concatenate_columns-163"><a href="#query_and_concatenate_columns-163"><span class="linenos">163</span></a>            <span class="n">table</span> <span class="o">=</span> <span class="n">parquet_reader</span><span class="o">.</span><span class="n">read_row_group</span><span class="p">(</span>
</span><span id="query_and_concatenate_columns-164"><a href="#query_and_concatenate_columns-164"><span class="linenos">164</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">skip_rows</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="n">chunk_size</span>
</span><span id="query_and_concatenate_columns-165"><a href="#query_and_concatenate_columns-165"><span class="linenos">165</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</span><span id="query_and_concatenate_columns-166"><a href="#query_and_concatenate_columns-166"><span class="linenos">166</span></a>            <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="query_and_concatenate_columns-167"><a href="#query_and_concatenate_columns-167"><span class="linenos">167</span></a>                <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="query_and_concatenate_columns-168"><a href="#query_and_concatenate_columns-168"><span class="linenos">168</span></a>                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])]</span>
</span><span id="query_and_concatenate_columns-169"><a href="#query_and_concatenate_columns-169"><span class="linenos">169</span></a>                <span class="p">),</span>
</span><span id="query_and_concatenate_columns-170"><a href="#query_and_concatenate_columns-170"><span class="linenos">170</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="query_and_concatenate_columns-171"><a href="#query_and_concatenate_columns-171"><span class="linenos">171</span></a>            <span class="p">)</span>
</span><span id="query_and_concatenate_columns-172"><a href="#query_and_concatenate_columns-172"><span class="linenos">172</span></a>            <span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="query_and_concatenate_columns-173"><a href="#query_and_concatenate_columns-173"><span class="linenos">173</span></a>
</span><span id="query_and_concatenate_columns-174"><a href="#query_and_concatenate_columns-174"><span class="linenos">174</span></a>    <span class="c1"># Export the concatenated data to a CSV file</span>
</span><span id="query_and_concatenate_columns-175"><a href="#query_and_concatenate_columns-175"><span class="linenos">175</span></a>    <span class="n">concatenated_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="query_and_concatenate_columns-176"><a href="#query_and_concatenate_columns-176"><span class="linenos">176</span></a>    <span class="n">concatenated_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function performs an SQL query on a large Parquet file and concatenates multiple columns (if not empty),
including the column name in the concatenation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>parquet_file</strong>:  The path to the Parquet file</li>
<li><strong>output_file</strong>:  The path to the output file where the concatenated data will be written</li>
<li><strong>columns</strong>:  The list of columns to concatenate</li>
</ul>
</div>


                </section>
                <section id="databases_infos">
                            <input id="databases_infos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_infos</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">database_folders</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">database_folder_releases</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">assembly</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hg19&#39;</span>,</span><span class="param">	<span class="n">database_formats</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="databases_infos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_infos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_infos-179"><a href="#databases_infos-179"><span class="linenos">179</span></a><span class="k">def</span> <span class="nf">databases_infos</span><span class="p">(</span>
</span><span id="databases_infos-180"><a href="#databases_infos-180"><span class="linenos">180</span></a>    <span class="n">database_folders</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="databases_infos-181"><a href="#databases_infos-181"><span class="linenos">181</span></a>    <span class="n">database_folder_releases</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;current&quot;</span><span class="p">],</span>
</span><span id="databases_infos-182"><a href="#databases_infos-182"><span class="linenos">182</span></a>    <span class="n">assembly</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hg19&quot;</span><span class="p">,</span>
</span><span id="databases_infos-183"><a href="#databases_infos-183"><span class="linenos">183</span></a>    <span class="n">database_formats</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_infos-184"><a href="#databases_infos-184"><span class="linenos">184</span></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="databases_infos-185"><a href="#databases_infos-185"><span class="linenos">185</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="databases_infos-186"><a href="#databases_infos-186"><span class="linenos">186</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_infos-187"><a href="#databases_infos-187"><span class="linenos">187</span></a><span class="sd">    The `databases_infos` function scans database folders and retrieves information about the databases</span>
</span><span id="databases_infos-188"><a href="#databases_infos-188"><span class="linenos">188</span></a><span class="sd">    found, including their folder, release, assembly, subdatabase, format, header, and parameters.</span>
</span><span id="databases_infos-189"><a href="#databases_infos-189"><span class="linenos">189</span></a>
</span><span id="databases_infos-190"><a href="#databases_infos-190"><span class="linenos">190</span></a><span class="sd">    :param database_folders: A list of folders where the databases are located</span>
</span><span id="databases_infos-191"><a href="#databases_infos-191"><span class="linenos">191</span></a><span class="sd">    :type database_folders: list</span>
</span><span id="databases_infos-192"><a href="#databases_infos-192"><span class="linenos">192</span></a><span class="sd">    :param database_folder_releases: A list of specific releases of the database folders to include in</span>
</span><span id="databases_infos-193"><a href="#databases_infos-193"><span class="linenos">193</span></a><span class="sd">    the search. If None, all releases will be included</span>
</span><span id="databases_infos-194"><a href="#databases_infos-194"><span class="linenos">194</span></a><span class="sd">    :type database_folder_releases: list</span>
</span><span id="databases_infos-195"><a href="#databases_infos-195"><span class="linenos">195</span></a><span class="sd">    :param assembly: The `assembly` parameter is a string that specifies the assembly version of the</span>
</span><span id="databases_infos-196"><a href="#databases_infos-196"><span class="linenos">196</span></a><span class="sd">    databases to be searched. It is used to filter the databases based on their assembly version. The</span>
</span><span id="databases_infos-197"><a href="#databases_infos-197"><span class="linenos">197</span></a><span class="sd">    default value is &quot;hg19&quot;, defaults to hg19</span>
</span><span id="databases_infos-198"><a href="#databases_infos-198"><span class="linenos">198</span></a><span class="sd">    :type assembly: str (optional)</span>
</span><span id="databases_infos-199"><a href="#databases_infos-199"><span class="linenos">199</span></a><span class="sd">    :param database_formats: The `database_formats` parameter is a list that specifies the formats of</span>
</span><span id="databases_infos-200"><a href="#databases_infos-200"><span class="linenos">200</span></a><span class="sd">    the databases to include in the results. If this parameter is not provided or is set to `None`, all</span>
</span><span id="databases_infos-201"><a href="#databases_infos-201"><span class="linenos">201</span></a><span class="sd">    database formats will be included</span>
</span><span id="databases_infos-202"><a href="#databases_infos-202"><span class="linenos">202</span></a><span class="sd">    :type database_formats: list</span>
</span><span id="databases_infos-203"><a href="#databases_infos-203"><span class="linenos">203</span></a><span class="sd">    :param config: The `config` parameter is a dictionary that contains configuration settings for the</span>
</span><span id="databases_infos-204"><a href="#databases_infos-204"><span class="linenos">204</span></a><span class="sd">    function. It has the following structure:</span>
</span><span id="databases_infos-205"><a href="#databases_infos-205"><span class="linenos">205</span></a><span class="sd">    :type config: dict</span>
</span><span id="databases_infos-206"><a href="#databases_infos-206"><span class="linenos">206</span></a><span class="sd">    :return: The `databases_infos` function returns a dictionary containing information about the</span>
</span><span id="databases_infos-207"><a href="#databases_infos-207"><span class="linenos">207</span></a><span class="sd">    databases found in the specified database folders. The keys of the dictionary are the paths to the</span>
</span><span id="databases_infos-208"><a href="#databases_infos-208"><span class="linenos">208</span></a><span class="sd">    database files, and the values are dictionaries containing the following information: folder,</span>
</span><span id="databases_infos-209"><a href="#databases_infos-209"><span class="linenos">209</span></a><span class="sd">    release, assembly, subdatabase, format, header, and parameters.</span>
</span><span id="databases_infos-210"><a href="#databases_infos-210"><span class="linenos">210</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_infos-211"><a href="#databases_infos-211"><span class="linenos">211</span></a>
</span><span id="databases_infos-212"><a href="#databases_infos-212"><span class="linenos">212</span></a>    <span class="c1"># Init Database object</span>
</span><span id="databases_infos-213"><a href="#databases_infos-213"><span class="linenos">213</span></a>    <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="databases_infos-214"><a href="#databases_infos-214"><span class="linenos">214</span></a>
</span><span id="databases_infos-215"><a href="#databases_infos-215"><span class="linenos">215</span></a>    <span class="n">vcfdata_obj</span> <span class="o">=</span> <span class="n">Database</span><span class="p">()</span>
</span><span id="databases_infos-216"><a href="#databases_infos-216"><span class="linenos">216</span></a>
</span><span id="databases_infos-217"><a href="#databases_infos-217"><span class="linenos">217</span></a>    <span class="c1"># Init results</span>
</span><span id="databases_infos-218"><a href="#databases_infos-218"><span class="linenos">218</span></a>    <span class="n">infos</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_infos-219"><a href="#databases_infos-219"><span class="linenos">219</span></a>
</span><span id="databases_infos-220"><a href="#databases_infos-220"><span class="linenos">220</span></a>    <span class="c1"># Check databases folders from config</span>
</span><span id="databases_infos-221"><a href="#databases_infos-221"><span class="linenos">221</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">database_folders</span><span class="p">:</span>
</span><span id="databases_infos-222"><a href="#databases_infos-222"><span class="linenos">222</span></a>        <span class="n">config_database_folders</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_infos-223"><a href="#databases_infos-223"><span class="linenos">223</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;folders&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;databases&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="databases_infos-224"><a href="#databases_infos-224"><span class="linenos">224</span></a>        <span class="p">)</span>
</span><span id="databases_infos-225"><a href="#databases_infos-225"><span class="linenos">225</span></a>        <span class="k">for</span> <span class="n">config_database_folder</span> <span class="ow">in</span> <span class="n">config_database_folders</span><span class="p">:</span>
</span><span id="databases_infos-226"><a href="#databases_infos-226"><span class="linenos">226</span></a>            <span class="n">config_database_folder_dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
</span><span id="databases_infos-227"><a href="#databases_infos-227"><span class="linenos">227</span></a>                <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/*$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">config_database_folder</span><span class="p">)</span>
</span><span id="databases_infos-228"><a href="#databases_infos-228"><span class="linenos">228</span></a>            <span class="p">)</span>
</span><span id="databases_infos-229"><a href="#databases_infos-229"><span class="linenos">229</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;config_database_folder: </span><span class="si">{</span><span class="n">config_database_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_infos-230"><a href="#databases_infos-230"><span class="linenos">230</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_infos-231"><a href="#databases_infos-231"><span class="linenos">231</span></a>                <span class="sa">f</span><span class="s2">&quot;   config_database_folder_dirname: </span><span class="si">{</span><span class="n">config_database_folder_dirname</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_infos-232"><a href="#databases_infos-232"><span class="linenos">232</span></a>            <span class="p">)</span>
</span><span id="databases_infos-233"><a href="#databases_infos-233"><span class="linenos">233</span></a>            <span class="n">database_folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_database_folder_dirname</span><span class="p">)</span>
</span><span id="databases_infos-234"><a href="#databases_infos-234"><span class="linenos">234</span></a>
</span><span id="databases_infos-235"><a href="#databases_infos-235"><span class="linenos">235</span></a>    <span class="c1"># Find all databases folders</span>
</span><span id="databases_infos-236"><a href="#databases_infos-236"><span class="linenos">236</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">database_folders</span><span class="p">:</span>
</span><span id="databases_infos-237"><a href="#databases_infos-237"><span class="linenos">237</span></a>        <span class="n">database_folders</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_infos-238"><a href="#databases_infos-238"><span class="linenos">238</span></a>        <span class="n">default_database_folder</span> <span class="o">=</span> <span class="n">DEFAULT_DATABASE_FOLDER</span>
</span><span id="databases_infos-239"><a href="#databases_infos-239"><span class="linenos">239</span></a>        <span class="n">database_folders_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">default_database_folder</span><span class="p">)</span>
</span><span id="databases_infos-240"><a href="#databases_infos-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">database_folder</span> <span class="ow">in</span> <span class="n">database_folders_list</span><span class="p">:</span>
</span><span id="databases_infos-241"><a href="#databases_infos-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_database_folder</span><span class="p">,</span> <span class="n">database_folder</span><span class="p">)):</span>
</span><span id="databases_infos-242"><a href="#databases_infos-242"><span class="linenos">242</span></a>                <span class="n">database_folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_infos-243"><a href="#databases_infos-243"><span class="linenos">243</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_database_folder</span><span class="p">,</span> <span class="n">database_folder</span><span class="p">)</span>
</span><span id="databases_infos-244"><a href="#databases_infos-244"><span class="linenos">244</span></a>                <span class="p">)</span>
</span><span id="databases_infos-245"><a href="#databases_infos-245"><span class="linenos">245</span></a>
</span><span id="databases_infos-246"><a href="#databases_infos-246"><span class="linenos">246</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;database_folders: </span><span class="si">{</span><span class="n">database_folders</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_infos-247"><a href="#databases_infos-247"><span class="linenos">247</span></a>
</span><span id="databases_infos-248"><a href="#databases_infos-248"><span class="linenos">248</span></a>    <span class="c1"># Scan database folders</span>
</span><span id="databases_infos-249"><a href="#databases_infos-249"><span class="linenos">249</span></a>    <span class="k">for</span> <span class="n">database_folder</span> <span class="ow">in</span> <span class="n">database_folders</span><span class="p">:</span>
</span><span id="databases_infos-250"><a href="#databases_infos-250"><span class="linenos">250</span></a>
</span><span id="databases_infos-251"><a href="#databases_infos-251"><span class="linenos">251</span></a>        <span class="c1"># Database folder name</span>
</span><span id="databases_infos-252"><a href="#databases_infos-252"><span class="linenos">252</span></a>        <span class="n">database_folder_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_folder</span><span class="p">)</span>
</span><span id="databases_infos-253"><a href="#databases_infos-253"><span class="linenos">253</span></a>
</span><span id="databases_infos-254"><a href="#databases_infos-254"><span class="linenos">254</span></a>        <span class="c1"># Scan all folder with allowed structure in database folder (&lt;release&gt;/&lt;assembly&gt;)</span>
</span><span id="databases_infos-255"><a href="#databases_infos-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">followlinks</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="databases_infos-256"><a href="#databases_infos-256"><span class="linenos">256</span></a>
</span><span id="databases_infos-257"><a href="#databases_infos-257"><span class="linenos">257</span></a>            <span class="c1"># database structure and level</span>
</span><span id="databases_infos-258"><a href="#databases_infos-258"><span class="linenos">258</span></a>            <span class="n">database_subfolder</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">database_folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_infos-259"><a href="#databases_infos-259"><span class="linenos">259</span></a>            <span class="n">database_subfolder_structure</span> <span class="o">=</span> <span class="n">database_subfolder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="databases_infos-260"><a href="#databases_infos-260"><span class="linenos">260</span></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">database_subfolder</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="databases_infos-261"><a href="#databases_infos-261"><span class="linenos">261</span></a>
</span><span id="databases_infos-262"><a href="#databases_infos-262"><span class="linenos">262</span></a>            <span class="c1"># Level as correct structure</span>
</span><span id="databases_infos-263"><a href="#databases_infos-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="databases_infos-264"><a href="#databases_infos-264"><span class="linenos">264</span></a>
</span><span id="databases_infos-265"><a href="#databases_infos-265"><span class="linenos">265</span></a>                <span class="c1"># If &quot;(&lt;release&gt;/&lt;assembly&gt;&quot; is a folder</span>
</span><span id="databases_infos-266"><a href="#databases_infos-266"><span class="linenos">266</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
</span><span id="databases_infos-267"><a href="#databases_infos-267"><span class="linenos">267</span></a>
</span><span id="databases_infos-268"><a href="#databases_infos-268"><span class="linenos">268</span></a>                    <span class="c1"># Database infos (release and assembly)</span>
</span><span id="databases_infos-269"><a href="#databases_infos-269"><span class="linenos">269</span></a>                    <span class="n">database_release</span> <span class="o">=</span> <span class="n">database_subfolder_structure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_infos-270"><a href="#databases_infos-270"><span class="linenos">270</span></a>                    <span class="n">database_assembly</span> <span class="o">=</span> <span class="n">database_subfolder_structure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="databases_infos-271"><a href="#databases_infos-271"><span class="linenos">271</span></a>
</span><span id="databases_infos-272"><a href="#databases_infos-272"><span class="linenos">272</span></a>                    <span class="c1"># Filter with input release and assembly</span>
</span><span id="databases_infos-273"><a href="#databases_infos-273"><span class="linenos">273</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_infos-274"><a href="#databases_infos-274"><span class="linenos">274</span></a>                        <span class="ow">not</span> <span class="n">database_folder_releases</span>
</span><span id="databases_infos-275"><a href="#databases_infos-275"><span class="linenos">275</span></a>                        <span class="ow">or</span> <span class="n">database_release</span> <span class="ow">in</span> <span class="n">database_folder_releases</span>
</span><span id="databases_infos-276"><a href="#databases_infos-276"><span class="linenos">276</span></a>                    <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">database_assembly</span> <span class="o">==</span> <span class="n">assembly</span><span class="p">):</span>
</span><span id="databases_infos-277"><a href="#databases_infos-277"><span class="linenos">277</span></a>
</span><span id="databases_infos-278"><a href="#databases_infos-278"><span class="linenos">278</span></a>                        <span class="c1"># List files within the folder</span>
</span><span id="databases_infos-279"><a href="#databases_infos-279"><span class="linenos">279</span></a>                        <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
</span><span id="databases_infos-280"><a href="#databases_infos-280"><span class="linenos">280</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span>
</span><span id="databases_infos-281"><a href="#databases_infos-281"><span class="linenos">281</span></a>                        <span class="p">)</span>
</span><span id="databases_infos-282"><a href="#databases_infos-282"><span class="linenos">282</span></a>
</span><span id="databases_infos-283"><a href="#databases_infos-283"><span class="linenos">283</span></a>                        <span class="c1"># List file as a database (to check)</span>
</span><span id="databases_infos-284"><a href="#databases_infos-284"><span class="linenos">284</span></a>                        <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">list_of_files</span><span class="p">:</span>
</span><span id="databases_infos-285"><a href="#databases_infos-285"><span class="linenos">285</span></a>
</span><span id="databases_infos-286"><a href="#databases_infos-286"><span class="linenos">286</span></a>                            <span class="c1"># Check if file exists (ERROR woth glob.glob???)</span>
</span><span id="databases_infos-287"><a href="#databases_infos-287"><span class="linenos">287</span></a>                            <span class="n">database</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</span><span id="databases_infos-288"><a href="#databases_infos-288"><span class="linenos">288</span></a>                            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">database</span><span class="p">):</span>
</span><span id="databases_infos-289"><a href="#databases_infos-289"><span class="linenos">289</span></a>
</span><span id="databases_infos-290"><a href="#databases_infos-290"><span class="linenos">290</span></a>                                <span class="c1"># Format of the database</span>
</span><span id="databases_infos-291"><a href="#databases_infos-291"><span class="linenos">291</span></a>                                <span class="n">database_format</span> <span class="o">=</span> <span class="n">vcfdata_obj</span><span class="o">.</span><span class="n">get_format</span><span class="p">(</span>
</span><span id="databases_infos-292"><a href="#databases_infos-292"><span class="linenos">292</span></a>                                    <span class="n">database</span><span class="o">=</span><span class="n">database</span>
</span><span id="databases_infos-293"><a href="#databases_infos-293"><span class="linenos">293</span></a>                                <span class="p">)</span>
</span><span id="databases_infos-294"><a href="#databases_infos-294"><span class="linenos">294</span></a>
</span><span id="databases_infos-295"><a href="#databases_infos-295"><span class="linenos">295</span></a>                                <span class="c1"># Check if it is a database (header exists as file or within vcf)</span>
</span><span id="databases_infos-296"><a href="#databases_infos-296"><span class="linenos">296</span></a>                                <span class="c1"># Filter with input database format</span>
</span><span id="databases_infos-297"><a href="#databases_infos-297"><span class="linenos">297</span></a>                                <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_infos-298"><a href="#databases_infos-298"><span class="linenos">298</span></a>                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">.hdr&quot;</span><span class="p">)</span>
</span><span id="databases_infos-299"><a href="#databases_infos-299"><span class="linenos">299</span></a>                                    <span class="ow">or</span> <span class="p">(</span>
</span><span id="databases_infos-300"><a href="#databases_infos-300"><span class="linenos">300</span></a>                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</span><span id="databases_infos-301"><a href="#databases_infos-301"><span class="linenos">301</span></a>                                        <span class="ow">and</span> <span class="n">database</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
</span><span id="databases_infos-302"><a href="#databases_infos-302"><span class="linenos">302</span></a>                                            <span class="p">(</span><span class="s2">&quot;vcf&quot;</span><span class="p">,</span> <span class="s2">&quot;vcf.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;vcf.bgz&quot;</span><span class="p">)</span>
</span><span id="databases_infos-303"><a href="#databases_infos-303"><span class="linenos">303</span></a>                                        <span class="p">)</span>
</span><span id="databases_infos-304"><a href="#databases_infos-304"><span class="linenos">304</span></a>                                    <span class="p">)</span>
</span><span id="databases_infos-305"><a href="#databases_infos-305"><span class="linenos">305</span></a>                                <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="databases_infos-306"><a href="#databases_infos-306"><span class="linenos">306</span></a>                                    <span class="ow">not</span> <span class="n">database_formats</span>
</span><span id="databases_infos-307"><a href="#databases_infos-307"><span class="linenos">307</span></a>                                    <span class="ow">or</span> <span class="n">database_format</span> <span class="ow">in</span> <span class="n">database_formats</span>
</span><span id="databases_infos-308"><a href="#databases_infos-308"><span class="linenos">308</span></a>                                <span class="p">):</span>
</span><span id="databases_infos-309"><a href="#databases_infos-309"><span class="linenos">309</span></a>
</span><span id="databases_infos-310"><a href="#databases_infos-310"><span class="linenos">310</span></a>                                    <span class="c1"># Database subfolder (allow files in subfolder, such as database versions)</span>
</span><span id="databases_infos-311"><a href="#databases_infos-311"><span class="linenos">311</span></a>                                    <span class="n">database_subfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
</span><span id="databases_infos-312"><a href="#databases_infos-312"><span class="linenos">312</span></a>                                        <span class="n">database</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_infos-313"><a href="#databases_infos-313"><span class="linenos">313</span></a>                                    <span class="p">)</span>
</span><span id="databases_infos-314"><a href="#databases_infos-314"><span class="linenos">314</span></a>
</span><span id="databases_infos-315"><a href="#databases_infos-315"><span class="linenos">315</span></a>                                    <span class="c1"># Database header</span>
</span><span id="databases_infos-316"><a href="#databases_infos-316"><span class="linenos">316</span></a>                                    <span class="n">database_header</span> <span class="o">=</span> <span class="n">vcfdata_obj</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span>
</span><span id="databases_infos-317"><a href="#databases_infos-317"><span class="linenos">317</span></a>                                        <span class="n">database</span><span class="o">=</span><span class="n">database</span>
</span><span id="databases_infos-318"><a href="#databases_infos-318"><span class="linenos">318</span></a>                                    <span class="p">)</span><span class="o">.</span><span class="n">infos</span>
</span><span id="databases_infos-319"><a href="#databases_infos-319"><span class="linenos">319</span></a>
</span><span id="databases_infos-320"><a href="#databases_infos-320"><span class="linenos">320</span></a>                                    <span class="c1"># Init</span>
</span><span id="databases_infos-321"><a href="#databases_infos-321"><span class="linenos">321</span></a>                                    <span class="n">header_infos_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_infos-322"><a href="#databases_infos-322"><span class="linenos">322</span></a>                                    <span class="n">header_infos_dict_param</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_infos-323"><a href="#databases_infos-323"><span class="linenos">323</span></a>
</span><span id="databases_infos-324"><a href="#databases_infos-324"><span class="linenos">324</span></a>                                    <span class="c1"># List header infos</span>
</span><span id="databases_infos-325"><a href="#databases_infos-325"><span class="linenos">325</span></a>                                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">database_header</span><span class="p">):</span>
</span><span id="databases_infos-326"><a href="#databases_infos-326"><span class="linenos">326</span></a>
</span><span id="databases_infos-327"><a href="#databases_infos-327"><span class="linenos">327</span></a>                                        <span class="c1"># Init</span>
</span><span id="databases_infos-328"><a href="#databases_infos-328"><span class="linenos">328</span></a>                                        <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_infos-329"><a href="#databases_infos-329"><span class="linenos">329</span></a>                                        <span class="n">header_infos_dict_param</span><span class="p">[</span><span class="n">info</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="databases_infos-330"><a href="#databases_infos-330"><span class="linenos">330</span></a>
</span><span id="databases_infos-331"><a href="#databases_infos-331"><span class="linenos">331</span></a>                                        <span class="c1"># ID</span>
</span><span id="databases_infos-332"><a href="#databases_infos-332"><span class="linenos">332</span></a>                                        <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="databases_infos-333"><a href="#databases_infos-333"><span class="linenos">333</span></a>
</span><span id="databases_infos-334"><a href="#databases_infos-334"><span class="linenos">334</span></a>                                        <span class="c1"># num</span>
</span><span id="databases_infos-335"><a href="#databases_infos-335"><span class="linenos">335</span></a>                                        <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_infos-336"><a href="#databases_infos-336"><span class="linenos">336</span></a>                                            <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">num</span>
</span><span id="databases_infos-337"><a href="#databases_infos-337"><span class="linenos">337</span></a>                                            <span class="ow">in</span> <span class="n">GENOTYPE_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="databases_infos-338"><a href="#databases_infos-338"><span class="linenos">338</span></a>                                        <span class="p">):</span>
</span><span id="databases_infos-339"><a href="#databases_infos-339"><span class="linenos">339</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_infos-340"><a href="#databases_infos-340"><span class="linenos">340</span></a>                                                <span class="n">GENOTYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_infos-341"><a href="#databases_infos-341"><span class="linenos">341</span></a>                                                    <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">num</span>
</span><span id="databases_infos-342"><a href="#databases_infos-342"><span class="linenos">342</span></a>                                                <span class="p">)</span>
</span><span id="databases_infos-343"><a href="#databases_infos-343"><span class="linenos">343</span></a>                                            <span class="p">)</span>
</span><span id="databases_infos-344"><a href="#databases_infos-344"><span class="linenos">344</span></a>                                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_infos-345"><a href="#databases_infos-345"><span class="linenos">345</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_infos-346"><a href="#databases_infos-346"><span class="linenos">346</span></a>                                                <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">num</span>
</span><span id="databases_infos-347"><a href="#databases_infos-347"><span class="linenos">347</span></a>                                            <span class="p">)</span>
</span><span id="databases_infos-348"><a href="#databases_infos-348"><span class="linenos">348</span></a>
</span><span id="databases_infos-349"><a href="#databases_infos-349"><span class="linenos">349</span></a>                                        <span class="c1"># type</span>
</span><span id="databases_infos-350"><a href="#databases_infos-350"><span class="linenos">350</span></a>                                        <span class="k">if</span> <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
</span><span id="databases_infos-351"><a href="#databases_infos-351"><span class="linenos">351</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_infos-352"><a href="#databases_infos-352"><span class="linenos">352</span></a>                                                <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="databases_infos-353"><a href="#databases_infos-353"><span class="linenos">353</span></a>                                            <span class="p">)</span>
</span><span id="databases_infos-354"><a href="#databases_infos-354"><span class="linenos">354</span></a>                                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_infos-355"><a href="#databases_infos-355"><span class="linenos">355</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="databases_infos-356"><a href="#databases_infos-356"><span class="linenos">356</span></a>
</span><span id="databases_infos-357"><a href="#databases_infos-357"><span class="linenos">357</span></a>                                        <span class="c1"># desc</span>
</span><span id="databases_infos-358"><a href="#databases_infos-358"><span class="linenos">358</span></a>                                        <span class="k">if</span> <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">desc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="databases_infos-359"><a href="#databases_infos-359"><span class="linenos">359</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_infos-360"><a href="#databases_infos-360"><span class="linenos">360</span></a>                                                <span class="n">database_header</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">desc</span>
</span><span id="databases_infos-361"><a href="#databases_infos-361"><span class="linenos">361</span></a>                                            <span class="p">)</span>
</span><span id="databases_infos-362"><a href="#databases_infos-362"><span class="linenos">362</span></a>                                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_infos-363"><a href="#databases_infos-363"><span class="linenos">363</span></a>                                            <span class="n">header_infos_dict</span><span class="p">[</span><span class="n">info</span><span class="p">][</span><span class="s2">&quot;Description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="databases_infos-364"><a href="#databases_infos-364"><span class="linenos">364</span></a>
</span><span id="databases_infos-365"><a href="#databases_infos-365"><span class="linenos">365</span></a>                                    <span class="c1"># Add database to dict</span>
</span><span id="databases_infos-366"><a href="#databases_infos-366"><span class="linenos">366</span></a>                                    <span class="k">if</span> <span class="n">header_infos_dict</span><span class="p">:</span>
</span><span id="databases_infos-367"><a href="#databases_infos-367"><span class="linenos">367</span></a>                                        <span class="n">infos</span><span class="p">[</span><span class="n">database</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="databases_infos-368"><a href="#databases_infos-368"><span class="linenos">368</span></a>                                            <span class="s2">&quot;folder&quot;</span><span class="p">:</span> <span class="n">database_folder_name</span><span class="p">,</span>
</span><span id="databases_infos-369"><a href="#databases_infos-369"><span class="linenos">369</span></a>                                            <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">database_release</span><span class="p">,</span>
</span><span id="databases_infos-370"><a href="#databases_infos-370"><span class="linenos">370</span></a>                                            <span class="s2">&quot;assembly&quot;</span><span class="p">:</span> <span class="n">database_assembly</span><span class="p">,</span>
</span><span id="databases_infos-371"><a href="#databases_infos-371"><span class="linenos">371</span></a>                                            <span class="s2">&quot;subdatabase&quot;</span><span class="p">:</span> <span class="n">database_subfolder</span><span class="p">,</span>
</span><span id="databases_infos-372"><a href="#databases_infos-372"><span class="linenos">372</span></a>                                            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">database_format</span><span class="p">,</span>
</span><span id="databases_infos-373"><a href="#databases_infos-373"><span class="linenos">373</span></a>                                            <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header_infos_dict</span><span class="p">,</span>
</span><span id="databases_infos-374"><a href="#databases_infos-374"><span class="linenos">374</span></a>                                            <span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="n">header_infos_dict_param</span><span class="p">,</span>
</span><span id="databases_infos-375"><a href="#databases_infos-375"><span class="linenos">375</span></a>                                        <span class="p">}</span>
</span><span id="databases_infos-376"><a href="#databases_infos-376"><span class="linenos">376</span></a>
</span><span id="databases_infos-377"><a href="#databases_infos-377"><span class="linenos">377</span></a>                                        <span class="c1"># Log</span>
</span><span id="databases_infos-378"><a href="#databases_infos-378"><span class="linenos">378</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</span><span id="databases_infos-379"><a href="#databases_infos-379"><span class="linenos">379</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;database: </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_infos-380"><a href="#databases_infos-380"><span class="linenos">380</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_infos-381"><a href="#databases_infos-381"><span class="linenos">381</span></a>                                            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
</span><span id="databases_infos-382"><a href="#databases_infos-382"><span class="linenos">382</span></a>                                                <span class="p">{</span>
</span><span id="databases_infos-383"><a href="#databases_infos-383"><span class="linenos">383</span></a>                                                    <span class="s2">&quot;folder&quot;</span><span class="p">:</span> <span class="n">database_folder_name</span><span class="p">,</span>
</span><span id="databases_infos-384"><a href="#databases_infos-384"><span class="linenos">384</span></a>                                                    <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">database_release</span><span class="p">,</span>
</span><span id="databases_infos-385"><a href="#databases_infos-385"><span class="linenos">385</span></a>                                                    <span class="s2">&quot;assembly&quot;</span><span class="p">:</span> <span class="n">database_assembly</span><span class="p">,</span>
</span><span id="databases_infos-386"><a href="#databases_infos-386"><span class="linenos">386</span></a>                                                    <span class="s2">&quot;subdatabase&quot;</span><span class="p">:</span> <span class="n">database_subfolder</span><span class="p">,</span>
</span><span id="databases_infos-387"><a href="#databases_infos-387"><span class="linenos">387</span></a>                                                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">database_format</span><span class="p">,</span>
</span><span id="databases_infos-388"><a href="#databases_infos-388"><span class="linenos">388</span></a>                                                    <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_infos_dict</span><span class="p">),</span>
</span><span id="databases_infos-389"><a href="#databases_infos-389"><span class="linenos">389</span></a>                                                    <span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="databases_infos-390"><a href="#databases_infos-390"><span class="linenos">390</span></a>                                                        <span class="n">header_infos_dict_param</span>
</span><span id="databases_infos-391"><a href="#databases_infos-391"><span class="linenos">391</span></a>                                                    <span class="p">),</span>
</span><span id="databases_infos-392"><a href="#databases_infos-392"><span class="linenos">392</span></a>                                                <span class="p">},</span>
</span><span id="databases_infos-393"><a href="#databases_infos-393"><span class="linenos">393</span></a>                                                <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="databases_infos-394"><a href="#databases_infos-394"><span class="linenos">394</span></a>                                            <span class="p">)</span>
</span><span id="databases_infos-395"><a href="#databases_infos-395"><span class="linenos">395</span></a>                                        <span class="p">)</span>
</span><span id="databases_infos-396"><a href="#databases_infos-396"><span class="linenos">396</span></a>
</span><span id="databases_infos-397"><a href="#databases_infos-397"><span class="linenos">397</span></a>    <span class="k">return</span> <span class="n">infos</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_infos">databases_infos</a></code> function scans database folders and retrieves information about the databases
found, including their folder, release, assembly, subdatabase, format, header, and parameters.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>database_folders</strong>:  A list of folders where the databases are located</li>
<li><strong>database_folder_releases</strong>:  A list of specific releases of the database folders to include in
the search. If None, all releases will be included</li>
<li><strong>assembly</strong>:  The <code>assembly</code> parameter is a string that specifies the assembly version of the
databases to be searched. It is used to filter the databases based on their assembly version. The
default value is "hg19", defaults to hg19</li>
<li><strong>database_formats</strong>:  The <code>database_formats</code> parameter is a list that specifies the formats of
the databases to include in the results. If this parameter is not provided or is set to <code>None</code>, all
database formats will be included</li>
<li><strong>config</strong>:  The <code>config</code> parameter is a dictionary that contains configuration settings for the
function. It has the following structure:</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The <code><a href="#databases_infos">databases_infos</a></code> function returns a dictionary containing information about the
  databases found in the specified database folders. The keys of the dictionary are the paths to the
  database files, and the values are dictionaries containing the following information: folder,
  release, assembly, subdatabase, format, header, and parameters.</p>
</blockquote>
</div>


                </section>
                <section id="databases_param">
                            <input id="databases_param-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_param</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">databases_infos_dict</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">bcftools_preference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="databases_param-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_param"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_param-400"><a href="#databases_param-400"><span class="linenos">400</span></a><span class="k">def</span> <span class="nf">databases_param</span><span class="p">(</span>
</span><span id="databases_param-401"><a href="#databases_param-401"><span class="linenos">401</span></a>    <span class="n">databases_infos_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="databases_param-402"><a href="#databases_param-402"><span class="linenos">402</span></a>    <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_param-403"><a href="#databases_param-403"><span class="linenos">403</span></a>    <span class="n">output_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_param-404"><a href="#databases_param-404"><span class="linenos">404</span></a>    <span class="n">bcftools_preference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_param-405"><a href="#databases_param-405"><span class="linenos">405</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="databases_param-406"><a href="#databases_param-406"><span class="linenos">406</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_param-407"><a href="#databases_param-407"><span class="linenos">407</span></a><span class="sd">    The `databases_param` function takes in a dictionary of database information, an optional output</span>
</span><span id="databases_param-408"><a href="#databases_param-408"><span class="linenos">408</span></a><span class="sd">    file path, and a boolean flag for bcftools preference, and returns a dictionary containing the</span>
</span><span id="databases_param-409"><a href="#databases_param-409"><span class="linenos">409</span></a><span class="sd">    parameters for parquet and bcftools annotations.</span>
</span><span id="databases_param-410"><a href="#databases_param-410"><span class="linenos">410</span></a>
</span><span id="databases_param-411"><a href="#databases_param-411"><span class="linenos">411</span></a><span class="sd">    :param databases_infos_dict: A dictionary containing information about databases. Each key in the</span>
</span><span id="databases_param-412"><a href="#databases_param-412"><span class="linenos">412</span></a><span class="sd">    dictionary represents the name of a database, and the corresponding value is another dictionary</span>
</span><span id="databases_param-413"><a href="#databases_param-413"><span class="linenos">413</span></a><span class="sd">    containing information about the database, such as its format and parameters</span>
</span><span id="databases_param-414"><a href="#databases_param-414"><span class="linenos">414</span></a><span class="sd">    :type databases_infos_dict: dict</span>
</span><span id="databases_param-415"><a href="#databases_param-415"><span class="linenos">415</span></a><span class="sd">    :param output: The `output` parameter is a string that specifies the path and filename of the output</span>
</span><span id="databases_param-416"><a href="#databases_param-416"><span class="linenos">416</span></a><span class="sd">    file where the generated JSON object will be written. If this parameter is not provided or is set to</span>
</span><span id="databases_param-417"><a href="#databases_param-417"><span class="linenos">417</span></a><span class="sd">    `None`, the JSON object will not be written to a file</span>
</span><span id="databases_param-418"><a href="#databases_param-418"><span class="linenos">418</span></a><span class="sd">    :type output: str</span>
</span><span id="databases_param-419"><a href="#databases_param-419"><span class="linenos">419</span></a><span class="sd">    :param output_description: The `output_description` parameter is a string that specifies the path</span>
</span><span id="databases_param-420"><a href="#databases_param-420"><span class="linenos">420</span></a><span class="sd">    and filename of the output file where the description of the databases will be written. If this</span>
</span><span id="databases_param-421"><a href="#databases_param-421"><span class="linenos">421</span></a><span class="sd">    parameter is not provided or is set to `None`, the description will not be written to a file</span>
</span><span id="databases_param-422"><a href="#databases_param-422"><span class="linenos">422</span></a><span class="sd">    :type output_description: str</span>
</span><span id="databases_param-423"><a href="#databases_param-423"><span class="linenos">423</span></a><span class="sd">    :param bcftools_preference: The `bcftools_preference` parameter is a boolean flag that determines</span>
</span><span id="databases_param-424"><a href="#databases_param-424"><span class="linenos">424</span></a><span class="sd">    whether to prioritize databases in the BCFTOOLS format. If `bcftools_preference` is set to `True`,</span>
</span><span id="databases_param-425"><a href="#databases_param-425"><span class="linenos">425</span></a><span class="sd">    databases in the BCFTOOLS format will be given priority over other formats. If `bcftools, defaults</span>
</span><span id="databases_param-426"><a href="#databases_param-426"><span class="linenos">426</span></a><span class="sd">    to False</span>
</span><span id="databases_param-427"><a href="#databases_param-427"><span class="linenos">427</span></a><span class="sd">    :type bcftools_preference: bool (optional)</span>
</span><span id="databases_param-428"><a href="#databases_param-428"><span class="linenos">428</span></a><span class="sd">    :return: The function `databases_param` returns a dictionary object named &quot;param_stats_show&quot;.</span>
</span><span id="databases_param-429"><a href="#databases_param-429"><span class="linenos">429</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_param-430"><a href="#databases_param-430"><span class="linenos">430</span></a>
</span><span id="databases_param-431"><a href="#databases_param-431"><span class="linenos">431</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_param-432"><a href="#databases_param-432"><span class="linenos">432</span></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="databases_param-433"><a href="#databases_param-433"><span class="linenos">433</span></a>    <span class="n">output_description</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">output_description</span><span class="p">)</span>
</span><span id="databases_param-434"><a href="#databases_param-434"><span class="linenos">434</span></a>
</span><span id="databases_param-435"><a href="#databases_param-435"><span class="linenos">435</span></a>    <span class="c1"># Init</span>
</span><span id="databases_param-436"><a href="#databases_param-436"><span class="linenos">436</span></a>    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="databases_param-437"><a href="#databases_param-437"><span class="linenos">437</span></a>    <span class="n">param_parquet</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_param-438"><a href="#databases_param-438"><span class="linenos">438</span></a>    <span class="n">param_bcftools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_param-439"><a href="#databases_param-439"><span class="linenos">439</span></a>    <span class="n">param_stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="databases_param-440"><a href="#databases_param-440"><span class="linenos">440</span></a>        <span class="s2">&quot;assembly&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="databases_param-441"><a href="#databases_param-441"><span class="linenos">441</span></a>        <span class="s2">&quot;databases&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="databases_param-442"><a href="#databases_param-442"><span class="linenos">442</span></a>        <span class="s2">&quot;releases&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="databases_param-443"><a href="#databases_param-443"><span class="linenos">443</span></a>        <span class="s2">&quot;formats&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="databases_param-444"><a href="#databases_param-444"><span class="linenos">444</span></a>        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="databases_param-445"><a href="#databases_param-445"><span class="linenos">445</span></a>    <span class="p">}</span>
</span><span id="databases_param-446"><a href="#databases_param-446"><span class="linenos">446</span></a>    <span class="n">param_stats_show</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_param-447"><a href="#databases_param-447"><span class="linenos">447</span></a>
</span><span id="databases_param-448"><a href="#databases_param-448"><span class="linenos">448</span></a>    <span class="c1"># If None (not empty) dict in input, check by default</span>
</span><span id="databases_param-449"><a href="#databases_param-449"><span class="linenos">449</span></a>    <span class="k">if</span> <span class="n">databases_infos_dict</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="databases_param-450"><a href="#databases_param-450"><span class="linenos">450</span></a>        <span class="n">databases_infos_dict</span> <span class="o">=</span> <span class="n">databases_infos</span><span class="p">()</span>
</span><span id="databases_param-451"><a href="#databases_param-451"><span class="linenos">451</span></a>
</span><span id="databases_param-452"><a href="#databases_param-452"><span class="linenos">452</span></a>    <span class="c1"># List databases</span>
</span><span id="databases_param-453"><a href="#databases_param-453"><span class="linenos">453</span></a>    <span class="k">for</span> <span class="n">database_infos</span> <span class="ow">in</span> <span class="n">databases_infos_dict</span><span class="p">:</span>
</span><span id="databases_param-454"><a href="#databases_param-454"><span class="linenos">454</span></a>
</span><span id="databases_param-455"><a href="#databases_param-455"><span class="linenos">455</span></a>        <span class="n">database_format</span> <span class="o">=</span> <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="databases_param-456"><a href="#databases_param-456"><span class="linenos">456</span></a>
</span><span id="databases_param-457"><a href="#databases_param-457"><span class="linenos">457</span></a>        <span class="c1"># If preference for bcftools</span>
</span><span id="databases_param-458"><a href="#databases_param-458"><span class="linenos">458</span></a>        <span class="k">if</span> <span class="n">bcftools_preference</span> <span class="ow">and</span> <span class="n">database_format</span> <span class="ow">in</span> <span class="n">BCFTOOLS_FORMAT</span><span class="p">:</span>
</span><span id="databases_param-459"><a href="#databases_param-459"><span class="linenos">459</span></a>            <span class="n">param_bcftools</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span> <span class="o">=</span> <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_param-460"><a href="#databases_param-460"><span class="linenos">460</span></a>                <span class="s2">&quot;param&quot;</span>
</span><span id="databases_param-461"><a href="#databases_param-461"><span class="linenos">461</span></a>            <span class="p">)</span>
</span><span id="databases_param-462"><a href="#databases_param-462"><span class="linenos">462</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_param-463"><a href="#databases_param-463"><span class="linenos">463</span></a>            <span class="n">param_parquet</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span> <span class="o">=</span> <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_param-464"><a href="#databases_param-464"><span class="linenos">464</span></a>                <span class="s2">&quot;param&quot;</span>
</span><span id="databases_param-465"><a href="#databases_param-465"><span class="linenos">465</span></a>            <span class="p">)</span>
</span><span id="databases_param-466"><a href="#databases_param-466"><span class="linenos">466</span></a>
</span><span id="databases_param-467"><a href="#databases_param-467"><span class="linenos">467</span></a>        <span class="c1"># Stats</span>
</span><span id="databases_param-468"><a href="#databases_param-468"><span class="linenos">468</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;assembly&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_param-469"><a href="#databases_param-469"><span class="linenos">469</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;assembly&quot;</span><span class="p">)</span>
</span><span id="databases_param-470"><a href="#databases_param-470"><span class="linenos">470</span></a>        <span class="p">)</span>
</span><span id="databases_param-471"><a href="#databases_param-471"><span class="linenos">471</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_infos</span><span class="p">)</span>
</span><span id="databases_param-472"><a href="#databases_param-472"><span class="linenos">472</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;releases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_param-473"><a href="#databases_param-473"><span class="linenos">473</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">)</span>
</span><span id="databases_param-474"><a href="#databases_param-474"><span class="linenos">474</span></a>        <span class="p">)</span>
</span><span id="databases_param-475"><a href="#databases_param-475"><span class="linenos">475</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;formats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_param-476"><a href="#databases_param-476"><span class="linenos">476</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>
</span><span id="databases_param-477"><a href="#databases_param-477"><span class="linenos">477</span></a>        <span class="p">)</span>
</span><span id="databases_param-478"><a href="#databases_param-478"><span class="linenos">478</span></a>        <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="databases_param-479"><a href="#databases_param-479"><span class="linenos">479</span></a>            <span class="n">databases_infos_dict</span><span class="p">[</span><span class="n">database_infos</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="databases_param-480"><a href="#databases_param-480"><span class="linenos">480</span></a>        <span class="p">)</span>
</span><span id="databases_param-481"><a href="#databases_param-481"><span class="linenos">481</span></a>
</span><span id="databases_param-482"><a href="#databases_param-482"><span class="linenos">482</span></a>    <span class="c1"># Stats</span>
</span><span id="databases_param-483"><a href="#databases_param-483"><span class="linenos">483</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Assembly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;assembly&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_param-484"><a href="#databases_param-484"><span class="linenos">484</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Number of databases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]))</span>
</span><span id="databases_param-485"><a href="#databases_param-485"><span class="linenos">485</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Releases of databases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;releases&quot;</span><span class="p">]))</span>
</span><span id="databases_param-486"><a href="#databases_param-486"><span class="linenos">486</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Formats of databases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;formats&quot;</span><span class="p">]))</span>
</span><span id="databases_param-487"><a href="#databases_param-487"><span class="linenos">487</span></a>    <span class="n">param_stats_show</span><span class="p">[</span><span class="s2">&quot;Number of Annotation fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_stats</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]))</span>
</span><span id="databases_param-488"><a href="#databases_param-488"><span class="linenos">488</span></a>
</span><span id="databases_param-489"><a href="#databases_param-489"><span class="linenos">489</span></a>    <span class="c1"># Add parquet annotations to param</span>
</span><span id="databases_param-490"><a href="#databases_param-490"><span class="linenos">490</span></a>    <span class="k">if</span> <span class="n">param_parquet</span><span class="p">:</span>
</span><span id="databases_param-491"><a href="#databases_param-491"><span class="linenos">491</span></a>        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">][</span><span class="s2">&quot;parquet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;annotations&quot;</span><span class="p">:</span> <span class="n">param_parquet</span><span class="p">}</span>
</span><span id="databases_param-492"><a href="#databases_param-492"><span class="linenos">492</span></a>
</span><span id="databases_param-493"><a href="#databases_param-493"><span class="linenos">493</span></a>    <span class="c1"># Add bcftools annotations to param</span>
</span><span id="databases_param-494"><a href="#databases_param-494"><span class="linenos">494</span></a>    <span class="k">if</span> <span class="n">bcftools_preference</span> <span class="ow">and</span> <span class="n">param_bcftools</span><span class="p">:</span>
</span><span id="databases_param-495"><a href="#databases_param-495"><span class="linenos">495</span></a>        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">][</span><span class="s2">&quot;bcftools&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;annotations&quot;</span><span class="p">:</span> <span class="n">param_bcftools</span><span class="p">}</span>
</span><span id="databases_param-496"><a href="#databases_param-496"><span class="linenos">496</span></a>
</span><span id="databases_param-497"><a href="#databases_param-497"><span class="linenos">497</span></a>    <span class="c1"># Output</span>
</span><span id="databases_param-498"><a href="#databases_param-498"><span class="linenos">498</span></a>    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
</span><span id="databases_param-499"><a href="#databases_param-499"><span class="linenos">499</span></a>
</span><span id="databases_param-500"><a href="#databases_param-500"><span class="linenos">500</span></a>        <span class="c1"># Create json object</span>
</span><span id="databases_param-501"><a href="#databases_param-501"><span class="linenos">501</span></a>        <span class="n">json_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="databases_param-502"><a href="#databases_param-502"><span class="linenos">502</span></a>
</span><span id="databases_param-503"><a href="#databases_param-503"><span class="linenos">503</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="databases_param-504"><a href="#databases_param-504"><span class="linenos">504</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">)):</span>
</span><span id="databases_param-505"><a href="#databases_param-505"><span class="linenos">505</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_param-506"><a href="#databases_param-506"><span class="linenos">506</span></a>
</span><span id="databases_param-507"><a href="#databases_param-507"><span class="linenos">507</span></a>        <span class="c1"># Write output file</span>
</span><span id="databases_param-508"><a href="#databases_param-508"><span class="linenos">508</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
</span><span id="databases_param-509"><a href="#databases_param-509"><span class="linenos">509</span></a>            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_object</span><span class="p">)</span>
</span><span id="databases_param-510"><a href="#databases_param-510"><span class="linenos">510</span></a>
</span><span id="databases_param-511"><a href="#databases_param-511"><span class="linenos">511</span></a>    <span class="c1"># Output description</span>
</span><span id="databases_param-512"><a href="#databases_param-512"><span class="linenos">512</span></a>    <span class="k">if</span> <span class="n">output_description</span><span class="p">:</span>
</span><span id="databases_param-513"><a href="#databases_param-513"><span class="linenos">513</span></a>
</span><span id="databases_param-514"><a href="#databases_param-514"><span class="linenos">514</span></a>        <span class="c1"># Create json object</span>
</span><span id="databases_param-515"><a href="#databases_param-515"><span class="linenos">515</span></a>        <span class="n">json_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">databases_infos_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="databases_param-516"><a href="#databases_param-516"><span class="linenos">516</span></a>
</span><span id="databases_param-517"><a href="#databases_param-517"><span class="linenos">517</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="databases_param-518"><a href="#databases_param-518"><span class="linenos">518</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_description</span><span class="p">)):</span>
</span><span id="databases_param-519"><a href="#databases_param-519"><span class="linenos">519</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_description</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_param-520"><a href="#databases_param-520"><span class="linenos">520</span></a>
</span><span id="databases_param-521"><a href="#databases_param-521"><span class="linenos">521</span></a>        <span class="c1"># Write output file</span>
</span><span id="databases_param-522"><a href="#databases_param-522"><span class="linenos">522</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_description</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
</span><span id="databases_param-523"><a href="#databases_param-523"><span class="linenos">523</span></a>            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_object</span><span class="p">)</span>
</span><span id="databases_param-524"><a href="#databases_param-524"><span class="linenos">524</span></a>
</span><span id="databases_param-525"><a href="#databases_param-525"><span class="linenos">525</span></a>    <span class="k">return</span> <span class="n">param_stats_show</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_param">databases_param</a></code> function takes in a dictionary of database information, an optional output
file path, and a boolean flag for bcftools preference, and returns a dictionary containing the
parameters for parquet and bcftools annotations.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>databases_infos_dict</strong>:  A dictionary containing information about databases. Each key in the
dictionary represents the name of a database, and the corresponding value is another dictionary
containing information about the database, such as its format and parameters</li>
<li><strong>output</strong>:  The <code>output</code> parameter is a string that specifies the path and filename of the output
file where the generated JSON object will be written. If this parameter is not provided or is set to
<code>None</code>, the JSON object will not be written to a file</li>
<li><strong>output_description</strong>:  The <code>output_description</code> parameter is a string that specifies the path
and filename of the output file where the description of the databases will be written. If this
parameter is not provided or is set to <code>None</code>, the description will not be written to a file</li>
<li><strong>bcftools_preference</strong>:  The <code>bcftools_preference</code> parameter is a boolean flag that determines
whether to prioritize databases in the BCFTOOLS format. If <code>bcftools_preference</code> is set to <code>True</code>,
databases in the BCFTOOLS format will be given priority over other formats. If `bcftools, defaults
to False</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The function <code><a href="#databases_param">databases_param</a></code> returns a dictionary object named "param_stats_show".</p>
</blockquote>
</div>


                </section>
                <section id="databases_download_annovar">
                            <input id="databases_download_annovar-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_annovar</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hg19&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">annovar_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://www.openbioinformatics.org/annovar/download&#39;</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="databases_download_annovar-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_annovar"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_annovar-528"><a href="#databases_download_annovar-528"><span class="linenos">528</span></a><span class="k">def</span> <span class="nf">databases_download_annovar</span><span class="p">(</span>
</span><span id="databases_download_annovar-529"><a href="#databases_download_annovar-529"><span class="linenos">529</span></a>    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_annovar-530"><a href="#databases_download_annovar-530"><span class="linenos">530</span></a>    <span class="n">files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_annovar-531"><a href="#databases_download_annovar-531"><span class="linenos">531</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hg19&quot;</span><span class="p">],</span>
</span><span id="databases_download_annovar-532"><a href="#databases_download_annovar-532"><span class="linenos">532</span></a>    <span class="n">annovar_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;http://www.openbioinformatics.org/annovar/download&quot;</span><span class="p">,</span>
</span><span id="databases_download_annovar-533"><a href="#databases_download_annovar-533"><span class="linenos">533</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_annovar-534"><a href="#databases_download_annovar-534"><span class="linenos">534</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="databases_download_annovar-535"><a href="#databases_download_annovar-535"><span class="linenos">535</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_annovar-536"><a href="#databases_download_annovar-536"><span class="linenos">536</span></a><span class="sd">    This function downloads and extracts Annovar databases for specified assemblies and files.</span>
</span><span id="databases_download_annovar-537"><a href="#databases_download_annovar-537"><span class="linenos">537</span></a>
</span><span id="databases_download_annovar-538"><a href="#databases_download_annovar-538"><span class="linenos">538</span></a><span class="sd">    :param folder: The folder where the Annovar databases will be downloaded to</span>
</span><span id="databases_download_annovar-539"><a href="#databases_download_annovar-539"><span class="linenos">539</span></a><span class="sd">    :type folder: str</span>
</span><span id="databases_download_annovar-540"><a href="#databases_download_annovar-540"><span class="linenos">540</span></a><span class="sd">    :param files: The `files` parameter is a list of specific Annovar database files to download. If not</span>
</span><span id="databases_download_annovar-541"><a href="#databases_download_annovar-541"><span class="linenos">541</span></a><span class="sd">    provided, only the mandatory files will be downloaded. If set to &quot;ALL&quot;, all available files will be</span>
</span><span id="databases_download_annovar-542"><a href="#databases_download_annovar-542"><span class="linenos">542</span></a><span class="sd">    downloaded</span>
</span><span id="databases_download_annovar-543"><a href="#databases_download_annovar-543"><span class="linenos">543</span></a><span class="sd">    :type files: list</span>
</span><span id="databases_download_annovar-544"><a href="#databases_download_annovar-544"><span class="linenos">544</span></a><span class="sd">    :param assemblies: A list of genome assemblies for which Annovar databases will be downloaded.</span>
</span><span id="databases_download_annovar-545"><a href="#databases_download_annovar-545"><span class="linenos">545</span></a><span class="sd">    Default is [&quot;hg19&quot;]</span>
</span><span id="databases_download_annovar-546"><a href="#databases_download_annovar-546"><span class="linenos">546</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_annovar-547"><a href="#databases_download_annovar-547"><span class="linenos">547</span></a><span class="sd">    :param annovar_url: The URL where Annovar databases can be downloaded from, defaults to</span>
</span><span id="databases_download_annovar-548"><a href="#databases_download_annovar-548"><span class="linenos">548</span></a><span class="sd">    http://www.openbioinformatics.org/annovar/download</span>
</span><span id="databases_download_annovar-549"><a href="#databases_download_annovar-549"><span class="linenos">549</span></a><span class="sd">    :type annovar_url: str (optional)</span>
</span><span id="databases_download_annovar-550"><a href="#databases_download_annovar-550"><span class="linenos">550</span></a><span class="sd">    :param threads: The &quot;threads&quot; parameter specifies the number of threads (parallel processes) to use</span>
</span><span id="databases_download_annovar-551"><a href="#databases_download_annovar-551"><span class="linenos">551</span></a><span class="sd">    for download and extract/uncompress files. Default: 1</span>
</span><span id="databases_download_annovar-552"><a href="#databases_download_annovar-552"><span class="linenos">552</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="databases_download_annovar-553"><a href="#databases_download_annovar-553"><span class="linenos">553</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_annovar-554"><a href="#databases_download_annovar-554"><span class="linenos">554</span></a>
</span><span id="databases_download_annovar-555"><a href="#databases_download_annovar-555"><span class="linenos">555</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-556"><a href="#databases_download_annovar-556"><span class="linenos">556</span></a>
</span><span id="databases_download_annovar-557"><a href="#databases_download_annovar-557"><span class="linenos">557</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_annovar-558"><a href="#databases_download_annovar-558"><span class="linenos">558</span></a>    <span class="n">folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="databases_download_annovar-559"><a href="#databases_download_annovar-559"><span class="linenos">559</span></a>
</span><span id="databases_download_annovar-560"><a href="#databases_download_annovar-560"><span class="linenos">560</span></a>    <span class="c1"># Minimum files to download</span>
</span><span id="databases_download_annovar-561"><a href="#databases_download_annovar-561"><span class="linenos">561</span></a>    <span class="n">files_minimum</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;refGene*&quot;</span><span class="p">]</span>
</span><span id="databases_download_annovar-562"><a href="#databases_download_annovar-562"><span class="linenos">562</span></a>
</span><span id="databases_download_annovar-563"><a href="#databases_download_annovar-563"><span class="linenos">563</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_annovar-564"><a href="#databases_download_annovar-564"><span class="linenos">564</span></a>
</span><span id="databases_download_annovar-565"><a href="#databases_download_annovar-565"><span class="linenos">565</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar for assembly &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-566"><a href="#databases_download_annovar-566"><span class="linenos">566</span></a>
</span><span id="databases_download_annovar-567"><a href="#databases_download_annovar-567"><span class="linenos">567</span></a>        <span class="n">folder_assembly</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_annovar-568"><a href="#databases_download_annovar-568"><span class="linenos">568</span></a>
</span><span id="databases_download_annovar-569"><a href="#databases_download_annovar-569"><span class="linenos">569</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">):</span>
</span><span id="databases_download_annovar-570"><a href="#databases_download_annovar-570"><span class="linenos">570</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">)</span>
</span><span id="databases_download_annovar-571"><a href="#databases_download_annovar-571"><span class="linenos">571</span></a>
</span><span id="databases_download_annovar-572"><a href="#databases_download_annovar-572"><span class="linenos">572</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases in folder &#39;</span><span class="si">{</span><span class="n">folder_assembly</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-573"><a href="#databases_download_annovar-573"><span class="linenos">573</span></a>
</span><span id="databases_download_annovar-574"><a href="#databases_download_annovar-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
</span><span id="databases_download_annovar-575"><a href="#databases_download_annovar-575"><span class="linenos">575</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Only mandatory files will be downloaded&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-576"><a href="#databases_download_annovar-576"><span class="linenos">576</span></a>            <span class="n">patterns_file_to_check</span> <span class="o">=</span> <span class="n">files_minimum</span>
</span><span id="databases_download_annovar-577"><a href="#databases_download_annovar-577"><span class="linenos">577</span></a>        <span class="k">elif</span> <span class="n">files</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;ALL&quot;</span><span class="p">]:</span>
</span><span id="databases_download_annovar-578"><a href="#databases_download_annovar-578"><span class="linenos">578</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;All files will be downloaded&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-579"><a href="#databases_download_annovar-579"><span class="linenos">579</span></a>            <span class="n">patterns_file_to_check</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_annovar-580"><a href="#databases_download_annovar-580"><span class="linenos">580</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_annovar-581"><a href="#databases_download_annovar-581"><span class="linenos">581</span></a>            <span class="n">patterns_file_to_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">files</span> <span class="o">+</span> <span class="n">files_minimum</span><span class="p">))</span>
</span><span id="databases_download_annovar-582"><a href="#databases_download_annovar-582"><span class="linenos">582</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Following files will be downloaded: </span><span class="si">{</span><span class="n">patterns_file_to_check</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-583"><a href="#databases_download_annovar-583"><span class="linenos">583</span></a>
</span><span id="databases_download_annovar-584"><a href="#databases_download_annovar-584"><span class="linenos">584</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download list of Annovar files from Annovar URL&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-585"><a href="#databases_download_annovar-585"><span class="linenos">585</span></a>
</span><span id="databases_download_annovar-586"><a href="#databases_download_annovar-586"><span class="linenos">586</span></a>        <span class="n">avdblist_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_avdblist.txt&quot;</span>
</span><span id="databases_download_annovar-587"><a href="#databases_download_annovar-587"><span class="linenos">587</span></a>        <span class="n">avdblist_url_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">annovar_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">avdblist_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_annovar-588"><a href="#databases_download_annovar-588"><span class="linenos">588</span></a>        <span class="n">avdblist_folder_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_assembly</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">avdblist_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_annovar-589"><a href="#databases_download_annovar-589"><span class="linenos">589</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_annovar-590"><a href="#databases_download_annovar-590"><span class="linenos">590</span></a>            <span class="sa">f</span><span class="s2">&quot;Download list of Annovar files </span><span class="si">{</span><span class="n">avdblist_file</span><span class="si">}</span><span class="s2"> from Annovar URL </span><span class="si">{</span><span class="n">avdblist_url_file</span><span class="si">}</span><span class="s2"> to Annovar folder </span><span class="si">{</span><span class="n">avdblist_folder_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_annovar-591"><a href="#databases_download_annovar-591"><span class="linenos">591</span></a>        <span class="p">)</span>
</span><span id="databases_download_annovar-592"><a href="#databases_download_annovar-592"><span class="linenos">592</span></a>        <span class="n">download_file</span><span class="p">(</span><span class="n">avdblist_url_file</span><span class="p">,</span> <span class="n">avdblist_folder_file</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_annovar-593"><a href="#databases_download_annovar-593"><span class="linenos">593</span></a>
</span><span id="databases_download_annovar-594"><a href="#databases_download_annovar-594"><span class="linenos">594</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">avdblist_folder_file</span><span class="p">):</span>
</span><span id="databases_download_annovar-595"><a href="#databases_download_annovar-595"><span class="linenos">595</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_annovar-596"><a href="#databases_download_annovar-596"><span class="linenos">596</span></a>                <span class="sa">f</span><span class="s2">&quot;Download list of Annovar files from Annovar URL: </span><span class="si">{</span><span class="n">avdblist_url_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_annovar-597"><a href="#databases_download_annovar-597"><span class="linenos">597</span></a>            <span class="p">)</span>
</span><span id="databases_download_annovar-598"><a href="#databases_download_annovar-598"><span class="linenos">598</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annovar Database list: </span><span class="si">{</span><span class="n">avdblist_folder_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-599"><a href="#databases_download_annovar-599"><span class="linenos">599</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annovar Database list: </span><span class="si">{</span><span class="n">avdblist_folder_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-600"><a href="#databases_download_annovar-600"><span class="linenos">600</span></a>
</span><span id="databases_download_annovar-601"><a href="#databases_download_annovar-601"><span class="linenos">601</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_annovar-602"><a href="#databases_download_annovar-602"><span class="linenos">602</span></a>
</span><span id="databases_download_annovar-603"><a href="#databases_download_annovar-603"><span class="linenos">603</span></a>            <span class="c1"># Open file</span>
</span><span id="databases_download_annovar-604"><a href="#databases_download_annovar-604"><span class="linenos">604</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">avdblist_folder_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_annovar-605"><a href="#databases_download_annovar-605"><span class="linenos">605</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="databases_download_annovar-606"><a href="#databases_download_annovar-606"><span class="linenos">606</span></a>            <span class="c1"># Dataframe</span>
</span><span id="databases_download_annovar-607"><a href="#databases_download_annovar-607"><span class="linenos">607</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_annovar-608"><a href="#databases_download_annovar-608"><span class="linenos">608</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="databases_download_annovar-609"><a href="#databases_download_annovar-609"><span class="linenos">609</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-610"><a href="#databases_download_annovar-610"><span class="linenos">610</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
</span><span id="databases_download_annovar-611"><a href="#databases_download_annovar-611"><span class="linenos">611</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="databases_download_annovar-612"><a href="#databases_download_annovar-612"><span class="linenos">612</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="databases_download_annovar-613"><a href="#databases_download_annovar-613"><span class="linenos">613</span></a>
</span><span id="databases_download_annovar-614"><a href="#databases_download_annovar-614"><span class="linenos">614</span></a>            <span class="c1"># Create list of files associated to Annovar code</span>
</span><span id="databases_download_annovar-615"><a href="#databases_download_annovar-615"><span class="linenos">615</span></a>            <span class="n">files_to_download</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_annovar-616"><a href="#databases_download_annovar-616"><span class="linenos">616</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">patterns_file_to_check</span><span class="p">:</span>
</span><span id="databases_download_annovar-617"><a href="#databases_download_annovar-617"><span class="linenos">617</span></a>                <span class="n">files_to_download</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
</span><span id="databases_download_annovar-618"><a href="#databases_download_annovar-618"><span class="linenos">618</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_annovar-619"><a href="#databases_download_annovar-619"><span class="linenos">619</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">patterns_file_to_check</span><span class="p">:</span>
</span><span id="databases_download_annovar-620"><a href="#databases_download_annovar-620"><span class="linenos">620</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.txt.gz&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-621"><a href="#databases_download_annovar-621"><span class="linenos">621</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.txt.idx.gz&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-622"><a href="#databases_download_annovar-622"><span class="linenos">622</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.fa.gz&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-623"><a href="#databases_download_annovar-623"><span class="linenos">623</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-624"><a href="#databases_download_annovar-624"><span class="linenos">624</span></a>
</span><span id="databases_download_annovar-625"><a href="#databases_download_annovar-625"><span class="linenos">625</span></a>            <span class="c1"># Found if files exists in folder</span>
</span><span id="databases_download_annovar-626"><a href="#databases_download_annovar-626"><span class="linenos">626</span></a>            <span class="n">list_files_in_folder</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_annovar-627"><a href="#databases_download_annovar-627"><span class="linenos">627</span></a>            <span class="n">list_files_in_folder_size</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_annovar-628"><a href="#databases_download_annovar-628"><span class="linenos">628</span></a>            <span class="c1"># Loop through each file in the list</span>
</span><span id="databases_download_annovar-629"><a href="#databases_download_annovar-629"><span class="linenos">629</span></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="databases_download_annovar-630"><a href="#databases_download_annovar-630"><span class="linenos">630</span></a>                <span class="c1"># Get a list of files in the folder that match the pattern</span>
</span><span id="databases_download_annovar-631"><a href="#databases_download_annovar-631"><span class="linenos">631</span></a>                <span class="n">files_in_folder</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
</span><span id="databases_download_annovar-632"><a href="#databases_download_annovar-632"><span class="linenos">632</span></a>                <span class="k">if</span> <span class="n">files_in_folder</span><span class="p">:</span>
</span><span id="databases_download_annovar-633"><a href="#databases_download_annovar-633"><span class="linenos">633</span></a>                    <span class="c1"># If the file exists, add it</span>
</span><span id="databases_download_annovar-634"><a href="#databases_download_annovar-634"><span class="linenos">634</span></a>                    <span class="n">list_files_in_folder</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="databases_download_annovar-635"><a href="#databases_download_annovar-635"><span class="linenos">635</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_in_folder</span>
</span><span id="databases_download_annovar-636"><a href="#databases_download_annovar-636"><span class="linenos">636</span></a>                    <span class="p">]</span>
</span><span id="databases_download_annovar-637"><a href="#databases_download_annovar-637"><span class="linenos">637</span></a>                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_in_folder</span><span class="p">:</span>
</span><span id="databases_download_annovar-638"><a href="#databases_download_annovar-638"><span class="linenos">638</span></a>                        <span class="n">list_files_in_folder_size</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_annovar-639"><a href="#databases_download_annovar-639"><span class="linenos">639</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="databases_download_annovar-640"><a href="#databases_download_annovar-640"><span class="linenos">640</span></a>                        <span class="p">)</span>
</span><span id="databases_download_annovar-641"><a href="#databases_download_annovar-641"><span class="linenos">641</span></a>            <span class="c1"># List of files in folder</span>
</span><span id="databases_download_annovar-642"><a href="#databases_download_annovar-642"><span class="linenos">642</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List of file in Annovar folder: </span><span class="si">{</span><span class="n">list_files_in_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-643"><a href="#databases_download_annovar-643"><span class="linenos">643</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_annovar-644"><a href="#databases_download_annovar-644"><span class="linenos">644</span></a>                <span class="sa">f</span><span class="s2">&quot;List of file in Annovar folder with size: </span><span class="si">{</span><span class="n">list_files_in_folder_size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_annovar-645"><a href="#databases_download_annovar-645"><span class="linenos">645</span></a>            <span class="p">)</span>
</span><span id="databases_download_annovar-646"><a href="#databases_download_annovar-646"><span class="linenos">646</span></a>
</span><span id="databases_download_annovar-647"><a href="#databases_download_annovar-647"><span class="linenos">647</span></a>            <span class="c1"># Found if files exists in url</span>
</span><span id="databases_download_annovar-648"><a href="#databases_download_annovar-648"><span class="linenos">648</span></a>            <span class="n">matched_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_annovar-649"><a href="#databases_download_annovar-649"><span class="linenos">649</span></a>            <span class="c1"># for pattern in list_files_in_folder:</span>
</span><span id="databases_download_annovar-650"><a href="#databases_download_annovar-650"><span class="linenos">650</span></a>            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="databases_download_annovar-651"><a href="#databases_download_annovar-651"><span class="linenos">651</span></a>                <span class="n">matched_files</span> <span class="o">+=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span> <span class="n">pattern</span><span class="p">)</span>
</span><span id="databases_download_annovar-652"><a href="#databases_download_annovar-652"><span class="linenos">652</span></a>            <span class="c1"># deduplicate</span>
</span><span id="databases_download_annovar-653"><a href="#databases_download_annovar-653"><span class="linenos">653</span></a>            <span class="n">matched_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matched_files</span><span class="p">))</span>
</span><span id="databases_download_annovar-654"><a href="#databases_download_annovar-654"><span class="linenos">654</span></a>            <span class="c1"># List of files available</span>
</span><span id="databases_download_annovar-655"><a href="#databases_download_annovar-655"><span class="linenos">655</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List of file available in Annovar URL: </span><span class="si">{</span><span class="n">matched_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-656"><a href="#databases_download_annovar-656"><span class="linenos">656</span></a>
</span><span id="databases_download_annovar-657"><a href="#databases_download_annovar-657"><span class="linenos">657</span></a>            <span class="c1"># Find files in url but not in folder</span>
</span><span id="databases_download_annovar-658"><a href="#databases_download_annovar-658"><span class="linenos">658</span></a>            <span class="n">files_to_download</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_annovar-659"><a href="#databases_download_annovar-659"><span class="linenos">659</span></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">matched_files</span><span class="p">:</span>
</span><span id="databases_download_annovar-660"><a href="#databases_download_annovar-660"><span class="linenos">660</span></a>                <span class="n">file_url_size</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
</span><span id="databases_download_annovar-661"><a href="#databases_download_annovar-661"><span class="linenos">661</span></a>                    <span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span> <span class="n">file</span><span class="p">)),</span> <span class="kc">None</span>
</span><span id="databases_download_annovar-662"><a href="#databases_download_annovar-662"><span class="linenos">662</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="databases_download_annovar-663"><a href="#databases_download_annovar-663"><span class="linenos">663</span></a>                <span class="n">file_folder_size</span> <span class="o">=</span> <span class="n">list_files_in_folder_size</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="databases_download_annovar-664"><a href="#databases_download_annovar-664"><span class="linenos">664</span></a>                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_files_in_folder</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_url_size</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="databases_download_annovar-665"><a href="#databases_download_annovar-665"><span class="linenos">665</span></a>                    <span class="n">file_folder_size</span>
</span><span id="databases_download_annovar-666"><a href="#databases_download_annovar-666"><span class="linenos">666</span></a>                <span class="p">):</span>
</span><span id="databases_download_annovar-667"><a href="#databases_download_annovar-667"><span class="linenos">667</span></a>                    <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="databases_download_annovar-668"><a href="#databases_download_annovar-668"><span class="linenos">668</span></a>
</span><span id="databases_download_annovar-669"><a href="#databases_download_annovar-669"><span class="linenos">669</span></a>            <span class="c1"># List of files to download</span>
</span><span id="databases_download_annovar-670"><a href="#databases_download_annovar-670"><span class="linenos">670</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List of file to download: </span><span class="si">{</span><span class="n">files_to_download</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-671"><a href="#databases_download_annovar-671"><span class="linenos">671</span></a>
</span><span id="databases_download_annovar-672"><a href="#databases_download_annovar-672"><span class="linenos">672</span></a>            <span class="c1"># Dowload and extract files</span>
</span><span id="databases_download_annovar-673"><a href="#databases_download_annovar-673"><span class="linenos">673</span></a>            <span class="k">if</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="databases_download_annovar-674"><a href="#databases_download_annovar-674"><span class="linenos">674</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-675"><a href="#databases_download_annovar-675"><span class="linenos">675</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
</span><span id="databases_download_annovar-676"><a href="#databases_download_annovar-676"><span class="linenos">676</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_annovar-677"><a href="#databases_download_annovar-677"><span class="linenos">677</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - file &#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39; Downloading...&quot;</span>
</span><span id="databases_download_annovar-678"><a href="#databases_download_annovar-678"><span class="linenos">678</span></a>                    <span class="p">)</span>
</span><span id="databases_download_annovar-679"><a href="#databases_download_annovar-679"><span class="linenos">679</span></a>                    <span class="n">file_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annovar_url</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="databases_download_annovar-680"><a href="#databases_download_annovar-680"><span class="linenos">680</span></a>                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="databases_download_annovar-681"><a href="#databases_download_annovar-681"><span class="linenos">681</span></a>
</span><span id="databases_download_annovar-682"><a href="#databases_download_annovar-682"><span class="linenos">682</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-683"><a href="#databases_download_annovar-683"><span class="linenos">683</span></a>                    <span class="n">download_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_annovar-684"><a href="#databases_download_annovar-684"><span class="linenos">684</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">folder_assembly</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="databases_download_annovar-685"><a href="#databases_download_annovar-685"><span class="linenos">685</span></a>                    <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_annovar-686"><a href="#databases_download_annovar-686"><span class="linenos">686</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_annovar-687"><a href="#databases_download_annovar-687"><span class="linenos">687</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Annovar databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - already exists&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function downloads and extracts Annovar databases for specified assemblies and files.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>folder</strong>:  The folder where the Annovar databases will be downloaded to</li>
<li><strong>files</strong>:  The <code>files</code> parameter is a list of specific Annovar database files to download. If not
provided, only the mandatory files will be downloaded. If set to "ALL", all available files will be
downloaded</li>
<li><strong>assemblies</strong>:  A list of genome assemblies for which Annovar databases will be downloaded.
Default is ["hg19"]</li>
<li><strong>annovar_url</strong>:  The URL where Annovar databases can be downloaded from, defaults to
<a href="http://www.openbioinformatics.org/annovar/download">http://www.openbioinformatics.org/annovar/download</a></li>
<li><strong>threads</strong>:  The "threads" parameter specifies the number of threads (parallel processes) to use
for download and extract/uncompress files. Default: 1</li>
</ul>
</div>


                </section>
                <section id="databases_download_snpeff">
                            <input id="databases_download_snpeff-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_snpeff</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hg19&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="databases_download_snpeff-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_snpeff"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_snpeff-690"><a href="#databases_download_snpeff-690"><span class="linenos">690</span></a><span class="k">def</span> <span class="nf">databases_download_snpeff</span><span class="p">(</span>
</span><span id="databases_download_snpeff-691"><a href="#databases_download_snpeff-691"><span class="linenos">691</span></a>    <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hg19&quot;</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="databases_download_snpeff-692"><a href="#databases_download_snpeff-692"><span class="linenos">692</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="databases_download_snpeff-693"><a href="#databases_download_snpeff-693"><span class="linenos">693</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_snpeff-694"><a href="#databases_download_snpeff-694"><span class="linenos">694</span></a><span class="sd">    The `databases_download_snpeff` function downloads and extracts snpEff databases for specified</span>
</span><span id="databases_download_snpeff-695"><a href="#databases_download_snpeff-695"><span class="linenos">695</span></a><span class="sd">    genome assemblies.</span>
</span><span id="databases_download_snpeff-696"><a href="#databases_download_snpeff-696"><span class="linenos">696</span></a>
</span><span id="databases_download_snpeff-697"><a href="#databases_download_snpeff-697"><span class="linenos">697</span></a><span class="sd">    :param folder: The `folder` parameter is a string that specifies the folder where the snpEff</span>
</span><span id="databases_download_snpeff-698"><a href="#databases_download_snpeff-698"><span class="linenos">698</span></a><span class="sd">    databases will be downloaded and stored. If the folder does not exist, it will be created</span>
</span><span id="databases_download_snpeff-699"><a href="#databases_download_snpeff-699"><span class="linenos">699</span></a><span class="sd">    :type folder: str</span>
</span><span id="databases_download_snpeff-700"><a href="#databases_download_snpeff-700"><span class="linenos">700</span></a><span class="sd">    :param assemblies: The `assemblies` parameter is a list of genome assemblies for which the snpEff</span>
</span><span id="databases_download_snpeff-701"><a href="#databases_download_snpeff-701"><span class="linenos">701</span></a><span class="sd">    databases need to be downloaded. It specifies the genome assemblies for which you want to download</span>
</span><span id="databases_download_snpeff-702"><a href="#databases_download_snpeff-702"><span class="linenos">702</span></a><span class="sd">    the snpEff databases. For example, if you want to download the snpEff databases for the human genome</span>
</span><span id="databases_download_snpeff-703"><a href="#databases_download_snpeff-703"><span class="linenos">703</span></a><span class="sd">    assembly hg</span>
</span><span id="databases_download_snpeff-704"><a href="#databases_download_snpeff-704"><span class="linenos">704</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_snpeff-705"><a href="#databases_download_snpeff-705"><span class="linenos">705</span></a><span class="sd">    :param config: The `config` parameter is a dictionary that contains information about the tools and</span>
</span><span id="databases_download_snpeff-706"><a href="#databases_download_snpeff-706"><span class="linenos">706</span></a><span class="sd">    their configurations. It is used to retrieve the path to the Java binary and the path to the snpEff</span>
</span><span id="databases_download_snpeff-707"><a href="#databases_download_snpeff-707"><span class="linenos">707</span></a><span class="sd">    binary</span>
</span><span id="databases_download_snpeff-708"><a href="#databases_download_snpeff-708"><span class="linenos">708</span></a><span class="sd">    :type config: dict</span>
</span><span id="databases_download_snpeff-709"><a href="#databases_download_snpeff-709"><span class="linenos">709</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to be used for downloading</span>
</span><span id="databases_download_snpeff-710"><a href="#databases_download_snpeff-710"><span class="linenos">710</span></a><span class="sd">    the snpEff databases. It determines the parallelism of the download process, allowing multiple files</span>
</span><span id="databases_download_snpeff-711"><a href="#databases_download_snpeff-711"><span class="linenos">711</span></a><span class="sd">    to be downloaded simultaneously, defaults to 1</span>
</span><span id="databases_download_snpeff-712"><a href="#databases_download_snpeff-712"><span class="linenos">712</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="databases_download_snpeff-713"><a href="#databases_download_snpeff-713"><span class="linenos">713</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_snpeff-714"><a href="#databases_download_snpeff-714"><span class="linenos">714</span></a>
</span><span id="databases_download_snpeff-715"><a href="#databases_download_snpeff-715"><span class="linenos">715</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-716"><a href="#databases_download_snpeff-716"><span class="linenos">716</span></a>
</span><span id="databases_download_snpeff-717"><a href="#databases_download_snpeff-717"><span class="linenos">717</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_snpeff-718"><a href="#databases_download_snpeff-718"><span class="linenos">718</span></a>    <span class="n">folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="databases_download_snpeff-719"><a href="#databases_download_snpeff-719"><span class="linenos">719</span></a>
</span><span id="databases_download_snpeff-720"><a href="#databases_download_snpeff-720"><span class="linenos">720</span></a>    <span class="c1"># Java bin and snpEff jar</span>
</span><span id="databases_download_snpeff-721"><a href="#databases_download_snpeff-721"><span class="linenos">721</span></a>    <span class="n">snpeff_bin</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="databases_download_snpeff-722"><a href="#databases_download_snpeff-722"><span class="linenos">722</span></a>        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;snpeff&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-723"><a href="#databases_download_snpeff-723"><span class="linenos">723</span></a>        <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;snpEff.jar&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-724"><a href="#databases_download_snpeff-724"><span class="linenos">724</span></a>        <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;jar&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-725"><a href="#databases_download_snpeff-725"><span class="linenos">725</span></a>        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span id="databases_download_snpeff-726"><a href="#databases_download_snpeff-726"><span class="linenos">726</span></a>        <span class="n">default_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_TOOLS_FOLDER</span><span class="si">}</span><span class="s2">/snpeff&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-727"><a href="#databases_download_snpeff-727"><span class="linenos">727</span></a>    <span class="p">)</span>
</span><span id="databases_download_snpeff-728"><a href="#databases_download_snpeff-728"><span class="linenos">728</span></a>    <span class="n">java_bin</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="databases_download_snpeff-729"><a href="#databases_download_snpeff-729"><span class="linenos">729</span></a>        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;java&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-730"><a href="#databases_download_snpeff-730"><span class="linenos">730</span></a>        <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;java&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-731"><a href="#databases_download_snpeff-731"><span class="linenos">731</span></a>        <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-732"><a href="#databases_download_snpeff-732"><span class="linenos">732</span></a>        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span id="databases_download_snpeff-733"><a href="#databases_download_snpeff-733"><span class="linenos">733</span></a>        <span class="n">default_folder</span><span class="o">=</span><span class="s2">&quot;/usr/bin&quot;</span><span class="p">,</span>
</span><span id="databases_download_snpeff-734"><a href="#databases_download_snpeff-734"><span class="linenos">734</span></a>    <span class="p">)</span>
</span><span id="databases_download_snpeff-735"><a href="#databases_download_snpeff-735"><span class="linenos">735</span></a>
</span><span id="databases_download_snpeff-736"><a href="#databases_download_snpeff-736"><span class="linenos">736</span></a>    <span class="c1"># database list</span>
</span><span id="databases_download_snpeff-737"><a href="#databases_download_snpeff-737"><span class="linenos">737</span></a>    <span class="n">snpeff_databases_list</span> <span class="o">=</span> <span class="s2">&quot;snpeff_databases.list&quot;</span>
</span><span id="databases_download_snpeff-738"><a href="#databases_download_snpeff-738"><span class="linenos">738</span></a>    <span class="n">snpeff_databases_list_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">snpeff_databases_list</span><span class="p">)</span>
</span><span id="databases_download_snpeff-739"><a href="#databases_download_snpeff-739"><span class="linenos">739</span></a>
</span><span id="databases_download_snpeff-740"><a href="#databases_download_snpeff-740"><span class="linenos">740</span></a>    <span class="c1"># create folder if not exists</span>
</span><span id="databases_download_snpeff-741"><a href="#databases_download_snpeff-741"><span class="linenos">741</span></a>    <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
</span><span id="databases_download_snpeff-742"><a href="#databases_download_snpeff-742"><span class="linenos">742</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
</span><span id="databases_download_snpeff-743"><a href="#databases_download_snpeff-743"><span class="linenos">743</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="databases_download_snpeff-744"><a href="#databases_download_snpeff-744"><span class="linenos">744</span></a>
</span><span id="databases_download_snpeff-745"><a href="#databases_download_snpeff-745"><span class="linenos">745</span></a>    <span class="c1"># For each assembly</span>
</span><span id="databases_download_snpeff-746"><a href="#databases_download_snpeff-746"><span class="linenos">746</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_snpeff-747"><a href="#databases_download_snpeff-747"><span class="linenos">747</span></a>
</span><span id="databases_download_snpeff-748"><a href="#databases_download_snpeff-748"><span class="linenos">748</span></a>        <span class="c1"># Destination folder</span>
</span><span id="databases_download_snpeff-749"><a href="#databases_download_snpeff-749"><span class="linenos">749</span></a>        <span class="n">folder_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_snpeff-750"><a href="#databases_download_snpeff-750"><span class="linenos">750</span></a>
</span><span id="databases_download_snpeff-751"><a href="#databases_download_snpeff-751"><span class="linenos">751</span></a>        <span class="c1"># Check if destination folder exists (already downloaded)</span>
</span><span id="databases_download_snpeff-752"><a href="#databases_download_snpeff-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_assembly</span><span class="p">):</span>
</span><span id="databases_download_snpeff-753"><a href="#databases_download_snpeff-753"><span class="linenos">753</span></a>
</span><span id="databases_download_snpeff-754"><a href="#databases_download_snpeff-754"><span class="linenos">754</span></a>            <span class="c1"># Download list of databases if file does not exists</span>
</span><span id="databases_download_snpeff-755"><a href="#databases_download_snpeff-755"><span class="linenos">755</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="databases_download_snpeff-756"><a href="#databases_download_snpeff-756"><span class="linenos">756</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span>
</span><span id="databases_download_snpeff-757"><a href="#databases_download_snpeff-757"><span class="linenos">757</span></a>                <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="databases_download_snpeff-758"><a href="#databases_download_snpeff-758"><span class="linenos">758</span></a>            <span class="p">):</span>
</span><span id="databases_download_snpeff-759"><a href="#databases_download_snpeff-759"><span class="linenos">759</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_snpeff-760"><a href="#databases_download_snpeff-760"><span class="linenos">760</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span>
</span><span id="databases_download_snpeff-761"><a href="#databases_download_snpeff-761"><span class="linenos">761</span></a>                    <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="databases_download_snpeff-762"><a href="#databases_download_snpeff-762"><span class="linenos">762</span></a>                <span class="p">):</span>
</span><span id="databases_download_snpeff-763"><a href="#databases_download_snpeff-763"><span class="linenos">763</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="databases_download_snpeff-764"><a href="#databases_download_snpeff-764"><span class="linenos">764</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - list of databases empty - download &#39;</span><span class="si">{</span><span class="n">snpeff_databases_list_path</span><span class="si">}</span><span class="s2">&#39; required&quot;</span>
</span><span id="databases_download_snpeff-765"><a href="#databases_download_snpeff-765"><span class="linenos">765</span></a>                    <span class="p">)</span>
</span><span id="databases_download_snpeff-766"><a href="#databases_download_snpeff-766"><span class="linenos">766</span></a>                <span class="n">snpeff_command_list_databases</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span><span class="si">{</span><span class="n">java_bin</span><span class="si">}</span><span class="s2"> -jar </span><span class="si">{</span><span class="n">snpeff_bin</span><span class="si">}</span><span class="s2"> databases &gt; </span><span class="si">{</span><span class="n">snpeff_databases_list_path</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="databases_download_snpeff-767"><a href="#databases_download_snpeff-767"><span class="linenos">767</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_snpeff-768"><a href="#databases_download_snpeff-768"><span class="linenos">768</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - list of databases...&quot;</span>
</span><span id="databases_download_snpeff-769"><a href="#databases_download_snpeff-769"><span class="linenos">769</span></a>                <span class="p">)</span>
</span><span id="databases_download_snpeff-770"><a href="#databases_download_snpeff-770"><span class="linenos">770</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_snpeff-771"><a href="#databases_download_snpeff-771"><span class="linenos">771</span></a>                    <span class="sa">f</span><span class="s2">&quot;snpEff databases downloading - list of databases: </span><span class="si">{</span><span class="n">snpeff_command_list_databases</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_snpeff-772"><a href="#databases_download_snpeff-772"><span class="linenos">772</span></a>                <span class="p">)</span>
</span><span id="databases_download_snpeff-773"><a href="#databases_download_snpeff-773"><span class="linenos">773</span></a>                <span class="n">command</span><span class="p">(</span><span class="n">snpeff_command_list_databases</span><span class="p">)</span>
</span><span id="databases_download_snpeff-774"><a href="#databases_download_snpeff-774"><span class="linenos">774</span></a>
</span><span id="databases_download_snpeff-775"><a href="#databases_download_snpeff-775"><span class="linenos">775</span></a>            <span class="c1"># Open list of databases and create list of url</span>
</span><span id="databases_download_snpeff-776"><a href="#databases_download_snpeff-776"><span class="linenos">776</span></a>            <span class="n">snpeff_list_databases</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_snpeff-777"><a href="#databases_download_snpeff-777"><span class="linenos">777</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">snpeff_databases_list_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_snpeff-778"><a href="#databases_download_snpeff-778"><span class="linenos">778</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_snpeff-779"><a href="#databases_download_snpeff-779"><span class="linenos">779</span></a>                    <span class="n">cols</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="databases_download_snpeff-780"><a href="#databases_download_snpeff-780"><span class="linenos">780</span></a>                    <span class="n">snpeff_list_databases</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_snpeff-781"><a href="#databases_download_snpeff-781"><span class="linenos">781</span></a>                    <span class="c1"># Last 2 infos on file. Fix from snpEff between release 5.0 and 5.1</span>
</span><span id="databases_download_snpeff-782"><a href="#databases_download_snpeff-782"><span class="linenos">782</span></a>                    <span class="n">snpeff_list_databases</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_snpeff-783"><a href="#databases_download_snpeff-783"><span class="linenos">783</span></a>                        <span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-784"><a href="#databases_download_snpeff-784"><span class="linenos">784</span></a>                    <span class="p">)</span>
</span><span id="databases_download_snpeff-785"><a href="#databases_download_snpeff-785"><span class="linenos">785</span></a>                    <span class="n">snpeff_list_databases</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_snpeff-786"><a href="#databases_download_snpeff-786"><span class="linenos">786</span></a>                        <span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-787"><a href="#databases_download_snpeff-787"><span class="linenos">787</span></a>                    <span class="p">)</span>
</span><span id="databases_download_snpeff-788"><a href="#databases_download_snpeff-788"><span class="linenos">788</span></a>
</span><span id="databases_download_snpeff-789"><a href="#databases_download_snpeff-789"><span class="linenos">789</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">snpeff_list_databases</span><span class="p">:</span>
</span><span id="databases_download_snpeff-790"><a href="#databases_download_snpeff-790"><span class="linenos">790</span></a>                <span class="n">msg_err</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - list of databases empty - check file &#39;</span><span class="si">{</span><span class="n">snpeff_databases_list_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="databases_download_snpeff-791"><a href="#databases_download_snpeff-791"><span class="linenos">791</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>
</span><span id="databases_download_snpeff-792"><a href="#databases_download_snpeff-792"><span class="linenos">792</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>
</span><span id="databases_download_snpeff-793"><a href="#databases_download_snpeff-793"><span class="linenos">793</span></a>
</span><span id="databases_download_snpeff-794"><a href="#databases_download_snpeff-794"><span class="linenos">794</span></a>            <span class="c1"># Start download</span>
</span><span id="databases_download_snpeff-795"><a href="#databases_download_snpeff-795"><span class="linenos">795</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - downloading...&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-796"><a href="#databases_download_snpeff-796"><span class="linenos">796</span></a>            <span class="c1"># Try to download files</span>
</span><span id="databases_download_snpeff-797"><a href="#databases_download_snpeff-797"><span class="linenos">797</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_snpeff-798"><a href="#databases_download_snpeff-798"><span class="linenos">798</span></a>            <span class="n">file_url</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_snpeff-799"><a href="#databases_download_snpeff-799"><span class="linenos">799</span></a>            <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">snpeff_list_databases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="databases_download_snpeff-800"><a href="#databases_download_snpeff-800"><span class="linenos">800</span></a>                <span class="c1"># File to be downloaded</span>
</span><span id="databases_download_snpeff-801"><a href="#databases_download_snpeff-801"><span class="linenos">801</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_url</span><span class="p">))</span>
</span><span id="databases_download_snpeff-802"><a href="#databases_download_snpeff-802"><span class="linenos">802</span></a>                <span class="c1"># Check if file already downloaded</span>
</span><span id="databases_download_snpeff-803"><a href="#databases_download_snpeff-803"><span class="linenos">803</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="databases_download_snpeff-804"><a href="#databases_download_snpeff-804"><span class="linenos">804</span></a>                    <span class="k">break</span>
</span><span id="databases_download_snpeff-805"><a href="#databases_download_snpeff-805"><span class="linenos">805</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_snpeff-806"><a href="#databases_download_snpeff-806"><span class="linenos">806</span></a>                    <span class="c1"># try to download</span>
</span><span id="databases_download_snpeff-807"><a href="#databases_download_snpeff-807"><span class="linenos">807</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="databases_download_snpeff-808"><a href="#databases_download_snpeff-808"><span class="linenos">808</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-809"><a href="#databases_download_snpeff-809"><span class="linenos">809</span></a>                        <span class="c1"># Download file</span>
</span><span id="databases_download_snpeff-810"><a href="#databases_download_snpeff-810"><span class="linenos">810</span></a>                        <span class="k">if</span> <span class="n">download_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">):</span>
</span><span id="databases_download_snpeff-811"><a href="#databases_download_snpeff-811"><span class="linenos">811</span></a>                            <span class="k">break</span>
</span><span id="databases_download_snpeff-812"><a href="#databases_download_snpeff-812"><span class="linenos">812</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_snpeff-813"><a href="#databases_download_snpeff-813"><span class="linenos">813</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-814"><a href="#databases_download_snpeff-814"><span class="linenos">814</span></a>                    <span class="c1"># If fail, just pass to next url</span>
</span><span id="databases_download_snpeff-815"><a href="#databases_download_snpeff-815"><span class="linenos">815</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="databases_download_snpeff-816"><a href="#databases_download_snpeff-816"><span class="linenos">816</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-817"><a href="#databases_download_snpeff-817"><span class="linenos">817</span></a>
</span><span id="databases_download_snpeff-818"><a href="#databases_download_snpeff-818"><span class="linenos">818</span></a>            <span class="c1"># If download file exists</span>
</span><span id="databases_download_snpeff-819"><a href="#databases_download_snpeff-819"><span class="linenos">819</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_snpeff-820"><a href="#databases_download_snpeff-820"><span class="linenos">820</span></a>                <span class="n">file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="databases_download_snpeff-821"><a href="#databases_download_snpeff-821"><span class="linenos">821</span></a>                <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="databases_download_snpeff-822"><a href="#databases_download_snpeff-822"><span class="linenos">822</span></a>                <span class="ow">and</span> <span class="n">file_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="databases_download_snpeff-823"><a href="#databases_download_snpeff-823"><span class="linenos">823</span></a>            <span class="p">):</span>
</span><span id="databases_download_snpeff-824"><a href="#databases_download_snpeff-824"><span class="linenos">824</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - extracting...&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-825"><a href="#databases_download_snpeff-825"><span class="linenos">825</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-826"><a href="#databases_download_snpeff-826"><span class="linenos">826</span></a>                <span class="c1"># Extract file</span>
</span><span id="databases_download_snpeff-827"><a href="#databases_download_snpeff-827"><span class="linenos">827</span></a>                <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="databases_download_snpeff-828"><a href="#databases_download_snpeff-828"><span class="linenos">828</span></a>                <span class="c1"># Move to destination folder</span>
</span><span id="databases_download_snpeff-829"><a href="#databases_download_snpeff-829"><span class="linenos">829</span></a>                <span class="n">extracted_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_snpeff-830"><a href="#databases_download_snpeff-830"><span class="linenos">830</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">extracted_folder</span><span class="p">,</span> <span class="n">folder_assembly</span><span class="p">)</span>
</span><span id="databases_download_snpeff-831"><a href="#databases_download_snpeff-831"><span class="linenos">831</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_snpeff-832"><a href="#databases_download_snpeff-832"><span class="linenos">832</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-833"><a href="#databases_download_snpeff-833"><span class="linenos">833</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff &#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39; failed&quot;</span><span class="p">)</span>
</span><span id="databases_download_snpeff-834"><a href="#databases_download_snpeff-834"><span class="linenos">834</span></a>
</span><span id="databases_download_snpeff-835"><a href="#databases_download_snpeff-835"><span class="linenos">835</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_snpeff-836"><a href="#databases_download_snpeff-836"><span class="linenos">836</span></a>
</span><span id="databases_download_snpeff-837"><a href="#databases_download_snpeff-837"><span class="linenos">837</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download snpEff databases </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - already exists&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_download_snpeff">databases_download_snpeff</a></code> function downloads and extracts snpEff databases for specified
genome assemblies.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>folder</strong>:  The <code>folder</code> parameter is a string that specifies the folder where the snpEff
databases will be downloaded and stored. If the folder does not exist, it will be created</li>
<li><strong>assemblies</strong>:  The <code>assemblies</code> parameter is a list of genome assemblies for which the snpEff
databases need to be downloaded. It specifies the genome assemblies for which you want to download
the snpEff databases. For example, if you want to download the snpEff databases for the human genome
assembly hg</li>
<li><strong>config</strong>:  The <code>config</code> parameter is a dictionary that contains information about the tools and
their configurations. It is used to retrieve the path to the Java binary and the path to the snpEff
binary</li>
<li><strong>threads</strong>:  The <code>threads</code> parameter specifies the number of threads to be used for downloading
the snpEff databases. It determines the parallelism of the download process, allowing multiple files
to be downloaded simultaneously, defaults to 1</li>
</ul>
</div>


                </section>
                <section id="databases_download_genomes">
                            <input id="databases_download_genomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_genomes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/lebechea/howard/databases/genomes/current&#39;</span>,</span><span class="param">	<span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;UCSC&#39;</span>,</span><span class="param">	<span class="n">contig_regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="databases_download_genomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_genomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_genomes-840"><a href="#databases_download_genomes-840"><span class="linenos">840</span></a><span class="k">def</span> <span class="nf">databases_download_genomes</span><span class="p">(</span>
</span><span id="databases_download_genomes-841"><a href="#databases_download_genomes-841"><span class="linenos">841</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="databases_download_genomes-842"><a href="#databases_download_genomes-842"><span class="linenos">842</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span><span class="p">,</span>
</span><span id="databases_download_genomes-843"><a href="#databases_download_genomes-843"><span class="linenos">843</span></a>    <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UCSC&quot;</span><span class="p">,</span>
</span><span id="databases_download_genomes-844"><a href="#databases_download_genomes-844"><span class="linenos">844</span></a>    <span class="n">contig_regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_genomes-845"><a href="#databases_download_genomes-845"><span class="linenos">845</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_genomes-846"><a href="#databases_download_genomes-846"><span class="linenos">846</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="databases_download_genomes-847"><a href="#databases_download_genomes-847"><span class="linenos">847</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_genomes-848"><a href="#databases_download_genomes-848"><span class="linenos">848</span></a><span class="sd">    This function downloads genome assemblies using genomepy package with options to specify genome</span>
</span><span id="databases_download_genomes-849"><a href="#databases_download_genomes-849"><span class="linenos">849</span></a><span class="sd">    folder, provider, contig regex, and number of threads.</span>
</span><span id="databases_download_genomes-850"><a href="#databases_download_genomes-850"><span class="linenos">850</span></a>
</span><span id="databases_download_genomes-851"><a href="#databases_download_genomes-851"><span class="linenos">851</span></a><span class="sd">    :param assemblies: a list of genome assembly names to download</span>
</span><span id="databases_download_genomes-852"><a href="#databases_download_genomes-852"><span class="linenos">852</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_genomes-853"><a href="#databases_download_genomes-853"><span class="linenos">853</span></a><span class="sd">    :param genomes_folder: The folder where the downloaded genome files will be saved. If no folder is</span>
</span><span id="databases_download_genomes-854"><a href="#databases_download_genomes-854"><span class="linenos">854</span></a><span class="sd">    specified, the default folder will be used</span>
</span><span id="databases_download_genomes-855"><a href="#databases_download_genomes-855"><span class="linenos">855</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="databases_download_genomes-856"><a href="#databases_download_genomes-856"><span class="linenos">856</span></a><span class="sd">    :param provider: The provider parameter specifies the source of the genome data. In this case, the</span>
</span><span id="databases_download_genomes-857"><a href="#databases_download_genomes-857"><span class="linenos">857</span></a><span class="sd">    default provider is set to &quot;UCSC&quot;, which refers to the University of California, Santa Cruz Genome</span>
</span><span id="databases_download_genomes-858"><a href="#databases_download_genomes-858"><span class="linenos">858</span></a><span class="sd">    Browser. Other possible providers could include NCBI or Ensembl, defaults to UCSC</span>
</span><span id="databases_download_genomes-859"><a href="#databases_download_genomes-859"><span class="linenos">859</span></a><span class="sd">    :type provider: str (optional)</span>
</span><span id="databases_download_genomes-860"><a href="#databases_download_genomes-860"><span class="linenos">860</span></a><span class="sd">    :param contig_regex: The contig_regex parameter is a regular expression used to filter the contigs</span>
</span><span id="databases_download_genomes-861"><a href="#databases_download_genomes-861"><span class="linenos">861</span></a><span class="sd">    (chromosomes or scaffolds) to be downloaded for a given genome assembly. It allows users to download</span>
</span><span id="databases_download_genomes-862"><a href="#databases_download_genomes-862"><span class="linenos">862</span></a><span class="sd">    only a subset of the available contigs, based on their names or other characteristics. If</span>
</span><span id="databases_download_genomes-863"><a href="#databases_download_genomes-863"><span class="linenos">863</span></a><span class="sd">    contig_regex is not specified</span>
</span><span id="databases_download_genomes-864"><a href="#databases_download_genomes-864"><span class="linenos">864</span></a><span class="sd">    :type contig_regex: str</span>
</span><span id="databases_download_genomes-865"><a href="#databases_download_genomes-865"><span class="linenos">865</span></a><span class="sd">    :param threads: The &quot;threads&quot; parameter specifies the number of threads (parallel processes) to use</span>
</span><span id="databases_download_genomes-866"><a href="#databases_download_genomes-866"><span class="linenos">866</span></a><span class="sd">    for downloading the genomes. This can speed up the process if the computer has multiple cores or</span>
</span><span id="databases_download_genomes-867"><a href="#databases_download_genomes-867"><span class="linenos">867</span></a><span class="sd">    processors. The default value is 1, meaning that the download will be done using a single thread,</span>
</span><span id="databases_download_genomes-868"><a href="#databases_download_genomes-868"><span class="linenos">868</span></a><span class="sd">    defaults to 1</span>
</span><span id="databases_download_genomes-869"><a href="#databases_download_genomes-869"><span class="linenos">869</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="databases_download_genomes-870"><a href="#databases_download_genomes-870"><span class="linenos">870</span></a><span class="sd">    :return: None is being returned.</span>
</span><span id="databases_download_genomes-871"><a href="#databases_download_genomes-871"><span class="linenos">871</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_genomes-872"><a href="#databases_download_genomes-872"><span class="linenos">872</span></a>
</span><span id="databases_download_genomes-873"><a href="#databases_download_genomes-873"><span class="linenos">873</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Genomes </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_genomes-874"><a href="#databases_download_genomes-874"><span class="linenos">874</span></a>
</span><span id="databases_download_genomes-875"><a href="#databases_download_genomes-875"><span class="linenos">875</span></a>    <span class="kn">import</span> <span class="nn">genomepy</span>
</span><span id="databases_download_genomes-876"><a href="#databases_download_genomes-876"><span class="linenos">876</span></a>
</span><span id="databases_download_genomes-877"><a href="#databases_download_genomes-877"><span class="linenos">877</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="databases_download_genomes-878"><a href="#databases_download_genomes-878"><span class="linenos">878</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="databases_download_genomes-879"><a href="#databases_download_genomes-879"><span class="linenos">879</span></a>
</span><span id="databases_download_genomes-880"><a href="#databases_download_genomes-880"><span class="linenos">880</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_genomes-881"><a href="#databases_download_genomes-881"><span class="linenos">881</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="databases_download_genomes-882"><a href="#databases_download_genomes-882"><span class="linenos">882</span></a>
</span><span id="databases_download_genomes-883"><a href="#databases_download_genomes-883"><span class="linenos">883</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">):</span>
</span><span id="databases_download_genomes-884"><a href="#databases_download_genomes-884"><span class="linenos">884</span></a>        <span class="n">installed_genomes</span> <span class="o">=</span> <span class="n">genomepy</span><span class="o">.</span><span class="n">list_installed_genomes</span><span class="p">(</span><span class="n">genomes_dir</span><span class="o">=</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="databases_download_genomes-885"><a href="#databases_download_genomes-885"><span class="linenos">885</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_genomes-886"><a href="#databases_download_genomes-886"><span class="linenos">886</span></a>        <span class="n">installed_genomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_genomes-887"><a href="#databases_download_genomes-887"><span class="linenos">887</span></a>
</span><span id="databases_download_genomes-888"><a href="#databases_download_genomes-888"><span class="linenos">888</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_genomes-889"><a href="#databases_download_genomes-889"><span class="linenos">889</span></a>        <span class="k">if</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">installed_genomes</span><span class="p">:</span>
</span><span id="databases_download_genomes-890"><a href="#databases_download_genomes-890"><span class="linenos">890</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Genomes </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - already exists&quot;</span><span class="p">)</span>
</span><span id="databases_download_genomes-891"><a href="#databases_download_genomes-891"><span class="linenos">891</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_genomes-892"><a href="#databases_download_genomes-892"><span class="linenos">892</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Genomes </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> downloading...&quot;</span><span class="p">)</span>
</span><span id="databases_download_genomes-893"><a href="#databases_download_genomes-893"><span class="linenos">893</span></a>            <span class="n">genomepy</span><span class="o">.</span><span class="n">install_genome</span><span class="p">(</span>
</span><span id="databases_download_genomes-894"><a href="#databases_download_genomes-894"><span class="linenos">894</span></a>                <span class="n">assembly</span><span class="p">,</span>
</span><span id="databases_download_genomes-895"><a href="#databases_download_genomes-895"><span class="linenos">895</span></a>                <span class="n">annotation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_genomes-896"><a href="#databases_download_genomes-896"><span class="linenos">896</span></a>                <span class="n">provider</span><span class="o">=</span><span class="n">provider</span><span class="p">,</span>
</span><span id="databases_download_genomes-897"><a href="#databases_download_genomes-897"><span class="linenos">897</span></a>                <span class="n">genomes_dir</span><span class="o">=</span><span class="n">genomes_folder</span><span class="p">,</span>
</span><span id="databases_download_genomes-898"><a href="#databases_download_genomes-898"><span class="linenos">898</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_genomes-899"><a href="#databases_download_genomes-899"><span class="linenos">899</span></a>                <span class="n">regex</span><span class="o">=</span><span class="n">contig_regex</span><span class="p">,</span>
</span><span id="databases_download_genomes-900"><a href="#databases_download_genomes-900"><span class="linenos">900</span></a>            <span class="p">)</span>
</span><span id="databases_download_genomes-901"><a href="#databases_download_genomes-901"><span class="linenos">901</span></a>
</span><span id="databases_download_genomes-902"><a href="#databases_download_genomes-902"><span class="linenos">902</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>This function downloads genome assemblies using genomepy package with options to specify genome
folder, provider, contig regex, and number of threads.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>assemblies</strong>:  a list of genome assembly names to download</li>
<li><strong>genomes_folder</strong>:  The folder where the downloaded genome files will be saved. If no folder is
specified, the default folder will be used</li>
<li><strong>provider</strong>:  The provider parameter specifies the source of the genome data. In this case, the
default provider is set to "UCSC", which refers to the University of California, Santa Cruz Genome
Browser. Other possible providers could include NCBI or Ensembl, defaults to UCSC</li>
<li><strong>contig_regex</strong>:  The contig_regex parameter is a regular expression used to filter the contigs
(chromosomes or scaffolds) to be downloaded for a given genome assembly. It allows users to download
only a subset of the available contigs, based on their names or other characteristics. If
contig_regex is not specified</li>
<li><strong>threads</strong>:  The "threads" parameter specifies the number of threads (parallel processes) to use
for downloading the genomes. This can speed up the process if the computer has multiple cores or
processors. The default value is 1, meaning that the download will be done using a single thread,
defaults to 1</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>None is being returned.</p>
</blockquote>
</div>


                </section>
                <section id="databases_download_refseq">
                            <input id="databases_download_refseq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_refseq</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">refseq_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">refseq_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">refseq_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ncbiRefSeq&#39;</span>,</span><span class="param">	<span class="n">refseq_files</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ncbiRefSeq.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;ncbiRefSeqLink.txt&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">refseq_format_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ncbiRefSeq.txt&#39;</span>,</span><span class="param">	<span class="n">refseq_format_file_output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">include_utr_5</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_utr_3</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_chrM</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_non_canonical_chr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_non_coding_transcripts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_transcript_ver</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="databases_download_refseq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_refseq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_refseq-905"><a href="#databases_download_refseq-905"><span class="linenos"> 905</span></a><span class="k">def</span> <span class="nf">databases_download_refseq</span><span class="p">(</span>
</span><span id="databases_download_refseq-906"><a href="#databases_download_refseq-906"><span class="linenos"> 906</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="databases_download_refseq-907"><a href="#databases_download_refseq-907"><span class="linenos"> 907</span></a>    <span class="n">refseq_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_refseq-908"><a href="#databases_download_refseq-908"><span class="linenos"> 908</span></a>    <span class="n">refseq_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_refseq-909"><a href="#databases_download_refseq-909"><span class="linenos"> 909</span></a>    <span class="n">refseq_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ncbiRefSeq&quot;</span><span class="p">,</span>
</span><span id="databases_download_refseq-910"><a href="#databases_download_refseq-910"><span class="linenos"> 910</span></a>    <span class="n">refseq_files</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ncbiRefSeq.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;ncbiRefSeqLink.txt&quot;</span><span class="p">],</span>
</span><span id="databases_download_refseq-911"><a href="#databases_download_refseq-911"><span class="linenos"> 911</span></a>    <span class="n">refseq_format_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ncbiRefSeq.txt&quot;</span><span class="p">,</span>
</span><span id="databases_download_refseq-912"><a href="#databases_download_refseq-912"><span class="linenos"> 912</span></a>    <span class="n">refseq_format_file_output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_refseq-913"><a href="#databases_download_refseq-913"><span class="linenos"> 913</span></a>    <span class="n">include_utr_5</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-914"><a href="#databases_download_refseq-914"><span class="linenos"> 914</span></a>    <span class="n">include_utr_3</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-915"><a href="#databases_download_refseq-915"><span class="linenos"> 915</span></a>    <span class="n">include_chrM</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-916"><a href="#databases_download_refseq-916"><span class="linenos"> 916</span></a>    <span class="n">include_non_canonical_chr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-917"><a href="#databases_download_refseq-917"><span class="linenos"> 917</span></a>    <span class="n">include_non_coding_transcripts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-918"><a href="#databases_download_refseq-918"><span class="linenos"> 918</span></a>    <span class="n">include_transcript_ver</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-919"><a href="#databases_download_refseq-919"><span class="linenos"> 919</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_refseq-920"><a href="#databases_download_refseq-920"><span class="linenos"> 920</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_refseq-921"><a href="#databases_download_refseq-921"><span class="linenos"> 921</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="databases_download_refseq-922"><a href="#databases_download_refseq-922"><span class="linenos"> 922</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_refseq-923"><a href="#databases_download_refseq-923"><span class="linenos"> 923</span></a><span class="sd">    The `databases_download_refseq` function downloads RefSeq files for a list of assemblies and returns</span>
</span><span id="databases_download_refseq-924"><a href="#databases_download_refseq-924"><span class="linenos"> 924</span></a><span class="sd">    a dictionary of installed RefSeq files for each assembly.</span>
</span><span id="databases_download_refseq-925"><a href="#databases_download_refseq-925"><span class="linenos"> 925</span></a>
</span><span id="databases_download_refseq-926"><a href="#databases_download_refseq-926"><span class="linenos"> 926</span></a><span class="sd">    :param assemblies: A list of assemblies for which the RefSeq files need to be downloaded. Each</span>
</span><span id="databases_download_refseq-927"><a href="#databases_download_refseq-927"><span class="linenos"> 927</span></a><span class="sd">    assembly is represented as a string</span>
</span><span id="databases_download_refseq-928"><a href="#databases_download_refseq-928"><span class="linenos"> 928</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_refseq-929"><a href="#databases_download_refseq-929"><span class="linenos"> 929</span></a><span class="sd">    :param refseq_folder: The `refseq_folder` parameter is a string that specifies the folder where the</span>
</span><span id="databases_download_refseq-930"><a href="#databases_download_refseq-930"><span class="linenos"> 930</span></a><span class="sd">    RefSeq files will be downloaded and stored. If this parameter is not provided, a default folder will</span>
</span><span id="databases_download_refseq-931"><a href="#databases_download_refseq-931"><span class="linenos"> 931</span></a><span class="sd">    be used</span>
</span><span id="databases_download_refseq-932"><a href="#databases_download_refseq-932"><span class="linenos"> 932</span></a><span class="sd">    :type refseq_folder: str</span>
</span><span id="databases_download_refseq-933"><a href="#databases_download_refseq-933"><span class="linenos"> 933</span></a><span class="sd">    :param refseq_url: The `refseq_url` parameter is a string that represents the URL where the RefSeq</span>
</span><span id="databases_download_refseq-934"><a href="#databases_download_refseq-934"><span class="linenos"> 934</span></a><span class="sd">    files can be downloaded from</span>
</span><span id="databases_download_refseq-935"><a href="#databases_download_refseq-935"><span class="linenos"> 935</span></a><span class="sd">    :type refseq_url: str</span>
</span><span id="databases_download_refseq-936"><a href="#databases_download_refseq-936"><span class="linenos"> 936</span></a><span class="sd">    :param refseq_prefix: The `refseq_prefix` parameter is a string that specifies the prefix for the</span>
</span><span id="databases_download_refseq-937"><a href="#databases_download_refseq-937"><span class="linenos"> 937</span></a><span class="sd">    downloaded RefSeq files. By default, it is set to &quot;ncbiRefSeq&quot;. This prefix is used to identify the</span>
</span><span id="databases_download_refseq-938"><a href="#databases_download_refseq-938"><span class="linenos"> 938</span></a><span class="sd">    RefSeq files for each assembly. For example, if the prefix is set to &quot;ncbi, defaults to ncbiRefSeq</span>
</span><span id="databases_download_refseq-939"><a href="#databases_download_refseq-939"><span class="linenos"> 939</span></a><span class="sd">    :type refseq_prefix: str (optional)</span>
</span><span id="databases_download_refseq-940"><a href="#databases_download_refseq-940"><span class="linenos"> 940</span></a><span class="sd">    :param refseq_files: The `refseq_files` parameter is a list of filenames that need to be downloaded</span>
</span><span id="databases_download_refseq-941"><a href="#databases_download_refseq-941"><span class="linenos"> 941</span></a><span class="sd">    for each assembly. The default value is `[&quot;ncbiRefSeq.txt&quot;, &quot;ncbiRefSeqLink.txt&quot;]`, but you can</span>
</span><span id="databases_download_refseq-942"><a href="#databases_download_refseq-942"><span class="linenos"> 942</span></a><span class="sd">    provide your own list of filenames if needed</span>
</span><span id="databases_download_refseq-943"><a href="#databases_download_refseq-943"><span class="linenos"> 943</span></a><span class="sd">    :type refseq_files: List</span>
</span><span id="databases_download_refseq-944"><a href="#databases_download_refseq-944"><span class="linenos"> 944</span></a><span class="sd">    :param refseq_format_file: The `refseq_format_file` parameter is a string that specifies the</span>
</span><span id="databases_download_refseq-945"><a href="#databases_download_refseq-945"><span class="linenos"> 945</span></a><span class="sd">    filename of the RefSeq file that needs to be formatted. This file will be used as input for the</span>
</span><span id="databases_download_refseq-946"><a href="#databases_download_refseq-946"><span class="linenos"> 946</span></a><span class="sd">    `databases_format_refseq` function. By default, the value is set to &quot;ncbiRefSeq.txt&quot;, defaults to</span>
</span><span id="databases_download_refseq-947"><a href="#databases_download_refseq-947"><span class="linenos"> 947</span></a><span class="sd">    ncbiRefSeq.txt</span>
</span><span id="databases_download_refseq-948"><a href="#databases_download_refseq-948"><span class="linenos"> 948</span></a><span class="sd">    :type refseq_format_file: str (optional)</span>
</span><span id="databases_download_refseq-949"><a href="#databases_download_refseq-949"><span class="linenos"> 949</span></a><span class="sd">    :param refseq_format_file_output: The `refseq_format_file_output` parameter is a string that</span>
</span><span id="databases_download_refseq-950"><a href="#databases_download_refseq-950"><span class="linenos"> 950</span></a><span class="sd">    specifies the output file path for the formatted RefSeq file. This file will be generated by the</span>
</span><span id="databases_download_refseq-951"><a href="#databases_download_refseq-951"><span class="linenos"> 951</span></a><span class="sd">    `databases_format_refseq` function and will contain the formatted RefSeq data. If this parameter is</span>
</span><span id="databases_download_refseq-952"><a href="#databases_download_refseq-952"><span class="linenos"> 952</span></a><span class="sd">    not provided, the formatted RefSeq</span>
</span><span id="databases_download_refseq-953"><a href="#databases_download_refseq-953"><span class="linenos"> 953</span></a><span class="sd">    :type refseq_format_file_output: str</span>
</span><span id="databases_download_refseq-954"><a href="#databases_download_refseq-954"><span class="linenos"> 954</span></a><span class="sd">    :param include_utr_5: A boolean parameter that specifies whether to include the 5&#39; untranslated</span>
</span><span id="databases_download_refseq-955"><a href="#databases_download_refseq-955"><span class="linenos"> 955</span></a><span class="sd">    region (UTR) in the downloaded RefSeq files. If set to True, the 5&#39; UTR will be included. If set to</span>
</span><span id="databases_download_refseq-956"><a href="#databases_download_refseq-956"><span class="linenos"> 956</span></a><span class="sd">    False, the 5&#39; UTR will be excluded, defaults to True</span>
</span><span id="databases_download_refseq-957"><a href="#databases_download_refseq-957"><span class="linenos"> 957</span></a><span class="sd">    :type include_utr_5: bool (optional)</span>
</span><span id="databases_download_refseq-958"><a href="#databases_download_refseq-958"><span class="linenos"> 958</span></a><span class="sd">    :param include_utr_3: The `include_utr_3` parameter is a boolean value that specifies whether to</span>
</span><span id="databases_download_refseq-959"><a href="#databases_download_refseq-959"><span class="linenos"> 959</span></a><span class="sd">    include the 3&#39; untranslated region (UTR) in the downloaded RefSeq files. If set to `True`, the 3&#39;</span>
</span><span id="databases_download_refseq-960"><a href="#databases_download_refseq-960"><span class="linenos"> 960</span></a><span class="sd">    UTR will be included. If set to `False`, the 3, defaults to True</span>
</span><span id="databases_download_refseq-961"><a href="#databases_download_refseq-961"><span class="linenos"> 961</span></a><span class="sd">    :type include_utr_3: bool (optional)</span>
</span><span id="databases_download_refseq-962"><a href="#databases_download_refseq-962"><span class="linenos"> 962</span></a><span class="sd">    :param include_chrM: The `include_chrM` parameter is a boolean value that determines whether to</span>
</span><span id="databases_download_refseq-963"><a href="#databases_download_refseq-963"><span class="linenos"> 963</span></a><span class="sd">    include the mitochondrial chromosome (chrM) in the downloaded RefSeq files. If set to True, the chrM</span>
</span><span id="databases_download_refseq-964"><a href="#databases_download_refseq-964"><span class="linenos"> 964</span></a><span class="sd">    will be included; if set to False, it will be excluded, defaults to True</span>
</span><span id="databases_download_refseq-965"><a href="#databases_download_refseq-965"><span class="linenos"> 965</span></a><span class="sd">    :type include_chrM: bool (optional)</span>
</span><span id="databases_download_refseq-966"><a href="#databases_download_refseq-966"><span class="linenos"> 966</span></a><span class="sd">    :param include_non_canonical_chr: The `include_non_canonical_chr` parameter is a boolean value that</span>
</span><span id="databases_download_refseq-967"><a href="#databases_download_refseq-967"><span class="linenos"> 967</span></a><span class="sd">    determines whether or not to include non-canonical chromosomes in the downloaded RefSeq files. If</span>
</span><span id="databases_download_refseq-968"><a href="#databases_download_refseq-968"><span class="linenos"> 968</span></a><span class="sd">    set to `True`, non-canonical chromosomes will be included. If set to `False`, non-canonical</span>
</span><span id="databases_download_refseq-969"><a href="#databases_download_refseq-969"><span class="linenos"> 969</span></a><span class="sd">    chromosomes will be excluded, defaults to True</span>
</span><span id="databases_download_refseq-970"><a href="#databases_download_refseq-970"><span class="linenos"> 970</span></a><span class="sd">    :type include_non_canonical_chr: bool (optional)</span>
</span><span id="databases_download_refseq-971"><a href="#databases_download_refseq-971"><span class="linenos"> 971</span></a><span class="sd">    :param include_non_coding_transcripts: The `include_non_coding_transcripts` parameter is a boolean</span>
</span><span id="databases_download_refseq-972"><a href="#databases_download_refseq-972"><span class="linenos"> 972</span></a><span class="sd">    flag that determines whether non-coding transcripts should be included in the downloaded RefSeq</span>
</span><span id="databases_download_refseq-973"><a href="#databases_download_refseq-973"><span class="linenos"> 973</span></a><span class="sd">    files. If set to `True`, non-coding transcripts will be included. If set to `False`, non-coding</span>
</span><span id="databases_download_refseq-974"><a href="#databases_download_refseq-974"><span class="linenos"> 974</span></a><span class="sd">    transcripts will be excluded, defaults to True</span>
</span><span id="databases_download_refseq-975"><a href="#databases_download_refseq-975"><span class="linenos"> 975</span></a><span class="sd">    :type include_non_coding_transcripts: bool (optional)</span>
</span><span id="databases_download_refseq-976"><a href="#databases_download_refseq-976"><span class="linenos"> 976</span></a><span class="sd">    :param include_transcript_ver: The `include_transcript_ver` parameter is a boolean value that</span>
</span><span id="databases_download_refseq-977"><a href="#databases_download_refseq-977"><span class="linenos"> 977</span></a><span class="sd">    determines whether to include the transcript version in the downloaded RefSeq files. If set to</span>
</span><span id="databases_download_refseq-978"><a href="#databases_download_refseq-978"><span class="linenos"> 978</span></a><span class="sd">    `True`, the transcript version will be included. If set to `False`, the transcript version will be</span>
</span><span id="databases_download_refseq-979"><a href="#databases_download_refseq-979"><span class="linenos"> 979</span></a><span class="sd">    excluded, defaults to True</span>
</span><span id="databases_download_refseq-980"><a href="#databases_download_refseq-980"><span class="linenos"> 980</span></a><span class="sd">    :type include_transcript_ver: bool (optional)</span>
</span><span id="databases_download_refseq-981"><a href="#databases_download_refseq-981"><span class="linenos"> 981</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for downloading and</span>
</span><span id="databases_download_refseq-982"><a href="#databases_download_refseq-982"><span class="linenos"> 982</span></a><span class="sd">    extracting the RefSeq files. It determines the level of parallelism in the download and extraction</span>
</span><span id="databases_download_refseq-983"><a href="#databases_download_refseq-983"><span class="linenos"> 983</span></a><span class="sd">    process. By default, it is set to 1, which means that the download and extraction will be performed</span>
</span><span id="databases_download_refseq-984"><a href="#databases_download_refseq-984"><span class="linenos"> 984</span></a><span class="sd">    sequentially. If you want, defaults to 1</span>
</span><span id="databases_download_refseq-985"><a href="#databases_download_refseq-985"><span class="linenos"> 985</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="databases_download_refseq-986"><a href="#databases_download_refseq-986"><span class="linenos"> 986</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of max memory (in Gb) to use for sorting.</span>
</span><span id="databases_download_refseq-987"><a href="#databases_download_refseq-987"><span class="linenos"> 987</span></a><span class="sd">    defaults to 1</span>
</span><span id="databases_download_refseq-988"><a href="#databases_download_refseq-988"><span class="linenos"> 988</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="databases_download_refseq-989"><a href="#databases_download_refseq-989"><span class="linenos"> 989</span></a><span class="sd">    :return: The function `databases_download_refseq` returns a dictionary `installed_refseq` which</span>
</span><span id="databases_download_refseq-990"><a href="#databases_download_refseq-990"><span class="linenos"> 990</span></a><span class="sd">    contains information about the downloaded RefSeq files for each assembly. The keys of the dictionary</span>
</span><span id="databases_download_refseq-991"><a href="#databases_download_refseq-991"><span class="linenos"> 991</span></a><span class="sd">    are the assembly names, and the values are lists of the installed RefSeq files for each assembly.</span>
</span><span id="databases_download_refseq-992"><a href="#databases_download_refseq-992"><span class="linenos"> 992</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_refseq-993"><a href="#databases_download_refseq-993"><span class="linenos"> 993</span></a>
</span><span id="databases_download_refseq-994"><a href="#databases_download_refseq-994"><span class="linenos"> 994</span></a>    <span class="c1"># Log</span>
</span><span id="databases_download_refseq-995"><a href="#databases_download_refseq-995"><span class="linenos"> 995</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_refseq-996"><a href="#databases_download_refseq-996"><span class="linenos"> 996</span></a>
</span><span id="databases_download_refseq-997"><a href="#databases_download_refseq-997"><span class="linenos"> 997</span></a>    <span class="c1"># Default refSeq Folder</span>
</span><span id="databases_download_refseq-998"><a href="#databases_download_refseq-998"><span class="linenos"> 998</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">refseq_folder</span><span class="p">:</span>
</span><span id="databases_download_refseq-999"><a href="#databases_download_refseq-999"><span class="linenos"> 999</span></a>        <span class="n">refseq_folder</span> <span class="o">=</span> <span class="n">DEFAULT_REFSEQ_FOLDER</span>
</span><span id="databases_download_refseq-1000"><a href="#databases_download_refseq-1000"><span class="linenos">1000</span></a>
</span><span id="databases_download_refseq-1001"><a href="#databases_download_refseq-1001"><span class="linenos">1001</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_refseq-1002"><a href="#databases_download_refseq-1002"><span class="linenos">1002</span></a>    <span class="n">refseq_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">)</span>
</span><span id="databases_download_refseq-1003"><a href="#databases_download_refseq-1003"><span class="linenos">1003</span></a>
</span><span id="databases_download_refseq-1004"><a href="#databases_download_refseq-1004"><span class="linenos">1004</span></a>    <span class="c1"># Default refSeq URL</span>
</span><span id="databases_download_refseq-1005"><a href="#databases_download_refseq-1005"><span class="linenos">1005</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">refseq_url</span><span class="p">:</span>
</span><span id="databases_download_refseq-1006"><a href="#databases_download_refseq-1006"><span class="linenos">1006</span></a>        <span class="n">refseq_url</span> <span class="o">=</span> <span class="n">DEFAULT_REFSEQ_URL</span>
</span><span id="databases_download_refseq-1007"><a href="#databases_download_refseq-1007"><span class="linenos">1007</span></a>
</span><span id="databases_download_refseq-1008"><a href="#databases_download_refseq-1008"><span class="linenos">1008</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_refseq-1009"><a href="#databases_download_refseq-1009"><span class="linenos">1009</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">):</span>
</span><span id="databases_download_refseq-1010"><a href="#databases_download_refseq-1010"><span class="linenos">1010</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">)</span>
</span><span id="databases_download_refseq-1011"><a href="#databases_download_refseq-1011"><span class="linenos">1011</span></a>
</span><span id="databases_download_refseq-1012"><a href="#databases_download_refseq-1012"><span class="linenos">1012</span></a>    <span class="c1"># Installed refSeq files</span>
</span><span id="databases_download_refseq-1013"><a href="#databases_download_refseq-1013"><span class="linenos">1013</span></a>    <span class="n">installed_refseq</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_refseq-1014"><a href="#databases_download_refseq-1014"><span class="linenos">1014</span></a>
</span><span id="databases_download_refseq-1015"><a href="#databases_download_refseq-1015"><span class="linenos">1015</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_refseq-1016"><a href="#databases_download_refseq-1016"><span class="linenos">1016</span></a>
</span><span id="databases_download_refseq-1017"><a href="#databases_download_refseq-1017"><span class="linenos">1017</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_refseq-1018"><a href="#databases_download_refseq-1018"><span class="linenos">1018</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="databases_download_refseq-1019"><a href="#databases_download_refseq-1019"><span class="linenos">1019</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_refseq-1020"><a href="#databases_download_refseq-1020"><span class="linenos">1020</span></a>
</span><span id="databases_download_refseq-1021"><a href="#databases_download_refseq-1021"><span class="linenos">1021</span></a>        <span class="c1"># Strat download needed files</span>
</span><span id="databases_download_refseq-1022"><a href="#databases_download_refseq-1022"><span class="linenos">1022</span></a>        <span class="n">installed_refseq</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_refseq-1023"><a href="#databases_download_refseq-1023"><span class="linenos">1023</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">refseq_folder</span><span class="p">):</span>
</span><span id="databases_download_refseq-1024"><a href="#databases_download_refseq-1024"><span class="linenos">1024</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="databases_download_refseq-1025"><a href="#databases_download_refseq-1025"><span class="linenos">1025</span></a>            <span class="n">existing_files_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_refseq-1026"><a href="#databases_download_refseq-1026"><span class="linenos">1026</span></a>            <span class="n">existing_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
</span><span id="databases_download_refseq-1027"><a href="#databases_download_refseq-1027"><span class="linenos">1027</span></a>                <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_files_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_prefix</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span>
</span><span id="databases_download_refseq-1028"><a href="#databases_download_refseq-1028"><span class="linenos">1028</span></a>            <span class="p">)</span>
</span><span id="databases_download_refseq-1029"><a href="#databases_download_refseq-1029"><span class="linenos">1029</span></a>            <span class="c1"># For refSeq files to download</span>
</span><span id="databases_download_refseq-1030"><a href="#databases_download_refseq-1030"><span class="linenos">1030</span></a>            <span class="k">for</span> <span class="n">refseq_file</span> <span class="ow">in</span> <span class="n">refseq_files</span><span class="p">:</span>
</span><span id="databases_download_refseq-1031"><a href="#databases_download_refseq-1031"><span class="linenos">1031</span></a>                <span class="n">new_refseq_file</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_refseq-1032"><a href="#databases_download_refseq-1032"><span class="linenos">1032</span></a>                <span class="c1"># If refSeq file exists</span>
</span><span id="databases_download_refseq-1033"><a href="#databases_download_refseq-1033"><span class="linenos">1033</span></a>                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_files_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">existing_files</span><span class="p">:</span>
</span><span id="databases_download_refseq-1034"><a href="#databases_download_refseq-1034"><span class="linenos">1034</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_refseq-1035"><a href="#databases_download_refseq-1035"><span class="linenos">1035</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_refseq-1036"><a href="#databases_download_refseq-1036"><span class="linenos">1036</span></a>                    <span class="p">)</span>
</span><span id="databases_download_refseq-1037"><a href="#databases_download_refseq-1037"><span class="linenos">1037</span></a>                    <span class="n">installed_refseq</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refseq_file</span><span class="p">)</span>
</span><span id="databases_download_refseq-1038"><a href="#databases_download_refseq-1038"><span class="linenos">1038</span></a>                <span class="c1"># If refSeq file need to be downloaded</span>
</span><span id="databases_download_refseq-1039"><a href="#databases_download_refseq-1039"><span class="linenos">1039</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_refseq-1040"><a href="#databases_download_refseq-1040"><span class="linenos">1040</span></a>                    <span class="c1"># files to download</span>
</span><span id="databases_download_refseq-1041"><a href="#databases_download_refseq-1041"><span class="linenos">1041</span></a>                    <span class="n">file_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/database/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="databases_download_refseq-1042"><a href="#databases_download_refseq-1042"><span class="linenos">1042</span></a>                    <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="databases_download_refseq-1043"><a href="#databases_download_refseq-1043"><span class="linenos">1043</span></a>                    <span class="c1"># try to download</span>
</span><span id="databases_download_refseq-1044"><a href="#databases_download_refseq-1044"><span class="linenos">1044</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="databases_download_refseq-1045"><a href="#databases_download_refseq-1045"><span class="linenos">1045</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_refseq-1046"><a href="#databases_download_refseq-1046"><span class="linenos">1046</span></a>                            <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; downloading...&quot;</span>
</span><span id="databases_download_refseq-1047"><a href="#databases_download_refseq-1047"><span class="linenos">1047</span></a>                        <span class="p">)</span>
</span><span id="databases_download_refseq-1048"><a href="#databases_download_refseq-1048"><span class="linenos">1048</span></a>                        <span class="c1"># Download file</span>
</span><span id="databases_download_refseq-1049"><a href="#databases_download_refseq-1049"><span class="linenos">1049</span></a>                        <span class="n">download_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_refseq-1050"><a href="#databases_download_refseq-1050"><span class="linenos">1050</span></a>                        <span class="c1"># Extract file</span>
</span><span id="databases_download_refseq-1051"><a href="#databases_download_refseq-1051"><span class="linenos">1051</span></a>                        <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_refseq-1052"><a href="#databases_download_refseq-1052"><span class="linenos">1052</span></a>                        <span class="c1"># add to installed files</span>
</span><span id="databases_download_refseq-1053"><a href="#databases_download_refseq-1053"><span class="linenos">1053</span></a>                        <span class="n">installed_refseq</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refseq_file</span><span class="p">)</span>
</span><span id="databases_download_refseq-1054"><a href="#databases_download_refseq-1054"><span class="linenos">1054</span></a>                        <span class="n">new_refseq_file</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_refseq-1055"><a href="#databases_download_refseq-1055"><span class="linenos">1055</span></a>                    <span class="c1"># If fail, just pass to next url</span>
</span><span id="databases_download_refseq-1056"><a href="#databases_download_refseq-1056"><span class="linenos">1056</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="databases_download_refseq-1057"><a href="#databases_download_refseq-1057"><span class="linenos">1057</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_refseq-1058"><a href="#databases_download_refseq-1058"><span class="linenos">1058</span></a>                            <span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39; - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; downloading failed&quot;</span>
</span><span id="databases_download_refseq-1059"><a href="#databases_download_refseq-1059"><span class="linenos">1059</span></a>                        <span class="p">)</span>
</span><span id="databases_download_refseq-1060"><a href="#databases_download_refseq-1060"><span class="linenos">1060</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_refseq-1061"><a href="#databases_download_refseq-1061"><span class="linenos">1061</span></a>                            <span class="sa">f</span><span class="s2">&quot;Download refSeq databases </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39; - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; downloading failed&quot;</span>
</span><span id="databases_download_refseq-1062"><a href="#databases_download_refseq-1062"><span class="linenos">1062</span></a>                        <span class="p">)</span>
</span><span id="databases_download_refseq-1063"><a href="#databases_download_refseq-1063"><span class="linenos">1063</span></a>                <span class="c1"># format refSeq</span>
</span><span id="databases_download_refseq-1064"><a href="#databases_download_refseq-1064"><span class="linenos">1064</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_refseq-1065"><a href="#databases_download_refseq-1065"><span class="linenos">1065</span></a>                <span class="k">if</span> <span class="n">refseq_format_file_output</span><span class="p">:</span>
</span><span id="databases_download_refseq-1066"><a href="#databases_download_refseq-1066"><span class="linenos">1066</span></a>                    <span class="n">file_path_bed</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refseq_format_file_output</span><span class="si">}</span><span class="s2">.uncompress.txt&quot;</span>
</span><span id="databases_download_refseq-1067"><a href="#databases_download_refseq-1067"><span class="linenos">1067</span></a>                    <span class="n">file_path_bed_compressed</span> <span class="o">=</span> <span class="n">refseq_format_file_output</span>
</span><span id="databases_download_refseq-1068"><a href="#databases_download_refseq-1068"><span class="linenos">1068</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_refseq-1069"><a href="#databases_download_refseq-1069"><span class="linenos">1069</span></a>                    <span class="n">file_path_bed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;txt$&quot;</span><span class="p">,</span> <span class="s2">&quot;bed&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</span><span id="databases_download_refseq-1070"><a href="#databases_download_refseq-1070"><span class="linenos">1070</span></a>                    <span class="n">file_path_bed_compressed</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path_bed</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="databases_download_refseq-1071"><a href="#databases_download_refseq-1071"><span class="linenos">1071</span></a>                <span class="n">file_path_bed_hdr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path_bed</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_refseq-1072"><a href="#databases_download_refseq-1072"><span class="linenos">1072</span></a>                <span class="n">file_path_bed_compressed_hdr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path_bed_compressed</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_refseq-1073"><a href="#databases_download_refseq-1073"><span class="linenos">1073</span></a>                <span class="n">file_path_bed_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path_bed</span><span class="p">)</span>
</span><span id="databases_download_refseq-1074"><a href="#databases_download_refseq-1074"><span class="linenos">1074</span></a>                <span class="n">file_path_bed_compressed_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
</span><span id="databases_download_refseq-1075"><a href="#databases_download_refseq-1075"><span class="linenos">1075</span></a>                    <span class="n">file_path_bed_compressed</span>
</span><span id="databases_download_refseq-1076"><a href="#databases_download_refseq-1076"><span class="linenos">1076</span></a>                <span class="p">)</span>
</span><span id="databases_download_refseq-1077"><a href="#databases_download_refseq-1077"><span class="linenos">1077</span></a>                <span class="k">if</span> <span class="n">refseq_file</span> <span class="o">==</span> <span class="n">refseq_format_file</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="databases_download_refseq-1078"><a href="#databases_download_refseq-1078"><span class="linenos">1078</span></a>                    <span class="n">new_refseq_file</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path_bed</span><span class="p">)</span>
</span><span id="databases_download_refseq-1079"><a href="#databases_download_refseq-1079"><span class="linenos">1079</span></a>                <span class="p">):</span>
</span><span id="databases_download_refseq-1080"><a href="#databases_download_refseq-1080"><span class="linenos">1080</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_refseq-1081"><a href="#databases_download_refseq-1081"><span class="linenos">1081</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">refseq_file</span><span class="si">}</span><span class="s2">&#39; formatting to &#39;</span><span class="si">{</span><span class="n">file_path_bed_basename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_refseq-1082"><a href="#databases_download_refseq-1082"><span class="linenos">1082</span></a>                    <span class="p">)</span>
</span><span id="databases_download_refseq-1083"><a href="#databases_download_refseq-1083"><span class="linenos">1083</span></a>                    <span class="c1"># Format refSeq in BED format</span>
</span><span id="databases_download_refseq-1084"><a href="#databases_download_refseq-1084"><span class="linenos">1084</span></a>                    <span class="n">databases_format_refseq</span><span class="p">(</span>
</span><span id="databases_download_refseq-1085"><a href="#databases_download_refseq-1085"><span class="linenos">1085</span></a>                        <span class="n">refseq_file</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
</span><span id="databases_download_refseq-1086"><a href="#databases_download_refseq-1086"><span class="linenos">1086</span></a>                        <span class="n">output_file</span><span class="o">=</span><span class="n">file_path_bed</span><span class="p">,</span>
</span><span id="databases_download_refseq-1087"><a href="#databases_download_refseq-1087"><span class="linenos">1087</span></a>                        <span class="n">include_utr_5</span><span class="o">=</span><span class="n">include_utr_5</span><span class="p">,</span>
</span><span id="databases_download_refseq-1088"><a href="#databases_download_refseq-1088"><span class="linenos">1088</span></a>                        <span class="n">include_utr_3</span><span class="o">=</span><span class="n">include_utr_3</span><span class="p">,</span>
</span><span id="databases_download_refseq-1089"><a href="#databases_download_refseq-1089"><span class="linenos">1089</span></a>                        <span class="n">include_chrM</span><span class="o">=</span><span class="n">include_chrM</span><span class="p">,</span>
</span><span id="databases_download_refseq-1090"><a href="#databases_download_refseq-1090"><span class="linenos">1090</span></a>                        <span class="n">include_non_canonical_chr</span><span class="o">=</span><span class="n">include_non_canonical_chr</span><span class="p">,</span>
</span><span id="databases_download_refseq-1091"><a href="#databases_download_refseq-1091"><span class="linenos">1091</span></a>                        <span class="n">include_non_coding_transcripts</span><span class="o">=</span><span class="n">include_non_coding_transcripts</span><span class="p">,</span>
</span><span id="databases_download_refseq-1092"><a href="#databases_download_refseq-1092"><span class="linenos">1092</span></a>                        <span class="n">include_transcript_ver</span><span class="o">=</span><span class="n">include_transcript_ver</span><span class="p">,</span>
</span><span id="databases_download_refseq-1093"><a href="#databases_download_refseq-1093"><span class="linenos">1093</span></a>                        <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-1094"><a href="#databases_download_refseq-1094"><span class="linenos">1094</span></a>                        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-1095"><a href="#databases_download_refseq-1095"><span class="linenos">1095</span></a>                        <span class="n">header_first_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_refseq-1096"><a href="#databases_download_refseq-1096"><span class="linenos">1096</span></a>                    <span class="p">)</span>
</span><span id="databases_download_refseq-1097"><a href="#databases_download_refseq-1097"><span class="linenos">1097</span></a>                    <span class="c1"># compress file</span>
</span><span id="databases_download_refseq-1098"><a href="#databases_download_refseq-1098"><span class="linenos">1098</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_refseq-1099"><a href="#databases_download_refseq-1099"><span class="linenos">1099</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download refSeq databases [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - &#39;</span><span class="si">{</span><span class="n">file_path_bed_basename</span><span class="si">}</span><span class="s2">&#39; compressing to &#39;</span><span class="si">{</span><span class="n">file_path_bed_compressed_basename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_refseq-1100"><a href="#databases_download_refseq-1100"><span class="linenos">1100</span></a>                    <span class="p">)</span>
</span><span id="databases_download_refseq-1101"><a href="#databases_download_refseq-1101"><span class="linenos">1101</span></a>                    <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="databases_download_refseq-1102"><a href="#databases_download_refseq-1102"><span class="linenos">1102</span></a>                        <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">file_path_bed</span><span class="p">],</span>
</span><span id="databases_download_refseq-1103"><a href="#databases_download_refseq-1103"><span class="linenos">1103</span></a>                        <span class="n">output_file</span><span class="o">=</span><span class="n">file_path_bed_compressed</span><span class="p">,</span>
</span><span id="databases_download_refseq-1104"><a href="#databases_download_refseq-1104"><span class="linenos">1104</span></a>                        <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_refseq-1105"><a href="#databases_download_refseq-1105"><span class="linenos">1105</span></a>                        <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="databases_download_refseq-1106"><a href="#databases_download_refseq-1106"><span class="linenos">1106</span></a>                        <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;bgzip&quot;</span><span class="p">,</span>
</span><span id="databases_download_refseq-1107"><a href="#databases_download_refseq-1107"><span class="linenos">1107</span></a>                        <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_refseq-1108"><a href="#databases_download_refseq-1108"><span class="linenos">1108</span></a>                        <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_refseq-1109"><a href="#databases_download_refseq-1109"><span class="linenos">1109</span></a>                    <span class="p">)</span>
</span><span id="databases_download_refseq-1110"><a href="#databases_download_refseq-1110"><span class="linenos">1110</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path_bed_hdr</span><span class="p">,</span> <span class="n">file_path_bed_compressed_hdr</span><span class="p">)</span>
</span><span id="databases_download_refseq-1111"><a href="#databases_download_refseq-1111"><span class="linenos">1111</span></a>
</span><span id="databases_download_refseq-1112"><a href="#databases_download_refseq-1112"><span class="linenos">1112</span></a>    <span class="c1"># Log</span>
</span><span id="databases_download_refseq-1113"><a href="#databases_download_refseq-1113"><span class="linenos">1113</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;installed_refseq: </span><span class="si">{</span><span class="n">installed_refseq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_refseq-1114"><a href="#databases_download_refseq-1114"><span class="linenos">1114</span></a>
</span><span id="databases_download_refseq-1115"><a href="#databases_download_refseq-1115"><span class="linenos">1115</span></a>    <span class="k">return</span> <span class="n">installed_refseq</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_download_refseq">databases_download_refseq</a></code> function downloads RefSeq files for a list of assemblies and returns
a dictionary of installed RefSeq files for each assembly.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>assemblies</strong>:  A list of assemblies for which the RefSeq files need to be downloaded. Each
assembly is represented as a string</li>
<li><strong>refseq_folder</strong>:  The <code>refseq_folder</code> parameter is a string that specifies the folder where the
RefSeq files will be downloaded and stored. If this parameter is not provided, a default folder will
be used</li>
<li><strong>refseq_url</strong>:  The <code>refseq_url</code> parameter is a string that represents the URL where the RefSeq
files can be downloaded from</li>
<li><strong>refseq_prefix</strong>:  The <code>refseq_prefix</code> parameter is a string that specifies the prefix for the
downloaded RefSeq files. By default, it is set to "ncbiRefSeq". This prefix is used to identify the
RefSeq files for each assembly. For example, if the prefix is set to "ncbi, defaults to ncbiRefSeq</li>
<li><strong>refseq_files</strong>:  The <code>refseq_files</code> parameter is a list of filenames that need to be downloaded
for each assembly. The default value is <code>["ncbiRefSeq.txt", "ncbiRefSeqLink.txt"]</code>, but you can
provide your own list of filenames if needed</li>
<li><strong>refseq_format_file</strong>:  The <code>refseq_format_file</code> parameter is a string that specifies the
filename of the RefSeq file that needs to be formatted. This file will be used as input for the
<code><a href="#databases_format_refseq">databases_format_refseq</a></code> function. By default, the value is set to "ncbiRefSeq.txt", defaults to
ncbiRefSeq.txt</li>
<li><strong>refseq_format_file_output</strong>:  The <code>refseq_format_file_output</code> parameter is a string that
specifies the output file path for the formatted RefSeq file. This file will be generated by the
<code><a href="#databases_format_refseq">databases_format_refseq</a></code> function and will contain the formatted RefSeq data. If this parameter is
not provided, the formatted RefSeq</li>
<li><strong>include_utr_5</strong>:  A boolean parameter that specifies whether to include the 5' untranslated
region (UTR) in the downloaded RefSeq files. If set to True, the 5' UTR will be included. If set to
False, the 5' UTR will be excluded, defaults to True</li>
<li><strong>include_utr_3</strong>:  The <code>include_utr_3</code> parameter is a boolean value that specifies whether to
include the 3' untranslated region (UTR) in the downloaded RefSeq files. If set to <code>True</code>, the 3'
UTR will be included. If set to <code>False</code>, the 3, defaults to True</li>
<li><strong>include_chrM</strong>:  The <code>include_chrM</code> parameter is a boolean value that determines whether to
include the mitochondrial chromosome (chrM) in the downloaded RefSeq files. If set to True, the chrM
will be included; if set to False, it will be excluded, defaults to True</li>
<li><strong>include_non_canonical_chr</strong>:  The <code>include_non_canonical_chr</code> parameter is a boolean value that
determines whether or not to include non-canonical chromosomes in the downloaded RefSeq files. If
set to <code>True</code>, non-canonical chromosomes will be included. If set to <code>False</code>, non-canonical
chromosomes will be excluded, defaults to True</li>
<li><strong>include_non_coding_transcripts</strong>:  The <code>include_non_coding_transcripts</code> parameter is a boolean
flag that determines whether non-coding transcripts should be included in the downloaded RefSeq
files. If set to <code>True</code>, non-coding transcripts will be included. If set to <code>False</code>, non-coding
transcripts will be excluded, defaults to True</li>
<li><strong>include_transcript_ver</strong>:  The <code>include_transcript_ver</code> parameter is a boolean value that
determines whether to include the transcript version in the downloaded RefSeq files. If set to
<code>True</code>, the transcript version will be included. If set to <code>False</code>, the transcript version will be
excluded, defaults to True</li>
<li><strong>threads</strong>:  The <code>threads</code> parameter specifies the number of threads to use for downloading and
extracting the RefSeq files. It determines the level of parallelism in the download and extraction
process. By default, it is set to 1, which means that the download and extraction will be performed
sequentially. If you want, defaults to 1</li>
<li><strong>memory</strong>:  The <code>memory</code> parameter specifies the amount of max memory (in Gb) to use for sorting.
defaults to 1</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The function <code><a href="#databases_download_refseq">databases_download_refseq</a></code> returns a dictionary <code>installed_refseq</code> which
  contains information about the downloaded RefSeq files for each assembly. The keys of the dictionary
  are the assembly names, and the values are lists of the installed RefSeq files for each assembly.</p>
</blockquote>
</div>


                </section>
                <section id="databases_format_refseq">
                            <input id="databases_format_refseq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_format_refseq</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">refseq_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">include_utr_5</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_utr_3</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_chrM</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_non_canonical_chr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_non_coding_transcripts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_transcript_ver</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">sort</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">header_first_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="databases_format_refseq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_format_refseq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_format_refseq-1118"><a href="#databases_format_refseq-1118"><span class="linenos">1118</span></a><span class="k">def</span> <span class="nf">databases_format_refseq</span><span class="p">(</span>
</span><span id="databases_format_refseq-1119"><a href="#databases_format_refseq-1119"><span class="linenos">1119</span></a>    <span class="n">refseq_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="databases_format_refseq-1120"><a href="#databases_format_refseq-1120"><span class="linenos">1120</span></a>    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="databases_format_refseq-1121"><a href="#databases_format_refseq-1121"><span class="linenos">1121</span></a>    <span class="n">include_utr_5</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_format_refseq-1122"><a href="#databases_format_refseq-1122"><span class="linenos">1122</span></a>    <span class="n">include_utr_3</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_format_refseq-1123"><a href="#databases_format_refseq-1123"><span class="linenos">1123</span></a>    <span class="n">include_chrM</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_format_refseq-1124"><a href="#databases_format_refseq-1124"><span class="linenos">1124</span></a>    <span class="n">include_non_canonical_chr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_format_refseq-1125"><a href="#databases_format_refseq-1125"><span class="linenos">1125</span></a>    <span class="n">include_non_coding_transcripts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_format_refseq-1126"><a href="#databases_format_refseq-1126"><span class="linenos">1126</span></a>    <span class="n">include_transcript_ver</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_format_refseq-1127"><a href="#databases_format_refseq-1127"><span class="linenos">1127</span></a>    <span class="n">sort</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_format_refseq-1128"><a href="#databases_format_refseq-1128"><span class="linenos">1128</span></a>    <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_format_refseq-1129"><a href="#databases_format_refseq-1129"><span class="linenos">1129</span></a>    <span class="n">header_first_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_format_refseq-1130"><a href="#databases_format_refseq-1130"><span class="linenos">1130</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="databases_format_refseq-1131"><a href="#databases_format_refseq-1131"><span class="linenos">1131</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_format_refseq-1132"><a href="#databases_format_refseq-1132"><span class="linenos">1132</span></a><span class="sd">    The `databases_format_refseq` function takes a RefSeq file as input, formats it according to</span>
</span><span id="databases_format_refseq-1133"><a href="#databases_format_refseq-1133"><span class="linenos">1133</span></a><span class="sd">    specified criteria, and outputs the formatted file.</span>
</span><span id="databases_format_refseq-1134"><a href="#databases_format_refseq-1134"><span class="linenos">1134</span></a>
</span><span id="databases_format_refseq-1135"><a href="#databases_format_refseq-1135"><span class="linenos">1135</span></a><span class="sd">    :param refseq_file: The `refseq_file` parameter is a string that represents the path to the input</span>
</span><span id="databases_format_refseq-1136"><a href="#databases_format_refseq-1136"><span class="linenos">1136</span></a><span class="sd">    RefSeq file. This file contains information about gene annotations, including chromosome, start and</span>
</span><span id="databases_format_refseq-1137"><a href="#databases_format_refseq-1137"><span class="linenos">1137</span></a><span class="sd">    end positions, strand, and other details</span>
</span><span id="databases_format_refseq-1138"><a href="#databases_format_refseq-1138"><span class="linenos">1138</span></a><span class="sd">    :type refseq_file: str</span>
</span><span id="databases_format_refseq-1139"><a href="#databases_format_refseq-1139"><span class="linenos">1139</span></a><span class="sd">    :param output_file: The `output_file` parameter is a string that represents the name of the file</span>
</span><span id="databases_format_refseq-1140"><a href="#databases_format_refseq-1140"><span class="linenos">1140</span></a><span class="sd">    where the formatted data will be written</span>
</span><span id="databases_format_refseq-1141"><a href="#databases_format_refseq-1141"><span class="linenos">1141</span></a><span class="sd">    :type output_file: str</span>
</span><span id="databases_format_refseq-1142"><a href="#databases_format_refseq-1142"><span class="linenos">1142</span></a><span class="sd">    :param include_utr_5: The `include_utr_5` parameter is a boolean that determines whether to include</span>
</span><span id="databases_format_refseq-1143"><a href="#databases_format_refseq-1143"><span class="linenos">1143</span></a><span class="sd">    the 5&#39; UTR (untranslated region) in the output file. If set to `True`, the 5&#39; UTR will be included.</span>
</span><span id="databases_format_refseq-1144"><a href="#databases_format_refseq-1144"><span class="linenos">1144</span></a><span class="sd">    If set to `False`, the 5&#39; U, defaults to True</span>
</span><span id="databases_format_refseq-1145"><a href="#databases_format_refseq-1145"><span class="linenos">1145</span></a><span class="sd">    :type include_utr_5: bool (optional)</span>
</span><span id="databases_format_refseq-1146"><a href="#databases_format_refseq-1146"><span class="linenos">1146</span></a><span class="sd">    :param include_utr_3: A boolean parameter that determines whether to include the 3&#39; UTR</span>
</span><span id="databases_format_refseq-1147"><a href="#databases_format_refseq-1147"><span class="linenos">1147</span></a><span class="sd">    (untranslated region) in the output. If set to True, the 3&#39; UTR will be included. If set to False,</span>
</span><span id="databases_format_refseq-1148"><a href="#databases_format_refseq-1148"><span class="linenos">1148</span></a><span class="sd">    the 3&#39; UTR will be excluded, defaults to True</span>
</span><span id="databases_format_refseq-1149"><a href="#databases_format_refseq-1149"><span class="linenos">1149</span></a><span class="sd">    :type include_utr_3: bool (optional)</span>
</span><span id="databases_format_refseq-1150"><a href="#databases_format_refseq-1150"><span class="linenos">1150</span></a><span class="sd">    :param include_chrM: The `include_chrM` parameter is a boolean that determines whether to include</span>
</span><span id="databases_format_refseq-1151"><a href="#databases_format_refseq-1151"><span class="linenos">1151</span></a><span class="sd">    transcripts from the mitochondrial chromosome (chrM or chrMT) in the output file. If set to True,</span>
</span><span id="databases_format_refseq-1152"><a href="#databases_format_refseq-1152"><span class="linenos">1152</span></a><span class="sd">    transcripts from the mitochondrial chromosome will be included. If set to False, transcripts from</span>
</span><span id="databases_format_refseq-1153"><a href="#databases_format_refseq-1153"><span class="linenos">1153</span></a><span class="sd">    the mitochondrial chromosome will be excluded, defaults to True</span>
</span><span id="databases_format_refseq-1154"><a href="#databases_format_refseq-1154"><span class="linenos">1154</span></a><span class="sd">    :type include_chrM: bool (optional)</span>
</span><span id="databases_format_refseq-1155"><a href="#databases_format_refseq-1155"><span class="linenos">1155</span></a><span class="sd">    :param include_non_canonical_chr: The parameter `include_non_canonical_chr` determines whether or</span>
</span><span id="databases_format_refseq-1156"><a href="#databases_format_refseq-1156"><span class="linenos">1156</span></a><span class="sd">    not to include non-canonical chromosomes in the output. If set to `True`, non-canonical chromosomes</span>
</span><span id="databases_format_refseq-1157"><a href="#databases_format_refseq-1157"><span class="linenos">1157</span></a><span class="sd">    will be included. If set to `False`, non-canonical chromosomes will be excluded, defaults to True</span>
</span><span id="databases_format_refseq-1158"><a href="#databases_format_refseq-1158"><span class="linenos">1158</span></a><span class="sd">    :type include_non_canonical_chr: bool (optional)</span>
</span><span id="databases_format_refseq-1159"><a href="#databases_format_refseq-1159"><span class="linenos">1159</span></a><span class="sd">    :param include_non_coding_transcripts: The parameter `include_non_coding_transcripts` determines</span>
</span><span id="databases_format_refseq-1160"><a href="#databases_format_refseq-1160"><span class="linenos">1160</span></a><span class="sd">    whether non-coding transcripts should be included in the output file. If set to `True`, non-coding</span>
</span><span id="databases_format_refseq-1161"><a href="#databases_format_refseq-1161"><span class="linenos">1161</span></a><span class="sd">    transcripts will be included. If set to `False`, non-coding transcripts will be excluded, defaults</span>
</span><span id="databases_format_refseq-1162"><a href="#databases_format_refseq-1162"><span class="linenos">1162</span></a><span class="sd">    to True</span>
</span><span id="databases_format_refseq-1163"><a href="#databases_format_refseq-1163"><span class="linenos">1163</span></a><span class="sd">    :type include_non_coding_transcripts: bool (optional)</span>
</span><span id="databases_format_refseq-1164"><a href="#databases_format_refseq-1164"><span class="linenos">1164</span></a><span class="sd">    :param include_transcript_ver: The `include_transcript_ver` parameter determines whether to include</span>
</span><span id="databases_format_refseq-1165"><a href="#databases_format_refseq-1165"><span class="linenos">1165</span></a><span class="sd">    the transcript version in the output file. If set to `True`, the transcript version will be included</span>
</span><span id="databases_format_refseq-1166"><a href="#databases_format_refseq-1166"><span class="linenos">1166</span></a><span class="sd">    in the output file. If set to `False`, the transcript version will be removed from the output file.</span>
</span><span id="databases_format_refseq-1167"><a href="#databases_format_refseq-1167"><span class="linenos">1167</span></a><span class="sd">    The default value is `True, defaults to True</span>
</span><span id="databases_format_refseq-1168"><a href="#databases_format_refseq-1168"><span class="linenos">1168</span></a><span class="sd">    :type include_transcript_ver: bool (optional)</span>
</span><span id="databases_format_refseq-1169"><a href="#databases_format_refseq-1169"><span class="linenos">1169</span></a><span class="sd">    :param sort: The `sort` parameter determines whether to sort the output file in ascending order</span>
</span><span id="databases_format_refseq-1170"><a href="#databases_format_refseq-1170"><span class="linenos">1170</span></a><span class="sd">    based on the chromosome and start position. If set to `True`, the file will be sorted. If set to</span>
</span><span id="databases_format_refseq-1171"><a href="#databases_format_refseq-1171"><span class="linenos">1171</span></a><span class="sd">    `False`, the file will not be sorted. The default value is `False`, defaults to False</span>
</span><span id="databases_format_refseq-1172"><a href="#databases_format_refseq-1172"><span class="linenos">1172</span></a><span class="sd">    :type sort: bool (optional)</span>
</span><span id="databases_format_refseq-1173"><a href="#databases_format_refseq-1173"><span class="linenos">1173</span></a><span class="sd">    :param header: The `header` parameter is a boolean that determines whether to include a header line</span>
</span><span id="databases_format_refseq-1174"><a href="#databases_format_refseq-1174"><span class="linenos">1174</span></a><span class="sd">    in the output file. If set to `True`, a header line will be included. If set to `False`, no header</span>
</span><span id="databases_format_refseq-1175"><a href="#databases_format_refseq-1175"><span class="linenos">1175</span></a><span class="sd">    line will be included. The default value is `False`, defaults to False</span>
</span><span id="databases_format_refseq-1176"><a href="#databases_format_refseq-1176"><span class="linenos">1176</span></a><span class="sd">    :type header: bool (optional)</span>
</span><span id="databases_format_refseq-1177"><a href="#databases_format_refseq-1177"><span class="linenos">1177</span></a><span class="sd">    :param header_first_line: The `header_first_line` parameter is a boolean that determines whether to</span>
</span><span id="databases_format_refseq-1178"><a href="#databases_format_refseq-1178"><span class="linenos">1178</span></a><span class="sd">    include the header line as the first line in the output file. If set to `True`, the header line will</span>
</span><span id="databases_format_refseq-1179"><a href="#databases_format_refseq-1179"><span class="linenos">1179</span></a><span class="sd">    be included as the first line. If set to `False`, the header line will not be included as the first,</span>
</span><span id="databases_format_refseq-1180"><a href="#databases_format_refseq-1180"><span class="linenos">1180</span></a><span class="sd">    defaults to True</span>
</span><span id="databases_format_refseq-1181"><a href="#databases_format_refseq-1181"><span class="linenos">1181</span></a><span class="sd">    :type header_first_line: bool (optional)</span>
</span><span id="databases_format_refseq-1182"><a href="#databases_format_refseq-1182"><span class="linenos">1182</span></a><span class="sd">    :return: The function `databases_format_refseq` returns the path of the output file.</span>
</span><span id="databases_format_refseq-1183"><a href="#databases_format_refseq-1183"><span class="linenos">1183</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_format_refseq-1184"><a href="#databases_format_refseq-1184"><span class="linenos">1184</span></a>
</span><span id="databases_format_refseq-1185"><a href="#databases_format_refseq-1185"><span class="linenos">1185</span></a>    <span class="c1"># Header</span>
</span><span id="databases_format_refseq-1186"><a href="#databases_format_refseq-1186"><span class="linenos">1186</span></a>    <span class="n">header_line</span> <span class="o">=</span> <span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">START</span><span class="se">\t</span><span class="s2">END</span><span class="se">\t</span><span class="s2">name</span><span class="se">\t</span><span class="s2">transcript</span><span class="se">\t</span><span class="s2">strand</span><span class="se">\t</span><span class="s2">exon&quot;</span>
</span><span id="databases_format_refseq-1187"><a href="#databases_format_refseq-1187"><span class="linenos">1187</span></a>
</span><span id="databases_format_refseq-1188"><a href="#databases_format_refseq-1188"><span class="linenos">1188</span></a>    <span class="c1"># Open refSeq file</span>
</span><span id="databases_format_refseq-1189"><a href="#databases_format_refseq-1189"><span class="linenos">1189</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">refseq_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
</span><span id="databases_format_refseq-1190"><a href="#databases_format_refseq-1190"><span class="linenos">1190</span></a>
</span><span id="databases_format_refseq-1191"><a href="#databases_format_refseq-1191"><span class="linenos">1191</span></a>        <span class="c1"># Open refSeq output file</span>
</span><span id="databases_format_refseq-1192"><a href="#databases_format_refseq-1192"><span class="linenos">1192</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fo</span><span class="p">:</span>
</span><span id="databases_format_refseq-1193"><a href="#databases_format_refseq-1193"><span class="linenos">1193</span></a>
</span><span id="databases_format_refseq-1194"><a href="#databases_format_refseq-1194"><span class="linenos">1194</span></a>            <span class="c1"># Write haeder line</span>
</span><span id="databases_format_refseq-1195"><a href="#databases_format_refseq-1195"><span class="linenos">1195</span></a>            <span class="k">if</span> <span class="n">header_first_line</span><span class="p">:</span>
</span><span id="databases_format_refseq-1196"><a href="#databases_format_refseq-1196"><span class="linenos">1196</span></a>                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header_line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_format_refseq-1197"><a href="#databases_format_refseq-1197"><span class="linenos">1197</span></a>
</span><span id="databases_format_refseq-1198"><a href="#databases_format_refseq-1198"><span class="linenos">1198</span></a>            <span class="c1"># For each line</span>
</span><span id="databases_format_refseq-1199"><a href="#databases_format_refseq-1199"><span class="linenos">1199</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">fi</span><span class="p">:</span>
</span><span id="databases_format_refseq-1200"><a href="#databases_format_refseq-1200"><span class="linenos">1200</span></a>
</span><span id="databases_format_refseq-1201"><a href="#databases_format_refseq-1201"><span class="linenos">1201</span></a>                <span class="c1"># Header</span>
</span><span id="databases_format_refseq-1202"><a href="#databases_format_refseq-1202"><span class="linenos">1202</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
</span><span id="databases_format_refseq-1203"><a href="#databases_format_refseq-1203"><span class="linenos">1203</span></a>
</span><span id="databases_format_refseq-1204"><a href="#databases_format_refseq-1204"><span class="linenos">1204</span></a>                    <span class="c1"># line</span>
</span><span id="databases_format_refseq-1205"><a href="#databases_format_refseq-1205"><span class="linenos">1205</span></a>                    <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="databases_format_refseq-1206"><a href="#databases_format_refseq-1206"><span class="linenos">1206</span></a>
</span><span id="databases_format_refseq-1207"><a href="#databases_format_refseq-1207"><span class="linenos">1207</span></a>                    <span class="c1"># check non-coding transcripts or unwanted chr</span>
</span><span id="databases_format_refseq-1208"><a href="#databases_format_refseq-1208"><span class="linenos">1208</span></a>                    <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_format_refseq-1209"><a href="#databases_format_refseq-1209"><span class="linenos">1209</span></a>                        <span class="n">include_non_coding_transcripts</span> <span class="ow">or</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;NM_&quot;</span><span class="p">)</span>
</span><span id="databases_format_refseq-1210"><a href="#databases_format_refseq-1210"><span class="linenos">1210</span></a>                    <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="databases_format_refseq-1211"><a href="#databases_format_refseq-1211"><span class="linenos">1211</span></a>                        <span class="p">(</span>
</span><span id="databases_format_refseq-1212"><a href="#databases_format_refseq-1212"><span class="linenos">1212</span></a>                            <span class="n">include_non_canonical_chr</span>
</span><span id="databases_format_refseq-1213"><a href="#databases_format_refseq-1213"><span class="linenos">1213</span></a>                            <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^chr([0-9]*|X|Y)$&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="databases_format_refseq-1214"><a href="#databases_format_refseq-1214"><span class="linenos">1214</span></a>                        <span class="p">)</span>
</span><span id="databases_format_refseq-1215"><a href="#databases_format_refseq-1215"><span class="linenos">1215</span></a>                        <span class="ow">or</span> <span class="p">(</span><span class="n">include_chrM</span> <span class="ow">and</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;chrM&quot;</span><span class="p">,</span> <span class="s2">&quot;chrMT&quot;</span><span class="p">})</span>
</span><span id="databases_format_refseq-1216"><a href="#databases_format_refseq-1216"><span class="linenos">1216</span></a>                    <span class="p">)</span>
</span><span id="databases_format_refseq-1217"><a href="#databases_format_refseq-1217"><span class="linenos">1217</span></a>
</span><span id="databases_format_refseq-1218"><a href="#databases_format_refseq-1218"><span class="linenos">1218</span></a>                    <span class="c1"># include transcript</span>
</span><span id="databases_format_refseq-1219"><a href="#databases_format_refseq-1219"><span class="linenos">1219</span></a>                    <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
</span><span id="databases_format_refseq-1220"><a href="#databases_format_refseq-1220"><span class="linenos">1220</span></a>
</span><span id="databases_format_refseq-1221"><a href="#databases_format_refseq-1221"><span class="linenos">1221</span></a>                        <span class="c1"># Transcript version</span>
</span><span id="databases_format_refseq-1222"><a href="#databases_format_refseq-1222"><span class="linenos">1222</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_transcript_ver</span><span class="p">:</span>
</span><span id="databases_format_refseq-1223"><a href="#databases_format_refseq-1223"><span class="linenos">1223</span></a>                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_format_refseq-1224"><a href="#databases_format_refseq-1224"><span class="linenos">1224</span></a>
</span><span id="databases_format_refseq-1225"><a href="#databases_format_refseq-1225"><span class="linenos">1225</span></a>                        <span class="c1"># Exon to write (depending on utr)</span>
</span><span id="databases_format_refseq-1226"><a href="#databases_format_refseq-1226"><span class="linenos">1226</span></a>                        <span class="c1"># packing exons together to be able to number them (need to start from the end if negative strand, if using IGV as standard)</span>
</span><span id="databases_format_refseq-1227"><a href="#databases_format_refseq-1227"><span class="linenos">1227</span></a>                        <span class="n">exon_starts</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="databases_format_refseq-1228"><a href="#databases_format_refseq-1228"><span class="linenos">1228</span></a>                        <span class="n">exon_ends</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="databases_format_refseq-1229"><a href="#databases_format_refseq-1229"><span class="linenos">1229</span></a>                        <span class="n">exons_to_write</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_format_refseq-1230"><a href="#databases_format_refseq-1230"><span class="linenos">1230</span></a>                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">)):</span>
</span><span id="databases_format_refseq-1231"><a href="#databases_format_refseq-1231"><span class="linenos">1231</span></a>
</span><span id="databases_format_refseq-1232"><a href="#databases_format_refseq-1232"><span class="linenos">1232</span></a>                            <span class="k">if</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="databases_format_refseq-1233"><a href="#databases_format_refseq-1233"><span class="linenos">1233</span></a>                                <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1234"><a href="#databases_format_refseq-1234"><span class="linenos">1234</span></a>                                    <span class="p">[</span>
</span><span id="databases_format_refseq-1235"><a href="#databases_format_refseq-1235"><span class="linenos">1235</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="databases_format_refseq-1236"><a href="#databases_format_refseq-1236"><span class="linenos">1236</span></a>                                        <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1237"><a href="#databases_format_refseq-1237"><span class="linenos">1237</span></a>                                        <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1238"><a href="#databases_format_refseq-1238"><span class="linenos">1238</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="databases_format_refseq-1239"><a href="#databases_format_refseq-1239"><span class="linenos">1239</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="databases_format_refseq-1240"><a href="#databases_format_refseq-1240"><span class="linenos">1240</span></a>                                        <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="databases_format_refseq-1241"><a href="#databases_format_refseq-1241"><span class="linenos">1241</span></a>                                    <span class="p">]</span>
</span><span id="databases_format_refseq-1242"><a href="#databases_format_refseq-1242"><span class="linenos">1242</span></a>                                <span class="p">)</span>
</span><span id="databases_format_refseq-1243"><a href="#databases_format_refseq-1243"><span class="linenos">1243</span></a>
</span><span id="databases_format_refseq-1244"><a href="#databases_format_refseq-1244"><span class="linenos">1244</span></a>                            <span class="k">elif</span> <span class="ow">not</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="databases_format_refseq-1245"><a href="#databases_format_refseq-1245"><span class="linenos">1245</span></a>                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]):</span>
</span><span id="databases_format_refseq-1246"><a href="#databases_format_refseq-1246"><span class="linenos">1246</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1247"><a href="#databases_format_refseq-1247"><span class="linenos">1247</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="databases_format_refseq-1248"><a href="#databases_format_refseq-1248"><span class="linenos">1248</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1249"><a href="#databases_format_refseq-1249"><span class="linenos">1249</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_format_refseq-1250"><a href="#databases_format_refseq-1250"><span class="linenos">1250</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1251"><a href="#databases_format_refseq-1251"><span class="linenos">1251</span></a>                                        <span class="p">[</span>
</span><span id="databases_format_refseq-1252"><a href="#databases_format_refseq-1252"><span class="linenos">1252</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="databases_format_refseq-1253"><a href="#databases_format_refseq-1253"><span class="linenos">1253</span></a>                                            <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1254"><a href="#databases_format_refseq-1254"><span class="linenos">1254</span></a>                                            <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1255"><a href="#databases_format_refseq-1255"><span class="linenos">1255</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="databases_format_refseq-1256"><a href="#databases_format_refseq-1256"><span class="linenos">1256</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="databases_format_refseq-1257"><a href="#databases_format_refseq-1257"><span class="linenos">1257</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="databases_format_refseq-1258"><a href="#databases_format_refseq-1258"><span class="linenos">1258</span></a>                                        <span class="p">]</span>
</span><span id="databases_format_refseq-1259"><a href="#databases_format_refseq-1259"><span class="linenos">1259</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1260"><a href="#databases_format_refseq-1260"><span class="linenos">1260</span></a>
</span><span id="databases_format_refseq-1261"><a href="#databases_format_refseq-1261"><span class="linenos">1261</span></a>                            <span class="k">elif</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="databases_format_refseq-1262"><a href="#databases_format_refseq-1262"><span class="linenos">1262</span></a>                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="databases_format_refseq-1263"><a href="#databases_format_refseq-1263"><span class="linenos">1263</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1264"><a href="#databases_format_refseq-1264"><span class="linenos">1264</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="databases_format_refseq-1265"><a href="#databases_format_refseq-1265"><span class="linenos">1265</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1266"><a href="#databases_format_refseq-1266"><span class="linenos">1266</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_format_refseq-1267"><a href="#databases_format_refseq-1267"><span class="linenos">1267</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1268"><a href="#databases_format_refseq-1268"><span class="linenos">1268</span></a>                                        <span class="p">[</span>
</span><span id="databases_format_refseq-1269"><a href="#databases_format_refseq-1269"><span class="linenos">1269</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="databases_format_refseq-1270"><a href="#databases_format_refseq-1270"><span class="linenos">1270</span></a>                                            <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1271"><a href="#databases_format_refseq-1271"><span class="linenos">1271</span></a>                                            <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1272"><a href="#databases_format_refseq-1272"><span class="linenos">1272</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="databases_format_refseq-1273"><a href="#databases_format_refseq-1273"><span class="linenos">1273</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="databases_format_refseq-1274"><a href="#databases_format_refseq-1274"><span class="linenos">1274</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="databases_format_refseq-1275"><a href="#databases_format_refseq-1275"><span class="linenos">1275</span></a>                                        <span class="p">]</span>
</span><span id="databases_format_refseq-1276"><a href="#databases_format_refseq-1276"><span class="linenos">1276</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1277"><a href="#databases_format_refseq-1277"><span class="linenos">1277</span></a>
</span><span id="databases_format_refseq-1278"><a href="#databases_format_refseq-1278"><span class="linenos">1278</span></a>                            <span class="k">elif</span> <span class="ow">not</span> <span class="n">include_utr_5</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_utr_3</span><span class="p">:</span>
</span><span id="databases_format_refseq-1279"><a href="#databases_format_refseq-1279"><span class="linenos">1279</span></a>                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="databases_format_refseq-1280"><a href="#databases_format_refseq-1280"><span class="linenos">1280</span></a>                                    <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="databases_format_refseq-1281"><a href="#databases_format_refseq-1281"><span class="linenos">1281</span></a>                                <span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="databases_format_refseq-1282"><a href="#databases_format_refseq-1282"><span class="linenos">1282</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1283"><a href="#databases_format_refseq-1283"><span class="linenos">1283</span></a>                                        <span class="p">[</span>
</span><span id="databases_format_refseq-1284"><a href="#databases_format_refseq-1284"><span class="linenos">1284</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="databases_format_refseq-1285"><a href="#databases_format_refseq-1285"><span class="linenos">1285</span></a>                                            <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1286"><a href="#databases_format_refseq-1286"><span class="linenos">1286</span></a>                                            <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="databases_format_refseq-1287"><a href="#databases_format_refseq-1287"><span class="linenos">1287</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
</span><span id="databases_format_refseq-1288"><a href="#databases_format_refseq-1288"><span class="linenos">1288</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="databases_format_refseq-1289"><a href="#databases_format_refseq-1289"><span class="linenos">1289</span></a>                                            <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="databases_format_refseq-1290"><a href="#databases_format_refseq-1290"><span class="linenos">1290</span></a>                                        <span class="p">]</span>
</span><span id="databases_format_refseq-1291"><a href="#databases_format_refseq-1291"><span class="linenos">1291</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1292"><a href="#databases_format_refseq-1292"><span class="linenos">1292</span></a>                                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="databases_format_refseq-1293"><a href="#databases_format_refseq-1293"><span class="linenos">1293</span></a>                                    <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</span><span id="databases_format_refseq-1294"><a href="#databases_format_refseq-1294"><span class="linenos">1294</span></a>                                <span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="databases_format_refseq-1295"><a href="#databases_format_refseq-1295"><span class="linenos">1295</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1296"><a href="#databases_format_refseq-1296"><span class="linenos">1296</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="databases_format_refseq-1297"><a href="#databases_format_refseq-1297"><span class="linenos">1297</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1298"><a href="#databases_format_refseq-1298"><span class="linenos">1298</span></a>                                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="databases_format_refseq-1299"><a href="#databases_format_refseq-1299"><span class="linenos">1299</span></a>                                    <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
</span><span id="databases_format_refseq-1300"><a href="#databases_format_refseq-1300"><span class="linenos">1300</span></a>                                <span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">]):</span>
</span><span id="databases_format_refseq-1301"><a href="#databases_format_refseq-1301"><span class="linenos">1301</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1302"><a href="#databases_format_refseq-1302"><span class="linenos">1302</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="databases_format_refseq-1303"><a href="#databases_format_refseq-1303"><span class="linenos">1303</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1304"><a href="#databases_format_refseq-1304"><span class="linenos">1304</span></a>                                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="databases_format_refseq-1305"><a href="#databases_format_refseq-1305"><span class="linenos">1305</span></a>                                    <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="databases_format_refseq-1306"><a href="#databases_format_refseq-1306"><span class="linenos">1306</span></a>                                <span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">exon_starts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="databases_format_refseq-1307"><a href="#databases_format_refseq-1307"><span class="linenos">1307</span></a>                                    <span class="n">exon_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="databases_format_refseq-1308"><a href="#databases_format_refseq-1308"><span class="linenos">1308</span></a>                                <span class="p">):</span>
</span><span id="databases_format_refseq-1309"><a href="#databases_format_refseq-1309"><span class="linenos">1309</span></a>                                    <span class="n">exons_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_format_refseq-1310"><a href="#databases_format_refseq-1310"><span class="linenos">1310</span></a>                                        <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="databases_format_refseq-1311"><a href="#databases_format_refseq-1311"><span class="linenos">1311</span></a>                                    <span class="p">)</span>
</span><span id="databases_format_refseq-1312"><a href="#databases_format_refseq-1312"><span class="linenos">1312</span></a>
</span><span id="databases_format_refseq-1313"><a href="#databases_format_refseq-1313"><span class="linenos">1313</span></a>                        <span class="c1"># Write exon (depending on strand)</span>
</span><span id="databases_format_refseq-1314"><a href="#databases_format_refseq-1314"><span class="linenos">1314</span></a>                        <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
</span><span id="databases_format_refseq-1315"><a href="#databases_format_refseq-1315"><span class="linenos">1315</span></a>                            <span class="n">exon_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exons_to_write</span><span class="p">)</span>
</span><span id="databases_format_refseq-1316"><a href="#databases_format_refseq-1316"><span class="linenos">1316</span></a>                            <span class="n">exon_num_incrementation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="databases_format_refseq-1317"><a href="#databases_format_refseq-1317"><span class="linenos">1317</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_format_refseq-1318"><a href="#databases_format_refseq-1318"><span class="linenos">1318</span></a>                            <span class="n">exon_num</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="databases_format_refseq-1319"><a href="#databases_format_refseq-1319"><span class="linenos">1319</span></a>                            <span class="n">exon_num_incrementation</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="databases_format_refseq-1320"><a href="#databases_format_refseq-1320"><span class="linenos">1320</span></a>
</span><span id="databases_format_refseq-1321"><a href="#databases_format_refseq-1321"><span class="linenos">1321</span></a>                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exons_to_write</span><span class="p">)):</span>
</span><span id="databases_format_refseq-1322"><a href="#databases_format_refseq-1322"><span class="linenos">1322</span></a>                            <span class="n">exons_to_write</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;exon&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exon_num</span><span class="p">))</span>
</span><span id="databases_format_refseq-1323"><a href="#databases_format_refseq-1323"><span class="linenos">1323</span></a>                            <span class="n">exon_num</span> <span class="o">+=</span> <span class="n">exon_num_incrementation</span>
</span><span id="databases_format_refseq-1324"><a href="#databases_format_refseq-1324"><span class="linenos">1324</span></a>                            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exons_to_write</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_format_refseq-1325"><a href="#databases_format_refseq-1325"><span class="linenos">1325</span></a>
</span><span id="databases_format_refseq-1326"><a href="#databases_format_refseq-1326"><span class="linenos">1326</span></a>    <span class="c1"># Sort BED file</span>
</span><span id="databases_format_refseq-1327"><a href="#databases_format_refseq-1327"><span class="linenos">1327</span></a>    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
</span><span id="databases_format_refseq-1328"><a href="#databases_format_refseq-1328"><span class="linenos">1328</span></a>        <span class="n">bed_sort</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="databases_format_refseq-1329"><a href="#databases_format_refseq-1329"><span class="linenos">1329</span></a>
</span><span id="databases_format_refseq-1330"><a href="#databases_format_refseq-1330"><span class="linenos">1330</span></a>    <span class="c1"># Create header</span>
</span><span id="databases_format_refseq-1331"><a href="#databases_format_refseq-1331"><span class="linenos">1331</span></a>    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
</span><span id="databases_format_refseq-1332"><a href="#databases_format_refseq-1332"><span class="linenos">1332</span></a>
</span><span id="databases_format_refseq-1333"><a href="#databases_format_refseq-1333"><span class="linenos">1333</span></a>        <span class="c1"># Header file</span>
</span><span id="databases_format_refseq-1334"><a href="#databases_format_refseq-1334"><span class="linenos">1334</span></a>        <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_format_refseq-1335"><a href="#databases_format_refseq-1335"><span class="linenos">1335</span></a>
</span><span id="databases_format_refseq-1336"><a href="#databases_format_refseq-1336"><span class="linenos">1336</span></a>        <span class="c1"># VCF header dict</span>
</span><span id="databases_format_refseq-1337"><a href="#databases_format_refseq-1337"><span class="linenos">1337</span></a>        <span class="n">header_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="databases_format_refseq-1338"><a href="#databases_format_refseq-1338"><span class="linenos">1338</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="databases_format_refseq-1339"><a href="#databases_format_refseq-1339"><span class="linenos">1339</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1340"><a href="#databases_format_refseq-1340"><span class="linenos">1340</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1341"><a href="#databases_format_refseq-1341"><span class="linenos">1341</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Name of the refSeq Gene&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1342"><a href="#databases_format_refseq-1342"><span class="linenos">1342</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1343"><a href="#databases_format_refseq-1343"><span class="linenos">1343</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1344"><a href="#databases_format_refseq-1344"><span class="linenos">1344</span></a>            <span class="p">},</span>
</span><span id="databases_format_refseq-1345"><a href="#databases_format_refseq-1345"><span class="linenos">1345</span></a>            <span class="s2">&quot;transcript&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="databases_format_refseq-1346"><a href="#databases_format_refseq-1346"><span class="linenos">1346</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1347"><a href="#databases_format_refseq-1347"><span class="linenos">1347</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1348"><a href="#databases_format_refseq-1348"><span class="linenos">1348</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Name of the refSeq Transcript&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1349"><a href="#databases_format_refseq-1349"><span class="linenos">1349</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1350"><a href="#databases_format_refseq-1350"><span class="linenos">1350</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1351"><a href="#databases_format_refseq-1351"><span class="linenos">1351</span></a>            <span class="p">},</span>
</span><span id="databases_format_refseq-1352"><a href="#databases_format_refseq-1352"><span class="linenos">1352</span></a>            <span class="s2">&quot;strand&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="databases_format_refseq-1353"><a href="#databases_format_refseq-1353"><span class="linenos">1353</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1354"><a href="#databases_format_refseq-1354"><span class="linenos">1354</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1355"><a href="#databases_format_refseq-1355"><span class="linenos">1355</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;DNA strand orientation&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1356"><a href="#databases_format_refseq-1356"><span class="linenos">1356</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1357"><a href="#databases_format_refseq-1357"><span class="linenos">1357</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1358"><a href="#databases_format_refseq-1358"><span class="linenos">1358</span></a>            <span class="p">},</span>
</span><span id="databases_format_refseq-1359"><a href="#databases_format_refseq-1359"><span class="linenos">1359</span></a>            <span class="s2">&quot;exon&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="databases_format_refseq-1360"><a href="#databases_format_refseq-1360"><span class="linenos">1360</span></a>                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1361"><a href="#databases_format_refseq-1361"><span class="linenos">1361</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1362"><a href="#databases_format_refseq-1362"><span class="linenos">1362</span></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Name of the refSeq Exon&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1363"><a href="#databases_format_refseq-1363"><span class="linenos">1363</span></a>                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1364"><a href="#databases_format_refseq-1364"><span class="linenos">1364</span></a>                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;refSeq&quot;</span><span class="p">,</span>
</span><span id="databases_format_refseq-1365"><a href="#databases_format_refseq-1365"><span class="linenos">1365</span></a>            <span class="p">},</span>
</span><span id="databases_format_refseq-1366"><a href="#databases_format_refseq-1366"><span class="linenos">1366</span></a>        <span class="p">}</span>
</span><span id="databases_format_refseq-1367"><a href="#databases_format_refseq-1367"><span class="linenos">1367</span></a>
</span><span id="databases_format_refseq-1368"><a href="#databases_format_refseq-1368"><span class="linenos">1368</span></a>        <span class="c1"># Create header</span>
</span><span id="databases_format_refseq-1369"><a href="#databases_format_refseq-1369"><span class="linenos">1369</span></a>        <span class="n">header_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;##fileformat=VCFv4.2&quot;</span><span class="p">,</span> <span class="n">header_line</span><span class="p">]</span>
</span><span id="databases_format_refseq-1370"><a href="#databases_format_refseq-1370"><span class="linenos">1370</span></a>        <span class="n">header_vcf</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_list</span><span class="p">)))</span>
</span><span id="databases_format_refseq-1371"><a href="#databases_format_refseq-1371"><span class="linenos">1371</span></a>
</span><span id="databases_format_refseq-1372"><a href="#databases_format_refseq-1372"><span class="linenos">1372</span></a>        <span class="c1"># List of header annotations</span>
</span><span id="databases_format_refseq-1373"><a href="#databases_format_refseq-1373"><span class="linenos">1373</span></a>        <span class="k">for</span> <span class="n">annotation_name</span> <span class="ow">in</span> <span class="n">header_dict</span><span class="p">:</span>
</span><span id="databases_format_refseq-1374"><a href="#databases_format_refseq-1374"><span class="linenos">1374</span></a>            <span class="n">header_vcf</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_Info</span><span class="p">(</span>
</span><span id="databases_format_refseq-1375"><a href="#databases_format_refseq-1375"><span class="linenos">1375</span></a>                <span class="n">annotation_name</span><span class="p">,</span>
</span><span id="databases_format_refseq-1376"><a href="#databases_format_refseq-1376"><span class="linenos">1376</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
</span><span id="databases_format_refseq-1377"><a href="#databases_format_refseq-1377"><span class="linenos">1377</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
</span><span id="databases_format_refseq-1378"><a href="#databases_format_refseq-1378"><span class="linenos">1378</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
</span><span id="databases_format_refseq-1379"><a href="#databases_format_refseq-1379"><span class="linenos">1379</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
</span><span id="databases_format_refseq-1380"><a href="#databases_format_refseq-1380"><span class="linenos">1380</span></a>                <span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">],</span>
</span><span id="databases_format_refseq-1381"><a href="#databases_format_refseq-1381"><span class="linenos">1381</span></a>                <span class="n">code_type_map</span><span class="p">[</span><span class="n">header_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]],</span>
</span><span id="databases_format_refseq-1382"><a href="#databases_format_refseq-1382"><span class="linenos">1382</span></a>            <span class="p">)</span>
</span><span id="databases_format_refseq-1383"><a href="#databases_format_refseq-1383"><span class="linenos">1383</span></a>
</span><span id="databases_format_refseq-1384"><a href="#databases_format_refseq-1384"><span class="linenos">1384</span></a>        <span class="c1"># Write file</span>
</span><span id="databases_format_refseq-1385"><a href="#databases_format_refseq-1385"><span class="linenos">1385</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="databases_format_refseq-1386"><a href="#databases_format_refseq-1386"><span class="linenos">1386</span></a>        <span class="n">vcf</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">header_vcf</span><span class="p">)</span>
</span><span id="databases_format_refseq-1387"><a href="#databases_format_refseq-1387"><span class="linenos">1387</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="databases_format_refseq-1388"><a href="#databases_format_refseq-1388"><span class="linenos">1388</span></a>
</span><span id="databases_format_refseq-1389"><a href="#databases_format_refseq-1389"><span class="linenos">1389</span></a>    <span class="k">return</span> <span class="n">output_file</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_format_refseq">databases_format_refseq</a></code> function takes a RefSeq file as input, formats it according to
specified criteria, and outputs the formatted file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>refseq_file</strong>:  The <code>refseq_file</code> parameter is a string that represents the path to the input
RefSeq file. This file contains information about gene annotations, including chromosome, start and
end positions, strand, and other details</li>
<li><strong>output_file</strong>:  The <code>output_file</code> parameter is a string that represents the name of the file
where the formatted data will be written</li>
<li><strong>include_utr_5</strong>:  The <code>include_utr_5</code> parameter is a boolean that determines whether to include
the 5' UTR (untranslated region) in the output file. If set to <code>True</code>, the 5' UTR will be included.
If set to <code>False</code>, the 5' U, defaults to True</li>
<li><strong>include_utr_3</strong>:  A boolean parameter that determines whether to include the 3' UTR
(untranslated region) in the output. If set to True, the 3' UTR will be included. If set to False,
the 3' UTR will be excluded, defaults to True</li>
<li><strong>include_chrM</strong>:  The <code>include_chrM</code> parameter is a boolean that determines whether to include
transcripts from the mitochondrial chromosome (chrM or chrMT) in the output file. If set to True,
transcripts from the mitochondrial chromosome will be included. If set to False, transcripts from
the mitochondrial chromosome will be excluded, defaults to True</li>
<li><strong>include_non_canonical_chr</strong>:  The parameter <code>include_non_canonical_chr</code> determines whether or
not to include non-canonical chromosomes in the output. If set to <code>True</code>, non-canonical chromosomes
will be included. If set to <code>False</code>, non-canonical chromosomes will be excluded, defaults to True</li>
<li><strong>include_non_coding_transcripts</strong>:  The parameter <code>include_non_coding_transcripts</code> determines
whether non-coding transcripts should be included in the output file. If set to <code>True</code>, non-coding
transcripts will be included. If set to <code>False</code>, non-coding transcripts will be excluded, defaults
to True</li>
<li><strong>include_transcript_ver</strong>:  The <code>include_transcript_ver</code> parameter determines whether to include
the transcript version in the output file. If set to <code>True</code>, the transcript version will be included
in the output file. If set to <code>False</code>, the transcript version will be removed from the output file.
The default value is `True, defaults to True</li>
<li><strong>sort</strong>:  The <code>sort</code> parameter determines whether to sort the output file in ascending order
based on the chromosome and start position. If set to <code>True</code>, the file will be sorted. If set to
<code>False</code>, the file will not be sorted. The default value is <code>False</code>, defaults to False</li>
<li><strong>header</strong>:  The <code>header</code> parameter is a boolean that determines whether to include a header line
in the output file. If set to <code>True</code>, a header line will be included. If set to <code>False</code>, no header
line will be included. The default value is <code>False</code>, defaults to False</li>
<li><strong>header_first_line</strong>:  The <code>header_first_line</code> parameter is a boolean that determines whether to
include the header line as the first line in the output file. If set to <code>True</code>, the header line will
be included as the first line. If set to <code>False</code>, the header line will not be included as the first,
defaults to True</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The function <code><a href="#databases_format_refseq">databases_format_refseq</a></code> returns the path of the output file.</p>
</blockquote>
</div>


                </section>
                <section id="databases_download_dbnsfp">
                            <input id="databases_download_dbnsfp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_dbnsfp</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">dbnsfp_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dbnsfp_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dbnsfp_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;4.4a&#39;</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">parquet_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">generate_parquet_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">generate_sub_databases</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">generate_vcf_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">not_generate_files_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">add_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">only_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">row_group_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span>,</span><span class="param">	<span class="n">uniquify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="databases_download_dbnsfp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_dbnsfp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_dbnsfp-1392"><a href="#databases_download_dbnsfp-1392"><span class="linenos">1392</span></a><span class="k">def</span> <span class="nf">databases_download_dbnsfp</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1393"><a href="#databases_download_dbnsfp-1393"><span class="linenos">1393</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1394"><a href="#databases_download_dbnsfp-1394"><span class="linenos">1394</span></a>    <span class="n">dbnsfp_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1395"><a href="#databases_download_dbnsfp-1395"><span class="linenos">1395</span></a>    <span class="n">dbnsfp_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1396"><a href="#databases_download_dbnsfp-1396"><span class="linenos">1396</span></a>    <span class="n">dbnsfp_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4.4a&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1397"><a href="#databases_download_dbnsfp-1397"><span class="linenos">1397</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1398"><a href="#databases_download_dbnsfp-1398"><span class="linenos">1398</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1399"><a href="#databases_download_dbnsfp-1399"><span class="linenos">1399</span></a>    <span class="n">parquet_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1400"><a href="#databases_download_dbnsfp-1400"><span class="linenos">1400</span></a>    <span class="n">generate_parquet_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1401"><a href="#databases_download_dbnsfp-1401"><span class="linenos">1401</span></a>    <span class="n">generate_sub_databases</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1402"><a href="#databases_download_dbnsfp-1402"><span class="linenos">1402</span></a>    <span class="n">generate_vcf_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1403"><a href="#databases_download_dbnsfp-1403"><span class="linenos">1403</span></a>    <span class="n">not_generate_files_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1404"><a href="#databases_download_dbnsfp-1404"><span class="linenos">1404</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1405"><a href="#databases_download_dbnsfp-1405"><span class="linenos">1405</span></a>    <span class="n">add_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1406"><a href="#databases_download_dbnsfp-1406"><span class="linenos">1406</span></a>    <span class="n">only_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1407"><a href="#databases_download_dbnsfp-1407"><span class="linenos">1407</span></a>    <span class="n">row_group_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1408"><a href="#databases_download_dbnsfp-1408"><span class="linenos">1408</span></a>    <span class="n">uniquify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1409"><a href="#databases_download_dbnsfp-1409"><span class="linenos">1409</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1410"><a href="#databases_download_dbnsfp-1410"><span class="linenos">1410</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1411"><a href="#databases_download_dbnsfp-1411"><span class="linenos">1411</span></a><span class="sd">    The `databases_download_dbnsfp` function is used to download and process dbNSFP databases for</span>
</span><span id="databases_download_dbnsfp-1412"><a href="#databases_download_dbnsfp-1412"><span class="linenos">1412</span></a><span class="sd">    specified genome assemblies, generating Parquet and VCF files based on the provided configurations.</span>
</span><span id="databases_download_dbnsfp-1413"><a href="#databases_download_dbnsfp-1413"><span class="linenos">1413</span></a>
</span><span id="databases_download_dbnsfp-1414"><a href="#databases_download_dbnsfp-1414"><span class="linenos">1414</span></a><span class="sd">    :param assemblies: A list of genome assemblies for which to download and process dbNSFP data. Each</span>
</span><span id="databases_download_dbnsfp-1415"><a href="#databases_download_dbnsfp-1415"><span class="linenos">1415</span></a><span class="sd">    assembly should be specified as a string</span>
</span><span id="databases_download_dbnsfp-1416"><a href="#databases_download_dbnsfp-1416"><span class="linenos">1416</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_dbnsfp-1417"><a href="#databases_download_dbnsfp-1417"><span class="linenos">1417</span></a><span class="sd">    :param dbnsfp_folder: The `dbnsfp_folder` parameter is a string that specifies the folder where the</span>
</span><span id="databases_download_dbnsfp-1418"><a href="#databases_download_dbnsfp-1418"><span class="linenos">1418</span></a><span class="sd">    dbNSFP database files are located. If this parameter is not provided, the function will attempt to</span>
</span><span id="databases_download_dbnsfp-1419"><a href="#databases_download_dbnsfp-1419"><span class="linenos">1419</span></a><span class="sd">    download the dbNSFP database files from the `dbnsfp_url` parameter</span>
</span><span id="databases_download_dbnsfp-1420"><a href="#databases_download_dbnsfp-1420"><span class="linenos">1420</span></a><span class="sd">    :type dbnsfp_folder: str</span>
</span><span id="databases_download_dbnsfp-1421"><a href="#databases_download_dbnsfp-1421"><span class="linenos">1421</span></a><span class="sd">    :param dbnsfp_url: The `dbnsfp_url` parameter represents the URL from which the dbNSFP database</span>
</span><span id="databases_download_dbnsfp-1422"><a href="#databases_download_dbnsfp-1422"><span class="linenos">1422</span></a><span class="sd">    files can be downloaded. This URL is used by the function to fetch the necessary database files for</span>
</span><span id="databases_download_dbnsfp-1423"><a href="#databases_download_dbnsfp-1423"><span class="linenos">1423</span></a><span class="sd">    processing</span>
</span><span id="databases_download_dbnsfp-1424"><a href="#databases_download_dbnsfp-1424"><span class="linenos">1424</span></a><span class="sd">    :type dbnsfp_url: str</span>
</span><span id="databases_download_dbnsfp-1425"><a href="#databases_download_dbnsfp-1425"><span class="linenos">1425</span></a><span class="sd">    :param dbnsfp_release: The `dbnsfp_release` parameter specifies the version of the dbNSFP database</span>
</span><span id="databases_download_dbnsfp-1426"><a href="#databases_download_dbnsfp-1426"><span class="linenos">1426</span></a><span class="sd">    to be used. The default value is &quot;4.4a&quot;, but you can specify a different version if needed, defaults</span>
</span><span id="databases_download_dbnsfp-1427"><a href="#databases_download_dbnsfp-1427"><span class="linenos">1427</span></a><span class="sd">    to 4.4a</span>
</span><span id="databases_download_dbnsfp-1428"><a href="#databases_download_dbnsfp-1428"><span class="linenos">1428</span></a><span class="sd">    :type dbnsfp_release: str (optional)</span>
</span><span id="databases_download_dbnsfp-1429"><a href="#databases_download_dbnsfp-1429"><span class="linenos">1429</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for parallel</span>
</span><span id="databases_download_dbnsfp-1430"><a href="#databases_download_dbnsfp-1430"><span class="linenos">1430</span></a><span class="sd">    processing. Increasing the number of threads can potentially speed up the execution time of the</span>
</span><span id="databases_download_dbnsfp-1431"><a href="#databases_download_dbnsfp-1431"><span class="linenos">1431</span></a><span class="sd">    function, especially if there are multiple cores available on the machine. It determines how many</span>
</span><span id="databases_download_dbnsfp-1432"><a href="#databases_download_dbnsfp-1432"><span class="linenos">1432</span></a><span class="sd">    tasks can be executed simultaneously</span>
</span><span id="databases_download_dbnsfp-1433"><a href="#databases_download_dbnsfp-1433"><span class="linenos">1433</span></a><span class="sd">    :type threads: int</span>
</span><span id="databases_download_dbnsfp-1434"><a href="#databases_download_dbnsfp-1434"><span class="linenos">1434</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of maximum memory (in gigabytes) to use</span>
</span><span id="databases_download_dbnsfp-1435"><a href="#databases_download_dbnsfp-1435"><span class="linenos">1435</span></a><span class="sd">    for sorting. It is used in the context of processing and sorting data efficiently. The default value</span>
</span><span id="databases_download_dbnsfp-1436"><a href="#databases_download_dbnsfp-1436"><span class="linenos">1436</span></a><span class="sd">    for this parameter is set to 1, meaning that 1 gigabyte of memory will be allocated for sorting</span>
</span><span id="databases_download_dbnsfp-1437"><a href="#databases_download_dbnsfp-1437"><span class="linenos">1437</span></a><span class="sd">    operations, defaults to 1</span>
</span><span id="databases_download_dbnsfp-1438"><a href="#databases_download_dbnsfp-1438"><span class="linenos">1438</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="databases_download_dbnsfp-1439"><a href="#databases_download_dbnsfp-1439"><span class="linenos">1439</span></a><span class="sd">    :param parquet_size: The `parquet_size` parameter specifies the maximum size (in megabytes) of data</span>
</span><span id="databases_download_dbnsfp-1440"><a href="#databases_download_dbnsfp-1440"><span class="linenos">1440</span></a><span class="sd">    files in the Parquet folder. It determines the size at which the Parquet files will be split or</span>
</span><span id="databases_download_dbnsfp-1441"><a href="#databases_download_dbnsfp-1441"><span class="linenos">1441</span></a><span class="sd">    generated. The value should be an integer representing the size in megabytes, defaults to 100</span>
</span><span id="databases_download_dbnsfp-1442"><a href="#databases_download_dbnsfp-1442"><span class="linenos">1442</span></a><span class="sd">    :type parquet_size: int (optional)</span>
</span><span id="databases_download_dbnsfp-1443"><a href="#databases_download_dbnsfp-1443"><span class="linenos">1443</span></a><span class="sd">    :param generate_parquet_file: The `generate_parquet_file` parameter in the</span>
</span><span id="databases_download_dbnsfp-1444"><a href="#databases_download_dbnsfp-1444"><span class="linenos">1444</span></a><span class="sd">    `databases_download_dbnsfp` function is a boolean flag that indicates whether to generate a Parquet</span>
</span><span id="databases_download_dbnsfp-1445"><a href="#databases_download_dbnsfp-1445"><span class="linenos">1445</span></a><span class="sd">    file or not. If set to `True`, the function will create Parquet files based on the specified</span>
</span><span id="databases_download_dbnsfp-1446"><a href="#databases_download_dbnsfp-1446"><span class="linenos">1446</span></a><span class="sd">    parameters and data. If set to `, defaults to False</span>
</span><span id="databases_download_dbnsfp-1447"><a href="#databases_download_dbnsfp-1447"><span class="linenos">1447</span></a><span class="sd">    :type generate_parquet_file: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1448"><a href="#databases_download_dbnsfp-1448"><span class="linenos">1448</span></a><span class="sd">    :param generate_sub_databases: The `generate_sub_databases` parameter in the</span>
</span><span id="databases_download_dbnsfp-1449"><a href="#databases_download_dbnsfp-1449"><span class="linenos">1449</span></a><span class="sd">    `databases_download_dbnsfp` function determines whether to generate sub-databases based on the</span>
</span><span id="databases_download_dbnsfp-1450"><a href="#databases_download_dbnsfp-1450"><span class="linenos">1450</span></a><span class="sd">    assemblies provided. If set to `True`, the function will create sub-databases based on the specified</span>
</span><span id="databases_download_dbnsfp-1451"><a href="#databases_download_dbnsfp-1451"><span class="linenos">1451</span></a><span class="sd">    genome assemblies. If set to `False`, the function, defaults to False</span>
</span><span id="databases_download_dbnsfp-1452"><a href="#databases_download_dbnsfp-1452"><span class="linenos">1452</span></a><span class="sd">    :type generate_sub_databases: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1453"><a href="#databases_download_dbnsfp-1453"><span class="linenos">1453</span></a><span class="sd">    :param generate_vcf_file: The `generate_vcf_file` parameter in the `databases_download_dbnsfp`</span>
</span><span id="databases_download_dbnsfp-1454"><a href="#databases_download_dbnsfp-1454"><span class="linenos">1454</span></a><span class="sd">    function is a boolean flag that indicates whether to generate a VCF file based on the specified</span>
</span><span id="databases_download_dbnsfp-1455"><a href="#databases_download_dbnsfp-1455"><span class="linenos">1455</span></a><span class="sd">    parameters and data. If set to `True`, the function will generate a VCF file. If set to `False,</span>
</span><span id="databases_download_dbnsfp-1456"><a href="#databases_download_dbnsfp-1456"><span class="linenos">1456</span></a><span class="sd">    defaults to False</span>
</span><span id="databases_download_dbnsfp-1457"><a href="#databases_download_dbnsfp-1457"><span class="linenos">1457</span></a><span class="sd">    :type generate_vcf_file: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1458"><a href="#databases_download_dbnsfp-1458"><span class="linenos">1458</span></a><span class="sd">    :param not_generate_files_all: The `not_generate_files_all` parameter in the</span>
</span><span id="databases_download_dbnsfp-1459"><a href="#databases_download_dbnsfp-1459"><span class="linenos">1459</span></a><span class="sd">    `databases_download_dbnsfp` function is a boolean flag that indicates whether to skip generating</span>
</span><span id="databases_download_dbnsfp-1460"><a href="#databases_download_dbnsfp-1460"><span class="linenos">1460</span></a><span class="sd">    database Parquet/VCF files for the entire database. If set to `True`, the function will not generate</span>
</span><span id="databases_download_dbnsfp-1461"><a href="#databases_download_dbnsfp-1461"><span class="linenos">1461</span></a><span class="sd">    files for the entire database. If set to, defaults to False</span>
</span><span id="databases_download_dbnsfp-1462"><a href="#databases_download_dbnsfp-1462"><span class="linenos">1462</span></a><span class="sd">    :type not_generate_files_all: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1463"><a href="#databases_download_dbnsfp-1463"><span class="linenos">1463</span></a><span class="sd">    :param genomes_folder: The `genomes_folder` parameter specifies the folder where the genome files</span>
</span><span id="databases_download_dbnsfp-1464"><a href="#databases_download_dbnsfp-1464"><span class="linenos">1464</span></a><span class="sd">    are located. It is a string that represents the path to the folder containing genome assemblies</span>
</span><span id="databases_download_dbnsfp-1465"><a href="#databases_download_dbnsfp-1465"><span class="linenos">1465</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="databases_download_dbnsfp-1466"><a href="#databases_download_dbnsfp-1466"><span class="linenos">1466</span></a><span class="sd">    :param add_info: The `add_info` parameter in the `databases_download_dbnsfp` function is a boolean</span>
</span><span id="databases_download_dbnsfp-1467"><a href="#databases_download_dbnsfp-1467"><span class="linenos">1467</span></a><span class="sd">    flag that determines whether to include an &quot;INFO&quot; column in the Parquet folder/file. If set to</span>
</span><span id="databases_download_dbnsfp-1468"><a href="#databases_download_dbnsfp-1468"><span class="linenos">1468</span></a><span class="sd">    `True`, the function will add an INFO column to the generated Parquet files. This INFO, defaults to</span>
</span><span id="databases_download_dbnsfp-1469"><a href="#databases_download_dbnsfp-1469"><span class="linenos">1469</span></a><span class="sd">    False</span>
</span><span id="databases_download_dbnsfp-1470"><a href="#databases_download_dbnsfp-1470"><span class="linenos">1470</span></a><span class="sd">    :type add_info: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1471"><a href="#databases_download_dbnsfp-1471"><span class="linenos">1471</span></a><span class="sd">    :param only_info: The `only_info` parameter in the `databases_download_dbnsfp` function is a boolean</span>
</span><span id="databases_download_dbnsfp-1472"><a href="#databases_download_dbnsfp-1472"><span class="linenos">1472</span></a><span class="sd">    flag that, when set to `True`, indicates that only the &quot;INFO&quot; column should be included in the</span>
</span><span id="databases_download_dbnsfp-1473"><a href="#databases_download_dbnsfp-1473"><span class="linenos">1473</span></a><span class="sd">    output. This parameter is used to control whether to include only the &quot;INFO&quot; column in, defaults to</span>
</span><span id="databases_download_dbnsfp-1474"><a href="#databases_download_dbnsfp-1474"><span class="linenos">1474</span></a><span class="sd">    False</span>
</span><span id="databases_download_dbnsfp-1475"><a href="#databases_download_dbnsfp-1475"><span class="linenos">1475</span></a><span class="sd">    :type only_info: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1476"><a href="#databases_download_dbnsfp-1476"><span class="linenos">1476</span></a><span class="sd">    :param row_group_size: The `row_group_size` parameter specifies the row group size to generate the</span>
</span><span id="databases_download_dbnsfp-1477"><a href="#databases_download_dbnsfp-1477"><span class="linenos">1477</span></a><span class="sd">    Parquet folder and file. It is used to control the size of row groups in the Parquet file. This</span>
</span><span id="databases_download_dbnsfp-1478"><a href="#databases_download_dbnsfp-1478"><span class="linenos">1478</span></a><span class="sd">    parameter affects the organization of data within the Parquet file and can impact performance and</span>
</span><span id="databases_download_dbnsfp-1479"><a href="#databases_download_dbnsfp-1479"><span class="linenos">1479</span></a><span class="sd">    memory usage during processing. The, defaults to 100000</span>
</span><span id="databases_download_dbnsfp-1480"><a href="#databases_download_dbnsfp-1480"><span class="linenos">1480</span></a><span class="sd">    :type row_group_size: int (optional)</span>
</span><span id="databases_download_dbnsfp-1481"><a href="#databases_download_dbnsfp-1481"><span class="linenos">1481</span></a><span class="sd">    :param uniquify: The `uniquify` parameter in the `databases_download_dbnsfp` function is a boolean</span>
</span><span id="databases_download_dbnsfp-1482"><a href="#databases_download_dbnsfp-1482"><span class="linenos">1482</span></a><span class="sd">    flag that determines whether to generate unique values for each annotation in the Parquet file. When</span>
</span><span id="databases_download_dbnsfp-1483"><a href="#databases_download_dbnsfp-1483"><span class="linenos">1483</span></a><span class="sd">    set to `True`, the function will ensure that each annotation column contains only unique values.</span>
</span><span id="databases_download_dbnsfp-1484"><a href="#databases_download_dbnsfp-1484"><span class="linenos">1484</span></a><span class="sd">    This can be, defaults to False</span>
</span><span id="databases_download_dbnsfp-1485"><a href="#databases_download_dbnsfp-1485"><span class="linenos">1485</span></a><span class="sd">    :type uniquify: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1486"><a href="#databases_download_dbnsfp-1486"><span class="linenos">1486</span></a><span class="sd">    :return: The function `databases_download_dbnsfp` returns a boolean value indicating whether the</span>
</span><span id="databases_download_dbnsfp-1487"><a href="#databases_download_dbnsfp-1487"><span class="linenos">1487</span></a><span class="sd">    process of downloading and processing dbNSFP databases for specified genome assemblies was</span>
</span><span id="databases_download_dbnsfp-1488"><a href="#databases_download_dbnsfp-1488"><span class="linenos">1488</span></a><span class="sd">    successful or not.</span>
</span><span id="databases_download_dbnsfp-1489"><a href="#databases_download_dbnsfp-1489"><span class="linenos">1489</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1490"><a href="#databases_download_dbnsfp-1490"><span class="linenos">1490</span></a>
</span><span id="databases_download_dbnsfp-1491"><a href="#databases_download_dbnsfp-1491"><span class="linenos">1491</span></a>    <span class="k">def</span> <span class="nf">get_database_files</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1492"><a href="#databases_download_dbnsfp-1492"><span class="linenos">1492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1493"><a href="#databases_download_dbnsfp-1493"><span class="linenos">1493</span></a><span class="sd">        The function `get_database_files` returns a list of database files that match a given pattern,</span>
</span><span id="databases_download_dbnsfp-1494"><a href="#databases_download_dbnsfp-1494"><span class="linenos">1494</span></a><span class="sd">        sorted by file size in descending order.</span>
</span><span id="databases_download_dbnsfp-1495"><a href="#databases_download_dbnsfp-1495"><span class="linenos">1495</span></a>
</span><span id="databases_download_dbnsfp-1496"><a href="#databases_download_dbnsfp-1496"><span class="linenos">1496</span></a><span class="sd">        :param pattern: The pattern parameter is a string that represents the file pattern to search</span>
</span><span id="databases_download_dbnsfp-1497"><a href="#databases_download_dbnsfp-1497"><span class="linenos">1497</span></a><span class="sd">        for. It can include wildcards such as &quot;*&quot;, which matches any number of characters, and &quot;?&quot;,</span>
</span><span id="databases_download_dbnsfp-1498"><a href="#databases_download_dbnsfp-1498"><span class="linenos">1498</span></a><span class="sd">        which matches any single character. The pattern is used to search for files in a specific</span>
</span><span id="databases_download_dbnsfp-1499"><a href="#databases_download_dbnsfp-1499"><span class="linenos">1499</span></a><span class="sd">        directory or directories</span>
</span><span id="databases_download_dbnsfp-1500"><a href="#databases_download_dbnsfp-1500"><span class="linenos">1500</span></a><span class="sd">        :type pattern: str</span>
</span><span id="databases_download_dbnsfp-1501"><a href="#databases_download_dbnsfp-1501"><span class="linenos">1501</span></a><span class="sd">        :return: a list of database files that match the given pattern.</span>
</span><span id="databases_download_dbnsfp-1502"><a href="#databases_download_dbnsfp-1502"><span class="linenos">1502</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1503"><a href="#databases_download_dbnsfp-1503"><span class="linenos">1503</span></a>
</span><span id="databases_download_dbnsfp-1504"><a href="#databases_download_dbnsfp-1504"><span class="linenos">1504</span></a>        <span class="n">database_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1505"><a href="#databases_download_dbnsfp-1505"><span class="linenos">1505</span></a>        <span class="k">return</span> <span class="n">database_files</span>
</span><span id="databases_download_dbnsfp-1506"><a href="#databases_download_dbnsfp-1506"><span class="linenos">1506</span></a>
</span><span id="databases_download_dbnsfp-1507"><a href="#databases_download_dbnsfp-1507"><span class="linenos">1507</span></a>    <span class="k">def</span> <span class="nf">get_columns_structure</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1508"><a href="#databases_download_dbnsfp-1508"><span class="linenos">1508</span></a>        <span class="n">database_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="databases_download_dbnsfp-1509"><a href="#databases_download_dbnsfp-1509"><span class="linenos">1509</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1510"><a href="#databases_download_dbnsfp-1510"><span class="linenos">1510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1511"><a href="#databases_download_dbnsfp-1511"><span class="linenos">1511</span></a><span class="sd">        The `get_columns_structure` function retrieves the column structure of a database file by</span>
</span><span id="databases_download_dbnsfp-1512"><a href="#databases_download_dbnsfp-1512"><span class="linenos">1512</span></a><span class="sd">        creating a view and analyzing a sample of rows, returning a dictionary with column names and</span>
</span><span id="databases_download_dbnsfp-1513"><a href="#databases_download_dbnsfp-1513"><span class="linenos">1513</span></a><span class="sd">        data types.</span>
</span><span id="databases_download_dbnsfp-1514"><a href="#databases_download_dbnsfp-1514"><span class="linenos">1514</span></a>
</span><span id="databases_download_dbnsfp-1515"><a href="#databases_download_dbnsfp-1515"><span class="linenos">1515</span></a><span class="sd">        :param database_file: The `database_file` parameter is a string that represents the path to the</span>
</span><span id="databases_download_dbnsfp-1516"><a href="#databases_download_dbnsfp-1516"><span class="linenos">1516</span></a><span class="sd">        database file from which you want to retrieve the column structure. It should be a valid file</span>
</span><span id="databases_download_dbnsfp-1517"><a href="#databases_download_dbnsfp-1517"><span class="linenos">1517</span></a><span class="sd">        path pointing to the database file you want to analyze</span>
</span><span id="databases_download_dbnsfp-1518"><a href="#databases_download_dbnsfp-1518"><span class="linenos">1518</span></a><span class="sd">        :type database_file: str</span>
</span><span id="databases_download_dbnsfp-1519"><a href="#databases_download_dbnsfp-1519"><span class="linenos">1519</span></a><span class="sd">        :param sample_size: The `sample_size` parameter in the `get_columns_structure` function</span>
</span><span id="databases_download_dbnsfp-1520"><a href="#databases_download_dbnsfp-1520"><span class="linenos">1520</span></a><span class="sd">        specifies the number of rows to sample from the database file in order to determine the</span>
</span><span id="databases_download_dbnsfp-1521"><a href="#databases_download_dbnsfp-1521"><span class="linenos">1521</span></a><span class="sd">        structure of the columns. By default, it is set to 1,000,000. This means that the function will</span>
</span><span id="databases_download_dbnsfp-1522"><a href="#databases_download_dbnsfp-1522"><span class="linenos">1522</span></a><span class="sd">        read a sample of, defaults to 1000000</span>
</span><span id="databases_download_dbnsfp-1523"><a href="#databases_download_dbnsfp-1523"><span class="linenos">1523</span></a><span class="sd">        :type sample_size: int (optional)</span>
</span><span id="databases_download_dbnsfp-1524"><a href="#databases_download_dbnsfp-1524"><span class="linenos">1524</span></a><span class="sd">        :param threads: The `threads` parameter in the `get_columns_structure` function specifies the</span>
</span><span id="databases_download_dbnsfp-1525"><a href="#databases_download_dbnsfp-1525"><span class="linenos">1525</span></a><span class="sd">        number of threads to use for parallel processing. Increasing the number of threads can</span>
</span><span id="databases_download_dbnsfp-1526"><a href="#databases_download_dbnsfp-1526"><span class="linenos">1526</span></a><span class="sd">        potentially speed up the execution time of the function, especially if there are multiple cores</span>
</span><span id="databases_download_dbnsfp-1527"><a href="#databases_download_dbnsfp-1527"><span class="linenos">1527</span></a><span class="sd">        available on the machine. By default, this parameter is set to, defaults to 1</span>
</span><span id="databases_download_dbnsfp-1528"><a href="#databases_download_dbnsfp-1528"><span class="linenos">1528</span></a><span class="sd">        :type threads: int (optional)</span>
</span><span id="databases_download_dbnsfp-1529"><a href="#databases_download_dbnsfp-1529"><span class="linenos">1529</span></a><span class="sd">        :return: The `get_columns_structure` function returns a dictionary named `columns_structure`</span>
</span><span id="databases_download_dbnsfp-1530"><a href="#databases_download_dbnsfp-1530"><span class="linenos">1530</span></a><span class="sd">        which contains the column names and their corresponding data types from the database file.</span>
</span><span id="databases_download_dbnsfp-1531"><a href="#databases_download_dbnsfp-1531"><span class="linenos">1531</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1532"><a href="#databases_download_dbnsfp-1532"><span class="linenos">1532</span></a>
</span><span id="databases_download_dbnsfp-1533"><a href="#databases_download_dbnsfp-1533"><span class="linenos">1533</span></a>        <span class="c1"># Check columns structure</span>
</span><span id="databases_download_dbnsfp-1534"><a href="#databases_download_dbnsfp-1534"><span class="linenos">1534</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure...&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1535"><a href="#databases_download_dbnsfp-1535"><span class="linenos">1535</span></a>
</span><span id="databases_download_dbnsfp-1536"><a href="#databases_download_dbnsfp-1536"><span class="linenos">1536</span></a>        <span class="c1"># Connexion for structure</span>
</span><span id="databases_download_dbnsfp-1537"><a href="#databases_download_dbnsfp-1537"><span class="linenos">1537</span></a>        <span class="n">db_structure</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="databases_download_dbnsfp-1538"><a href="#databases_download_dbnsfp-1538"><span class="linenos">1538</span></a>
</span><span id="databases_download_dbnsfp-1539"><a href="#databases_download_dbnsfp-1539"><span class="linenos">1539</span></a>        <span class="c1"># Create view and retrive structure</span>
</span><span id="databases_download_dbnsfp-1540"><a href="#databases_download_dbnsfp-1540"><span class="linenos">1540</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1541"><a href="#databases_download_dbnsfp-1541"><span class="linenos">1541</span></a><span class="s2">            CREATE TABLE view_for_structure AS</span>
</span><span id="databases_download_dbnsfp-1542"><a href="#databases_download_dbnsfp-1542"><span class="linenos">1542</span></a><span class="s2">                (</span>
</span><span id="databases_download_dbnsfp-1543"><a href="#databases_download_dbnsfp-1543"><span class="linenos">1543</span></a><span class="s2">                    SELECT *</span>
</span><span id="databases_download_dbnsfp-1544"><a href="#databases_download_dbnsfp-1544"><span class="linenos">1544</span></a><span class="s2">                    FROM read_csv_auto(&#39;</span><span class="si">{</span><span class="n">database_file</span><span class="si">}</span><span class="s2">&#39;, compression=gzip, ALL_VARCHAR=0, delim=&#39;</span><span class="se">\t</span><span class="s2">&#39;, nullstr=&#39;.&#39;, sample_size=</span><span class="si">{</span><span class="n">sample_size</span><span class="si">}</span><span class="s2">)</span>
</span><span id="databases_download_dbnsfp-1545"><a href="#databases_download_dbnsfp-1545"><span class="linenos">1545</span></a><span class="s2">                    LIMIT </span><span class="si">{</span><span class="n">sample_size</span><span class="si">}</span>
</span><span id="databases_download_dbnsfp-1546"><a href="#databases_download_dbnsfp-1546"><span class="linenos">1546</span></a><span class="s2">                )</span>
</span><span id="databases_download_dbnsfp-1547"><a href="#databases_download_dbnsfp-1547"><span class="linenos">1547</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1548"><a href="#databases_download_dbnsfp-1548"><span class="linenos">1548</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1549"><a href="#databases_download_dbnsfp-1549"><span class="linenos">1549</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Create view...&quot;</span>
</span><span id="databases_download_dbnsfp-1550"><a href="#databases_download_dbnsfp-1550"><span class="linenos">1550</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1551"><a href="#databases_download_dbnsfp-1551"><span class="linenos">1551</span></a>        <span class="n">db_structure</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1552"><a href="#databases_download_dbnsfp-1552"><span class="linenos">1552</span></a>
</span><span id="databases_download_dbnsfp-1553"><a href="#databases_download_dbnsfp-1553"><span class="linenos">1553</span></a>        <span class="c1"># Retrieve structure</span>
</span><span id="databases_download_dbnsfp-1554"><a href="#databases_download_dbnsfp-1554"><span class="linenos">1554</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1555"><a href="#databases_download_dbnsfp-1555"><span class="linenos">1555</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Retrieve database structure...&quot;</span>
</span><span id="databases_download_dbnsfp-1556"><a href="#databases_download_dbnsfp-1556"><span class="linenos">1556</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1557"><a href="#databases_download_dbnsfp-1557"><span class="linenos">1557</span></a>        <span class="n">res_structure</span> <span class="o">=</span> <span class="n">db_structure</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;PRAGMA table_info(&#39;view_for_structure&#39;);&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1558"><a href="#databases_download_dbnsfp-1558"><span class="linenos">1558</span></a>
</span><span id="databases_download_dbnsfp-1559"><a href="#databases_download_dbnsfp-1559"><span class="linenos">1559</span></a>        <span class="c1"># Constructure structure dict</span>
</span><span id="databases_download_dbnsfp-1560"><a href="#databases_download_dbnsfp-1560"><span class="linenos">1560</span></a>        <span class="n">columns_structure</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DB&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;Number&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="databases_download_dbnsfp-1561"><a href="#databases_download_dbnsfp-1561"><span class="linenos">1561</span></a>
</span><span id="databases_download_dbnsfp-1562"><a href="#databases_download_dbnsfp-1562"><span class="linenos">1562</span></a>        <span class="c1"># Determine type for duckDB</span>
</span><span id="databases_download_dbnsfp-1563"><a href="#databases_download_dbnsfp-1563"><span class="linenos">1563</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1564"><a href="#databases_download_dbnsfp-1564"><span class="linenos">1564</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Construct DB structure dict...&quot;</span>
</span><span id="databases_download_dbnsfp-1565"><a href="#databases_download_dbnsfp-1565"><span class="linenos">1565</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1566"><a href="#databases_download_dbnsfp-1566"><span class="linenos">1566</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">res_structure</span><span class="o">.</span><span class="n">df</span><span class="p">()</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="databases_download_dbnsfp-1567"><a href="#databases_download_dbnsfp-1567"><span class="linenos">1567</span></a>            <span class="n">column_name</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-1568"><a href="#databases_download_dbnsfp-1568"><span class="linenos">1568</span></a>            <span class="n">data_type</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-1569"><a href="#databases_download_dbnsfp-1569"><span class="linenos">1569</span></a>            <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">][</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="databases_download_dbnsfp-1570"><a href="#databases_download_dbnsfp-1570"><span class="linenos">1570</span></a>
</span><span id="databases_download_dbnsfp-1571"><a href="#databases_download_dbnsfp-1571"><span class="linenos">1571</span></a>        <span class="c1"># Determine type for VCF</span>
</span><span id="databases_download_dbnsfp-1572"><a href="#databases_download_dbnsfp-1572"><span class="linenos">1572</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1573"><a href="#databases_download_dbnsfp-1573"><span class="linenos">1573</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Construct VCF structure dict (Type and Number)...&quot;</span>
</span><span id="databases_download_dbnsfp-1574"><a href="#databases_download_dbnsfp-1574"><span class="linenos">1574</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1575"><a href="#databases_download_dbnsfp-1575"><span class="linenos">1575</span></a>
</span><span id="databases_download_dbnsfp-1576"><a href="#databases_download_dbnsfp-1576"><span class="linenos">1576</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]:</span>
</span><span id="databases_download_dbnsfp-1577"><a href="#databases_download_dbnsfp-1577"><span class="linenos">1577</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="n">db_structure</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; FROM view_for_structure;&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1578"><a href="#databases_download_dbnsfp-1578"><span class="linenos">1578</span></a>            <span class="c1"># Type</span>
</span><span id="databases_download_dbnsfp-1579"><a href="#databases_download_dbnsfp-1579"><span class="linenos">1579</span></a>            <span class="n">column_type</span> <span class="o">=</span> <span class="n">determine_column_types</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="n">column</span><span class="p">]))</span>
</span><span id="databases_download_dbnsfp-1580"><a href="#databases_download_dbnsfp-1580"><span class="linenos">1580</span></a>            <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_type</span>
</span><span id="databases_download_dbnsfp-1581"><a href="#databases_download_dbnsfp-1581"><span class="linenos">1581</span></a>            <span class="c1"># Number</span>
</span><span id="databases_download_dbnsfp-1582"><a href="#databases_download_dbnsfp-1582"><span class="linenos">1582</span></a>            <span class="n">column_number</span> <span class="o">=</span> <span class="n">determine_column_number</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="n">column</span><span class="p">]))</span>
</span><span id="databases_download_dbnsfp-1583"><a href="#databases_download_dbnsfp-1583"><span class="linenos">1583</span></a>            <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;Number&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_number</span>
</span><span id="databases_download_dbnsfp-1584"><a href="#databases_download_dbnsfp-1584"><span class="linenos">1584</span></a>
</span><span id="databases_download_dbnsfp-1585"><a href="#databases_download_dbnsfp-1585"><span class="linenos">1585</span></a>        <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-1586"><a href="#databases_download_dbnsfp-1586"><span class="linenos">1586</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1587"><a href="#databases_download_dbnsfp-1587"><span class="linenos">1587</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">columns_structure</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns found&quot;</span>
</span><span id="databases_download_dbnsfp-1588"><a href="#databases_download_dbnsfp-1588"><span class="linenos">1588</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1589"><a href="#databases_download_dbnsfp-1589"><span class="linenos">1589</span></a>
</span><span id="databases_download_dbnsfp-1590"><a href="#databases_download_dbnsfp-1590"><span class="linenos">1590</span></a>        <span class="n">db_structure</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-1591"><a href="#databases_download_dbnsfp-1591"><span class="linenos">1591</span></a>
</span><span id="databases_download_dbnsfp-1592"><a href="#databases_download_dbnsfp-1592"><span class="linenos">1592</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1593"><a href="#databases_download_dbnsfp-1593"><span class="linenos">1593</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1594"><a href="#databases_download_dbnsfp-1594"><span class="linenos">1594</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - No database structure found&quot;</span>
</span><span id="databases_download_dbnsfp-1595"><a href="#databases_download_dbnsfp-1595"><span class="linenos">1595</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1596"><a href="#databases_download_dbnsfp-1596"><span class="linenos">1596</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1597"><a href="#databases_download_dbnsfp-1597"><span class="linenos">1597</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - No database structure found&quot;</span>
</span><span id="databases_download_dbnsfp-1598"><a href="#databases_download_dbnsfp-1598"><span class="linenos">1598</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1599"><a href="#databases_download_dbnsfp-1599"><span class="linenos">1599</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1600"><a href="#databases_download_dbnsfp-1600"><span class="linenos">1600</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1601"><a href="#databases_download_dbnsfp-1601"><span class="linenos">1601</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database structure - Database structure generated&quot;</span>
</span><span id="databases_download_dbnsfp-1602"><a href="#databases_download_dbnsfp-1602"><span class="linenos">1602</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1603"><a href="#databases_download_dbnsfp-1603"><span class="linenos">1603</span></a>
</span><span id="databases_download_dbnsfp-1604"><a href="#databases_download_dbnsfp-1604"><span class="linenos">1604</span></a>        <span class="k">return</span> <span class="n">columns_structure</span>
</span><span id="databases_download_dbnsfp-1605"><a href="#databases_download_dbnsfp-1605"><span class="linenos">1605</span></a>
</span><span id="databases_download_dbnsfp-1606"><a href="#databases_download_dbnsfp-1606"><span class="linenos">1606</span></a>    <span class="k">def</span> <span class="nf">clean_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1607"><a href="#databases_download_dbnsfp-1607"><span class="linenos">1607</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1608"><a href="#databases_download_dbnsfp-1608"><span class="linenos">1608</span></a><span class="sd">        The clean_name function replaces hyphens and plus signs in a string with underscores.</span>
</span><span id="databases_download_dbnsfp-1609"><a href="#databases_download_dbnsfp-1609"><span class="linenos">1609</span></a>
</span><span id="databases_download_dbnsfp-1610"><a href="#databases_download_dbnsfp-1610"><span class="linenos">1610</span></a><span class="sd">        :param name: The `name` parameter is a string that represents a name</span>
</span><span id="databases_download_dbnsfp-1611"><a href="#databases_download_dbnsfp-1611"><span class="linenos">1611</span></a><span class="sd">        :type name: str</span>
</span><span id="databases_download_dbnsfp-1612"><a href="#databases_download_dbnsfp-1612"><span class="linenos">1612</span></a><span class="sd">        :return: The function `clean_name` returns a string.</span>
</span><span id="databases_download_dbnsfp-1613"><a href="#databases_download_dbnsfp-1613"><span class="linenos">1613</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1614"><a href="#databases_download_dbnsfp-1614"><span class="linenos">1614</span></a>
</span><span id="databases_download_dbnsfp-1615"><a href="#databases_download_dbnsfp-1615"><span class="linenos">1615</span></a>        <span class="n">mapping_table</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">({</span><span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span><span class="p">})</span>
</span><span id="databases_download_dbnsfp-1616"><a href="#databases_download_dbnsfp-1616"><span class="linenos">1616</span></a>        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mapping_table</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1617"><a href="#databases_download_dbnsfp-1617"><span class="linenos">1617</span></a>
</span><span id="databases_download_dbnsfp-1618"><a href="#databases_download_dbnsfp-1618"><span class="linenos">1618</span></a>    <span class="k">def</span> <span class="nf">get_columns_select_clause</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1619"><a href="#databases_download_dbnsfp-1619"><span class="linenos">1619</span></a>        <span class="n">columns_structure</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1620"><a href="#databases_download_dbnsfp-1620"><span class="linenos">1620</span></a>        <span class="n">assembly</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hg19&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1621"><a href="#databases_download_dbnsfp-1621"><span class="linenos">1621</span></a>        <span class="n">for_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1622"><a href="#databases_download_dbnsfp-1622"><span class="linenos">1622</span></a>        <span class="n">sub_database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1623"><a href="#databases_download_dbnsfp-1623"><span class="linenos">1623</span></a>        <span class="n">null_if_no_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1624"><a href="#databases_download_dbnsfp-1624"><span class="linenos">1624</span></a>        <span class="n">print_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1625"><a href="#databases_download_dbnsfp-1625"><span class="linenos">1625</span></a>        <span class="n">add_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1626"><a href="#databases_download_dbnsfp-1626"><span class="linenos">1626</span></a>        <span class="n">only_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1627"><a href="#databases_download_dbnsfp-1627"><span class="linenos">1627</span></a>        <span class="n">uniquify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1628"><a href="#databases_download_dbnsfp-1628"><span class="linenos">1628</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1629"><a href="#databases_download_dbnsfp-1629"><span class="linenos">1629</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1630"><a href="#databases_download_dbnsfp-1630"><span class="linenos">1630</span></a><span class="sd">        The `get_columns_select_clause` function generates SELECT and WHERE clauses for a SQL query</span>
</span><span id="databases_download_dbnsfp-1631"><a href="#databases_download_dbnsfp-1631"><span class="linenos">1631</span></a><span class="sd">        based on input columns structure, assembly, sub-database, and other optional parameters.</span>
</span><span id="databases_download_dbnsfp-1632"><a href="#databases_download_dbnsfp-1632"><span class="linenos">1632</span></a>
</span><span id="databases_download_dbnsfp-1633"><a href="#databases_download_dbnsfp-1633"><span class="linenos">1633</span></a><span class="sd">        :param columns_structure: The `columns_structure` parameter is a dictionary that represents the</span>
</span><span id="databases_download_dbnsfp-1634"><a href="#databases_download_dbnsfp-1634"><span class="linenos">1634</span></a><span class="sd">        structure of the columns. Each key in the dictionary is a column name, and the corresponding</span>
</span><span id="databases_download_dbnsfp-1635"><a href="#databases_download_dbnsfp-1635"><span class="linenos">1635</span></a><span class="sd">        value is the column type. This parameter provides the information needed to generate the SELECT</span>
</span><span id="databases_download_dbnsfp-1636"><a href="#databases_download_dbnsfp-1636"><span class="linenos">1636</span></a><span class="sd">        and WHERE clauses for a SQL query based on the specified columns</span>
</span><span id="databases_download_dbnsfp-1637"><a href="#databases_download_dbnsfp-1637"><span class="linenos">1637</span></a><span class="sd">        :type columns_structure: dict</span>
</span><span id="databases_download_dbnsfp-1638"><a href="#databases_download_dbnsfp-1638"><span class="linenos">1638</span></a><span class="sd">        :param assembly: The `assembly` parameter specifies the genome assembly version. It can take</span>
</span><span id="databases_download_dbnsfp-1639"><a href="#databases_download_dbnsfp-1639"><span class="linenos">1639</span></a><span class="sd">        values like &quot;hg19&quot;, &quot;hg38&quot;, or &quot;hg18&quot;. By default, it is set to &quot;hg19&quot;, defaults to hg19</span>
</span><span id="databases_download_dbnsfp-1640"><a href="#databases_download_dbnsfp-1640"><span class="linenos">1640</span></a><span class="sd">        :type assembly: str (optional)</span>
</span><span id="databases_download_dbnsfp-1641"><a href="#databases_download_dbnsfp-1641"><span class="linenos">1641</span></a><span class="sd">        :param for_parquet: The `for_parquet` parameter is a boolean flag that determines whether the</span>
</span><span id="databases_download_dbnsfp-1642"><a href="#databases_download_dbnsfp-1642"><span class="linenos">1642</span></a><span class="sd">        SQL query is being generated for a Parquet file. If `for_parquet` is set to `True`, the function</span>
</span><span id="databases_download_dbnsfp-1643"><a href="#databases_download_dbnsfp-1643"><span class="linenos">1643</span></a><span class="sd">        will include the position and REF/ALT columns in the SELECT clause, regardless of whether they</span>
</span><span id="databases_download_dbnsfp-1644"><a href="#databases_download_dbnsfp-1644"><span class="linenos">1644</span></a><span class="sd">        are specified, defaults to False</span>
</span><span id="databases_download_dbnsfp-1645"><a href="#databases_download_dbnsfp-1645"><span class="linenos">1645</span></a><span class="sd">        :type for_parquet: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1646"><a href="#databases_download_dbnsfp-1646"><span class="linenos">1646</span></a><span class="sd">        :param sub_database: The `sub_database` parameter is an optional parameter that specifies a</span>
</span><span id="databases_download_dbnsfp-1647"><a href="#databases_download_dbnsfp-1647"><span class="linenos">1647</span></a><span class="sd">        sub-database within the main database. It is used to filter the columns based on the specified</span>
</span><span id="databases_download_dbnsfp-1648"><a href="#databases_download_dbnsfp-1648"><span class="linenos">1648</span></a><span class="sd">        sub-database. If a sub-database is provided, only columns that belong to that sub-database or</span>
</span><span id="databases_download_dbnsfp-1649"><a href="#databases_download_dbnsfp-1649"><span class="linenos">1649</span></a><span class="sd">        start with the sub-database</span>
</span><span id="databases_download_dbnsfp-1650"><a href="#databases_download_dbnsfp-1650"><span class="linenos">1650</span></a><span class="sd">        :type sub_database: str</span>
</span><span id="databases_download_dbnsfp-1651"><a href="#databases_download_dbnsfp-1651"><span class="linenos">1651</span></a><span class="sd">        :param null_if_no_annotation: The `null_if_no_annotation` parameter in the</span>
</span><span id="databases_download_dbnsfp-1652"><a href="#databases_download_dbnsfp-1652"><span class="linenos">1652</span></a><span class="sd">        `get_columns_select_clause` function is a boolean parameter that determines whether to return</span>
</span><span id="databases_download_dbnsfp-1653"><a href="#databases_download_dbnsfp-1653"><span class="linenos">1653</span></a><span class="sd">        null if there are no annotations found. If this parameter is set to `True`, the function will</span>
</span><span id="databases_download_dbnsfp-1654"><a href="#databases_download_dbnsfp-1654"><span class="linenos">1654</span></a><span class="sd">        return null if there are no annotations found. This parameter helps handle cases, defaults to</span>
</span><span id="databases_download_dbnsfp-1655"><a href="#databases_download_dbnsfp-1655"><span class="linenos">1655</span></a><span class="sd">        True</span>
</span><span id="databases_download_dbnsfp-1656"><a href="#databases_download_dbnsfp-1656"><span class="linenos">1656</span></a><span class="sd">        :type null_if_no_annotation: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1657"><a href="#databases_download_dbnsfp-1657"><span class="linenos">1657</span></a><span class="sd">        :param print_log: The `print_log` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="databases_download_dbnsfp-1658"><a href="#databases_download_dbnsfp-1658"><span class="linenos">1658</span></a><span class="sd">        boolean flag that determines whether to enable logging or not. If set to `True`, the function</span>
</span><span id="databases_download_dbnsfp-1659"><a href="#databases_download_dbnsfp-1659"><span class="linenos">1659</span></a><span class="sd">        will log debug messages during execution. If set to `False`, logging will be disabled. By</span>
</span><span id="databases_download_dbnsfp-1660"><a href="#databases_download_dbnsfp-1660"><span class="linenos">1660</span></a><span class="sd">        default, this parameter is, defaults to True</span>
</span><span id="databases_download_dbnsfp-1661"><a href="#databases_download_dbnsfp-1661"><span class="linenos">1661</span></a><span class="sd">        :type print_log: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1662"><a href="#databases_download_dbnsfp-1662"><span class="linenos">1662</span></a><span class="sd">        :param add_info: The `add_info` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="databases_download_dbnsfp-1663"><a href="#databases_download_dbnsfp-1663"><span class="linenos">1663</span></a><span class="sd">        boolean flag that determines whether to include an &quot;INFO&quot; column in the Parquet folder/file. If</span>
</span><span id="databases_download_dbnsfp-1664"><a href="#databases_download_dbnsfp-1664"><span class="linenos">1664</span></a><span class="sd">        `add_info` is set to `True`, the function will concatenate and format the selected annotations</span>
</span><span id="databases_download_dbnsfp-1665"><a href="#databases_download_dbnsfp-1665"><span class="linenos">1665</span></a><span class="sd">        into an &quot;INFO, defaults to False</span>
</span><span id="databases_download_dbnsfp-1666"><a href="#databases_download_dbnsfp-1666"><span class="linenos">1666</span></a><span class="sd">        :type add_info: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1667"><a href="#databases_download_dbnsfp-1667"><span class="linenos">1667</span></a><span class="sd">        :param only_info: The `only_info` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="databases_download_dbnsfp-1668"><a href="#databases_download_dbnsfp-1668"><span class="linenos">1668</span></a><span class="sd">        boolean flag that, when set to `True`, indicates that only the &quot;INFO&quot; column should be included</span>
</span><span id="databases_download_dbnsfp-1669"><a href="#databases_download_dbnsfp-1669"><span class="linenos">1669</span></a><span class="sd">        in the output. This parameter is used to control whether to include only the &quot;INFO&quot; column in</span>
</span><span id="databases_download_dbnsfp-1670"><a href="#databases_download_dbnsfp-1670"><span class="linenos">1670</span></a><span class="sd">        the SELECT, defaults to False</span>
</span><span id="databases_download_dbnsfp-1671"><a href="#databases_download_dbnsfp-1671"><span class="linenos">1671</span></a><span class="sd">        :type only_info: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1672"><a href="#databases_download_dbnsfp-1672"><span class="linenos">1672</span></a><span class="sd">        :param uniquify: The `uniquify` parameter in the `get_columns_select_clause` function is a</span>
</span><span id="databases_download_dbnsfp-1673"><a href="#databases_download_dbnsfp-1673"><span class="linenos">1673</span></a><span class="sd">        boolean flag that determines whether to include unique values for each annotation column. When</span>
</span><span id="databases_download_dbnsfp-1674"><a href="#databases_download_dbnsfp-1674"><span class="linenos">1674</span></a><span class="sd">        set to `True`, the function will ensure that each annotation column contains only unique values.</span>
</span><span id="databases_download_dbnsfp-1675"><a href="#databases_download_dbnsfp-1675"><span class="linenos">1675</span></a><span class="sd">        This can be useful when you want to avoid, defaults to False</span>
</span><span id="databases_download_dbnsfp-1676"><a href="#databases_download_dbnsfp-1676"><span class="linenos">1676</span></a><span class="sd">        :type uniquify: bool (optional)</span>
</span><span id="databases_download_dbnsfp-1677"><a href="#databases_download_dbnsfp-1677"><span class="linenos">1677</span></a><span class="sd">        :return: The `get_columns_select_clause` function returns a dictionary containing the following</span>
</span><span id="databases_download_dbnsfp-1678"><a href="#databases_download_dbnsfp-1678"><span class="linenos">1678</span></a><span class="sd">        keys and their corresponding values:</span>
</span><span id="databases_download_dbnsfp-1679"><a href="#databases_download_dbnsfp-1679"><span class="linenos">1679</span></a><span class="sd">        - &quot;select&quot;: A string representing the SELECT clause for a SQL query based on the input columns</span>
</span><span id="databases_download_dbnsfp-1680"><a href="#databases_download_dbnsfp-1680"><span class="linenos">1680</span></a><span class="sd">        structure, assembly, and other parameters.</span>
</span><span id="databases_download_dbnsfp-1681"><a href="#databases_download_dbnsfp-1681"><span class="linenos">1681</span></a><span class="sd">        - &quot;where&quot;: A string representing the WHERE clause for a SQL query based on the input columns</span>
</span><span id="databases_download_dbnsfp-1682"><a href="#databases_download_dbnsfp-1682"><span class="linenos">1682</span></a><span class="sd">        structure, assembly, and other parameters.</span>
</span><span id="databases_download_dbnsfp-1683"><a href="#databases_download_dbnsfp-1683"><span class="linenos">1683</span></a><span class="sd">        - &quot;annotations&quot;: A dictionary</span>
</span><span id="databases_download_dbnsfp-1684"><a href="#databases_download_dbnsfp-1684"><span class="linenos">1684</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1685"><a href="#databases_download_dbnsfp-1685"><span class="linenos">1685</span></a>
</span><span id="databases_download_dbnsfp-1686"><a href="#databases_download_dbnsfp-1686"><span class="linenos">1686</span></a>        <span class="c1"># Only INFO</span>
</span><span id="databases_download_dbnsfp-1687"><a href="#databases_download_dbnsfp-1687"><span class="linenos">1687</span></a>        <span class="k">if</span> <span class="n">only_info</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1688"><a href="#databases_download_dbnsfp-1688"><span class="linenos">1688</span></a>            <span class="n">add_info</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_dbnsfp-1689"><a href="#databases_download_dbnsfp-1689"><span class="linenos">1689</span></a>
</span><span id="databases_download_dbnsfp-1690"><a href="#databases_download_dbnsfp-1690"><span class="linenos">1690</span></a>        <span class="c1"># Init</span>
</span><span id="databases_download_dbnsfp-1691"><a href="#databases_download_dbnsfp-1691"><span class="linenos">1691</span></a>        <span class="n">columns_select_position</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1692"><a href="#databases_download_dbnsfp-1692"><span class="linenos">1692</span></a>        <span class="n">columns_select_ref_alt</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1693"><a href="#databases_download_dbnsfp-1693"><span class="linenos">1693</span></a>        <span class="n">columns_select_info</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1694"><a href="#databases_download_dbnsfp-1694"><span class="linenos">1694</span></a>        <span class="n">columns_select_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1695"><a href="#databases_download_dbnsfp-1695"><span class="linenos">1695</span></a>        <span class="n">columns_where_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1696"><a href="#databases_download_dbnsfp-1696"><span class="linenos">1696</span></a>        <span class="n">columns_list_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1697"><a href="#databases_download_dbnsfp-1697"><span class="linenos">1697</span></a>        <span class="n">columns_info_annotations</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1698"><a href="#databases_download_dbnsfp-1698"><span class="linenos">1698</span></a>        <span class="n">variant_position_columns</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="databases_download_dbnsfp-1699"><a href="#databases_download_dbnsfp-1699"><span class="linenos">1699</span></a>            <span class="s2">&quot;hg38&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="databases_download_dbnsfp-1700"><a href="#databases_download_dbnsfp-1700"><span class="linenos">1700</span></a>                <span class="s2">&quot;#chr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;chr&quot;</span><span class="p">},</span>
</span><span id="databases_download_dbnsfp-1701"><a href="#databases_download_dbnsfp-1701"><span class="linenos">1701</span></a>                <span class="s2">&quot;pos(1-based)&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BIGINT&quot;</span><span class="p">},</span>
</span><span id="databases_download_dbnsfp-1702"><a href="#databases_download_dbnsfp-1702"><span class="linenos">1702</span></a>            <span class="p">},</span>
</span><span id="databases_download_dbnsfp-1703"><a href="#databases_download_dbnsfp-1703"><span class="linenos">1703</span></a>            <span class="s2">&quot;hg19&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="databases_download_dbnsfp-1704"><a href="#databases_download_dbnsfp-1704"><span class="linenos">1704</span></a>                <span class="s2">&quot;hg19_chr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;chr&quot;</span><span class="p">},</span>
</span><span id="databases_download_dbnsfp-1705"><a href="#databases_download_dbnsfp-1705"><span class="linenos">1705</span></a>                <span class="s2">&quot;hg19_pos(1-based)&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BIGINT&quot;</span><span class="p">},</span>
</span><span id="databases_download_dbnsfp-1706"><a href="#databases_download_dbnsfp-1706"><span class="linenos">1706</span></a>            <span class="p">},</span>
</span><span id="databases_download_dbnsfp-1707"><a href="#databases_download_dbnsfp-1707"><span class="linenos">1707</span></a>            <span class="s2">&quot;hg18&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="databases_download_dbnsfp-1708"><a href="#databases_download_dbnsfp-1708"><span class="linenos">1708</span></a>                <span class="s2">&quot;hg18_chr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;chr&quot;</span><span class="p">},</span>
</span><span id="databases_download_dbnsfp-1709"><a href="#databases_download_dbnsfp-1709"><span class="linenos">1709</span></a>                <span class="s2">&quot;hg18_pos(1-based)&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;BIGINT&quot;</span><span class="p">},</span>
</span><span id="databases_download_dbnsfp-1710"><a href="#databases_download_dbnsfp-1710"><span class="linenos">1710</span></a>            <span class="p">},</span>
</span><span id="databases_download_dbnsfp-1711"><a href="#databases_download_dbnsfp-1711"><span class="linenos">1711</span></a>        <span class="p">}</span>
</span><span id="databases_download_dbnsfp-1712"><a href="#databases_download_dbnsfp-1712"><span class="linenos">1712</span></a>
</span><span id="databases_download_dbnsfp-1713"><a href="#databases_download_dbnsfp-1713"><span class="linenos">1713</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1714"><a href="#databases_download_dbnsfp-1714"><span class="linenos">1714</span></a>
</span><span id="databases_download_dbnsfp-1715"><a href="#databases_download_dbnsfp-1715"><span class="linenos">1715</span></a>            <span class="c1"># REF/ALT columns</span>
</span><span id="databases_download_dbnsfp-1716"><a href="#databases_download_dbnsfp-1716"><span class="linenos">1716</span></a>            <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">,</span> <span class="s2">&quot;alt&quot;</span><span class="p">]:</span>
</span><span id="databases_download_dbnsfp-1717"><a href="#databases_download_dbnsfp-1717"><span class="linenos">1717</span></a>                <span class="n">column_alias</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-1718"><a href="#databases_download_dbnsfp-1718"><span class="linenos">1718</span></a>                <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1719"><a href="#databases_download_dbnsfp-1719"><span class="linenos">1719</span></a>                <span class="n">columns_select_ref_alt</span><span class="p">[</span><span class="n">column_key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VARCHAR&quot;</span>
</span><span id="databases_download_dbnsfp-1720"><a href="#databases_download_dbnsfp-1720"><span class="linenos">1720</span></a>
</span><span id="databases_download_dbnsfp-1721"><a href="#databases_download_dbnsfp-1721"><span class="linenos">1721</span></a>            <span class="c1"># Keep assembly position columns</span>
</span><span id="databases_download_dbnsfp-1722"><a href="#databases_download_dbnsfp-1722"><span class="linenos">1722</span></a>            <span class="k">elif</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="databases_download_dbnsfp-1723"><a href="#databases_download_dbnsfp-1723"><span class="linenos">1723</span></a>
</span><span id="databases_download_dbnsfp-1724"><a href="#databases_download_dbnsfp-1724"><span class="linenos">1724</span></a>                <span class="n">column_prefix</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1725"><a href="#databases_download_dbnsfp-1725"><span class="linenos">1725</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1726"><a href="#databases_download_dbnsfp-1726"><span class="linenos">1726</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1727"><a href="#databases_download_dbnsfp-1727"><span class="linenos">1727</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1728"><a href="#databases_download_dbnsfp-1728"><span class="linenos">1728</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1729"><a href="#databases_download_dbnsfp-1729"><span class="linenos">1729</span></a>                <span class="n">column_alias</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1730"><a href="#databases_download_dbnsfp-1730"><span class="linenos">1730</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1731"><a href="#databases_download_dbnsfp-1731"><span class="linenos">1731</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1732"><a href="#databases_download_dbnsfp-1732"><span class="linenos">1732</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alias&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1733"><a href="#databases_download_dbnsfp-1733"><span class="linenos">1733</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1734"><a href="#databases_download_dbnsfp-1734"><span class="linenos">1734</span></a>                <span class="n">column_type</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1735"><a href="#databases_download_dbnsfp-1735"><span class="linenos">1735</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1736"><a href="#databases_download_dbnsfp-1736"><span class="linenos">1736</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1737"><a href="#databases_download_dbnsfp-1737"><span class="linenos">1737</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1738"><a href="#databases_download_dbnsfp-1738"><span class="linenos">1738</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1739"><a href="#databases_download_dbnsfp-1739"><span class="linenos">1739</span></a>                <span class="k">if</span> <span class="n">column_prefix</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1740"><a href="#databases_download_dbnsfp-1740"><span class="linenos">1740</span></a>                    <span class="n">column_prefix_concat</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &#39;</span><span class="si">{</span><span class="n">column_prefix</span><span class="si">}</span><span class="s2">&#39; ||  &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1741"><a href="#databases_download_dbnsfp-1741"><span class="linenos">1741</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1742"><a href="#databases_download_dbnsfp-1742"><span class="linenos">1742</span></a>                    <span class="n">column_prefix_concat</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1743"><a href="#databases_download_dbnsfp-1743"><span class="linenos">1743</span></a>                <span class="n">column_key</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1744"><a href="#databases_download_dbnsfp-1744"><span class="linenos">1744</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span><span class="si">{</span><span class="n">column_prefix_concat</span><span class="si">}</span><span class="s2"> &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1745"><a href="#databases_download_dbnsfp-1745"><span class="linenos">1745</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1746"><a href="#databases_download_dbnsfp-1746"><span class="linenos">1746</span></a>                <span class="n">columns_select_position</span><span class="p">[</span><span class="n">column_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_type</span>
</span><span id="databases_download_dbnsfp-1747"><a href="#databases_download_dbnsfp-1747"><span class="linenos">1747</span></a>                <span class="c1"># Force type on structure</span>
</span><span id="databases_download_dbnsfp-1748"><a href="#databases_download_dbnsfp-1748"><span class="linenos">1748</span></a>                <span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1749"><a href="#databases_download_dbnsfp-1749"><span class="linenos">1749</span></a>                    <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1750"><a href="#databases_download_dbnsfp-1750"><span class="linenos">1750</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1751"><a href="#databases_download_dbnsfp-1751"><span class="linenos">1751</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1752"><a href="#databases_download_dbnsfp-1752"><span class="linenos">1752</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1753"><a href="#databases_download_dbnsfp-1753"><span class="linenos">1753</span></a>
</span><span id="databases_download_dbnsfp-1754"><a href="#databases_download_dbnsfp-1754"><span class="linenos">1754</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1755"><a href="#databases_download_dbnsfp-1755"><span class="linenos">1755</span></a>                <span class="n">column_to_remove</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_dbnsfp-1756"><a href="#databases_download_dbnsfp-1756"><span class="linenos">1756</span></a>                <span class="c1"># Remove other assemby position columns</span>
</span><span id="databases_download_dbnsfp-1757"><a href="#databases_download_dbnsfp-1757"><span class="linenos">1757</span></a>                <span class="k">for</span> <span class="n">other_assembly</span> <span class="ow">in</span> <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="databases_download_dbnsfp-1758"><a href="#databases_download_dbnsfp-1758"><span class="linenos">1758</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1759"><a href="#databases_download_dbnsfp-1759"><span class="linenos">1759</span></a>                        <span class="n">column</span>
</span><span id="databases_download_dbnsfp-1760"><a href="#databases_download_dbnsfp-1760"><span class="linenos">1760</span></a>                        <span class="ow">in</span> <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">other_assembly</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-1761"><a href="#databases_download_dbnsfp-1761"><span class="linenos">1761</span></a>                    <span class="p">):</span>
</span><span id="databases_download_dbnsfp-1762"><a href="#databases_download_dbnsfp-1762"><span class="linenos">1762</span></a>                        <span class="c1"># Force type on structure</span>
</span><span id="databases_download_dbnsfp-1763"><a href="#databases_download_dbnsfp-1763"><span class="linenos">1763</span></a>                        <span class="n">column_type</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1764"><a href="#databases_download_dbnsfp-1764"><span class="linenos">1764</span></a>                            <span class="n">variant_position_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">other_assembly</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1765"><a href="#databases_download_dbnsfp-1765"><span class="linenos">1765</span></a>                            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="databases_download_dbnsfp-1766"><a href="#databases_download_dbnsfp-1766"><span class="linenos">1766</span></a>                            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1767"><a href="#databases_download_dbnsfp-1767"><span class="linenos">1767</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1768"><a href="#databases_download_dbnsfp-1768"><span class="linenos">1768</span></a>                        <span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_type</span>
</span><span id="databases_download_dbnsfp-1769"><a href="#databases_download_dbnsfp-1769"><span class="linenos">1769</span></a>                        <span class="n">column_to_remove</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_dbnsfp-1770"><a href="#databases_download_dbnsfp-1770"><span class="linenos">1770</span></a>
</span><span id="databases_download_dbnsfp-1771"><a href="#databases_download_dbnsfp-1771"><span class="linenos">1771</span></a>                <span class="c1"># other columns - annotations</span>
</span><span id="databases_download_dbnsfp-1772"><a href="#databases_download_dbnsfp-1772"><span class="linenos">1772</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">column_to_remove</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1773"><a href="#databases_download_dbnsfp-1773"><span class="linenos">1773</span></a>                    <span class="n">column_alias</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1774"><a href="#databases_download_dbnsfp-1774"><span class="linenos">1774</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1775"><a href="#databases_download_dbnsfp-1775"><span class="linenos">1775</span></a>                        <span class="n">sub_database</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="databases_download_dbnsfp-1776"><a href="#databases_download_dbnsfp-1776"><span class="linenos">1776</span></a>                        <span class="ow">or</span> <span class="n">sub_database</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ALL&quot;</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-1777"><a href="#databases_download_dbnsfp-1777"><span class="linenos">1777</span></a>                        <span class="ow">or</span> <span class="n">column</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">sub_database</span>
</span><span id="databases_download_dbnsfp-1778"><a href="#databases_download_dbnsfp-1778"><span class="linenos">1778</span></a>                        <span class="ow">or</span> <span class="n">column_alias</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1779"><a href="#databases_download_dbnsfp-1779"><span class="linenos">1779</span></a>                    <span class="p">):</span>
</span><span id="databases_download_dbnsfp-1780"><a href="#databases_download_dbnsfp-1780"><span class="linenos">1780</span></a>                        <span class="k">if</span> <span class="n">for_parquet</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1781"><a href="#databases_download_dbnsfp-1781"><span class="linenos">1781</span></a>                            <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1782"><a href="#databases_download_dbnsfp-1782"><span class="linenos">1782</span></a>                            <span class="n">column_where</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1783"><a href="#databases_download_dbnsfp-1783"><span class="linenos">1783</span></a>                            <span class="n">column_info_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1784"><a href="#databases_download_dbnsfp-1784"><span class="linenos">1784</span></a><span class="s2">                                CASE</span>
</span><span id="databases_download_dbnsfp-1785"><a href="#databases_download_dbnsfp-1785"><span class="linenos">1785</span></a><span class="s2">                                    WHEN &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL</span>
</span><span id="databases_download_dbnsfp-1786"><a href="#databases_download_dbnsfp-1786"><span class="linenos">1786</span></a><span class="s2">                                    THEN </span>
</span><span id="databases_download_dbnsfp-1787"><a href="#databases_download_dbnsfp-1787"><span class="linenos">1787</span></a><span class="s2">                                        concat(</span>
</span><span id="databases_download_dbnsfp-1788"><a href="#databases_download_dbnsfp-1788"><span class="linenos">1788</span></a><span class="s2">                                            &#39;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">=&#39;,</span>
</span><span id="databases_download_dbnsfp-1789"><a href="#databases_download_dbnsfp-1789"><span class="linenos">1789</span></a><span class="s2">                                            replace(CAST(&quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;),</span>
</span><span id="databases_download_dbnsfp-1790"><a href="#databases_download_dbnsfp-1790"><span class="linenos">1790</span></a><span class="s2">                                            &#39;;&#39;</span>
</span><span id="databases_download_dbnsfp-1791"><a href="#databases_download_dbnsfp-1791"><span class="linenos">1791</span></a><span class="s2">                                        )</span>
</span><span id="databases_download_dbnsfp-1792"><a href="#databases_download_dbnsfp-1792"><span class="linenos">1792</span></a><span class="s2">                                    ELSE &#39;&#39;</span>
</span><span id="databases_download_dbnsfp-1793"><a href="#databases_download_dbnsfp-1793"><span class="linenos">1793</span></a><span class="s2">                                END</span>
</span><span id="databases_download_dbnsfp-1794"><a href="#databases_download_dbnsfp-1794"><span class="linenos">1794</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1795"><a href="#databases_download_dbnsfp-1795"><span class="linenos">1795</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1796"><a href="#databases_download_dbnsfp-1796"><span class="linenos">1796</span></a>                            <span class="k">if</span> <span class="n">uniquify</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1797"><a href="#databases_download_dbnsfp-1797"><span class="linenos">1797</span></a>                                <span class="c1"># columns for each annotation</span>
</span><span id="databases_download_dbnsfp-1798"><a href="#databases_download_dbnsfp-1798"><span class="linenos">1798</span></a>                                <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1799"><a href="#databases_download_dbnsfp-1799"><span class="linenos">1799</span></a><span class="s2">                                    list_aggregate(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;)), &#39;string_agg&#39;, &#39;,&#39;)::</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="si">}</span><span class="s2"> AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-1800"><a href="#databases_download_dbnsfp-1800"><span class="linenos">1800</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1801"><a href="#databases_download_dbnsfp-1801"><span class="linenos">1801</span></a>                                <span class="c1"># columns for INFO clumn</span>
</span><span id="databases_download_dbnsfp-1802"><a href="#databases_download_dbnsfp-1802"><span class="linenos">1802</span></a>                                <span class="n">column_info_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1803"><a href="#databases_download_dbnsfp-1803"><span class="linenos">1803</span></a><span class="s2">                                    CASE</span>
</span><span id="databases_download_dbnsfp-1804"><a href="#databases_download_dbnsfp-1804"><span class="linenos">1804</span></a><span class="s2">                                        WHEN len(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;))) &gt; 0</span>
</span><span id="databases_download_dbnsfp-1805"><a href="#databases_download_dbnsfp-1805"><span class="linenos">1805</span></a><span class="s2">                                        THEN </span>
</span><span id="databases_download_dbnsfp-1806"><a href="#databases_download_dbnsfp-1806"><span class="linenos">1806</span></a><span class="s2">                                            concat(</span>
</span><span id="databases_download_dbnsfp-1807"><a href="#databases_download_dbnsfp-1807"><span class="linenos">1807</span></a><span class="s2">                                                &#39;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">=&#39;,</span>
</span><span id="databases_download_dbnsfp-1808"><a href="#databases_download_dbnsfp-1808"><span class="linenos">1808</span></a><span class="s2">                                                list_aggregate(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;)), &#39;string_agg&#39;, &#39;,&#39;),</span>
</span><span id="databases_download_dbnsfp-1809"><a href="#databases_download_dbnsfp-1809"><span class="linenos">1809</span></a><span class="s2">                                                &#39;;&#39;</span>
</span><span id="databases_download_dbnsfp-1810"><a href="#databases_download_dbnsfp-1810"><span class="linenos">1810</span></a><span class="s2">                                            )</span>
</span><span id="databases_download_dbnsfp-1811"><a href="#databases_download_dbnsfp-1811"><span class="linenos">1811</span></a><span class="s2">                                        ELSE &#39;&#39;</span>
</span><span id="databases_download_dbnsfp-1812"><a href="#databases_download_dbnsfp-1812"><span class="linenos">1812</span></a><span class="s2">                                    END</span>
</span><span id="databases_download_dbnsfp-1813"><a href="#databases_download_dbnsfp-1813"><span class="linenos">1813</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1814"><a href="#databases_download_dbnsfp-1814"><span class="linenos">1814</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1815"><a href="#databases_download_dbnsfp-1815"><span class="linenos">1815</span></a>                                <span class="c1"># columns for each annotation</span>
</span><span id="databases_download_dbnsfp-1816"><a href="#databases_download_dbnsfp-1816"><span class="linenos">1816</span></a>                                <span class="n">column_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1817"><a href="#databases_download_dbnsfp-1817"><span class="linenos">1817</span></a><span class="s2">                                    replace(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;)::</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="si">}</span><span class="s2"> AS &quot;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-1818"><a href="#databases_download_dbnsfp-1818"><span class="linenos">1818</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1819"><a href="#databases_download_dbnsfp-1819"><span class="linenos">1819</span></a>                                <span class="c1"># columns for INFO clumn</span>
</span><span id="databases_download_dbnsfp-1820"><a href="#databases_download_dbnsfp-1820"><span class="linenos">1820</span></a>                                <span class="n">column_info_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1821"><a href="#databases_download_dbnsfp-1821"><span class="linenos">1821</span></a><span class="s2">                                    CASE</span>
</span><span id="databases_download_dbnsfp-1822"><a href="#databases_download_dbnsfp-1822"><span class="linenos">1822</span></a><span class="s2">                                        WHEN len(list_distinct(array_filter(string_split(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;), x -&gt; x != &#39;.&#39;))) &gt; 0</span>
</span><span id="databases_download_dbnsfp-1823"><a href="#databases_download_dbnsfp-1823"><span class="linenos">1823</span></a><span class="s2">                                        THEN </span>
</span><span id="databases_download_dbnsfp-1824"><a href="#databases_download_dbnsfp-1824"><span class="linenos">1824</span></a><span class="s2">                                            concat(</span>
</span><span id="databases_download_dbnsfp-1825"><a href="#databases_download_dbnsfp-1825"><span class="linenos">1825</span></a><span class="s2">                                                &#39;</span><span class="si">{</span><span class="n">column_alias</span><span class="si">}</span><span class="s2">=&#39;,</span>
</span><span id="databases_download_dbnsfp-1826"><a href="#databases_download_dbnsfp-1826"><span class="linenos">1826</span></a><span class="s2">                                                replace(CAST(&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;),</span>
</span><span id="databases_download_dbnsfp-1827"><a href="#databases_download_dbnsfp-1827"><span class="linenos">1827</span></a><span class="s2">                                                &#39;;&#39;</span>
</span><span id="databases_download_dbnsfp-1828"><a href="#databases_download_dbnsfp-1828"><span class="linenos">1828</span></a><span class="s2">                                            )</span>
</span><span id="databases_download_dbnsfp-1829"><a href="#databases_download_dbnsfp-1829"><span class="linenos">1829</span></a><span class="s2">                                        ELSE &#39;&#39;</span>
</span><span id="databases_download_dbnsfp-1830"><a href="#databases_download_dbnsfp-1830"><span class="linenos">1830</span></a><span class="s2">                                    END</span>
</span><span id="databases_download_dbnsfp-1831"><a href="#databases_download_dbnsfp-1831"><span class="linenos">1831</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1832"><a href="#databases_download_dbnsfp-1832"><span class="linenos">1832</span></a>                            <span class="n">column_where</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; &quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1833"><a href="#databases_download_dbnsfp-1833"><span class="linenos">1833</span></a>                        <span class="n">columns_info_annotations</span><span class="p">[</span><span class="n">column_info_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_dbnsfp-1834"><a href="#databases_download_dbnsfp-1834"><span class="linenos">1834</span></a>                        <span class="n">columns_select_annotations</span><span class="p">[</span><span class="n">column_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span>
</span><span id="databases_download_dbnsfp-1835"><a href="#databases_download_dbnsfp-1835"><span class="linenos">1835</span></a>                            <span class="n">column</span>
</span><span id="databases_download_dbnsfp-1836"><a href="#databases_download_dbnsfp-1836"><span class="linenos">1836</span></a>                        <span class="p">]</span>
</span><span id="databases_download_dbnsfp-1837"><a href="#databases_download_dbnsfp-1837"><span class="linenos">1837</span></a>                        <span class="n">columns_where_annotations</span><span class="p">[</span><span class="n">column_where</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span>
</span><span id="databases_download_dbnsfp-1838"><a href="#databases_download_dbnsfp-1838"><span class="linenos">1838</span></a>                            <span class="n">column</span>
</span><span id="databases_download_dbnsfp-1839"><a href="#databases_download_dbnsfp-1839"><span class="linenos">1839</span></a>                        <span class="p">]</span>
</span><span id="databases_download_dbnsfp-1840"><a href="#databases_download_dbnsfp-1840"><span class="linenos">1840</span></a>                        <span class="n">columns_list_annotations</span><span class="p">[</span><span class="n">column_alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span>
</span><span id="databases_download_dbnsfp-1841"><a href="#databases_download_dbnsfp-1841"><span class="linenos">1841</span></a>                            <span class="n">column</span>
</span><span id="databases_download_dbnsfp-1842"><a href="#databases_download_dbnsfp-1842"><span class="linenos">1842</span></a>                        <span class="p">]</span>
</span><span id="databases_download_dbnsfp-1843"><a href="#databases_download_dbnsfp-1843"><span class="linenos">1843</span></a>
</span><span id="databases_download_dbnsfp-1844"><a href="#databases_download_dbnsfp-1844"><span class="linenos">1844</span></a>        <span class="c1"># Force position and ref/alt if parquet</span>
</span><span id="databases_download_dbnsfp-1845"><a href="#databases_download_dbnsfp-1845"><span class="linenos">1845</span></a>        <span class="k">if</span> <span class="n">for_parquet</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1846"><a href="#databases_download_dbnsfp-1846"><span class="linenos">1846</span></a>            <span class="n">columns_select_position</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&quot;#CHROM&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;#CHROM&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;POS&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;POS&quot;</span><span class="p">}</span>
</span><span id="databases_download_dbnsfp-1847"><a href="#databases_download_dbnsfp-1847"><span class="linenos">1847</span></a>            <span class="n">columns_select_ref_alt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&quot;REF&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;REF&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;ALT&quot;&#39;</span><span class="p">:</span> <span class="s2">&quot;ALT&quot;</span><span class="p">}</span>
</span><span id="databases_download_dbnsfp-1848"><a href="#databases_download_dbnsfp-1848"><span class="linenos">1848</span></a>
</span><span id="databases_download_dbnsfp-1849"><a href="#databases_download_dbnsfp-1849"><span class="linenos">1849</span></a>        <span class="c1"># Add INFO</span>
</span><span id="databases_download_dbnsfp-1850"><a href="#databases_download_dbnsfp-1850"><span class="linenos">1850</span></a>        <span class="k">if</span> <span class="n">add_info</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1851"><a href="#databases_download_dbnsfp-1851"><span class="linenos">1851</span></a>            <span class="n">info_concat</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1852"><a href="#databases_download_dbnsfp-1852"><span class="linenos">1852</span></a><span class="s2">                regexp_replace(</span>
</span><span id="databases_download_dbnsfp-1853"><a href="#databases_download_dbnsfp-1853"><span class="linenos">1853</span></a><span class="s2">                    replace(</span>
</span><span id="databases_download_dbnsfp-1854"><a href="#databases_download_dbnsfp-1854"><span class="linenos">1854</span></a><span class="s2">                        concat(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">columns_info_annotations</span><span class="p">))</span><span class="si">}</span><span class="s2">),</span>
</span><span id="databases_download_dbnsfp-1855"><a href="#databases_download_dbnsfp-1855"><span class="linenos">1855</span></a><span class="s2">                        &#39;&quot;&#39;, &#39;&#39;),</span>
</span><span id="databases_download_dbnsfp-1856"><a href="#databases_download_dbnsfp-1856"><span class="linenos">1856</span></a><span class="s2">                    &#39;;$&#39;, &#39;&#39;)</span>
</span><span id="databases_download_dbnsfp-1857"><a href="#databases_download_dbnsfp-1857"><span class="linenos">1857</span></a><span class="s2">                AS &quot;INFO&quot;</span>
</span><span id="databases_download_dbnsfp-1858"><a href="#databases_download_dbnsfp-1858"><span class="linenos">1858</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1859"><a href="#databases_download_dbnsfp-1859"><span class="linenos">1859</span></a>            <span class="n">columns_select_info</span><span class="p">[</span><span class="n">info_concat</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
</span><span id="databases_download_dbnsfp-1860"><a href="#databases_download_dbnsfp-1860"><span class="linenos">1860</span></a>            <span class="n">columns_list_annotations</span><span class="p">[</span><span class="s2">&quot;INFO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VARCHAR&quot;</span>
</span><span id="databases_download_dbnsfp-1861"><a href="#databases_download_dbnsfp-1861"><span class="linenos">1861</span></a>
</span><span id="databases_download_dbnsfp-1862"><a href="#databases_download_dbnsfp-1862"><span class="linenos">1862</span></a>            <span class="k">if</span> <span class="n">only_info</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1863"><a href="#databases_download_dbnsfp-1863"><span class="linenos">1863</span></a>                <span class="n">columns_select_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">info_concat</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">}</span>
</span><span id="databases_download_dbnsfp-1864"><a href="#databases_download_dbnsfp-1864"><span class="linenos">1864</span></a>
</span><span id="databases_download_dbnsfp-1865"><a href="#databases_download_dbnsfp-1865"><span class="linenos">1865</span></a>        <span class="c1"># Create select clause</span>
</span><span id="databases_download_dbnsfp-1866"><a href="#databases_download_dbnsfp-1866"><span class="linenos">1866</span></a>        <span class="n">columns_select</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-1867"><a href="#databases_download_dbnsfp-1867"><span class="linenos">1867</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_position</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="databases_download_dbnsfp-1868"><a href="#databases_download_dbnsfp-1868"><span class="linenos">1868</span></a>            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_ref_alt</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="databases_download_dbnsfp-1869"><a href="#databases_download_dbnsfp-1869"><span class="linenos">1869</span></a>            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="databases_download_dbnsfp-1870"><a href="#databases_download_dbnsfp-1870"><span class="linenos">1870</span></a>            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_select_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="databases_download_dbnsfp-1871"><a href="#databases_download_dbnsfp-1871"><span class="linenos">1871</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1872"><a href="#databases_download_dbnsfp-1872"><span class="linenos">1872</span></a>        <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns_select</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1873"><a href="#databases_download_dbnsfp-1873"><span class="linenos">1873</span></a>
</span><span id="databases_download_dbnsfp-1874"><a href="#databases_download_dbnsfp-1874"><span class="linenos">1874</span></a>        <span class="c1"># Create where clause</span>
</span><span id="databases_download_dbnsfp-1875"><a href="#databases_download_dbnsfp-1875"><span class="linenos">1875</span></a>        <span class="n">columns_where</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns_where_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="databases_download_dbnsfp-1876"><a href="#databases_download_dbnsfp-1876"><span class="linenos">1876</span></a>        <span class="n">columns_where_clause</span> <span class="o">=</span> <span class="s2">&quot; OR &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns_where</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1877"><a href="#databases_download_dbnsfp-1877"><span class="linenos">1877</span></a>
</span><span id="databases_download_dbnsfp-1878"><a href="#databases_download_dbnsfp-1878"><span class="linenos">1878</span></a>        <span class="c1"># log</span>
</span><span id="databases_download_dbnsfp-1879"><a href="#databases_download_dbnsfp-1879"><span class="linenos">1879</span></a>        <span class="k">if</span> <span class="n">print_log</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1880"><a href="#databases_download_dbnsfp-1880"><span class="linenos">1880</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1881"><a href="#databases_download_dbnsfp-1881"><span class="linenos">1881</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Check database structure - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">columns_select_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="si">}</span><span class="s2"> annotations found&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1882"><a href="#databases_download_dbnsfp-1882"><span class="linenos">1882</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1883"><a href="#databases_download_dbnsfp-1883"><span class="linenos">1883</span></a>
</span><span id="databases_download_dbnsfp-1884"><a href="#databases_download_dbnsfp-1884"><span class="linenos">1884</span></a>        <span class="c1"># If no annotation found (usually for sub_database ref, alt, pos...)</span>
</span><span id="databases_download_dbnsfp-1885"><a href="#databases_download_dbnsfp-1885"><span class="linenos">1885</span></a>        <span class="k">if</span> <span class="n">null_if_no_annotation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">columns_select_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="databases_download_dbnsfp-1886"><a href="#databases_download_dbnsfp-1886"><span class="linenos">1886</span></a>            <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_dbnsfp-1887"><a href="#databases_download_dbnsfp-1887"><span class="linenos">1887</span></a>
</span><span id="databases_download_dbnsfp-1888"><a href="#databases_download_dbnsfp-1888"><span class="linenos">1888</span></a>        <span class="c1"># Create output</span>
</span><span id="databases_download_dbnsfp-1889"><a href="#databases_download_dbnsfp-1889"><span class="linenos">1889</span></a>        <span class="n">clauses</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="databases_download_dbnsfp-1890"><a href="#databases_download_dbnsfp-1890"><span class="linenos">1890</span></a>            <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="n">columns_select_clause</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1891"><a href="#databases_download_dbnsfp-1891"><span class="linenos">1891</span></a>            <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">columns_where_clause</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1892"><a href="#databases_download_dbnsfp-1892"><span class="linenos">1892</span></a>            <span class="s2">&quot;annotations&quot;</span><span class="p">:</span> <span class="n">columns_list_annotations</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1893"><a href="#databases_download_dbnsfp-1893"><span class="linenos">1893</span></a>        <span class="p">}</span>
</span><span id="databases_download_dbnsfp-1894"><a href="#databases_download_dbnsfp-1894"><span class="linenos">1894</span></a>
</span><span id="databases_download_dbnsfp-1895"><a href="#databases_download_dbnsfp-1895"><span class="linenos">1895</span></a>        <span class="k">return</span> <span class="n">clauses</span>
</span><span id="databases_download_dbnsfp-1896"><a href="#databases_download_dbnsfp-1896"><span class="linenos">1896</span></a>
</span><span id="databases_download_dbnsfp-1897"><a href="#databases_download_dbnsfp-1897"><span class="linenos">1897</span></a>    <span class="k">def</span> <span class="nf">get_annotation_description</span><span class="p">(</span><span class="n">readme</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1898"><a href="#databases_download_dbnsfp-1898"><span class="linenos">1898</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1899"><a href="#databases_download_dbnsfp-1899"><span class="linenos">1899</span></a><span class="sd">        The function `get_annotation_description` reads a README file and extracts annotation</span>
</span><span id="databases_download_dbnsfp-1900"><a href="#databases_download_dbnsfp-1900"><span class="linenos">1900</span></a><span class="sd">        descriptions from it, storing them in a dictionary.</span>
</span><span id="databases_download_dbnsfp-1901"><a href="#databases_download_dbnsfp-1901"><span class="linenos">1901</span></a>
</span><span id="databases_download_dbnsfp-1902"><a href="#databases_download_dbnsfp-1902"><span class="linenos">1902</span></a><span class="sd">        :param readme: The `readme` parameter is a string that represents the file path to a README</span>
</span><span id="databases_download_dbnsfp-1903"><a href="#databases_download_dbnsfp-1903"><span class="linenos">1903</span></a><span class="sd">        file. This function reads the contents of the README file and extracts information about</span>
</span><span id="databases_download_dbnsfp-1904"><a href="#databases_download_dbnsfp-1904"><span class="linenos">1904</span></a><span class="sd">        annotation descriptions</span>
</span><span id="databases_download_dbnsfp-1905"><a href="#databases_download_dbnsfp-1905"><span class="linenos">1905</span></a><span class="sd">        :type readme: str</span>
</span><span id="databases_download_dbnsfp-1906"><a href="#databases_download_dbnsfp-1906"><span class="linenos">1906</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1907"><a href="#databases_download_dbnsfp-1907"><span class="linenos">1907</span></a>
</span><span id="databases_download_dbnsfp-1908"><a href="#databases_download_dbnsfp-1908"><span class="linenos">1908</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">readme</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1909"><a href="#databases_download_dbnsfp-1909"><span class="linenos">1909</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-1910"><a href="#databases_download_dbnsfp-1910"><span class="linenos">1910</span></a>        <span class="n">line_in_variant</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_dbnsfp-1911"><a href="#databases_download_dbnsfp-1911"><span class="linenos">1911</span></a>        <span class="n">annotation_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-1912"><a href="#databases_download_dbnsfp-1912"><span class="linenos">1912</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1913"><a href="#databases_download_dbnsfp-1913"><span class="linenos">1913</span></a>            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Columns of dbNSFP_variant&quot;</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-1914"><a href="#databases_download_dbnsfp-1914"><span class="linenos">1914</span></a>                <span class="n">line_in_variant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_dbnsfp-1915"><a href="#databases_download_dbnsfp-1915"><span class="linenos">1915</span></a>            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-1916"><a href="#databases_download_dbnsfp-1916"><span class="linenos">1916</span></a>                <span class="n">line_in_variant</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_dbnsfp-1917"><a href="#databases_download_dbnsfp-1917"><span class="linenos">1917</span></a>            <span class="k">elif</span> <span class="n">line_in_variant</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1918"><a href="#databases_download_dbnsfp-1918"><span class="linenos">1918</span></a>                <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1919"><a href="#databases_download_dbnsfp-1919"><span class="linenos">1919</span></a>                <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1920"><a href="#databases_download_dbnsfp-1920"><span class="linenos">1920</span></a>                    <span class="n">line_name</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-1921"><a href="#databases_download_dbnsfp-1921"><span class="linenos">1921</span></a>                    <span class="n">line_desc</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-1922"><a href="#databases_download_dbnsfp-1922"><span class="linenos">1922</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1923"><a href="#databases_download_dbnsfp-1923"><span class="linenos">1923</span></a>                    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
</span><span id="databases_download_dbnsfp-1924"><a href="#databases_download_dbnsfp-1924"><span class="linenos">1924</span></a>                        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="databases_download_dbnsfp-1925"><a href="#databases_download_dbnsfp-1925"><span class="linenos">1925</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1926"><a href="#databases_download_dbnsfp-1926"><span class="linenos">1926</span></a>                        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1927"><a href="#databases_download_dbnsfp-1927"><span class="linenos">1927</span></a>                    <span class="n">line_desc</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">sep</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1928"><a href="#databases_download_dbnsfp-1928"><span class="linenos">1928</span></a>                <span class="n">annotation_dict</span><span class="p">[</span><span class="n">line_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_desc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1929"><a href="#databases_download_dbnsfp-1929"><span class="linenos">1929</span></a>
</span><span id="databases_download_dbnsfp-1930"><a href="#databases_download_dbnsfp-1930"><span class="linenos">1930</span></a>        <span class="k">return</span> <span class="n">annotation_dict</span>
</span><span id="databases_download_dbnsfp-1931"><a href="#databases_download_dbnsfp-1931"><span class="linenos">1931</span></a>
</span><span id="databases_download_dbnsfp-1932"><a href="#databases_download_dbnsfp-1932"><span class="linenos">1932</span></a>    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-1933"><a href="#databases_download_dbnsfp-1933"><span class="linenos">1933</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1934"><a href="#databases_download_dbnsfp-1934"><span class="linenos">1934</span></a>
</span><span id="databases_download_dbnsfp-1935"><a href="#databases_download_dbnsfp-1935"><span class="linenos">1935</span></a>    <span class="c1"># genomes folder</span>
</span><span id="databases_download_dbnsfp-1936"><a href="#databases_download_dbnsfp-1936"><span class="linenos">1936</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1937"><a href="#databases_download_dbnsfp-1937"><span class="linenos">1937</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="databases_download_dbnsfp-1938"><a href="#databases_download_dbnsfp-1938"><span class="linenos">1938</span></a>
</span><span id="databases_download_dbnsfp-1939"><a href="#databases_download_dbnsfp-1939"><span class="linenos">1939</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_dbnsfp-1940"><a href="#databases_download_dbnsfp-1940"><span class="linenos">1940</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1941"><a href="#databases_download_dbnsfp-1941"><span class="linenos">1941</span></a>
</span><span id="databases_download_dbnsfp-1942"><a href="#databases_download_dbnsfp-1942"><span class="linenos">1942</span></a>    <span class="c1"># Default refSeq Folder</span>
</span><span id="databases_download_dbnsfp-1943"><a href="#databases_download_dbnsfp-1943"><span class="linenos">1943</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dbnsfp_folder</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1944"><a href="#databases_download_dbnsfp-1944"><span class="linenos">1944</span></a>        <span class="n">dbnsfp_folder</span> <span class="o">=</span> <span class="n">DEFAULT_DBNSFP_FOLDER</span>
</span><span id="databases_download_dbnsfp-1945"><a href="#databases_download_dbnsfp-1945"><span class="linenos">1945</span></a>
</span><span id="databases_download_dbnsfp-1946"><a href="#databases_download_dbnsfp-1946"><span class="linenos">1946</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_dbnsfp-1947"><a href="#databases_download_dbnsfp-1947"><span class="linenos">1947</span></a>    <span class="n">dbnsfp_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1948"><a href="#databases_download_dbnsfp-1948"><span class="linenos">1948</span></a>
</span><span id="databases_download_dbnsfp-1949"><a href="#databases_download_dbnsfp-1949"><span class="linenos">1949</span></a>    <span class="c1"># Default refSeq URL</span>
</span><span id="databases_download_dbnsfp-1950"><a href="#databases_download_dbnsfp-1950"><span class="linenos">1950</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dbnsfp_url</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1951"><a href="#databases_download_dbnsfp-1951"><span class="linenos">1951</span></a>        <span class="n">dbnsfp_url</span> <span class="o">=</span> <span class="n">DEFAULT_DBNSFP_URL</span>
</span><span id="databases_download_dbnsfp-1952"><a href="#databases_download_dbnsfp-1952"><span class="linenos">1952</span></a>
</span><span id="databases_download_dbnsfp-1953"><a href="#databases_download_dbnsfp-1953"><span class="linenos">1953</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_dbnsfp-1954"><a href="#databases_download_dbnsfp-1954"><span class="linenos">1954</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-1955"><a href="#databases_download_dbnsfp-1955"><span class="linenos">1955</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1956"><a href="#databases_download_dbnsfp-1956"><span class="linenos">1956</span></a>
</span><span id="databases_download_dbnsfp-1957"><a href="#databases_download_dbnsfp-1957"><span class="linenos">1957</span></a>    <span class="c1"># Files for dbNSFP</span>
</span><span id="databases_download_dbnsfp-1958"><a href="#databases_download_dbnsfp-1958"><span class="linenos">1958</span></a>    <span class="c1"># https://dbnsfp.s3.amazonaws.com/dbNSFP4.4a.zip</span>
</span><span id="databases_download_dbnsfp-1959"><a href="#databases_download_dbnsfp-1959"><span class="linenos">1959</span></a>    <span class="n">dbnsfp_zip</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">.zip&quot;</span>
</span><span id="databases_download_dbnsfp-1960"><a href="#databases_download_dbnsfp-1960"><span class="linenos">1960</span></a>    <span class="n">dbnsfp_readme</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">.readme.txt&quot;</span>
</span><span id="databases_download_dbnsfp-1961"><a href="#databases_download_dbnsfp-1961"><span class="linenos">1961</span></a>    <span class="n">dbnsfp_zip_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbnsfp_url</span><span class="p">,</span> <span class="n">dbnsfp_zip</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1962"><a href="#databases_download_dbnsfp-1962"><span class="linenos">1962</span></a>    <span class="n">dbnsfp_zip_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">,</span> <span class="n">dbnsfp_zip</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1963"><a href="#databases_download_dbnsfp-1963"><span class="linenos">1963</span></a>    <span class="n">dbnsfp_readme_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbnsfp_folder</span><span class="p">,</span> <span class="n">dbnsfp_readme</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1964"><a href="#databases_download_dbnsfp-1964"><span class="linenos">1964</span></a>    <span class="n">dbnsfp_zip_dest_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbnsfp_zip_dest</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1965"><a href="#databases_download_dbnsfp-1965"><span class="linenos">1965</span></a>
</span><span id="databases_download_dbnsfp-1966"><a href="#databases_download_dbnsfp-1966"><span class="linenos">1966</span></a>    <span class="c1"># Download dbNSFP</span>
</span><span id="databases_download_dbnsfp-1967"><a href="#databases_download_dbnsfp-1967"><span class="linenos">1967</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbnsfp_zip_dest</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-1968"><a href="#databases_download_dbnsfp-1968"><span class="linenos">1968</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1969"><a href="#databases_download_dbnsfp-1969"><span class="linenos">1969</span></a>        <span class="n">download_file</span><span class="p">(</span><span class="n">dbnsfp_zip_url</span><span class="p">,</span> <span class="n">dbnsfp_zip_dest</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1970"><a href="#databases_download_dbnsfp-1970"><span class="linenos">1970</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1971"><a href="#databases_download_dbnsfp-1971"><span class="linenos">1971</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1972"><a href="#databases_download_dbnsfp-1972"><span class="linenos">1972</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_dbnsfp-1973"><a href="#databases_download_dbnsfp-1973"><span class="linenos">1973</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1974"><a href="#databases_download_dbnsfp-1974"><span class="linenos">1974</span></a>
</span><span id="databases_download_dbnsfp-1975"><a href="#databases_download_dbnsfp-1975"><span class="linenos">1975</span></a>    <span class="c1"># Extract dbNSFP</span>
</span><span id="databases_download_dbnsfp-1976"><a href="#databases_download_dbnsfp-1976"><span class="linenos">1976</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbnsfp_readme_dest</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-1977"><a href="#databases_download_dbnsfp-1977"><span class="linenos">1977</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Extract &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1978"><a href="#databases_download_dbnsfp-1978"><span class="linenos">1978</span></a>        <span class="n">extract_file</span><span class="p">(</span><span class="n">dbnsfp_zip_dest</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-1979"><a href="#databases_download_dbnsfp-1979"><span class="linenos">1979</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1980"><a href="#databases_download_dbnsfp-1980"><span class="linenos">1980</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1981"><a href="#databases_download_dbnsfp-1981"><span class="linenos">1981</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">dbnsfp_zip</span><span class="si">}</span><span class="s2">&#39; already extracted&quot;</span>
</span><span id="databases_download_dbnsfp-1982"><a href="#databases_download_dbnsfp-1982"><span class="linenos">1982</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-1983"><a href="#databases_download_dbnsfp-1983"><span class="linenos">1983</span></a>
</span><span id="databases_download_dbnsfp-1984"><a href="#databases_download_dbnsfp-1984"><span class="linenos">1984</span></a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-1985"><a href="#databases_download_dbnsfp-1985"><span class="linenos">1985</span></a>        <span class="n">header_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1986"><a href="#databases_download_dbnsfp-1986"><span class="linenos">1986</span></a>        <span class="n">dbnsfp_readme_dest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1987"><a href="#databases_download_dbnsfp-1987"><span class="linenos">1987</span></a>        <span class="n">columns_structure</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="databases_download_dbnsfp-1988"><a href="#databases_download_dbnsfp-1988"><span class="linenos">1988</span></a>        <span class="n">annotations</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="databases_download_dbnsfp-1989"><a href="#databases_download_dbnsfp-1989"><span class="linenos">1989</span></a>        <span class="n">readme_annotations_description</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-1990"><a href="#databases_download_dbnsfp-1990"><span class="linenos">1990</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-1991"><a href="#databases_download_dbnsfp-1991"><span class="linenos">1991</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-1992"><a href="#databases_download_dbnsfp-1992"><span class="linenos">1992</span></a><span class="sd">        The function `get_header` generates a VCF header based on provided annotations and writes it to</span>
</span><span id="databases_download_dbnsfp-1993"><a href="#databases_download_dbnsfp-1993"><span class="linenos">1993</span></a><span class="sd">        a file.</span>
</span><span id="databases_download_dbnsfp-1994"><a href="#databases_download_dbnsfp-1994"><span class="linenos">1994</span></a>
</span><span id="databases_download_dbnsfp-1995"><a href="#databases_download_dbnsfp-1995"><span class="linenos">1995</span></a><span class="sd">        :param header_file: The path to the output file where the VCF header will be written</span>
</span><span id="databases_download_dbnsfp-1996"><a href="#databases_download_dbnsfp-1996"><span class="linenos">1996</span></a><span class="sd">        :type header_file: str</span>
</span><span id="databases_download_dbnsfp-1997"><a href="#databases_download_dbnsfp-1997"><span class="linenos">1997</span></a><span class="sd">        :param dbnsfp_readme_dest: The `dbnsfp_readme_dest` parameter is a string that represents the</span>
</span><span id="databases_download_dbnsfp-1998"><a href="#databases_download_dbnsfp-1998"><span class="linenos">1998</span></a><span class="sd">        destination file path for the dbNSFP readme file. This file contains the description of the</span>
</span><span id="databases_download_dbnsfp-1999"><a href="#databases_download_dbnsfp-1999"><span class="linenos">1999</span></a><span class="sd">        annotations present in the dbNSFP database</span>
</span><span id="databases_download_dbnsfp-2000"><a href="#databases_download_dbnsfp-2000"><span class="linenos">2000</span></a><span class="sd">        :type dbnsfp_readme_dest: str</span>
</span><span id="databases_download_dbnsfp-2001"><a href="#databases_download_dbnsfp-2001"><span class="linenos">2001</span></a><span class="sd">        :param columns_structure: The `columns_structure` parameter is a dictionary that maps annotation</span>
</span><span id="databases_download_dbnsfp-2002"><a href="#databases_download_dbnsfp-2002"><span class="linenos">2002</span></a><span class="sd">        names to their corresponding column types in a database. The keys of the dictionary are the</span>
</span><span id="databases_download_dbnsfp-2003"><a href="#databases_download_dbnsfp-2003"><span class="linenos">2003</span></a><span class="sd">        annotation names, and the values are the column types</span>
</span><span id="databases_download_dbnsfp-2004"><a href="#databases_download_dbnsfp-2004"><span class="linenos">2004</span></a><span class="sd">        :type columns_structure: dict</span>
</span><span id="databases_download_dbnsfp-2005"><a href="#databases_download_dbnsfp-2005"><span class="linenos">2005</span></a><span class="sd">        :param annotations: The `annotations` parameter is a list of strings that represents the</span>
</span><span id="databases_download_dbnsfp-2006"><a href="#databases_download_dbnsfp-2006"><span class="linenos">2006</span></a><span class="sd">        annotations to be included in the VCF header</span>
</span><span id="databases_download_dbnsfp-2007"><a href="#databases_download_dbnsfp-2007"><span class="linenos">2007</span></a><span class="sd">        :type annotations: list</span>
</span><span id="databases_download_dbnsfp-2008"><a href="#databases_download_dbnsfp-2008"><span class="linenos">2008</span></a><span class="sd">        :return: a boolean value indicating whether the header file was successfully created.</span>
</span><span id="databases_download_dbnsfp-2009"><a href="#databases_download_dbnsfp-2009"><span class="linenos">2009</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2010"><a href="#databases_download_dbnsfp-2010"><span class="linenos">2010</span></a>
</span><span id="databases_download_dbnsfp-2011"><a href="#databases_download_dbnsfp-2011"><span class="linenos">2011</span></a>        <span class="c1"># Full path</span>
</span><span id="databases_download_dbnsfp-2012"><a href="#databases_download_dbnsfp-2012"><span class="linenos">2012</span></a>        <span class="n">header_file</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">header_file</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2013"><a href="#databases_download_dbnsfp-2013"><span class="linenos">2013</span></a>
</span><span id="databases_download_dbnsfp-2014"><a href="#databases_download_dbnsfp-2014"><span class="linenos">2014</span></a>        <span class="c1"># Default VCF header</span>
</span><span id="databases_download_dbnsfp-2015"><a href="#databases_download_dbnsfp-2015"><span class="linenos">2015</span></a>        <span class="n">default_header_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="databases_download_dbnsfp-2016"><a href="#databases_download_dbnsfp-2016"><span class="linenos">2016</span></a>            <span class="s2">&quot;##fileformat=VCFv4.2&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2017"><a href="#databases_download_dbnsfp-2017"><span class="linenos">2017</span></a>            <span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">POS</span><span class="se">\t</span><span class="s2">REF</span><span class="se">\t</span><span class="s2">ALT</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">annotations</span><span class="p">),</span>
</span><span id="databases_download_dbnsfp-2018"><a href="#databases_download_dbnsfp-2018"><span class="linenos">2018</span></a>        <span class="p">]</span>
</span><span id="databases_download_dbnsfp-2019"><a href="#databases_download_dbnsfp-2019"><span class="linenos">2019</span></a>        <span class="n">header_vcf</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_header_list</span><span class="p">)))</span>
</span><span id="databases_download_dbnsfp-2020"><a href="#databases_download_dbnsfp-2020"><span class="linenos">2020</span></a>
</span><span id="databases_download_dbnsfp-2021"><a href="#databases_download_dbnsfp-2021"><span class="linenos">2021</span></a>        <span class="n">code_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Integer&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;String&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Float&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Flag&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span><span id="databases_download_dbnsfp-2022"><a href="#databases_download_dbnsfp-2022"><span class="linenos">2022</span></a>        <span class="n">code_type_map_from_sql</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="databases_download_dbnsfp-2023"><a href="#databases_download_dbnsfp-2023"><span class="linenos">2023</span></a>            <span class="s2">&quot;BIGINT&quot;</span><span class="p">:</span> <span class="s2">&quot;Integer&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2024"><a href="#databases_download_dbnsfp-2024"><span class="linenos">2024</span></a>            <span class="s2">&quot;VARCHAR&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2025"><a href="#databases_download_dbnsfp-2025"><span class="linenos">2025</span></a>            <span class="s2">&quot;DOUBLE&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2026"><a href="#databases_download_dbnsfp-2026"><span class="linenos">2026</span></a>            <span class="s2">&quot;BOOLEAN&quot;</span><span class="p">:</span> <span class="s2">&quot;Integer&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2027"><a href="#databases_download_dbnsfp-2027"><span class="linenos">2027</span></a>        <span class="p">}</span>
</span><span id="databases_download_dbnsfp-2028"><a href="#databases_download_dbnsfp-2028"><span class="linenos">2028</span></a>
</span><span id="databases_download_dbnsfp-2029"><a href="#databases_download_dbnsfp-2029"><span class="linenos">2029</span></a>        <span class="c1"># Extract annotation description</span>
</span><span id="databases_download_dbnsfp-2030"><a href="#databases_download_dbnsfp-2030"><span class="linenos">2030</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2031"><a href="#databases_download_dbnsfp-2031"><span class="linenos">2031</span></a>            <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="n">get_annotation_description</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2032"><a href="#databases_download_dbnsfp-2032"><span class="linenos">2032</span></a>                <span class="n">dbnsfp_readme_dest</span>
</span><span id="databases_download_dbnsfp-2033"><a href="#databases_download_dbnsfp-2033"><span class="linenos">2033</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2034"><a href="#databases_download_dbnsfp-2034"><span class="linenos">2034</span></a>
</span><span id="databases_download_dbnsfp-2035"><a href="#databases_download_dbnsfp-2035"><span class="linenos">2035</span></a>        <span class="c1"># Number of annotations</span>
</span><span id="databases_download_dbnsfp-2036"><a href="#databases_download_dbnsfp-2036"><span class="linenos">2036</span></a>        <span class="c1"># log.debug(f&quot;&quot;&quot;{len(readme_annotations_description)} annotations found &quot;&quot;&quot;)</span>
</span><span id="databases_download_dbnsfp-2037"><a href="#databases_download_dbnsfp-2037"><span class="linenos">2037</span></a>
</span><span id="databases_download_dbnsfp-2038"><a href="#databases_download_dbnsfp-2038"><span class="linenos">2038</span></a>        <span class="c1"># Add annotations to header</span>
</span><span id="databases_download_dbnsfp-2039"><a href="#databases_download_dbnsfp-2039"><span class="linenos">2039</span></a>        <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2040"><a href="#databases_download_dbnsfp-2040"><span class="linenos">2040</span></a>            <span class="n">annotation_name</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2041"><a href="#databases_download_dbnsfp-2041"><span class="linenos">2041</span></a>
</span><span id="databases_download_dbnsfp-2042"><a href="#databases_download_dbnsfp-2042"><span class="linenos">2042</span></a>            <span class="k">if</span> <span class="n">annotation_name</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2043"><a href="#databases_download_dbnsfp-2043"><span class="linenos">2043</span></a>                <span class="n">vcf_header_infos_number</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Number&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2044"><a href="#databases_download_dbnsfp-2044"><span class="linenos">2044</span></a>                    <span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span>
</span><span id="databases_download_dbnsfp-2045"><a href="#databases_download_dbnsfp-2045"><span class="linenos">2045</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2046"><a href="#databases_download_dbnsfp-2046"><span class="linenos">2046</span></a>                <span class="n">vcf_header_infos_type</span> <span class="o">=</span> <span class="n">code_type_map_from_sql</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2047"><a href="#databases_download_dbnsfp-2047"><span class="linenos">2047</span></a>                    <span class="n">columns_structure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;VARCHAR&quot;</span><span class="p">),</span> <span class="s2">&quot;String&quot;</span>
</span><span id="databases_download_dbnsfp-2048"><a href="#databases_download_dbnsfp-2048"><span class="linenos">2048</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2049"><a href="#databases_download_dbnsfp-2049"><span class="linenos">2049</span></a>                <span class="n">vcf_header_infos_description</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-2050"><a href="#databases_download_dbnsfp-2050"><span class="linenos">2050</span></a>                    <span class="n">readme_annotations_description</span><span class="p">[</span><span class="n">annotation</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-2051"><a href="#databases_download_dbnsfp-2051"><span class="linenos">2051</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; [dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="databases_download_dbnsfp-2052"><a href="#databases_download_dbnsfp-2052"><span class="linenos">2052</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2053"><a href="#databases_download_dbnsfp-2053"><span class="linenos">2053</span></a>                <span class="n">vcf_header_infos_source</span> <span class="o">=</span> <span class="n">dbnsfp_release</span>
</span><span id="databases_download_dbnsfp-2054"><a href="#databases_download_dbnsfp-2054"><span class="linenos">2054</span></a>                <span class="n">vcf_header_infos_version</span> <span class="o">=</span> <span class="n">dbnsfp_release</span>
</span><span id="databases_download_dbnsfp-2055"><a href="#databases_download_dbnsfp-2055"><span class="linenos">2055</span></a>
</span><span id="databases_download_dbnsfp-2056"><a href="#databases_download_dbnsfp-2056"><span class="linenos">2056</span></a>                <span class="n">header_vcf</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_Info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2057"><a href="#databases_download_dbnsfp-2057"><span class="linenos">2057</span></a>                    <span class="n">annotation_name</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2058"><a href="#databases_download_dbnsfp-2058"><span class="linenos">2058</span></a>                    <span class="n">vcf_header_infos_number</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2059"><a href="#databases_download_dbnsfp-2059"><span class="linenos">2059</span></a>                    <span class="n">vcf_header_infos_type</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2060"><a href="#databases_download_dbnsfp-2060"><span class="linenos">2060</span></a>                    <span class="n">vcf_header_infos_description</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2061"><a href="#databases_download_dbnsfp-2061"><span class="linenos">2061</span></a>                    <span class="n">vcf_header_infos_source</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2062"><a href="#databases_download_dbnsfp-2062"><span class="linenos">2062</span></a>                    <span class="n">vcf_header_infos_version</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2063"><a href="#databases_download_dbnsfp-2063"><span class="linenos">2063</span></a>                    <span class="n">code_type_map</span><span class="p">[</span><span class="n">vcf_header_infos_type</span><span class="p">],</span>
</span><span id="databases_download_dbnsfp-2064"><a href="#databases_download_dbnsfp-2064"><span class="linenos">2064</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2065"><a href="#databases_download_dbnsfp-2065"><span class="linenos">2065</span></a>
</span><span id="databases_download_dbnsfp-2066"><a href="#databases_download_dbnsfp-2066"><span class="linenos">2066</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2067"><a href="#databases_download_dbnsfp-2067"><span class="linenos">2067</span></a>        <span class="n">vcf</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">header_vcf</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2068"><a href="#databases_download_dbnsfp-2068"><span class="linenos">2068</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2069"><a href="#databases_download_dbnsfp-2069"><span class="linenos">2069</span></a>
</span><span id="databases_download_dbnsfp-2070"><a href="#databases_download_dbnsfp-2070"><span class="linenos">2070</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">header_file</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2071"><a href="#databases_download_dbnsfp-2071"><span class="linenos">2071</span></a>
</span><span id="databases_download_dbnsfp-2072"><a href="#databases_download_dbnsfp-2072"><span class="linenos">2072</span></a>    <span class="k">def</span> <span class="nf">size_to_mb</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2073"><a href="#databases_download_dbnsfp-2073"><span class="linenos">2073</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2074"><a href="#databases_download_dbnsfp-2074"><span class="linenos">2074</span></a><span class="sd">        The function `size_to_mb` converts a given size in megabytes to bytes.</span>
</span><span id="databases_download_dbnsfp-2075"><a href="#databases_download_dbnsfp-2075"><span class="linenos">2075</span></a>
</span><span id="databases_download_dbnsfp-2076"><a href="#databases_download_dbnsfp-2076"><span class="linenos">2076</span></a><span class="sd">        :param size: The size parameter represents the size of a partition in megabytes</span>
</span><span id="databases_download_dbnsfp-2077"><a href="#databases_download_dbnsfp-2077"><span class="linenos">2077</span></a><span class="sd">        :type size: int</span>
</span><span id="databases_download_dbnsfp-2078"><a href="#databases_download_dbnsfp-2078"><span class="linenos">2078</span></a><span class="sd">        :return: the partition size in megabytes as an integer.</span>
</span><span id="databases_download_dbnsfp-2079"><a href="#databases_download_dbnsfp-2079"><span class="linenos">2079</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2080"><a href="#databases_download_dbnsfp-2080"><span class="linenos">2080</span></a>
</span><span id="databases_download_dbnsfp-2081"><a href="#databases_download_dbnsfp-2081"><span class="linenos">2081</span></a>        <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2082"><a href="#databases_download_dbnsfp-2082"><span class="linenos">2082</span></a>            <span class="n">byte</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="databases_download_dbnsfp-2083"><a href="#databases_download_dbnsfp-2083"><span class="linenos">2083</span></a>            <span class="n">kilobytes</span> <span class="o">=</span> <span class="n">byte</span> <span class="o">*</span> <span class="mi">1024</span>
</span><span id="databases_download_dbnsfp-2084"><a href="#databases_download_dbnsfp-2084"><span class="linenos">2084</span></a>            <span class="n">megabytes</span> <span class="o">=</span> <span class="n">kilobytes</span> <span class="o">*</span> <span class="mi">1024</span>
</span><span id="databases_download_dbnsfp-2085"><a href="#databases_download_dbnsfp-2085"><span class="linenos">2085</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="n">megabytes</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2086"><a href="#databases_download_dbnsfp-2086"><span class="linenos">2086</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2087"><a href="#databases_download_dbnsfp-2087"><span class="linenos">2087</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="databases_download_dbnsfp-2088"><a href="#databases_download_dbnsfp-2088"><span class="linenos">2088</span></a>
</span><span id="databases_download_dbnsfp-2089"><a href="#databases_download_dbnsfp-2089"><span class="linenos">2089</span></a>    <span class="c1"># Init</span>
</span><span id="databases_download_dbnsfp-2090"><a href="#databases_download_dbnsfp-2090"><span class="linenos">2090</span></a>    <span class="n">partition_size</span> <span class="o">=</span> <span class="n">size_to_mb</span><span class="p">(</span><span class="n">parquet_size</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2091"><a href="#databases_download_dbnsfp-2091"><span class="linenos">2091</span></a>    <span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000000</span>
</span><span id="databases_download_dbnsfp-2092"><a href="#databases_download_dbnsfp-2092"><span class="linenos">2092</span></a>    <span class="n">database_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2093"><a href="#databases_download_dbnsfp-2093"><span class="linenos">2093</span></a>    <span class="n">columns_structure</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-2094"><a href="#databases_download_dbnsfp-2094"><span class="linenos">2094</span></a>    <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_dbnsfp-2095"><a href="#databases_download_dbnsfp-2095"><span class="linenos">2095</span></a>
</span><span id="databases_download_dbnsfp-2096"><a href="#databases_download_dbnsfp-2096"><span class="linenos">2096</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">threads</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2097"><a href="#databases_download_dbnsfp-2097"><span class="linenos">2097</span></a>        <span class="n">threads</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2098"><a href="#databases_download_dbnsfp-2098"><span class="linenos">2098</span></a>    <span class="n">threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2099"><a href="#databases_download_dbnsfp-2099"><span class="linenos">2099</span></a>
</span><span id="databases_download_dbnsfp-2100"><a href="#databases_download_dbnsfp-2100"><span class="linenos">2100</span></a>    <span class="c1"># Create duckdb connexion</span>
</span><span id="databases_download_dbnsfp-2101"><a href="#databases_download_dbnsfp-2101"><span class="linenos">2101</span></a>    <span class="n">db</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="databases_download_dbnsfp-2102"><a href="#databases_download_dbnsfp-2102"><span class="linenos">2102</span></a>
</span><span id="databases_download_dbnsfp-2103"><a href="#databases_download_dbnsfp-2103"><span class="linenos">2103</span></a>    <span class="n">parquet_partition_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2104"><a href="#databases_download_dbnsfp-2104"><span class="linenos">2104</span></a>    <span class="n">parquet_partition_already_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2105"><a href="#databases_download_dbnsfp-2105"><span class="linenos">2105</span></a>    <span class="n">parquet_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2106"><a href="#databases_download_dbnsfp-2106"><span class="linenos">2106</span></a>    <span class="n">parquet_already_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2107"><a href="#databases_download_dbnsfp-2107"><span class="linenos">2107</span></a>    <span class="n">vcf_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2108"><a href="#databases_download_dbnsfp-2108"><span class="linenos">2108</span></a>    <span class="n">vcf_already_generated_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2109"><a href="#databases_download_dbnsfp-2109"><span class="linenos">2109</span></a>
</span><span id="databases_download_dbnsfp-2110"><a href="#databases_download_dbnsfp-2110"><span class="linenos">2110</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2111"><a href="#databases_download_dbnsfp-2111"><span class="linenos">2111</span></a>
</span><span id="databases_download_dbnsfp-2112"><a href="#databases_download_dbnsfp-2112"><span class="linenos">2112</span></a>        <span class="n">output_assembly</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-2113"><a href="#databases_download_dbnsfp-2113"><span class="linenos">2113</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_assembly</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2114"><a href="#databases_download_dbnsfp-2114"><span class="linenos">2114</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet folder already exists&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2115"><a href="#databases_download_dbnsfp-2115"><span class="linenos">2115</span></a>            <span class="k">continue</span>
</span><span id="databases_download_dbnsfp-2116"><a href="#databases_download_dbnsfp-2116"><span class="linenos">2116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2117"><a href="#databases_download_dbnsfp-2117"><span class="linenos">2117</span></a>            <span class="c1"># Create output chromosome</span>
</span><span id="databases_download_dbnsfp-2118"><a href="#databases_download_dbnsfp-2118"><span class="linenos">2118</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">output_assembly</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2119"><a href="#databases_download_dbnsfp-2119"><span class="linenos">2119</span></a>
</span><span id="databases_download_dbnsfp-2120"><a href="#databases_download_dbnsfp-2120"><span class="linenos">2120</span></a>        <span class="c1"># Check database files</span>
</span><span id="databases_download_dbnsfp-2121"><a href="#databases_download_dbnsfp-2121"><span class="linenos">2121</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files...&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2122"><a href="#databases_download_dbnsfp-2122"><span class="linenos">2122</span></a>        <span class="n">database_files</span> <span class="o">=</span> <span class="n">get_database_files</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2123"><a href="#databases_download_dbnsfp-2123"><span class="linenos">2123</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_zip_dest_folder</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">_variant.chr*.gz&quot;</span>
</span><span id="databases_download_dbnsfp-2124"><a href="#databases_download_dbnsfp-2124"><span class="linenos">2124</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2125"><a href="#databases_download_dbnsfp-2125"><span class="linenos">2125</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2126"><a href="#databases_download_dbnsfp-2126"><span class="linenos">2126</span></a>            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">database_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files&quot;</span>
</span><span id="databases_download_dbnsfp-2127"><a href="#databases_download_dbnsfp-2127"><span class="linenos">2127</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2128"><a href="#databases_download_dbnsfp-2128"><span class="linenos">2128</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">database_files</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2129"><a href="#databases_download_dbnsfp-2129"><span class="linenos">2129</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2130"><a href="#databases_download_dbnsfp-2130"><span class="linenos">2130</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files - No files found&quot;</span>
</span><span id="databases_download_dbnsfp-2131"><a href="#databases_download_dbnsfp-2131"><span class="linenos">2131</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2132"><a href="#databases_download_dbnsfp-2132"><span class="linenos">2132</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2133"><a href="#databases_download_dbnsfp-2133"><span class="linenos">2133</span></a>                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Check database files - No files found&quot;</span>
</span><span id="databases_download_dbnsfp-2134"><a href="#databases_download_dbnsfp-2134"><span class="linenos">2134</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2135"><a href="#databases_download_dbnsfp-2135"><span class="linenos">2135</span></a>
</span><span id="databases_download_dbnsfp-2136"><a href="#databases_download_dbnsfp-2136"><span class="linenos">2136</span></a>        <span class="c1"># Database structure</span>
</span><span id="databases_download_dbnsfp-2137"><a href="#databases_download_dbnsfp-2137"><span class="linenos">2137</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2138"><a href="#databases_download_dbnsfp-2138"><span class="linenos">2138</span></a>            <span class="n">columns_structure</span> <span class="o">=</span> <span class="n">get_columns_structure</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2139"><a href="#databases_download_dbnsfp-2139"><span class="linenos">2139</span></a>                <span class="n">database_file</span><span class="o">=</span><span class="n">database_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="databases_download_dbnsfp-2140"><a href="#databases_download_dbnsfp-2140"><span class="linenos">2140</span></a>                <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2141"><a href="#databases_download_dbnsfp-2141"><span class="linenos">2141</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2142"><a href="#databases_download_dbnsfp-2142"><span class="linenos">2142</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2143"><a href="#databases_download_dbnsfp-2143"><span class="linenos">2143</span></a>
</span><span id="databases_download_dbnsfp-2144"><a href="#databases_download_dbnsfp-2144"><span class="linenos">2144</span></a>        <span class="c1"># Output prefix</span>
</span><span id="databases_download_dbnsfp-2145"><a href="#databases_download_dbnsfp-2145"><span class="linenos">2145</span></a>        <span class="n">output_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-2146"><a href="#databases_download_dbnsfp-2146"><span class="linenos">2146</span></a>
</span><span id="databases_download_dbnsfp-2147"><a href="#databases_download_dbnsfp-2147"><span class="linenos">2147</span></a>        <span class="c1"># Sub database</span>
</span><span id="databases_download_dbnsfp-2148"><a href="#databases_download_dbnsfp-2148"><span class="linenos">2148</span></a>        <span class="n">sub_database</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
</span><span id="databases_download_dbnsfp-2149"><a href="#databases_download_dbnsfp-2149"><span class="linenos">2149</span></a>
</span><span id="databases_download_dbnsfp-2150"><a href="#databases_download_dbnsfp-2150"><span class="linenos">2150</span></a>        <span class="c1"># Create clauses (select and where)</span>
</span><span id="databases_download_dbnsfp-2151"><a href="#databases_download_dbnsfp-2151"><span class="linenos">2151</span></a>        <span class="n">columns_clauses</span> <span class="o">=</span> <span class="n">get_columns_select_clause</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2152"><a href="#databases_download_dbnsfp-2152"><span class="linenos">2152</span></a>            <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">],</span>
</span><span id="databases_download_dbnsfp-2153"><a href="#databases_download_dbnsfp-2153"><span class="linenos">2153</span></a>            <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2154"><a href="#databases_download_dbnsfp-2154"><span class="linenos">2154</span></a>            <span class="n">sub_database</span><span class="o">=</span><span class="n">sub_database</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2155"><a href="#databases_download_dbnsfp-2155"><span class="linenos">2155</span></a>            <span class="n">add_info</span><span class="o">=</span><span class="n">add_info</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2156"><a href="#databases_download_dbnsfp-2156"><span class="linenos">2156</span></a>            <span class="n">only_info</span><span class="o">=</span><span class="n">only_info</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2157"><a href="#databases_download_dbnsfp-2157"><span class="linenos">2157</span></a>            <span class="n">uniquify</span><span class="o">=</span><span class="n">uniquify</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2158"><a href="#databases_download_dbnsfp-2158"><span class="linenos">2158</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2159"><a href="#databases_download_dbnsfp-2159"><span class="linenos">2159</span></a>        <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2160"><a href="#databases_download_dbnsfp-2160"><span class="linenos">2160</span></a>        <span class="n">columns_annotations</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2161"><a href="#databases_download_dbnsfp-2161"><span class="linenos">2161</span></a>
</span><span id="databases_download_dbnsfp-2162"><a href="#databases_download_dbnsfp-2162"><span class="linenos">2162</span></a>        <span class="c1"># If clause select not empty</span>
</span><span id="databases_download_dbnsfp-2163"><a href="#databases_download_dbnsfp-2163"><span class="linenos">2163</span></a>        <span class="k">if</span> <span class="n">columns_select_clause</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2164"><a href="#databases_download_dbnsfp-2164"><span class="linenos">2164</span></a>
</span><span id="databases_download_dbnsfp-2165"><a href="#databases_download_dbnsfp-2165"><span class="linenos">2165</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2166"><a href="#databases_download_dbnsfp-2166"><span class="linenos">2166</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet folder generation&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2167"><a href="#databases_download_dbnsfp-2167"><span class="linenos">2167</span></a>
</span><span id="databases_download_dbnsfp-2168"><a href="#databases_download_dbnsfp-2168"><span class="linenos">2168</span></a>            <span class="c1"># Process database files</span>
</span><span id="databases_download_dbnsfp-2169"><a href="#databases_download_dbnsfp-2169"><span class="linenos">2169</span></a>            <span class="k">for</span> <span class="n">database_file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2170"><a href="#databases_download_dbnsfp-2170"><span class="linenos">2170</span></a>                <span class="n">database_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
</span><span id="databases_download_dbnsfp-2171"><a href="#databases_download_dbnsfp-2171"><span class="linenos">2171</span></a>            <span class="p">):</span>
</span><span id="databases_download_dbnsfp-2172"><a href="#databases_download_dbnsfp-2172"><span class="linenos">2172</span></a>
</span><span id="databases_download_dbnsfp-2173"><a href="#databases_download_dbnsfp-2173"><span class="linenos">2173</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2174"><a href="#databases_download_dbnsfp-2174"><span class="linenos">2174</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2175"><a href="#databases_download_dbnsfp-2175"><span class="linenos">2175</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2176"><a href="#databases_download_dbnsfp-2176"><span class="linenos">2176</span></a>
</span><span id="databases_download_dbnsfp-2177"><a href="#databases_download_dbnsfp-2177"><span class="linenos">2177</span></a>                <span class="c1"># Chromosome</span>
</span><span id="databases_download_dbnsfp-2178"><a href="#databases_download_dbnsfp-2178"><span class="linenos">2178</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2179"><a href="#databases_download_dbnsfp-2179"><span class="linenos">2179</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Check chomosome...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2180"><a href="#databases_download_dbnsfp-2180"><span class="linenos">2180</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2181"><a href="#databases_download_dbnsfp-2181"><span class="linenos">2181</span></a>                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2182"><a href="#databases_download_dbnsfp-2182"><span class="linenos">2182</span></a><span class="s2">                            SELECT &quot;#chr&quot;</span>
</span><span id="databases_download_dbnsfp-2183"><a href="#databases_download_dbnsfp-2183"><span class="linenos">2183</span></a><span class="s2">                            FROM read_csv_auto(&#39;</span><span class="si">{</span><span class="n">database_file</span><span class="si">}</span><span class="s2">&#39;, compression=gzip, ALL_VARCHAR=1, delim=&#39;</span><span class="se">\t</span><span class="s2">&#39;, nullstr=&#39;.&#39;, SAMPLE_SIZE=10)</span>
</span><span id="databases_download_dbnsfp-2184"><a href="#databases_download_dbnsfp-2184"><span class="linenos">2184</span></a><span class="s2">                            WHERE </span><span class="se">\&quot;</span><span class="s2">#chr</span><span class="se">\&quot;</span><span class="s2"> IS NOT NULL</span>
</span><span id="databases_download_dbnsfp-2185"><a href="#databases_download_dbnsfp-2185"><span class="linenos">2185</span></a><span class="s2">                            LIMIT 1</span>
</span><span id="databases_download_dbnsfp-2186"><a href="#databases_download_dbnsfp-2186"><span class="linenos">2186</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2187"><a href="#databases_download_dbnsfp-2187"><span class="linenos">2187</span></a>                <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2188"><a href="#databases_download_dbnsfp-2188"><span class="linenos">2188</span></a>                <span class="n">chromosome</span> <span class="o">=</span> <span class="s2">&quot;chr&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;#chr&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="databases_download_dbnsfp-2189"><a href="#databases_download_dbnsfp-2189"><span class="linenos">2189</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2190"><a href="#databases_download_dbnsfp-2190"><span class="linenos">2190</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Found chromosome &#39;</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2191"><a href="#databases_download_dbnsfp-2191"><span class="linenos">2191</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2192"><a href="#databases_download_dbnsfp-2192"><span class="linenos">2192</span></a>
</span><span id="databases_download_dbnsfp-2193"><a href="#databases_download_dbnsfp-2193"><span class="linenos">2193</span></a>                <span class="c1"># Output</span>
</span><span id="databases_download_dbnsfp-2194"><a href="#databases_download_dbnsfp-2194"><span class="linenos">2194</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.partition.parquet&quot;</span>
</span><span id="databases_download_dbnsfp-2195"><a href="#databases_download_dbnsfp-2195"><span class="linenos">2195</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2196"><a href="#databases_download_dbnsfp-2196"><span class="linenos">2196</span></a>                    <span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2197"><a href="#databases_download_dbnsfp-2197"><span class="linenos">2197</span></a>                <span class="n">output_parquet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;#CHROM=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2198"><a href="#databases_download_dbnsfp-2198"><span class="linenos">2198</span></a>
</span><span id="databases_download_dbnsfp-2199"><a href="#databases_download_dbnsfp-2199"><span class="linenos">2199</span></a>                <span class="c1"># Query</span>
</span><span id="databases_download_dbnsfp-2200"><a href="#databases_download_dbnsfp-2200"><span class="linenos">2200</span></a>                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2201"><a href="#databases_download_dbnsfp-2201"><span class="linenos">2201</span></a><span class="s2">                        COPY (</span>
</span><span id="databases_download_dbnsfp-2202"><a href="#databases_download_dbnsfp-2202"><span class="linenos">2202</span></a><span class="s2">                            SELECT </span><span class="si">{</span><span class="n">columns_select_clause</span><span class="si">}</span>
</span><span id="databases_download_dbnsfp-2203"><a href="#databases_download_dbnsfp-2203"><span class="linenos">2203</span></a><span class="s2">                            FROM read_csv_auto(</span>
</span><span id="databases_download_dbnsfp-2204"><a href="#databases_download_dbnsfp-2204"><span class="linenos">2204</span></a><span class="s2">                                &#39;</span><span class="si">{</span><span class="n">database_file</span><span class="si">}</span><span class="s2">&#39;,</span>
</span><span id="databases_download_dbnsfp-2205"><a href="#databases_download_dbnsfp-2205"><span class="linenos">2205</span></a><span class="s2">                                header=1,</span>
</span><span id="databases_download_dbnsfp-2206"><a href="#databases_download_dbnsfp-2206"><span class="linenos">2206</span></a><span class="s2">                                delim=&#39;</span><span class="se">\t</span><span class="s2">&#39;,</span>
</span><span id="databases_download_dbnsfp-2207"><a href="#databases_download_dbnsfp-2207"><span class="linenos">2207</span></a><span class="s2">                                compression=gzip,</span>
</span><span id="databases_download_dbnsfp-2208"><a href="#databases_download_dbnsfp-2208"><span class="linenos">2208</span></a><span class="s2">                                nullstr=&#39;.&#39;,</span>
</span><span id="databases_download_dbnsfp-2209"><a href="#databases_download_dbnsfp-2209"><span class="linenos">2209</span></a><span class="s2">                                columns=</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span>
</span><span id="databases_download_dbnsfp-2210"><a href="#databases_download_dbnsfp-2210"><span class="linenos">2210</span></a><span class="s2">                                types=</span><span class="si">{</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]</span><span class="si">}</span>
</span><span id="databases_download_dbnsfp-2211"><a href="#databases_download_dbnsfp-2211"><span class="linenos">2211</span></a><span class="s2">                                )</span>
</span><span id="databases_download_dbnsfp-2212"><a href="#databases_download_dbnsfp-2212"><span class="linenos">2212</span></a><span class="s2">                            WHERE </span><span class="se">\&quot;</span><span class="s2">#CHROM</span><span class="se">\&quot;</span><span class="s2"> IS NOT NULL</span>
</span><span id="databases_download_dbnsfp-2213"><a href="#databases_download_dbnsfp-2213"><span class="linenos">2213</span></a><span class="s2">                            )</span>
</span><span id="databases_download_dbnsfp-2214"><a href="#databases_download_dbnsfp-2214"><span class="linenos">2214</span></a><span class="s2">                        TO &#39;</span><span class="si">{</span><span class="n">output_parquet</span><span class="si">}</span><span class="s2">&#39; WITH (FORMAT PARQUET, PER_THREAD_OUTPUT TRUE, ROW_GROUP_SIZE </span><span class="si">{</span><span class="n">row_group_size</span><span class="si">}</span><span class="s2">)</span>
</span><span id="databases_download_dbnsfp-2215"><a href="#databases_download_dbnsfp-2215"><span class="linenos">2215</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2216"><a href="#databases_download_dbnsfp-2216"><span class="linenos">2216</span></a>
</span><span id="databases_download_dbnsfp-2217"><a href="#databases_download_dbnsfp-2217"><span class="linenos">2217</span></a>                <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2218"><a href="#databases_download_dbnsfp-2218"><span class="linenos">2218</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2219"><a href="#databases_download_dbnsfp-2219"><span class="linenos">2219</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Write parquet files...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2220"><a href="#databases_download_dbnsfp-2220"><span class="linenos">2220</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2221"><a href="#databases_download_dbnsfp-2221"><span class="linenos">2221</span></a>
</span><span id="databases_download_dbnsfp-2222"><a href="#databases_download_dbnsfp-2222"><span class="linenos">2222</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_parquet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2223"><a href="#databases_download_dbnsfp-2223"><span class="linenos">2223</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2224"><a href="#databases_download_dbnsfp-2224"><span class="linenos">2224</span></a>                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Parquet file already exists&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2225"><a href="#databases_download_dbnsfp-2225"><span class="linenos">2225</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2226"><a href="#databases_download_dbnsfp-2226"><span class="linenos">2226</span></a>
</span><span id="databases_download_dbnsfp-2227"><a href="#databases_download_dbnsfp-2227"><span class="linenos">2227</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2228"><a href="#databases_download_dbnsfp-2228"><span class="linenos">2228</span></a>
</span><span id="databases_download_dbnsfp-2229"><a href="#databases_download_dbnsfp-2229"><span class="linenos">2229</span></a>                    <span class="c1"># Query</span>
</span><span id="databases_download_dbnsfp-2230"><a href="#databases_download_dbnsfp-2230"><span class="linenos">2230</span></a>                    <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="databases_download_dbnsfp-2231"><a href="#databases_download_dbnsfp-2231"><span class="linenos">2231</span></a>                    <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2232"><a href="#databases_download_dbnsfp-2232"><span class="linenos">2232</span></a>                    <span class="n">db_copy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2233"><a href="#databases_download_dbnsfp-2233"><span class="linenos">2233</span></a>
</span><span id="databases_download_dbnsfp-2234"><a href="#databases_download_dbnsfp-2234"><span class="linenos">2234</span></a>                    <span class="c1"># # Split parquet to max size</span>
</span><span id="databases_download_dbnsfp-2235"><a href="#databases_download_dbnsfp-2235"><span class="linenos">2235</span></a>                    <span class="k">if</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2236"><a href="#databases_download_dbnsfp-2236"><span class="linenos">2236</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2237"><a href="#databases_download_dbnsfp-2237"><span class="linenos">2237</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Split parquet files...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2238"><a href="#databases_download_dbnsfp-2238"><span class="linenos">2238</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2239"><a href="#databases_download_dbnsfp-2239"><span class="linenos">2239</span></a>                        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2240"><a href="#databases_download_dbnsfp-2240"><span class="linenos">2240</span></a>                            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2241"><a href="#databases_download_dbnsfp-2241"><span class="linenos">2241</span></a>                            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
</span><span id="databases_download_dbnsfp-2242"><a href="#databases_download_dbnsfp-2242"><span class="linenos">2242</span></a>                            <span class="n">file_base</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2243"><a href="#databases_download_dbnsfp-2243"><span class="linenos">2243</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2244"><a href="#databases_download_dbnsfp-2244"><span class="linenos">2244</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Split parquet files [&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;]...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2245"><a href="#databases_download_dbnsfp-2245"><span class="linenos">2245</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2246"><a href="#databases_download_dbnsfp-2246"><span class="linenos">2246</span></a>                            <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2247"><a href="#databases_download_dbnsfp-2247"><span class="linenos">2247</span></a>                                <span class="n">schema</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">schema_arrow</span>
</span><span id="databases_download_dbnsfp-2248"><a href="#databases_download_dbnsfp-2248"><span class="linenos">2248</span></a>                                <span class="n">dd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2249"><a href="#databases_download_dbnsfp-2249"><span class="linenos">2249</span></a>                                    <span class="n">partition_size</span><span class="o">=</span><span class="n">partition_size</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="databases_download_dbnsfp-2250"><a href="#databases_download_dbnsfp-2250"><span class="linenos">2250</span></a>                                <span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2251"><a href="#databases_download_dbnsfp-2251"><span class="linenos">2251</span></a>                                    <span class="n">output_parquet</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2252"><a href="#databases_download_dbnsfp-2252"><span class="linenos">2252</span></a>                                    <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2253"><a href="#databases_download_dbnsfp-2253"><span class="linenos">2253</span></a>                                    <span class="n">name_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_base</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2254"><a href="#databases_download_dbnsfp-2254"><span class="linenos">2254</span></a>                                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2255"><a href="#databases_download_dbnsfp-2255"><span class="linenos">2255</span></a>                                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2256"><a href="#databases_download_dbnsfp-2256"><span class="linenos">2256</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2257"><a href="#databases_download_dbnsfp-2257"><span class="linenos">2257</span></a>                                <span class="n">new_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2258"><a href="#databases_download_dbnsfp-2258"><span class="linenos">2258</span></a>                                    <span class="n">output_parquet</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2259"><a href="#databases_download_dbnsfp-2259"><span class="linenos">2259</span></a>                                    <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;-0.parquet&quot;</span><span class="p">),</span>
</span><span id="databases_download_dbnsfp-2260"><a href="#databases_download_dbnsfp-2260"><span class="linenos">2260</span></a>                                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2261"><a href="#databases_download_dbnsfp-2261"><span class="linenos">2261</span></a>                                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_file_name</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2262"><a href="#databases_download_dbnsfp-2262"><span class="linenos">2262</span></a>
</span><span id="databases_download_dbnsfp-2263"><a href="#databases_download_dbnsfp-2263"><span class="linenos">2263</span></a>                    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2264"><a href="#databases_download_dbnsfp-2264"><span class="linenos">2264</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2265"><a href="#databases_download_dbnsfp-2265"><span class="linenos">2265</span></a>                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Process file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; - Write parquet file - done.&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2266"><a href="#databases_download_dbnsfp-2266"><span class="linenos">2266</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2267"><a href="#databases_download_dbnsfp-2267"><span class="linenos">2267</span></a>
</span><span id="databases_download_dbnsfp-2268"><a href="#databases_download_dbnsfp-2268"><span class="linenos">2268</span></a>            <span class="c1"># Header</span>
</span><span id="databases_download_dbnsfp-2269"><a href="#databases_download_dbnsfp-2269"><span class="linenos">2269</span></a>            <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_dbnsfp-2270"><a href="#databases_download_dbnsfp-2270"><span class="linenos">2270</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">header_file</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2271"><a href="#databases_download_dbnsfp-2271"><span class="linenos">2271</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2272"><a href="#databases_download_dbnsfp-2272"><span class="linenos">2272</span></a>                    <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="n">get_annotation_description</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2273"><a href="#databases_download_dbnsfp-2273"><span class="linenos">2273</span></a>                        <span class="n">dbnsfp_readme_dest</span>
</span><span id="databases_download_dbnsfp-2274"><a href="#databases_download_dbnsfp-2274"><span class="linenos">2274</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2275"><a href="#databases_download_dbnsfp-2275"><span class="linenos">2275</span></a>                <span class="k">if</span> <span class="n">get_header</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2276"><a href="#databases_download_dbnsfp-2276"><span class="linenos">2276</span></a>                    <span class="n">header_file</span><span class="o">=</span><span class="n">header_file</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2277"><a href="#databases_download_dbnsfp-2277"><span class="linenos">2277</span></a>                    <span class="n">dbnsfp_readme_dest</span><span class="o">=</span><span class="n">dbnsfp_readme_dest</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2278"><a href="#databases_download_dbnsfp-2278"><span class="linenos">2278</span></a>                    <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2279"><a href="#databases_download_dbnsfp-2279"><span class="linenos">2279</span></a>                    <span class="n">annotations</span><span class="o">=</span><span class="n">columns_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
</span><span id="databases_download_dbnsfp-2280"><a href="#databases_download_dbnsfp-2280"><span class="linenos">2280</span></a>                    <span class="n">readme_annotations_description</span><span class="o">=</span><span class="n">readme_annotations_description</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2281"><a href="#databases_download_dbnsfp-2281"><span class="linenos">2281</span></a>                <span class="p">):</span>
</span><span id="databases_download_dbnsfp-2282"><a href="#databases_download_dbnsfp-2282"><span class="linenos">2282</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2283"><a href="#databases_download_dbnsfp-2283"><span class="linenos">2283</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Write header&quot;</span>
</span><span id="databases_download_dbnsfp-2284"><a href="#databases_download_dbnsfp-2284"><span class="linenos">2284</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2285"><a href="#databases_download_dbnsfp-2285"><span class="linenos">2285</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2286"><a href="#databases_download_dbnsfp-2286"><span class="linenos">2286</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2287"><a href="#databases_download_dbnsfp-2287"><span class="linenos">2287</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Write header failed&quot;</span>
</span><span id="databases_download_dbnsfp-2288"><a href="#databases_download_dbnsfp-2288"><span class="linenos">2288</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2289"><a href="#databases_download_dbnsfp-2289"><span class="linenos">2289</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2290"><a href="#databases_download_dbnsfp-2290"><span class="linenos">2290</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Write header failed&quot;</span>
</span><span id="databases_download_dbnsfp-2291"><a href="#databases_download_dbnsfp-2291"><span class="linenos">2291</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2292"><a href="#databases_download_dbnsfp-2292"><span class="linenos">2292</span></a>
</span><span id="databases_download_dbnsfp-2293"><a href="#databases_download_dbnsfp-2293"><span class="linenos">2293</span></a>    <span class="k">if</span> <span class="n">generate_sub_databases</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2294"><a href="#databases_download_dbnsfp-2294"><span class="linenos">2294</span></a>
</span><span id="databases_download_dbnsfp-2295"><a href="#databases_download_dbnsfp-2295"><span class="linenos">2295</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2296"><a href="#databases_download_dbnsfp-2296"><span class="linenos">2296</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet folders generation&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2297"><a href="#databases_download_dbnsfp-2297"><span class="linenos">2297</span></a>
</span><span id="databases_download_dbnsfp-2298"><a href="#databases_download_dbnsfp-2298"><span class="linenos">2298</span></a>        <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2299"><a href="#databases_download_dbnsfp-2299"><span class="linenos">2299</span></a>
</span><span id="databases_download_dbnsfp-2300"><a href="#databases_download_dbnsfp-2300"><span class="linenos">2300</span></a>            <span class="c1"># Find database structure</span>
</span><span id="databases_download_dbnsfp-2301"><a href="#databases_download_dbnsfp-2301"><span class="linenos">2301</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">database_files</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2302"><a href="#databases_download_dbnsfp-2302"><span class="linenos">2302</span></a>                <span class="n">database_files</span> <span class="o">=</span> <span class="n">get_database_files</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2303"><a href="#databases_download_dbnsfp-2303"><span class="linenos">2303</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_zip_dest_folder</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">_variant.chr*.gz&quot;</span>
</span><span id="databases_download_dbnsfp-2304"><a href="#databases_download_dbnsfp-2304"><span class="linenos">2304</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2305"><a href="#databases_download_dbnsfp-2305"><span class="linenos">2305</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">database_files</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2306"><a href="#databases_download_dbnsfp-2306"><span class="linenos">2306</span></a>                <span class="n">columns_structure</span> <span class="o">=</span> <span class="n">get_columns_structure</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2307"><a href="#databases_download_dbnsfp-2307"><span class="linenos">2307</span></a>                    <span class="n">database_file</span><span class="o">=</span><span class="n">database_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="databases_download_dbnsfp-2308"><a href="#databases_download_dbnsfp-2308"><span class="linenos">2308</span></a>                    <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2309"><a href="#databases_download_dbnsfp-2309"><span class="linenos">2309</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2310"><a href="#databases_download_dbnsfp-2310"><span class="linenos">2310</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2311"><a href="#databases_download_dbnsfp-2311"><span class="linenos">2311</span></a>                <span class="c1"># columns_structure_vcf = get_columns_structure(</span>
</span><span id="databases_download_dbnsfp-2312"><a href="#databases_download_dbnsfp-2312"><span class="linenos">2312</span></a>                <span class="c1">#     database_file=database_files[0],</span>
</span><span id="databases_download_dbnsfp-2313"><a href="#databases_download_dbnsfp-2313"><span class="linenos">2313</span></a>                <span class="c1">#     sample_size=sample_size,</span>
</span><span id="databases_download_dbnsfp-2314"><a href="#databases_download_dbnsfp-2314"><span class="linenos">2314</span></a>                <span class="c1">#     threads=threads,</span>
</span><span id="databases_download_dbnsfp-2315"><a href="#databases_download_dbnsfp-2315"><span class="linenos">2315</span></a>                <span class="c1">#     output_type=&quot;VCF&quot;,</span>
</span><span id="databases_download_dbnsfp-2316"><a href="#databases_download_dbnsfp-2316"><span class="linenos">2316</span></a>                <span class="c1"># )</span>
</span><span id="databases_download_dbnsfp-2317"><a href="#databases_download_dbnsfp-2317"><span class="linenos">2317</span></a>
</span><span id="databases_download_dbnsfp-2318"><a href="#databases_download_dbnsfp-2318"><span class="linenos">2318</span></a>            <span class="n">output_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-2319"><a href="#databases_download_dbnsfp-2319"><span class="linenos">2319</span></a>            <span class="n">parquet_all_annotation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-2320"><a href="#databases_download_dbnsfp-2320"><span class="linenos">2320</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.ALL.partition.parquet/*/*.parquet&quot;</span>
</span><span id="databases_download_dbnsfp-2321"><a href="#databases_download_dbnsfp-2321"><span class="linenos">2321</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2322"><a href="#databases_download_dbnsfp-2322"><span class="linenos">2322</span></a>
</span><span id="databases_download_dbnsfp-2323"><a href="#databases_download_dbnsfp-2323"><span class="linenos">2323</span></a>            <span class="n">sub_databases_structure</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-2324"><a href="#databases_download_dbnsfp-2324"><span class="linenos">2324</span></a>
</span><span id="databases_download_dbnsfp-2325"><a href="#databases_download_dbnsfp-2325"><span class="linenos">2325</span></a>            <span class="c1"># Find sub databases</span>
</span><span id="databases_download_dbnsfp-2326"><a href="#databases_download_dbnsfp-2326"><span class="linenos">2326</span></a>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">]:</span>
</span><span id="databases_download_dbnsfp-2327"><a href="#databases_download_dbnsfp-2327"><span class="linenos">2327</span></a>                <span class="n">sub_database</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2328"><a href="#databases_download_dbnsfp-2328"><span class="linenos">2328</span></a>                <span class="k">if</span> <span class="n">sub_database</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sub_databases_structure</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2329"><a href="#databases_download_dbnsfp-2329"><span class="linenos">2329</span></a>                    <span class="n">sub_databases_structure</span><span class="p">[</span><span class="n">sub_database</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-2330"><a href="#databases_download_dbnsfp-2330"><span class="linenos">2330</span></a>                <span class="n">sub_databases_structure</span><span class="p">[</span><span class="n">sub_database</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">][</span>
</span><span id="databases_download_dbnsfp-2331"><a href="#databases_download_dbnsfp-2331"><span class="linenos">2331</span></a>                    <span class="n">column</span>
</span><span id="databases_download_dbnsfp-2332"><a href="#databases_download_dbnsfp-2332"><span class="linenos">2332</span></a>                <span class="p">]</span>
</span><span id="databases_download_dbnsfp-2333"><a href="#databases_download_dbnsfp-2333"><span class="linenos">2333</span></a>
</span><span id="databases_download_dbnsfp-2334"><a href="#databases_download_dbnsfp-2334"><span class="linenos">2334</span></a>            <span class="c1"># Chromosomes</span>
</span><span id="databases_download_dbnsfp-2335"><a href="#databases_download_dbnsfp-2335"><span class="linenos">2335</span></a>            <span class="n">chromosomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2336"><a href="#databases_download_dbnsfp-2336"><span class="linenos">2336</span></a>
</span><span id="databases_download_dbnsfp-2337"><a href="#databases_download_dbnsfp-2337"><span class="linenos">2337</span></a>            <span class="c1"># for each sub database</span>
</span><span id="databases_download_dbnsfp-2338"><a href="#databases_download_dbnsfp-2338"><span class="linenos">2338</span></a>            <span class="k">for</span> <span class="n">sub_database</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2339"><a href="#databases_download_dbnsfp-2339"><span class="linenos">2339</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">sub_databases_structure</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
</span><span id="databases_download_dbnsfp-2340"><a href="#databases_download_dbnsfp-2340"><span class="linenos">2340</span></a>            <span class="p">):</span>
</span><span id="databases_download_dbnsfp-2341"><a href="#databases_download_dbnsfp-2341"><span class="linenos">2341</span></a>
</span><span id="databases_download_dbnsfp-2342"><a href="#databases_download_dbnsfp-2342"><span class="linenos">2342</span></a>                <span class="c1"># Clauses</span>
</span><span id="databases_download_dbnsfp-2343"><a href="#databases_download_dbnsfp-2343"><span class="linenos">2343</span></a>                <span class="n">columns_clauses</span> <span class="o">=</span> <span class="n">get_columns_select_clause</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2344"><a href="#databases_download_dbnsfp-2344"><span class="linenos">2344</span></a>                    <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">],</span>
</span><span id="databases_download_dbnsfp-2345"><a href="#databases_download_dbnsfp-2345"><span class="linenos">2345</span></a>                    <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2346"><a href="#databases_download_dbnsfp-2346"><span class="linenos">2346</span></a>                    <span class="n">for_parquet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2347"><a href="#databases_download_dbnsfp-2347"><span class="linenos">2347</span></a>                    <span class="n">sub_database</span><span class="o">=</span><span class="n">sub_database</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2348"><a href="#databases_download_dbnsfp-2348"><span class="linenos">2348</span></a>                    <span class="n">null_if_no_annotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2349"><a href="#databases_download_dbnsfp-2349"><span class="linenos">2349</span></a>                    <span class="n">print_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2350"><a href="#databases_download_dbnsfp-2350"><span class="linenos">2350</span></a>                    <span class="n">add_info</span><span class="o">=</span><span class="n">add_info</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2351"><a href="#databases_download_dbnsfp-2351"><span class="linenos">2351</span></a>                    <span class="n">only_info</span><span class="o">=</span><span class="n">only_info</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2352"><a href="#databases_download_dbnsfp-2352"><span class="linenos">2352</span></a>                    <span class="n">uniquify</span><span class="o">=</span><span class="n">uniquify</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2353"><a href="#databases_download_dbnsfp-2353"><span class="linenos">2353</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2354"><a href="#databases_download_dbnsfp-2354"><span class="linenos">2354</span></a>                <span class="n">columns_select_clause</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2355"><a href="#databases_download_dbnsfp-2355"><span class="linenos">2355</span></a>                <span class="n">columns_where_clause</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;where&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2356"><a href="#databases_download_dbnsfp-2356"><span class="linenos">2356</span></a>                <span class="n">columns_annotations</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2357"><a href="#databases_download_dbnsfp-2357"><span class="linenos">2357</span></a>
</span><span id="databases_download_dbnsfp-2358"><a href="#databases_download_dbnsfp-2358"><span class="linenos">2358</span></a>                <span class="c1"># Clean sub database name</span>
</span><span id="databases_download_dbnsfp-2359"><a href="#databases_download_dbnsfp-2359"><span class="linenos">2359</span></a>                <span class="n">sub_database_name</span> <span class="o">=</span> <span class="n">clean_name</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2360"><a href="#databases_download_dbnsfp-2360"><span class="linenos">2360</span></a>
</span><span id="databases_download_dbnsfp-2361"><a href="#databases_download_dbnsfp-2361"><span class="linenos">2361</span></a>                <span class="c1"># Parquet folder</span>
</span><span id="databases_download_dbnsfp-2362"><a href="#databases_download_dbnsfp-2362"><span class="linenos">2362</span></a>                <span class="n">parquet_sub_database_annotation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-2363"><a href="#databases_download_dbnsfp-2363"><span class="linenos">2363</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">.partition.parquet&quot;</span>
</span><span id="databases_download_dbnsfp-2364"><a href="#databases_download_dbnsfp-2364"><span class="linenos">2364</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2365"><a href="#databases_download_dbnsfp-2365"><span class="linenos">2365</span></a>
</span><span id="databases_download_dbnsfp-2366"><a href="#databases_download_dbnsfp-2366"><span class="linenos">2366</span></a>                <span class="k">if</span> <span class="n">columns_select_clause</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2367"><a href="#databases_download_dbnsfp-2367"><span class="linenos">2367</span></a>
</span><span id="databases_download_dbnsfp-2368"><a href="#databases_download_dbnsfp-2368"><span class="linenos">2368</span></a>                    <span class="c1"># Parquet Folder</span>
</span><span id="databases_download_dbnsfp-2369"><a href="#databases_download_dbnsfp-2369"><span class="linenos">2369</span></a>                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parquet_sub_database_annotation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2370"><a href="#databases_download_dbnsfp-2370"><span class="linenos">2370</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2371"><a href="#databases_download_dbnsfp-2371"><span class="linenos">2371</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder already exists&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2372"><a href="#databases_download_dbnsfp-2372"><span class="linenos">2372</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2373"><a href="#databases_download_dbnsfp-2373"><span class="linenos">2373</span></a>                        <span class="n">parquet_partition_already_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2374"><a href="#databases_download_dbnsfp-2374"><span class="linenos">2374</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2375"><a href="#databases_download_dbnsfp-2375"><span class="linenos">2375</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2376"><a href="#databases_download_dbnsfp-2376"><span class="linenos">2376</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2377"><a href="#databases_download_dbnsfp-2377"><span class="linenos">2377</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2378"><a href="#databases_download_dbnsfp-2378"><span class="linenos">2378</span></a>
</span><span id="databases_download_dbnsfp-2379"><a href="#databases_download_dbnsfp-2379"><span class="linenos">2379</span></a>                        <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="databases_download_dbnsfp-2380"><a href="#databases_download_dbnsfp-2380"><span class="linenos">2380</span></a>
</span><span id="databases_download_dbnsfp-2381"><a href="#databases_download_dbnsfp-2381"><span class="linenos">2381</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2382"><a href="#databases_download_dbnsfp-2382"><span class="linenos">2382</span></a>                            <span class="n">query_chromosomes</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2383"><a href="#databases_download_dbnsfp-2383"><span class="linenos">2383</span></a><span class="s2">                                SELECT distinct &quot;#CHROM&quot;</span>
</span><span id="databases_download_dbnsfp-2384"><a href="#databases_download_dbnsfp-2384"><span class="linenos">2384</span></a><span class="s2">                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_all_annotation</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="databases_download_dbnsfp-2385"><a href="#databases_download_dbnsfp-2385"><span class="linenos">2385</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2386"><a href="#databases_download_dbnsfp-2386"><span class="linenos">2386</span></a>                            <span class="n">res</span> <span class="o">=</span> <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2387"><a href="#databases_download_dbnsfp-2387"><span class="linenos">2387</span></a>                            <span class="n">chromosomes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;#CHROM&quot;</span><span class="p">]))</span>
</span><span id="databases_download_dbnsfp-2388"><a href="#databases_download_dbnsfp-2388"><span class="linenos">2388</span></a>
</span><span id="databases_download_dbnsfp-2389"><a href="#databases_download_dbnsfp-2389"><span class="linenos">2389</span></a>                        <span class="c1"># Generate folder by chromosome</span>
</span><span id="databases_download_dbnsfp-2390"><a href="#databases_download_dbnsfp-2390"><span class="linenos">2390</span></a>                        <span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2391"><a href="#databases_download_dbnsfp-2391"><span class="linenos">2391</span></a>                            <span class="n">parquet_sub_database_annotation_chromosome</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2392"><a href="#databases_download_dbnsfp-2392"><span class="linenos">2392</span></a>                                <span class="n">parquet_sub_database_annotation</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;#CHROM=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-2393"><a href="#databases_download_dbnsfp-2393"><span class="linenos">2393</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2394"><a href="#databases_download_dbnsfp-2394"><span class="linenos">2394</span></a>                            <span class="n">Path</span><span class="p">(</span><span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2395"><a href="#databases_download_dbnsfp-2395"><span class="linenos">2395</span></a>                                <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="databases_download_dbnsfp-2396"><a href="#databases_download_dbnsfp-2396"><span class="linenos">2396</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2397"><a href="#databases_download_dbnsfp-2397"><span class="linenos">2397</span></a>                            <span class="n">query_copy</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2398"><a href="#databases_download_dbnsfp-2398"><span class="linenos">2398</span></a><span class="s2">                                COPY (</span>
</span><span id="databases_download_dbnsfp-2399"><a href="#databases_download_dbnsfp-2399"><span class="linenos">2399</span></a><span class="s2">                                    SELECT </span><span class="si">{</span><span class="n">columns_select_clause</span><span class="si">}</span>
</span><span id="databases_download_dbnsfp-2400"><a href="#databases_download_dbnsfp-2400"><span class="linenos">2400</span></a><span class="s2">                                        FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_all_annotation</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="databases_download_dbnsfp-2401"><a href="#databases_download_dbnsfp-2401"><span class="linenos">2401</span></a><span class="s2">                                        WHERE &quot;#CHROM&quot; in (&#39;</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="databases_download_dbnsfp-2402"><a href="#databases_download_dbnsfp-2402"><span class="linenos">2402</span></a><span class="s2">                                            AND (</span><span class="si">{</span><span class="n">columns_where_clause</span><span class="si">}</span><span class="s2">)</span>
</span><span id="databases_download_dbnsfp-2403"><a href="#databases_download_dbnsfp-2403"><span class="linenos">2403</span></a><span class="s2">                                    )</span>
</span><span id="databases_download_dbnsfp-2404"><a href="#databases_download_dbnsfp-2404"><span class="linenos">2404</span></a><span class="s2">                                TO &#39;</span><span class="si">{</span><span class="n">parquet_sub_database_annotation_chromosome</span><span class="si">}</span><span class="s2">&#39; WITH (FORMAT PARQUET, PER_THREAD_OUTPUT TRUE, ROW_GROUP_SIZE </span><span class="si">{</span><span class="n">row_group_size</span><span class="si">}</span><span class="s2">)</span>
</span><span id="databases_download_dbnsfp-2405"><a href="#databases_download_dbnsfp-2405"><span class="linenos">2405</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2406"><a href="#databases_download_dbnsfp-2406"><span class="linenos">2406</span></a>                            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_copy</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2407"><a href="#databases_download_dbnsfp-2407"><span class="linenos">2407</span></a>
</span><span id="databases_download_dbnsfp-2408"><a href="#databases_download_dbnsfp-2408"><span class="linenos">2408</span></a>                            <span class="c1"># Split parquet to max size</span>
</span><span id="databases_download_dbnsfp-2409"><a href="#databases_download_dbnsfp-2409"><span class="linenos">2409</span></a>                            <span class="k">if</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2410"><a href="#databases_download_dbnsfp-2410"><span class="linenos">2410</span></a>                                <span class="c1"># log.debug(f&quot;&quot;&quot;Download dbNSFP [&#39;{assembly}&#39;] - Database &#39;{sub_database}&#39; - Parquet folder [&#39;{sub_database_name}&#39;] generation - Split parquet files...&quot;&quot;&quot;)</span>
</span><span id="databases_download_dbnsfp-2411"><a href="#databases_download_dbnsfp-2411"><span class="linenos">2411</span></a>                                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2412"><a href="#databases_download_dbnsfp-2412"><span class="linenos">2412</span></a>                                    <span class="n">parquet_sub_database_annotation_chromosome</span>
</span><span id="databases_download_dbnsfp-2413"><a href="#databases_download_dbnsfp-2413"><span class="linenos">2413</span></a>                                <span class="p">):</span>
</span><span id="databases_download_dbnsfp-2414"><a href="#databases_download_dbnsfp-2414"><span class="linenos">2414</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2415"><a href="#databases_download_dbnsfp-2415"><span class="linenos">2415</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Split parquet files [&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;]...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2416"><a href="#databases_download_dbnsfp-2416"><span class="linenos">2416</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2417"><a href="#databases_download_dbnsfp-2417"><span class="linenos">2417</span></a>                                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2418"><a href="#databases_download_dbnsfp-2418"><span class="linenos">2418</span></a>                                        <span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">,</span> <span class="n">file</span>
</span><span id="databases_download_dbnsfp-2419"><a href="#databases_download_dbnsfp-2419"><span class="linenos">2419</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2420"><a href="#databases_download_dbnsfp-2420"><span class="linenos">2420</span></a>                                    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
</span><span id="databases_download_dbnsfp-2421"><a href="#databases_download_dbnsfp-2421"><span class="linenos">2421</span></a>                                    <span class="n">file_base</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2422"><a href="#databases_download_dbnsfp-2422"><span class="linenos">2422</span></a>                                    <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="n">partition_size</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2423"><a href="#databases_download_dbnsfp-2423"><span class="linenos">2423</span></a>                                        <span class="n">schema</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">schema_arrow</span>
</span><span id="databases_download_dbnsfp-2424"><a href="#databases_download_dbnsfp-2424"><span class="linenos">2424</span></a>                                        <span class="n">dd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2425"><a href="#databases_download_dbnsfp-2425"><span class="linenos">2425</span></a>                                            <span class="n">partition_size</span><span class="o">=</span><span class="n">partition_size</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="databases_download_dbnsfp-2426"><a href="#databases_download_dbnsfp-2426"><span class="linenos">2426</span></a>                                        <span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2427"><a href="#databases_download_dbnsfp-2427"><span class="linenos">2427</span></a>                                            <span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2428"><a href="#databases_download_dbnsfp-2428"><span class="linenos">2428</span></a>                                            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2429"><a href="#databases_download_dbnsfp-2429"><span class="linenos">2429</span></a>                                            <span class="n">name_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_base</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2430"><a href="#databases_download_dbnsfp-2430"><span class="linenos">2430</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2431"><a href="#databases_download_dbnsfp-2431"><span class="linenos">2431</span></a>                                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2432"><a href="#databases_download_dbnsfp-2432"><span class="linenos">2432</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2433"><a href="#databases_download_dbnsfp-2433"><span class="linenos">2433</span></a>                                        <span class="n">new_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2434"><a href="#databases_download_dbnsfp-2434"><span class="linenos">2434</span></a>                                            <span class="n">parquet_sub_database_annotation_chromosome</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2435"><a href="#databases_download_dbnsfp-2435"><span class="linenos">2435</span></a>                                            <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;-0.parquet&quot;</span><span class="p">),</span>
</span><span id="databases_download_dbnsfp-2436"><a href="#databases_download_dbnsfp-2436"><span class="linenos">2436</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2437"><a href="#databases_download_dbnsfp-2437"><span class="linenos">2437</span></a>                                        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_file_name</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2438"><a href="#databases_download_dbnsfp-2438"><span class="linenos">2438</span></a>
</span><span id="databases_download_dbnsfp-2439"><a href="#databases_download_dbnsfp-2439"><span class="linenos">2439</span></a>                        <span class="n">db_copy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2440"><a href="#databases_download_dbnsfp-2440"><span class="linenos">2440</span></a>                        <span class="n">parquet_partition_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2441"><a href="#databases_download_dbnsfp-2441"><span class="linenos">2441</span></a>
</span><span id="databases_download_dbnsfp-2442"><a href="#databases_download_dbnsfp-2442"><span class="linenos">2442</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2443"><a href="#databases_download_dbnsfp-2443"><span class="linenos">2443</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - done.&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2444"><a href="#databases_download_dbnsfp-2444"><span class="linenos">2444</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2445"><a href="#databases_download_dbnsfp-2445"><span class="linenos">2445</span></a>
</span><span id="databases_download_dbnsfp-2446"><a href="#databases_download_dbnsfp-2446"><span class="linenos">2446</span></a>                    <span class="c1"># Header</span>
</span><span id="databases_download_dbnsfp-2447"><a href="#databases_download_dbnsfp-2447"><span class="linenos">2447</span></a>                    <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parquet_sub_database_annotation</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_dbnsfp-2448"><a href="#databases_download_dbnsfp-2448"><span class="linenos">2448</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">header_file</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2449"><a href="#databases_download_dbnsfp-2449"><span class="linenos">2449</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">readme_annotations_description</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2450"><a href="#databases_download_dbnsfp-2450"><span class="linenos">2450</span></a>                            <span class="n">readme_annotations_description</span> <span class="o">=</span> <span class="n">get_annotation_description</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2451"><a href="#databases_download_dbnsfp-2451"><span class="linenos">2451</span></a>                                <span class="n">dbnsfp_readme_dest</span>
</span><span id="databases_download_dbnsfp-2452"><a href="#databases_download_dbnsfp-2452"><span class="linenos">2452</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2453"><a href="#databases_download_dbnsfp-2453"><span class="linenos">2453</span></a>                        <span class="k">if</span> <span class="n">get_header</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2454"><a href="#databases_download_dbnsfp-2454"><span class="linenos">2454</span></a>                            <span class="n">header_file</span><span class="o">=</span><span class="n">header_file</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2455"><a href="#databases_download_dbnsfp-2455"><span class="linenos">2455</span></a>                            <span class="n">dbnsfp_readme_dest</span><span class="o">=</span><span class="n">dbnsfp_readme_dest</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2456"><a href="#databases_download_dbnsfp-2456"><span class="linenos">2456</span></a>                            <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2457"><a href="#databases_download_dbnsfp-2457"><span class="linenos">2457</span></a>                            <span class="n">annotations</span><span class="o">=</span><span class="n">columns_annotations</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
</span><span id="databases_download_dbnsfp-2458"><a href="#databases_download_dbnsfp-2458"><span class="linenos">2458</span></a>                            <span class="n">readme_annotations_description</span><span class="o">=</span><span class="n">readme_annotations_description</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2459"><a href="#databases_download_dbnsfp-2459"><span class="linenos">2459</span></a>                        <span class="p">):</span>
</span><span id="databases_download_dbnsfp-2460"><a href="#databases_download_dbnsfp-2460"><span class="linenos">2460</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2461"><a href="#databases_download_dbnsfp-2461"><span class="linenos">2461</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Write header&quot;</span>
</span><span id="databases_download_dbnsfp-2462"><a href="#databases_download_dbnsfp-2462"><span class="linenos">2462</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2463"><a href="#databases_download_dbnsfp-2463"><span class="linenos">2463</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2464"><a href="#databases_download_dbnsfp-2464"><span class="linenos">2464</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2465"><a href="#databases_download_dbnsfp-2465"><span class="linenos">2465</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Write header&quot;</span>
</span><span id="databases_download_dbnsfp-2466"><a href="#databases_download_dbnsfp-2466"><span class="linenos">2466</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2467"><a href="#databases_download_dbnsfp-2467"><span class="linenos">2467</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2468"><a href="#databases_download_dbnsfp-2468"><span class="linenos">2468</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet folder [&#39;</span><span class="si">{</span><span class="n">sub_database_name</span><span class="si">}</span><span class="s2">&#39;] generation - Write header&quot;</span>
</span><span id="databases_download_dbnsfp-2469"><a href="#databases_download_dbnsfp-2469"><span class="linenos">2469</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2470"><a href="#databases_download_dbnsfp-2470"><span class="linenos">2470</span></a>
</span><span id="databases_download_dbnsfp-2471"><a href="#databases_download_dbnsfp-2471"><span class="linenos">2471</span></a>    <span class="c1"># Full DB</span>
</span><span id="databases_download_dbnsfp-2472"><a href="#databases_download_dbnsfp-2472"><span class="linenos">2472</span></a>    <span class="k">if</span> <span class="n">generate_parquet_file</span> <span class="ow">or</span> <span class="n">generate_vcf_file</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2473"><a href="#databases_download_dbnsfp-2473"><span class="linenos">2473</span></a>
</span><span id="databases_download_dbnsfp-2474"><a href="#databases_download_dbnsfp-2474"><span class="linenos">2474</span></a>        <span class="c1"># Init</span>
</span><span id="databases_download_dbnsfp-2475"><a href="#databases_download_dbnsfp-2475"><span class="linenos">2475</span></a>        <span class="n">genomes_sizes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_dbnsfp-2476"><a href="#databases_download_dbnsfp-2476"><span class="linenos">2476</span></a>
</span><span id="databases_download_dbnsfp-2477"><a href="#databases_download_dbnsfp-2477"><span class="linenos">2477</span></a>        <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2478"><a href="#databases_download_dbnsfp-2478"><span class="linenos">2478</span></a>
</span><span id="databases_download_dbnsfp-2479"><a href="#databases_download_dbnsfp-2479"><span class="linenos">2479</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2480"><a href="#databases_download_dbnsfp-2480"><span class="linenos">2480</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Parquet/VCF files generation&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2481"><a href="#databases_download_dbnsfp-2481"><span class="linenos">2481</span></a>
</span><span id="databases_download_dbnsfp-2482"><a href="#databases_download_dbnsfp-2482"><span class="linenos">2482</span></a>            <span class="n">output_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-2483"><a href="#databases_download_dbnsfp-2483"><span class="linenos">2483</span></a>            <span class="n">partition_parquet_folder_all</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.ALL.partition.parquet&quot;</span>
</span><span id="databases_download_dbnsfp-2484"><a href="#databases_download_dbnsfp-2484"><span class="linenos">2484</span></a>            <span class="n">partition_parquet_folders</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2485"><a href="#databases_download_dbnsfp-2485"><span class="linenos">2485</span></a>                <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.*.partition.parquet&quot;</span><span class="p">),</span>
</span><span id="databases_download_dbnsfp-2486"><a href="#databases_download_dbnsfp-2486"><span class="linenos">2486</span></a>                <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2487"><a href="#databases_download_dbnsfp-2487"><span class="linenos">2487</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2488"><a href="#databases_download_dbnsfp-2488"><span class="linenos">2488</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2489"><a href="#databases_download_dbnsfp-2489"><span class="linenos">2489</span></a>            <span class="k">if</span> <span class="n">partition_parquet_folders</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2490"><a href="#databases_download_dbnsfp-2490"><span class="linenos">2490</span></a>                <span class="n">partition_parquet_folders</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">partition_parquet_folder_all</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2491"><a href="#databases_download_dbnsfp-2491"><span class="linenos">2491</span></a>
</span><span id="databases_download_dbnsfp-2492"><a href="#databases_download_dbnsfp-2492"><span class="linenos">2492</span></a>            <span class="k">for</span> <span class="n">partition_parquet_folder</span> <span class="ow">in</span> <span class="p">[</span><span class="n">partition_parquet_folder_all</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2493"><a href="#databases_download_dbnsfp-2493"><span class="linenos">2493</span></a>                <span class="n">partition_parquet_folders</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
</span><span id="databases_download_dbnsfp-2494"><a href="#databases_download_dbnsfp-2494"><span class="linenos">2494</span></a>            <span class="p">):</span>
</span><span id="databases_download_dbnsfp-2495"><a href="#databases_download_dbnsfp-2495"><span class="linenos">2495</span></a>
</span><span id="databases_download_dbnsfp-2496"><a href="#databases_download_dbnsfp-2496"><span class="linenos">2496</span></a>                <span class="c1"># sub database</span>
</span><span id="databases_download_dbnsfp-2497"><a href="#databases_download_dbnsfp-2497"><span class="linenos">2497</span></a>                <span class="n">sub_database</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">partition_parquet_folder</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-2498"><a href="#databases_download_dbnsfp-2498"><span class="linenos">2498</span></a>
</span><span id="databases_download_dbnsfp-2499"><a href="#databases_download_dbnsfp-2499"><span class="linenos">2499</span></a>                <span class="c1"># Input Parquet folder</span>
</span><span id="databases_download_dbnsfp-2500"><a href="#databases_download_dbnsfp-2500"><span class="linenos">2500</span></a>                <span class="n">input_partition_parquet</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbnsfp-2501"><a href="#databases_download_dbnsfp-2501"><span class="linenos">2501</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.partition.parquet&quot;</span>
</span><span id="databases_download_dbnsfp-2502"><a href="#databases_download_dbnsfp-2502"><span class="linenos">2502</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2503"><a href="#databases_download_dbnsfp-2503"><span class="linenos">2503</span></a>                <span class="n">input_partition_parquet_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_partition_parquet</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_dbnsfp-2504"><a href="#databases_download_dbnsfp-2504"><span class="linenos">2504</span></a>
</span><span id="databases_download_dbnsfp-2505"><a href="#databases_download_dbnsfp-2505"><span class="linenos">2505</span></a>                <span class="c1"># Input Parquet files</span>
</span><span id="databases_download_dbnsfp-2506"><a href="#databases_download_dbnsfp-2506"><span class="linenos">2506</span></a>                <span class="n">input_parquet_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2507"><a href="#databases_download_dbnsfp-2507"><span class="linenos">2507</span></a>                    <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_partition_parquet</span><span class="si">}</span><span class="s2">/*/*parquet&quot;</span><span class="p">),</span>
</span><span id="databases_download_dbnsfp-2508"><a href="#databases_download_dbnsfp-2508"><span class="linenos">2508</span></a>                    <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2509"><a href="#databases_download_dbnsfp-2509"><span class="linenos">2509</span></a>                    <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2510"><a href="#databases_download_dbnsfp-2510"><span class="linenos">2510</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2511"><a href="#databases_download_dbnsfp-2511"><span class="linenos">2511</span></a>
</span><span id="databases_download_dbnsfp-2512"><a href="#databases_download_dbnsfp-2512"><span class="linenos">2512</span></a>                <span class="c1"># Skip ALL sub database</span>
</span><span id="databases_download_dbnsfp-2513"><a href="#databases_download_dbnsfp-2513"><span class="linenos">2513</span></a>                <span class="k">if</span> <span class="n">sub_database</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ALL&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">not_generate_files_all</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2514"><a href="#databases_download_dbnsfp-2514"><span class="linenos">2514</span></a>                    <span class="k">continue</span>
</span><span id="databases_download_dbnsfp-2515"><a href="#databases_download_dbnsfp-2515"><span class="linenos">2515</span></a>
</span><span id="databases_download_dbnsfp-2516"><a href="#databases_download_dbnsfp-2516"><span class="linenos">2516</span></a>                <span class="c1"># Parquet file</span>
</span><span id="databases_download_dbnsfp-2517"><a href="#databases_download_dbnsfp-2517"><span class="linenos">2517</span></a>                <span class="k">if</span> <span class="n">generate_parquet_file</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2518"><a href="#databases_download_dbnsfp-2518"><span class="linenos">2518</span></a>
</span><span id="databases_download_dbnsfp-2519"><a href="#databases_download_dbnsfp-2519"><span class="linenos">2519</span></a>                    <span class="c1"># Output</span>
</span><span id="databases_download_dbnsfp-2520"><a href="#databases_download_dbnsfp-2520"><span class="linenos">2520</span></a>                    <span class="n">output_parquet</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.parquet&quot;</span>
</span><span id="databases_download_dbnsfp-2521"><a href="#databases_download_dbnsfp-2521"><span class="linenos">2521</span></a>                    <span class="n">output_header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_parquet</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_dbnsfp-2522"><a href="#databases_download_dbnsfp-2522"><span class="linenos">2522</span></a>
</span><span id="databases_download_dbnsfp-2523"><a href="#databases_download_dbnsfp-2523"><span class="linenos">2523</span></a>                    <span class="c1"># Parquet file</span>
</span><span id="databases_download_dbnsfp-2524"><a href="#databases_download_dbnsfp-2524"><span class="linenos">2524</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2525"><a href="#databases_download_dbnsfp-2525"><span class="linenos">2525</span></a>
</span><span id="databases_download_dbnsfp-2526"><a href="#databases_download_dbnsfp-2526"><span class="linenos">2526</span></a>                        <span class="k">if</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2527"><a href="#databases_download_dbnsfp-2527"><span class="linenos">2527</span></a>
</span><span id="databases_download_dbnsfp-2528"><a href="#databases_download_dbnsfp-2528"><span class="linenos">2528</span></a>                            <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2529"><a href="#databases_download_dbnsfp-2529"><span class="linenos">2529</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2530"><a href="#databases_download_dbnsfp-2530"><span class="linenos">2530</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2531"><a href="#databases_download_dbnsfp-2531"><span class="linenos">2531</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2532"><a href="#databases_download_dbnsfp-2532"><span class="linenos">2532</span></a>
</span><span id="databases_download_dbnsfp-2533"><a href="#databases_download_dbnsfp-2533"><span class="linenos">2533</span></a>                            <span class="c1"># Generate Parquet files</span>
</span><span id="databases_download_dbnsfp-2534"><a href="#databases_download_dbnsfp-2534"><span class="linenos">2534</span></a>                            <span class="c1"># log.debug(pq.ParquetFile(input_parquet_files[0]).schema_arrow)</span>
</span><span id="databases_download_dbnsfp-2535"><a href="#databases_download_dbnsfp-2535"><span class="linenos">2535</span></a>                            <span class="k">with</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetWriter</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2536"><a href="#databases_download_dbnsfp-2536"><span class="linenos">2536</span></a>                                <span class="n">output_parquet</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2537"><a href="#databases_download_dbnsfp-2537"><span class="linenos">2537</span></a>                                <span class="n">schema</span><span class="o">=</span><span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2538"><a href="#databases_download_dbnsfp-2538"><span class="linenos">2538</span></a>                                    <span class="n">input_parquet_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-2539"><a href="#databases_download_dbnsfp-2539"><span class="linenos">2539</span></a>                                <span class="p">)</span><span class="o">.</span><span class="n">schema_arrow</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2540"><a href="#databases_download_dbnsfp-2540"><span class="linenos">2540</span></a>                            <span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2541"><a href="#databases_download_dbnsfp-2541"><span class="linenos">2541</span></a>                                <span class="n">chromosome_folder_previous</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2542"><a href="#databases_download_dbnsfp-2542"><span class="linenos">2542</span></a>                                <span class="k">for</span> <span class="n">parquet_file</span> <span class="ow">in</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2543"><a href="#databases_download_dbnsfp-2543"><span class="linenos">2543</span></a>                                    <span class="n">chromosome_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-2544"><a href="#databases_download_dbnsfp-2544"><span class="linenos">2544</span></a>                                    <span class="k">if</span> <span class="n">chromosome_folder</span> <span class="o">!=</span> <span class="n">chromosome_folder_previous</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2545"><a href="#databases_download_dbnsfp-2545"><span class="linenos">2545</span></a>                                        <span class="n">chromosome_folder_previous</span> <span class="o">=</span> <span class="n">chromosome_folder</span>
</span><span id="databases_download_dbnsfp-2546"><a href="#databases_download_dbnsfp-2546"><span class="linenos">2546</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2547"><a href="#databases_download_dbnsfp-2547"><span class="linenos">2547</span></a>                                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Process &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">/*&#39; files...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2548"><a href="#databases_download_dbnsfp-2548"><span class="linenos">2548</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2549"><a href="#databases_download_dbnsfp-2549"><span class="linenos">2549</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2550"><a href="#databases_download_dbnsfp-2550"><span class="linenos">2550</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Process &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; file...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2551"><a href="#databases_download_dbnsfp-2551"><span class="linenos">2551</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2552"><a href="#databases_download_dbnsfp-2552"><span class="linenos">2552</span></a>                                    <span class="c1"># log.debug(pq.ParquetFile(parquet_file).schema_arrow)</span>
</span><span id="databases_download_dbnsfp-2553"><a href="#databases_download_dbnsfp-2553"><span class="linenos">2553</span></a>                                    <span class="n">writer</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span>
</span><span id="databases_download_dbnsfp-2554"><a href="#databases_download_dbnsfp-2554"><span class="linenos">2554</span></a>                            <span class="n">parquet_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2555"><a href="#databases_download_dbnsfp-2555"><span class="linenos">2555</span></a>
</span><span id="databases_download_dbnsfp-2556"><a href="#databases_download_dbnsfp-2556"><span class="linenos">2556</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2557"><a href="#databases_download_dbnsfp-2557"><span class="linenos">2557</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2558"><a href="#databases_download_dbnsfp-2558"><span class="linenos">2558</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2559"><a href="#databases_download_dbnsfp-2559"><span class="linenos">2559</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2560"><a href="#databases_download_dbnsfp-2560"><span class="linenos">2560</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2561"><a href="#databases_download_dbnsfp-2561"><span class="linenos">2561</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2562"><a href="#databases_download_dbnsfp-2562"><span class="linenos">2562</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2563"><a href="#databases_download_dbnsfp-2563"><span class="linenos">2563</span></a>
</span><span id="databases_download_dbnsfp-2564"><a href="#databases_download_dbnsfp-2564"><span class="linenos">2564</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2565"><a href="#databases_download_dbnsfp-2565"><span class="linenos">2565</span></a>
</span><span id="databases_download_dbnsfp-2566"><a href="#databases_download_dbnsfp-2566"><span class="linenos">2566</span></a>                        <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2567"><a href="#databases_download_dbnsfp-2567"><span class="linenos">2567</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2568"><a href="#databases_download_dbnsfp-2568"><span class="linenos">2568</span></a>                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file already generated&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2569"><a href="#databases_download_dbnsfp-2569"><span class="linenos">2569</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2570"><a href="#databases_download_dbnsfp-2570"><span class="linenos">2570</span></a>
</span><span id="databases_download_dbnsfp-2571"><a href="#databases_download_dbnsfp-2571"><span class="linenos">2571</span></a>                        <span class="n">parquet_already_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2572"><a href="#databases_download_dbnsfp-2572"><span class="linenos">2572</span></a>
</span><span id="databases_download_dbnsfp-2573"><a href="#databases_download_dbnsfp-2573"><span class="linenos">2573</span></a>                    <span class="c1"># Header</span>
</span><span id="databases_download_dbnsfp-2574"><a href="#databases_download_dbnsfp-2574"><span class="linenos">2574</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_header_file</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2575"><a href="#databases_download_dbnsfp-2575"><span class="linenos">2575</span></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_partition_parquet_header</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2576"><a href="#databases_download_dbnsfp-2576"><span class="linenos">2576</span></a>                            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2577"><a href="#databases_download_dbnsfp-2577"><span class="linenos">2577</span></a>                                <span class="n">input_partition_parquet_header</span><span class="p">,</span> <span class="n">output_header_file</span>
</span><span id="databases_download_dbnsfp-2578"><a href="#databases_download_dbnsfp-2578"><span class="linenos">2578</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2579"><a href="#databases_download_dbnsfp-2579"><span class="linenos">2579</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2580"><a href="#databases_download_dbnsfp-2580"><span class="linenos">2580</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Write header&quot;</span>
</span><span id="databases_download_dbnsfp-2581"><a href="#databases_download_dbnsfp-2581"><span class="linenos">2581</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2582"><a href="#databases_download_dbnsfp-2582"><span class="linenos">2582</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2583"><a href="#databases_download_dbnsfp-2583"><span class="linenos">2583</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2584"><a href="#databases_download_dbnsfp-2584"><span class="linenos">2584</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Write header failed&quot;</span>
</span><span id="databases_download_dbnsfp-2585"><a href="#databases_download_dbnsfp-2585"><span class="linenos">2585</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2586"><a href="#databases_download_dbnsfp-2586"><span class="linenos">2586</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2587"><a href="#databases_download_dbnsfp-2587"><span class="linenos">2587</span></a>                                <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - Parquet file - Write header failed&quot;</span>
</span><span id="databases_download_dbnsfp-2588"><a href="#databases_download_dbnsfp-2588"><span class="linenos">2588</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2589"><a href="#databases_download_dbnsfp-2589"><span class="linenos">2589</span></a>
</span><span id="databases_download_dbnsfp-2590"><a href="#databases_download_dbnsfp-2590"><span class="linenos">2590</span></a>                <span class="k">if</span> <span class="n">generate_vcf_file</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2591"><a href="#databases_download_dbnsfp-2591"><span class="linenos">2591</span></a>
</span><span id="databases_download_dbnsfp-2592"><a href="#databases_download_dbnsfp-2592"><span class="linenos">2592</span></a>                    <span class="c1"># Output VCF</span>
</span><span id="databases_download_dbnsfp-2593"><a href="#databases_download_dbnsfp-2593"><span class="linenos">2593</span></a>                    <span class="n">output_vcf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">.vcf.gz&quot;</span>
</span><span id="databases_download_dbnsfp-2594"><a href="#databases_download_dbnsfp-2594"><span class="linenos">2594</span></a>                    <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_vcf</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_dbnsfp-2595"><a href="#databases_download_dbnsfp-2595"><span class="linenos">2595</span></a>
</span><span id="databases_download_dbnsfp-2596"><a href="#databases_download_dbnsfp-2596"><span class="linenos">2596</span></a>                    <span class="c1"># Chromosome sizes</span>
</span><span id="databases_download_dbnsfp-2597"><a href="#databases_download_dbnsfp-2597"><span class="linenos">2597</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_sizes</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2598"><a href="#databases_download_dbnsfp-2598"><span class="linenos">2598</span></a>                        <span class="n">genomes_sizes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2599"><a href="#databases_download_dbnsfp-2599"><span class="linenos">2599</span></a>                            <span class="n">genomes_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.fa.sizes&quot;</span>
</span><span id="databases_download_dbnsfp-2600"><a href="#databases_download_dbnsfp-2600"><span class="linenos">2600</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2601"><a href="#databases_download_dbnsfp-2601"><span class="linenos">2601</span></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2602"><a href="#databases_download_dbnsfp-2602"><span class="linenos">2602</span></a>                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2603"><a href="#databases_download_dbnsfp-2603"><span class="linenos">2603</span></a>                                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2604"><a href="#databases_download_dbnsfp-2604"><span class="linenos">2604</span></a>                                    <span class="n">genomes_sizes</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2605"><a href="#databases_download_dbnsfp-2605"><span class="linenos">2605</span></a>                                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="databases_download_dbnsfp-2606"><a href="#databases_download_dbnsfp-2606"><span class="linenos">2606</span></a>                                    <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2607"><a href="#databases_download_dbnsfp-2607"><span class="linenos">2607</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2608"><a href="#databases_download_dbnsfp-2608"><span class="linenos">2608</span></a>                            <span class="n">genomes_sizes</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_dbnsfp-2609"><a href="#databases_download_dbnsfp-2609"><span class="linenos">2609</span></a>
</span><span id="databases_download_dbnsfp-2610"><a href="#databases_download_dbnsfp-2610"><span class="linenos">2610</span></a>                    <span class="c1"># VCF file</span>
</span><span id="databases_download_dbnsfp-2611"><a href="#databases_download_dbnsfp-2611"><span class="linenos">2611</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2612"><a href="#databases_download_dbnsfp-2612"><span class="linenos">2612</span></a>
</span><span id="databases_download_dbnsfp-2613"><a href="#databases_download_dbnsfp-2613"><span class="linenos">2613</span></a>                        <span class="k">if</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2614"><a href="#databases_download_dbnsfp-2614"><span class="linenos">2614</span></a>
</span><span id="databases_download_dbnsfp-2615"><a href="#databases_download_dbnsfp-2615"><span class="linenos">2615</span></a>                            <span class="c1"># Init</span>
</span><span id="databases_download_dbnsfp-2616"><a href="#databases_download_dbnsfp-2616"><span class="linenos">2616</span></a>                            <span class="n">list_of_queries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2617"><a href="#databases_download_dbnsfp-2617"><span class="linenos">2617</span></a>                            <span class="n">list_for_vcf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2618"><a href="#databases_download_dbnsfp-2618"><span class="linenos">2618</span></a>
</span><span id="databases_download_dbnsfp-2619"><a href="#databases_download_dbnsfp-2619"><span class="linenos">2619</span></a>                            <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2620"><a href="#databases_download_dbnsfp-2620"><span class="linenos">2620</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2621"><a href="#databases_download_dbnsfp-2621"><span class="linenos">2621</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2622"><a href="#databases_download_dbnsfp-2622"><span class="linenos">2622</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2623"><a href="#databases_download_dbnsfp-2623"><span class="linenos">2623</span></a>
</span><span id="databases_download_dbnsfp-2624"><a href="#databases_download_dbnsfp-2624"><span class="linenos">2624</span></a>                            <span class="c1"># Find database structure</span>
</span><span id="databases_download_dbnsfp-2625"><a href="#databases_download_dbnsfp-2625"><span class="linenos">2625</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">database_files</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2626"><a href="#databases_download_dbnsfp-2626"><span class="linenos">2626</span></a>                                <span class="n">database_files</span> <span class="o">=</span> <span class="n">get_database_files</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2627"><a href="#databases_download_dbnsfp-2627"><span class="linenos">2627</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbnsfp_zip_dest_folder</span><span class="si">}</span><span class="s2">/dbNSFP</span><span class="si">{</span><span class="n">dbnsfp_release</span><span class="si">}</span><span class="s2">_variant.chr*.gz&quot;</span>
</span><span id="databases_download_dbnsfp-2628"><a href="#databases_download_dbnsfp-2628"><span class="linenos">2628</span></a>                                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2629"><a href="#databases_download_dbnsfp-2629"><span class="linenos">2629</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_structure</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2630"><a href="#databases_download_dbnsfp-2630"><span class="linenos">2630</span></a>                                <span class="n">columns_structure</span> <span class="o">=</span> <span class="n">get_columns_structure</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2631"><a href="#databases_download_dbnsfp-2631"><span class="linenos">2631</span></a>                                    <span class="n">database_file</span><span class="o">=</span><span class="n">database_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="databases_download_dbnsfp-2632"><a href="#databases_download_dbnsfp-2632"><span class="linenos">2632</span></a>                                    <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2633"><a href="#databases_download_dbnsfp-2633"><span class="linenos">2633</span></a>                                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2634"><a href="#databases_download_dbnsfp-2634"><span class="linenos">2634</span></a>                                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2635"><a href="#databases_download_dbnsfp-2635"><span class="linenos">2635</span></a>                            <span class="n">columns_clauses</span> <span class="o">=</span> <span class="n">get_columns_select_clause</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2636"><a href="#databases_download_dbnsfp-2636"><span class="linenos">2636</span></a>                                <span class="n">columns_structure</span><span class="o">=</span><span class="n">columns_structure</span><span class="p">[</span><span class="s2">&quot;DB&quot;</span><span class="p">],</span>
</span><span id="databases_download_dbnsfp-2637"><a href="#databases_download_dbnsfp-2637"><span class="linenos">2637</span></a>                                <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2638"><a href="#databases_download_dbnsfp-2638"><span class="linenos">2638</span></a>                                <span class="n">for_parquet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2639"><a href="#databases_download_dbnsfp-2639"><span class="linenos">2639</span></a>                                <span class="n">sub_database</span><span class="o">=</span><span class="n">sub_database</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2640"><a href="#databases_download_dbnsfp-2640"><span class="linenos">2640</span></a>                                <span class="n">null_if_no_annotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2641"><a href="#databases_download_dbnsfp-2641"><span class="linenos">2641</span></a>                                <span class="n">print_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2642"><a href="#databases_download_dbnsfp-2642"><span class="linenos">2642</span></a>                                <span class="n">add_info</span><span class="o">=</span><span class="n">add_info</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2643"><a href="#databases_download_dbnsfp-2643"><span class="linenos">2643</span></a>                                <span class="n">only_info</span><span class="o">=</span><span class="n">only_info</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2644"><a href="#databases_download_dbnsfp-2644"><span class="linenos">2644</span></a>                                <span class="n">uniquify</span><span class="o">=</span><span class="n">uniquify</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2645"><a href="#databases_download_dbnsfp-2645"><span class="linenos">2645</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2646"><a href="#databases_download_dbnsfp-2646"><span class="linenos">2646</span></a>                            <span class="n">columns_annotations</span> <span class="o">=</span> <span class="n">columns_clauses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2647"><a href="#databases_download_dbnsfp-2647"><span class="linenos">2647</span></a>
</span><span id="databases_download_dbnsfp-2648"><a href="#databases_download_dbnsfp-2648"><span class="linenos">2648</span></a>                            <span class="c1"># Generate columns concat for INFO column</span>
</span><span id="databases_download_dbnsfp-2649"><a href="#databases_download_dbnsfp-2649"><span class="linenos">2649</span></a>                            <span class="n">column_info</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2650"><a href="#databases_download_dbnsfp-2650"><span class="linenos">2650</span></a>
</span><span id="databases_download_dbnsfp-2651"><a href="#databases_download_dbnsfp-2651"><span class="linenos">2651</span></a>                            <span class="c1"># INFO column check</span>
</span><span id="databases_download_dbnsfp-2652"><a href="#databases_download_dbnsfp-2652"><span class="linenos">2652</span></a>                            <span class="n">query_info_check</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2653"><a href="#databases_download_dbnsfp-2653"><span class="linenos">2653</span></a><span class="s2">                                    SELECT *</span>
</span><span id="databases_download_dbnsfp-2654"><a href="#databases_download_dbnsfp-2654"><span class="linenos">2654</span></a><span class="s2">                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">input_parquet_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="databases_download_dbnsfp-2655"><a href="#databases_download_dbnsfp-2655"><span class="linenos">2655</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2656"><a href="#databases_download_dbnsfp-2656"><span class="linenos">2656</span></a>                            <span class="n">columns_info_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_info_check</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">())</span>
</span><span id="databases_download_dbnsfp-2657"><a href="#databases_download_dbnsfp-2657"><span class="linenos">2657</span></a>
</span><span id="databases_download_dbnsfp-2658"><a href="#databases_download_dbnsfp-2658"><span class="linenos">2658</span></a>                            <span class="c1"># If INFO column exists</span>
</span><span id="databases_download_dbnsfp-2659"><a href="#databases_download_dbnsfp-2659"><span class="linenos">2659</span></a>                            <span class="k">if</span> <span class="s2">&quot;INFO&quot;</span> <span class="ow">in</span> <span class="n">columns_info_check</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2660"><a href="#databases_download_dbnsfp-2660"><span class="linenos">2660</span></a>                                <span class="n">column_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot; &quot;INFO&quot; &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2661"><a href="#databases_download_dbnsfp-2661"><span class="linenos">2661</span></a>
</span><span id="databases_download_dbnsfp-2662"><a href="#databases_download_dbnsfp-2662"><span class="linenos">2662</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2663"><a href="#databases_download_dbnsfp-2663"><span class="linenos">2663</span></a>                                <span class="k">for</span> <span class="n">column_annotation</span> <span class="ow">in</span> <span class="n">columns_annotations</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2664"><a href="#databases_download_dbnsfp-2664"><span class="linenos">2664</span></a>                                    <span class="n">column_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2665"><a href="#databases_download_dbnsfp-2665"><span class="linenos">2665</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2666"><a href="#databases_download_dbnsfp-2666"><span class="linenos">2666</span></a><span class="s2">                                    CASE</span>
</span><span id="databases_download_dbnsfp-2667"><a href="#databases_download_dbnsfp-2667"><span class="linenos">2667</span></a><span class="s2">                                        WHEN &quot;</span><span class="si">{</span><span class="n">column_annotation</span><span class="si">}</span><span class="s2">&quot; IS NOT NULL</span>
</span><span id="databases_download_dbnsfp-2668"><a href="#databases_download_dbnsfp-2668"><span class="linenos">2668</span></a><span class="s2">                                        THEN concat(&#39;</span><span class="si">{</span><span class="n">column_annotation</span><span class="si">}</span><span class="s2">=&#39;, replace(CAST(&quot;</span><span class="si">{</span><span class="n">column_annotation</span><span class="si">}</span><span class="s2">&quot; AS VARCHAR), &#39;;&#39;, &#39;,&#39;), &#39;;&#39;)</span>
</span><span id="databases_download_dbnsfp-2669"><a href="#databases_download_dbnsfp-2669"><span class="linenos">2669</span></a><span class="s2">                                        ELSE &#39;&#39;</span>
</span><span id="databases_download_dbnsfp-2670"><a href="#databases_download_dbnsfp-2670"><span class="linenos">2670</span></a><span class="s2">                                    END</span>
</span><span id="databases_download_dbnsfp-2671"><a href="#databases_download_dbnsfp-2671"><span class="linenos">2671</span></a><span class="s2">                                    &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2672"><a href="#databases_download_dbnsfp-2672"><span class="linenos">2672</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2673"><a href="#databases_download_dbnsfp-2673"><span class="linenos">2673</span></a>
</span><span id="databases_download_dbnsfp-2674"><a href="#databases_download_dbnsfp-2674"><span class="linenos">2674</span></a>                            <span class="k">if</span> <span class="n">column_info</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2675"><a href="#databases_download_dbnsfp-2675"><span class="linenos">2675</span></a>
</span><span id="databases_download_dbnsfp-2676"><a href="#databases_download_dbnsfp-2676"><span class="linenos">2676</span></a>                                <span class="c1"># Generate VCF files within tmp folder</span>
</span><span id="databases_download_dbnsfp-2677"><a href="#databases_download_dbnsfp-2677"><span class="linenos">2677</span></a>                                <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">output_assembly</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2678"><a href="#databases_download_dbnsfp-2678"><span class="linenos">2678</span></a>
</span><span id="databases_download_dbnsfp-2679"><a href="#databases_download_dbnsfp-2679"><span class="linenos">2679</span></a>                                    <span class="c1"># Init</span>
</span><span id="databases_download_dbnsfp-2680"><a href="#databases_download_dbnsfp-2680"><span class="linenos">2680</span></a>                                    <span class="n">file_num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="databases_download_dbnsfp-2681"><a href="#databases_download_dbnsfp-2681"><span class="linenos">2681</span></a>
</span><span id="databases_download_dbnsfp-2682"><a href="#databases_download_dbnsfp-2682"><span class="linenos">2682</span></a>                                    <span class="c1"># Create duckDB connexion</span>
</span><span id="databases_download_dbnsfp-2683"><a href="#databases_download_dbnsfp-2683"><span class="linenos">2683</span></a>                                    <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2684"><a href="#databases_download_dbnsfp-2684"><span class="linenos">2684</span></a>                                        <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">}</span>
</span><span id="databases_download_dbnsfp-2685"><a href="#databases_download_dbnsfp-2685"><span class="linenos">2685</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2686"><a href="#databases_download_dbnsfp-2686"><span class="linenos">2686</span></a>
</span><span id="databases_download_dbnsfp-2687"><a href="#databases_download_dbnsfp-2687"><span class="linenos">2687</span></a>                                    <span class="c1"># Set max expression depth for big sub databases (e.g. gnomAD, ALL)</span>
</span><span id="databases_download_dbnsfp-2688"><a href="#databases_download_dbnsfp-2688"><span class="linenos">2688</span></a>                                    <span class="n">db_copy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET max_expression_depth TO 10000&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2689"><a href="#databases_download_dbnsfp-2689"><span class="linenos">2689</span></a>
</span><span id="databases_download_dbnsfp-2690"><a href="#databases_download_dbnsfp-2690"><span class="linenos">2690</span></a>                                    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2691"><a href="#databases_download_dbnsfp-2691"><span class="linenos">2691</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2692"><a href="#databases_download_dbnsfp-2692"><span class="linenos">2692</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Check chomosomes and number of variants...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2693"><a href="#databases_download_dbnsfp-2693"><span class="linenos">2693</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2694"><a href="#databases_download_dbnsfp-2694"><span class="linenos">2694</span></a>
</span><span id="databases_download_dbnsfp-2695"><a href="#databases_download_dbnsfp-2695"><span class="linenos">2695</span></a>                                    <span class="c1"># Check chomosomes and total number of variants</span>
</span><span id="databases_download_dbnsfp-2696"><a href="#databases_download_dbnsfp-2696"><span class="linenos">2696</span></a>                                    <span class="n">query_chromosomes</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2697"><a href="#databases_download_dbnsfp-2697"><span class="linenos">2697</span></a><span class="s2">                                                SELECT distinct &quot;#CHROM&quot; AS chromosome, count(*) AS nb_variants</span>
</span><span id="databases_download_dbnsfp-2698"><a href="#databases_download_dbnsfp-2698"><span class="linenos">2698</span></a><span class="s2">                                                FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">input_partition_parquet</span><span class="si">}</span><span class="s2">/*/*parquet&#39;)</span>
</span><span id="databases_download_dbnsfp-2699"><a href="#databases_download_dbnsfp-2699"><span class="linenos">2699</span></a><span class="s2">                                                GROUP BY &quot;#CHROM&quot;</span>
</span><span id="databases_download_dbnsfp-2700"><a href="#databases_download_dbnsfp-2700"><span class="linenos">2700</span></a><span class="s2">                                            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2701"><a href="#databases_download_dbnsfp-2701"><span class="linenos">2701</span></a>                                    <span class="n">chromosomes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2702"><a href="#databases_download_dbnsfp-2702"><span class="linenos">2702</span></a>                                        <span class="nb">list</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2703"><a href="#databases_download_dbnsfp-2703"><span class="linenos">2703</span></a>                                            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span>
</span><span id="databases_download_dbnsfp-2704"><a href="#databases_download_dbnsfp-2704"><span class="linenos">2704</span></a>                                                <span class="s2">&quot;chromosome&quot;</span>
</span><span id="databases_download_dbnsfp-2705"><a href="#databases_download_dbnsfp-2705"><span class="linenos">2705</span></a>                                            <span class="p">]</span>
</span><span id="databases_download_dbnsfp-2706"><a href="#databases_download_dbnsfp-2706"><span class="linenos">2706</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2707"><a href="#databases_download_dbnsfp-2707"><span class="linenos">2707</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2708"><a href="#databases_download_dbnsfp-2708"><span class="linenos">2708</span></a>                                    <span class="n">nb_variants</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2709"><a href="#databases_download_dbnsfp-2709"><span class="linenos">2709</span></a>                                        <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span>
</span><span id="databases_download_dbnsfp-2710"><a href="#databases_download_dbnsfp-2710"><span class="linenos">2710</span></a>                                            <span class="s2">&quot;nb_variants&quot;</span>
</span><span id="databases_download_dbnsfp-2711"><a href="#databases_download_dbnsfp-2711"><span class="linenos">2711</span></a>                                        <span class="p">]</span>
</span><span id="databases_download_dbnsfp-2712"><a href="#databases_download_dbnsfp-2712"><span class="linenos">2712</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2713"><a href="#databases_download_dbnsfp-2713"><span class="linenos">2713</span></a>
</span><span id="databases_download_dbnsfp-2714"><a href="#databases_download_dbnsfp-2714"><span class="linenos">2714</span></a>                                    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2715"><a href="#databases_download_dbnsfp-2715"><span class="linenos">2715</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2716"><a href="#databases_download_dbnsfp-2716"><span class="linenos">2716</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chromosomes</span><span class="p">)</span><span class="si">}</span><span class="s2"> chromosomes&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2717"><a href="#databases_download_dbnsfp-2717"><span class="linenos">2717</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2718"><a href="#databases_download_dbnsfp-2718"><span class="linenos">2718</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2719"><a href="#databases_download_dbnsfp-2719"><span class="linenos">2719</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Found </span><span class="si">{</span><span class="n">nb_variants</span><span class="si">}</span><span class="s2"> variants&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2720"><a href="#databases_download_dbnsfp-2720"><span class="linenos">2720</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2721"><a href="#databases_download_dbnsfp-2721"><span class="linenos">2721</span></a>
</span><span id="databases_download_dbnsfp-2722"><a href="#databases_download_dbnsfp-2722"><span class="linenos">2722</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2723"><a href="#databases_download_dbnsfp-2723"><span class="linenos">2723</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Generate files...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2724"><a href="#databases_download_dbnsfp-2724"><span class="linenos">2724</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2725"><a href="#databases_download_dbnsfp-2725"><span class="linenos">2725</span></a>
</span><span id="databases_download_dbnsfp-2726"><a href="#databases_download_dbnsfp-2726"><span class="linenos">2726</span></a>                                    <span class="k">for</span> <span class="n">parquet_file</span> <span class="ow">in</span> <span class="n">input_parquet_files</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2727"><a href="#databases_download_dbnsfp-2727"><span class="linenos">2727</span></a>
</span><span id="databases_download_dbnsfp-2728"><a href="#databases_download_dbnsfp-2728"><span class="linenos">2728</span></a>                                        <span class="c1"># Check number of variant for parquet file</span>
</span><span id="databases_download_dbnsfp-2729"><a href="#databases_download_dbnsfp-2729"><span class="linenos">2729</span></a>                                        <span class="n">query_nb_variants</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2730"><a href="#databases_download_dbnsfp-2730"><span class="linenos">2730</span></a><span class="s2">                                                    SELECT count(*) AS nb_variants</span>
</span><span id="databases_download_dbnsfp-2731"><a href="#databases_download_dbnsfp-2731"><span class="linenos">2731</span></a><span class="s2">                                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_file</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="databases_download_dbnsfp-2732"><a href="#databases_download_dbnsfp-2732"><span class="linenos">2732</span></a><span class="s2">                                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2733"><a href="#databases_download_dbnsfp-2733"><span class="linenos">2733</span></a>                                        <span class="n">parquet_file_nb_variants</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2734"><a href="#databases_download_dbnsfp-2734"><span class="linenos">2734</span></a>                                            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_nb_variants</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span>
</span><span id="databases_download_dbnsfp-2735"><a href="#databases_download_dbnsfp-2735"><span class="linenos">2735</span></a>                                                <span class="s2">&quot;nb_variants&quot;</span>
</span><span id="databases_download_dbnsfp-2736"><a href="#databases_download_dbnsfp-2736"><span class="linenos">2736</span></a>                                            <span class="p">]</span>
</span><span id="databases_download_dbnsfp-2737"><a href="#databases_download_dbnsfp-2737"><span class="linenos">2737</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2738"><a href="#databases_download_dbnsfp-2738"><span class="linenos">2738</span></a>
</span><span id="databases_download_dbnsfp-2739"><a href="#databases_download_dbnsfp-2739"><span class="linenos">2739</span></a>                                        <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2740"><a href="#databases_download_dbnsfp-2740"><span class="linenos">2740</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2741"><a href="#databases_download_dbnsfp-2741"><span class="linenos">2741</span></a>                                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Process &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">))</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; file [</span><span class="si">{</span><span class="n">parquet_file_nb_variants</span><span class="si">}</span><span class="s2"> variants]...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2742"><a href="#databases_download_dbnsfp-2742"><span class="linenos">2742</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2743"><a href="#databases_download_dbnsfp-2743"><span class="linenos">2743</span></a>
</span><span id="databases_download_dbnsfp-2744"><a href="#databases_download_dbnsfp-2744"><span class="linenos">2744</span></a>                                        <span class="c1"># Query for parquet file</span>
</span><span id="databases_download_dbnsfp-2745"><a href="#databases_download_dbnsfp-2745"><span class="linenos">2745</span></a>                                        <span class="n">file_num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="databases_download_dbnsfp-2746"><a href="#databases_download_dbnsfp-2746"><span class="linenos">2746</span></a>                                        <span class="n">vcf_file_gz</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2747"><a href="#databases_download_dbnsfp-2747"><span class="linenos">2747</span></a>                                            <span class="n">tmp_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;variants.</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span>
</span><span id="databases_download_dbnsfp-2748"><a href="#databases_download_dbnsfp-2748"><span class="linenos">2748</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2749"><a href="#databases_download_dbnsfp-2749"><span class="linenos">2749</span></a>                                        <span class="n">query_copy</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2750"><a href="#databases_download_dbnsfp-2750"><span class="linenos">2750</span></a><span class="s2">                                                COPY (</span>
</span><span id="databases_download_dbnsfp-2751"><a href="#databases_download_dbnsfp-2751"><span class="linenos">2751</span></a><span class="s2">                                                    SELECT &quot;#CHROM&quot;, POS, &#39;.&#39; AS ID, REF, ALT, 0 AS QUAL, &#39;PASS&#39; AS FILTER, regexp_replace(replace(concat(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">column_info</span><span class="p">)</span><span class="si">}</span><span class="s2">),&#39;&quot;&#39;, &#39;&#39;), &#39;;$&#39;, &#39;&#39;) AS INFO</span>
</span><span id="databases_download_dbnsfp-2752"><a href="#databases_download_dbnsfp-2752"><span class="linenos">2752</span></a><span class="s2">                                                    FROM read_parquet(&#39;</span><span class="si">{</span><span class="n">parquet_file</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="databases_download_dbnsfp-2753"><a href="#databases_download_dbnsfp-2753"><span class="linenos">2753</span></a><span class="s2">                                                    )</span>
</span><span id="databases_download_dbnsfp-2754"><a href="#databases_download_dbnsfp-2754"><span class="linenos">2754</span></a><span class="s2">                                                TO &#39;</span><span class="si">{</span><span class="n">vcf_file_gz</span><span class="si">}</span><span class="s2">&#39; WITH (FORMAT CSV, DELIM &#39;</span><span class="se">\t</span><span class="s2">&#39;, HEADER 0, QUOTE &#39;&#39;, COMPRESSION &#39;gzip&#39;)</span>
</span><span id="databases_download_dbnsfp-2755"><a href="#databases_download_dbnsfp-2755"><span class="linenos">2755</span></a><span class="s2">                                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2756"><a href="#databases_download_dbnsfp-2756"><span class="linenos">2756</span></a>                                        <span class="c1"># Query</span>
</span><span id="databases_download_dbnsfp-2757"><a href="#databases_download_dbnsfp-2757"><span class="linenos">2757</span></a>                                        <span class="n">list_of_queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query_copy</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2758"><a href="#databases_download_dbnsfp-2758"><span class="linenos">2758</span></a>                                        <span class="c1"># db_copy.execute(query_copy)</span>
</span><span id="databases_download_dbnsfp-2759"><a href="#databases_download_dbnsfp-2759"><span class="linenos">2759</span></a>                                        <span class="n">list_for_vcf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcf_file_gz</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2760"><a href="#databases_download_dbnsfp-2760"><span class="linenos">2760</span></a>
</span><span id="databases_download_dbnsfp-2761"><a href="#databases_download_dbnsfp-2761"><span class="linenos">2761</span></a>                                    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2762"><a href="#databases_download_dbnsfp-2762"><span class="linenos">2762</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2763"><a href="#databases_download_dbnsfp-2763"><span class="linenos">2763</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_for_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2"> files process in parallel [</span><span class="si">{</span><span class="n">threads</span><span class="si">}</span><span class="s2"> threads]...&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2764"><a href="#databases_download_dbnsfp-2764"><span class="linenos">2764</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2765"><a href="#databases_download_dbnsfp-2765"><span class="linenos">2765</span></a>                                    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2766"><a href="#databases_download_dbnsfp-2766"><span class="linenos">2766</span></a>                                        <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">duckdb_execute</span><span class="p">,</span> <span class="n">list_of_queries</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2767"><a href="#databases_download_dbnsfp-2767"><span class="linenos">2767</span></a>
</span><span id="databases_download_dbnsfp-2768"><a href="#databases_download_dbnsfp-2768"><span class="linenos">2768</span></a>                                    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2769"><a href="#databases_download_dbnsfp-2769"><span class="linenos">2769</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2770"><a href="#databases_download_dbnsfp-2770"><span class="linenos">2770</span></a>                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_for_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2"> files generated&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2771"><a href="#databases_download_dbnsfp-2771"><span class="linenos">2771</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2772"><a href="#databases_download_dbnsfp-2772"><span class="linenos">2772</span></a>
</span><span id="databases_download_dbnsfp-2773"><a href="#databases_download_dbnsfp-2773"><span class="linenos">2773</span></a>                                    <span class="c1"># Header</span>
</span><span id="databases_download_dbnsfp-2774"><a href="#databases_download_dbnsfp-2774"><span class="linenos">2774</span></a>
</span><span id="databases_download_dbnsfp-2775"><a href="#databases_download_dbnsfp-2775"><span class="linenos">2775</span></a>                                    <span class="c1"># Init</span>
</span><span id="databases_download_dbnsfp-2776"><a href="#databases_download_dbnsfp-2776"><span class="linenos">2776</span></a>                                    <span class="n">header_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbnsfp-2777"><a href="#databases_download_dbnsfp-2777"><span class="linenos">2777</span></a>
</span><span id="databases_download_dbnsfp-2778"><a href="#databases_download_dbnsfp-2778"><span class="linenos">2778</span></a>                                    <span class="c1"># Temporary header file for INFO fields</span>
</span><span id="databases_download_dbnsfp-2779"><a href="#databases_download_dbnsfp-2779"><span class="linenos">2779</span></a>                                    <span class="n">header_file_tmp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2780"><a href="#databases_download_dbnsfp-2780"><span class="linenos">2780</span></a>                                        <span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;header.hdr&quot;</span>
</span><span id="databases_download_dbnsfp-2781"><a href="#databases_download_dbnsfp-2781"><span class="linenos">2781</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2782"><a href="#databases_download_dbnsfp-2782"><span class="linenos">2782</span></a>                                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_partition_parquet_header</span><span class="p">):</span>
</span><span id="databases_download_dbnsfp-2783"><a href="#databases_download_dbnsfp-2783"><span class="linenos">2783</span></a>                                        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2784"><a href="#databases_download_dbnsfp-2784"><span class="linenos">2784</span></a>                                            <span class="n">input_partition_parquet_header</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2785"><a href="#databases_download_dbnsfp-2785"><span class="linenos">2785</span></a>                                            <span class="n">header_file_tmp</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2786"><a href="#databases_download_dbnsfp-2786"><span class="linenos">2786</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2787"><a href="#databases_download_dbnsfp-2787"><span class="linenos">2787</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2788"><a href="#databases_download_dbnsfp-2788"><span class="linenos">2788</span></a>                                            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Write header&quot;</span>
</span><span id="databases_download_dbnsfp-2789"><a href="#databases_download_dbnsfp-2789"><span class="linenos">2789</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2790"><a href="#databases_download_dbnsfp-2790"><span class="linenos">2790</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2791"><a href="#databases_download_dbnsfp-2791"><span class="linenos">2791</span></a>                                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2792"><a href="#databases_download_dbnsfp-2792"><span class="linenos">2792</span></a>                                            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Write header failed&quot;</span>
</span><span id="databases_download_dbnsfp-2793"><a href="#databases_download_dbnsfp-2793"><span class="linenos">2793</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2794"><a href="#databases_download_dbnsfp-2794"><span class="linenos">2794</span></a>                                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2795"><a href="#databases_download_dbnsfp-2795"><span class="linenos">2795</span></a>                                            <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Write header failed&quot;</span>
</span><span id="databases_download_dbnsfp-2796"><a href="#databases_download_dbnsfp-2796"><span class="linenos">2796</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2797"><a href="#databases_download_dbnsfp-2797"><span class="linenos">2797</span></a>
</span><span id="databases_download_dbnsfp-2798"><a href="#databases_download_dbnsfp-2798"><span class="linenos">2798</span></a>                                    <span class="c1"># Read header file to dict</span>
</span><span id="databases_download_dbnsfp-2799"><a href="#databases_download_dbnsfp-2799"><span class="linenos">2799</span></a>                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2800"><a href="#databases_download_dbnsfp-2800"><span class="linenos">2800</span></a>                                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2801"><a href="#databases_download_dbnsfp-2801"><span class="linenos">2801</span></a>                                            <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="databases_download_dbnsfp-2802"><a href="#databases_download_dbnsfp-2802"><span class="linenos">2802</span></a>
</span><span id="databases_download_dbnsfp-2803"><a href="#databases_download_dbnsfp-2803"><span class="linenos">2803</span></a>                                    <span class="c1"># Remove last line with #CHROM</span>
</span><span id="databases_download_dbnsfp-2804"><a href="#databases_download_dbnsfp-2804"><span class="linenos">2804</span></a>                                    <span class="n">header_list</span> <span class="o">=</span> <span class="n">header_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="databases_download_dbnsfp-2805"><a href="#databases_download_dbnsfp-2805"><span class="linenos">2805</span></a>
</span><span id="databases_download_dbnsfp-2806"><a href="#databases_download_dbnsfp-2806"><span class="linenos">2806</span></a>                                    <span class="c1"># Append FILTER PASS</span>
</span><span id="databases_download_dbnsfp-2807"><a href="#databases_download_dbnsfp-2807"><span class="linenos">2807</span></a>                                    <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2808"><a href="#databases_download_dbnsfp-2808"><span class="linenos">2808</span></a>                                        <span class="s1">&#39;##FILTER=&lt;ID=PASS,Description=&quot;All filters passed&quot;&gt;&#39;</span>
</span><span id="databases_download_dbnsfp-2809"><a href="#databases_download_dbnsfp-2809"><span class="linenos">2809</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2810"><a href="#databases_download_dbnsfp-2810"><span class="linenos">2810</span></a>
</span><span id="databases_download_dbnsfp-2811"><a href="#databases_download_dbnsfp-2811"><span class="linenos">2811</span></a>                                    <span class="c1"># Add chromosomes</span>
</span><span id="databases_download_dbnsfp-2812"><a href="#databases_download_dbnsfp-2812"><span class="linenos">2812</span></a>                                    <span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2813"><a href="#databases_download_dbnsfp-2813"><span class="linenos">2813</span></a>                                        <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2814"><a href="#databases_download_dbnsfp-2814"><span class="linenos">2814</span></a>                                            <span class="sa">f</span><span class="s2">&quot;##contig=&lt;ID=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">,length=</span><span class="si">{</span><span class="n">genomes_sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chromosome</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">,assembly=</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="databases_download_dbnsfp-2815"><a href="#databases_download_dbnsfp-2815"><span class="linenos">2815</span></a>                                        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2816"><a href="#databases_download_dbnsfp-2816"><span class="linenos">2816</span></a>
</span><span id="databases_download_dbnsfp-2817"><a href="#databases_download_dbnsfp-2817"><span class="linenos">2817</span></a>                                    <span class="c1"># Add last line with #CHROM</span>
</span><span id="databases_download_dbnsfp-2818"><a href="#databases_download_dbnsfp-2818"><span class="linenos">2818</span></a>                                    <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2819"><a href="#databases_download_dbnsfp-2819"><span class="linenos">2819</span></a>                                        <span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">POS</span><span class="se">\t</span><span class="s2">ID</span><span class="se">\t</span><span class="s2">REF</span><span class="se">\t</span><span class="s2">ALT</span><span class="se">\t</span><span class="s2">QUAL</span><span class="se">\t</span><span class="s2">FILTER</span><span class="se">\t</span><span class="s2">INFO&quot;</span>
</span><span id="databases_download_dbnsfp-2820"><a href="#databases_download_dbnsfp-2820"><span class="linenos">2820</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2821"><a href="#databases_download_dbnsfp-2821"><span class="linenos">2821</span></a>
</span><span id="databases_download_dbnsfp-2822"><a href="#databases_download_dbnsfp-2822"><span class="linenos">2822</span></a>                                    <span class="c1"># Write header</span>
</span><span id="databases_download_dbnsfp-2823"><a href="#databases_download_dbnsfp-2823"><span class="linenos">2823</span></a>                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2824"><a href="#databases_download_dbnsfp-2824"><span class="linenos">2824</span></a>                                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">header_list</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2825"><a href="#databases_download_dbnsfp-2825"><span class="linenos">2825</span></a>                                            <span class="c1"># write each item on a new line</span>
</span><span id="databases_download_dbnsfp-2826"><a href="#databases_download_dbnsfp-2826"><span class="linenos">2826</span></a>                                            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2827"><a href="#databases_download_dbnsfp-2827"><span class="linenos">2827</span></a>
</span><span id="databases_download_dbnsfp-2828"><a href="#databases_download_dbnsfp-2828"><span class="linenos">2828</span></a>                                    <span class="c1"># Insert header to lists of files to concat</span>
</span><span id="databases_download_dbnsfp-2829"><a href="#databases_download_dbnsfp-2829"><span class="linenos">2829</span></a>                                    <span class="n">list_for_vcf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">header_file</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2830"><a href="#databases_download_dbnsfp-2830"><span class="linenos">2830</span></a>
</span><span id="databases_download_dbnsfp-2831"><a href="#databases_download_dbnsfp-2831"><span class="linenos">2831</span></a>                                    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2832"><a href="#databases_download_dbnsfp-2832"><span class="linenos">2832</span></a>                                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2833"><a href="#databases_download_dbnsfp-2833"><span class="linenos">2833</span></a>                                        <span class="sa">f</span><span class="s2">&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - Concate and Compress files...&quot;</span>
</span><span id="databases_download_dbnsfp-2834"><a href="#databases_download_dbnsfp-2834"><span class="linenos">2834</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2835"><a href="#databases_download_dbnsfp-2835"><span class="linenos">2835</span></a>                                    <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2836"><a href="#databases_download_dbnsfp-2836"><span class="linenos">2836</span></a>                                        <span class="n">input_files</span><span class="o">=</span><span class="n">list_for_vcf</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2837"><a href="#databases_download_dbnsfp-2837"><span class="linenos">2837</span></a>                                        <span class="n">output_file</span><span class="o">=</span><span class="n">output_vcf</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2838"><a href="#databases_download_dbnsfp-2838"><span class="linenos">2838</span></a>                                        <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2839"><a href="#databases_download_dbnsfp-2839"><span class="linenos">2839</span></a>                                        <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2840"><a href="#databases_download_dbnsfp-2840"><span class="linenos">2840</span></a>                                        <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2841"><a href="#databases_download_dbnsfp-2841"><span class="linenos">2841</span></a>                                        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbnsfp-2842"><a href="#databases_download_dbnsfp-2842"><span class="linenos">2842</span></a>                                    <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2843"><a href="#databases_download_dbnsfp-2843"><span class="linenos">2843</span></a>
</span><span id="databases_download_dbnsfp-2844"><a href="#databases_download_dbnsfp-2844"><span class="linenos">2844</span></a>                                    <span class="n">db_copy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2845"><a href="#databases_download_dbnsfp-2845"><span class="linenos">2845</span></a>
</span><span id="databases_download_dbnsfp-2846"><a href="#databases_download_dbnsfp-2846"><span class="linenos">2846</span></a>                                    <span class="n">vcf_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2847"><a href="#databases_download_dbnsfp-2847"><span class="linenos">2847</span></a>
</span><span id="databases_download_dbnsfp-2848"><a href="#databases_download_dbnsfp-2848"><span class="linenos">2848</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2849"><a href="#databases_download_dbnsfp-2849"><span class="linenos">2849</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2850"><a href="#databases_download_dbnsfp-2850"><span class="linenos">2850</span></a>                                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No INFO columns found&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2851"><a href="#databases_download_dbnsfp-2851"><span class="linenos">2851</span></a>                                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2852"><a href="#databases_download_dbnsfp-2852"><span class="linenos">2852</span></a>                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2853"><a href="#databases_download_dbnsfp-2853"><span class="linenos">2853</span></a>                                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No INFO columns found&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2854"><a href="#databases_download_dbnsfp-2854"><span class="linenos">2854</span></a>                                <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2855"><a href="#databases_download_dbnsfp-2855"><span class="linenos">2855</span></a>
</span><span id="databases_download_dbnsfp-2856"><a href="#databases_download_dbnsfp-2856"><span class="linenos">2856</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2857"><a href="#databases_download_dbnsfp-2857"><span class="linenos">2857</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2858"><a href="#databases_download_dbnsfp-2858"><span class="linenos">2858</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2859"><a href="#databases_download_dbnsfp-2859"><span class="linenos">2859</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2860"><a href="#databases_download_dbnsfp-2860"><span class="linenos">2860</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2861"><a href="#databases_download_dbnsfp-2861"><span class="linenos">2861</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - Database &#39;</span><span class="si">{</span><span class="n">sub_database</span><span class="si">}</span><span class="s2">&#39; - VCF file - No parquet files found&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2862"><a href="#databases_download_dbnsfp-2862"><span class="linenos">2862</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2863"><a href="#databases_download_dbnsfp-2863"><span class="linenos">2863</span></a>
</span><span id="databases_download_dbnsfp-2864"><a href="#databases_download_dbnsfp-2864"><span class="linenos">2864</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2865"><a href="#databases_download_dbnsfp-2865"><span class="linenos">2865</span></a>                        <span class="n">vcf_already_generated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_database</span><span class="p">)</span>
</span><span id="databases_download_dbnsfp-2866"><a href="#databases_download_dbnsfp-2866"><span class="linenos">2866</span></a>
</span><span id="databases_download_dbnsfp-2867"><a href="#databases_download_dbnsfp-2867"><span class="linenos">2867</span></a>    <span class="c1"># Log</span>
</span><span id="databases_download_dbnsfp-2868"><a href="#databases_download_dbnsfp-2868"><span class="linenos">2868</span></a>    <span class="k">if</span> <span class="n">parquet_partition_generated_list</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2869"><a href="#databases_download_dbnsfp-2869"><span class="linenos">2869</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2870"><a href="#databases_download_dbnsfp-2870"><span class="linenos">2870</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet folders generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2871"><a href="#databases_download_dbnsfp-2871"><span class="linenos">2871</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2872"><a href="#databases_download_dbnsfp-2872"><span class="linenos">2872</span></a>    <span class="k">if</span> <span class="n">parquet_partition_already_generated_list</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2873"><a href="#databases_download_dbnsfp-2873"><span class="linenos">2873</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2874"><a href="#databases_download_dbnsfp-2874"><span class="linenos">2874</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet folders already generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_partition_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2875"><a href="#databases_download_dbnsfp-2875"><span class="linenos">2875</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2876"><a href="#databases_download_dbnsfp-2876"><span class="linenos">2876</span></a>    <span class="k">if</span> <span class="n">parquet_generated_list</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2877"><a href="#databases_download_dbnsfp-2877"><span class="linenos">2877</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2878"><a href="#databases_download_dbnsfp-2878"><span class="linenos">2878</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet files generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2879"><a href="#databases_download_dbnsfp-2879"><span class="linenos">2879</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2880"><a href="#databases_download_dbnsfp-2880"><span class="linenos">2880</span></a>    <span class="k">if</span> <span class="n">parquet_already_generated_list</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2881"><a href="#databases_download_dbnsfp-2881"><span class="linenos">2881</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2882"><a href="#databases_download_dbnsfp-2882"><span class="linenos">2882</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> Parquet files already generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parquet_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2883"><a href="#databases_download_dbnsfp-2883"><span class="linenos">2883</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2884"><a href="#databases_download_dbnsfp-2884"><span class="linenos">2884</span></a>    <span class="k">if</span> <span class="n">vcf_generated_list</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2885"><a href="#databases_download_dbnsfp-2885"><span class="linenos">2885</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2886"><a href="#databases_download_dbnsfp-2886"><span class="linenos">2886</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> VCF files generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2887"><a href="#databases_download_dbnsfp-2887"><span class="linenos">2887</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2888"><a href="#databases_download_dbnsfp-2888"><span class="linenos">2888</span></a>    <span class="k">if</span> <span class="n">vcf_already_generated_list</span><span class="p">:</span>
</span><span id="databases_download_dbnsfp-2889"><a href="#databases_download_dbnsfp-2889"><span class="linenos">2889</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbnsfp-2890"><a href="#databases_download_dbnsfp-2890"><span class="linenos">2890</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Download dbNSFP [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;] - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> VCF files already generated </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vcf_already_generated_list</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>
</span><span id="databases_download_dbnsfp-2891"><a href="#databases_download_dbnsfp-2891"><span class="linenos">2891</span></a>        <span class="p">)</span>
</span><span id="databases_download_dbnsfp-2892"><a href="#databases_download_dbnsfp-2892"><span class="linenos">2892</span></a>
</span><span id="databases_download_dbnsfp-2893"><a href="#databases_download_dbnsfp-2893"><span class="linenos">2893</span></a>    <span class="c1"># Close duckdb connexion</span>
</span><span id="databases_download_dbnsfp-2894"><a href="#databases_download_dbnsfp-2894"><span class="linenos">2894</span></a>    <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="databases_download_dbnsfp-2895"><a href="#databases_download_dbnsfp-2895"><span class="linenos">2895</span></a>
</span><span id="databases_download_dbnsfp-2896"><a href="#databases_download_dbnsfp-2896"><span class="linenos">2896</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> function is used to download and process dbNSFP databases for
specified genome assemblies, generating Parquet and VCF files based on the provided configurations.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>assemblies</strong>:  A list of genome assemblies for which to download and process dbNSFP data. Each
assembly should be specified as a string</li>
<li><strong>dbnsfp_folder</strong>:  The <code>dbnsfp_folder</code> parameter is a string that specifies the folder where the
dbNSFP database files are located. If this parameter is not provided, the function will attempt to
download the dbNSFP database files from the <code>dbnsfp_url</code> parameter</li>
<li><strong>dbnsfp_url</strong>:  The <code>dbnsfp_url</code> parameter represents the URL from which the dbNSFP database
files can be downloaded. This URL is used by the function to fetch the necessary database files for
processing</li>
<li><strong>dbnsfp_release</strong>:  The <code>dbnsfp_release</code> parameter specifies the version of the dbNSFP database
to be used. The default value is "4.4a", but you can specify a different version if needed, defaults
to 4.4a</li>
<li><strong>threads</strong>:  The <code>threads</code> parameter specifies the number of threads to use for parallel
processing. Increasing the number of threads can potentially speed up the execution time of the
function, especially if there are multiple cores available on the machine. It determines how many
tasks can be executed simultaneously</li>
<li><strong>memory</strong>:  The <code>memory</code> parameter specifies the amount of maximum memory (in gigabytes) to use
for sorting. It is used in the context of processing and sorting data efficiently. The default value
for this parameter is set to 1, meaning that 1 gigabyte of memory will be allocated for sorting
operations, defaults to 1</li>
<li><strong>parquet_size</strong>:  The <code>parquet_size</code> parameter specifies the maximum size (in megabytes) of data
files in the Parquet folder. It determines the size at which the Parquet files will be split or
generated. The value should be an integer representing the size in megabytes, defaults to 100</li>
<li><strong>generate_parquet_file</strong>:  The <code>generate_parquet_file</code> parameter in the
<code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> function is a boolean flag that indicates whether to generate a Parquet
file or not. If set to <code>True</code>, the function will create Parquet files based on the specified
parameters and data. If set to `, defaults to False</li>
<li><strong>generate_sub_databases</strong>:  The <code>generate_sub_databases</code> parameter in the
<code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> function determines whether to generate sub-databases based on the
assemblies provided. If set to <code>True</code>, the function will create sub-databases based on the specified
genome assemblies. If set to <code>False</code>, the function, defaults to False</li>
<li><strong>generate_vcf_file</strong>:  The <code>generate_vcf_file</code> parameter in the <code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code>
function is a boolean flag that indicates whether to generate a VCF file based on the specified
parameters and data. If set to <code>True</code>, the function will generate a VCF file. If set to `False,
defaults to False</li>
<li><strong>not_generate_files_all</strong>:  The <code>not_generate_files_all</code> parameter in the
<code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> function is a boolean flag that indicates whether to skip generating
database Parquet/VCF files for the entire database. If set to <code>True</code>, the function will not generate
files for the entire database. If set to, defaults to False</li>
<li><strong>genomes_folder</strong>:  The <code>genomes_folder</code> parameter specifies the folder where the genome files
are located. It is a string that represents the path to the folder containing genome assemblies</li>
<li><strong>add_info</strong>:  The <code>add_info</code> parameter in the <code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> function is a boolean
flag that determines whether to include an "INFO" column in the Parquet folder/file. If set to
<code>True</code>, the function will add an INFO column to the generated Parquet files. This INFO, defaults to
False</li>
<li><strong>only_info</strong>:  The <code>only_info</code> parameter in the <code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> function is a boolean
flag that, when set to <code>True</code>, indicates that only the "INFO" column should be included in the
output. This parameter is used to control whether to include only the "INFO" column in, defaults to
False</li>
<li><strong>row_group_size</strong>:  The <code>row_group_size</code> parameter specifies the row group size to generate the
Parquet folder and file. It is used to control the size of row groups in the Parquet file. This
parameter affects the organization of data within the Parquet file and can impact performance and
memory usage during processing. The, defaults to 100000</li>
<li><strong>uniquify</strong>:  The <code>uniquify</code> parameter in the <code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> function is a boolean
flag that determines whether to generate unique values for each annotation in the Parquet file. When
set to <code>True</code>, the function will ensure that each annotation column contains only unique values.
This can be, defaults to False</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The function <code><a href="#databases_download_dbnsfp">databases_download_dbnsfp</a></code> returns a boolean value indicating whether the
  process of downloading and processing dbNSFP databases for specified genome assemblies was
  successful or not.</p>
</blockquote>
</div>


                </section>
                <section id="databases_download_alphamissense">
                            <input id="databases_download_alphamissense-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_alphamissense</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">alphamissense_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/lebechea/howard/databases/annotations/current&#39;</span>,</span><span class="param">	<span class="n">alphamissense_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;https://storage.googleapis.com/dm_alphamissense&#39;</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="databases_download_alphamissense-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_alphamissense"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_alphamissense-2899"><a href="#databases_download_alphamissense-2899"><span class="linenos">2899</span></a><span class="k">def</span> <span class="nf">databases_download_alphamissense</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2900"><a href="#databases_download_alphamissense-2900"><span class="linenos">2900</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="databases_download_alphamissense-2901"><a href="#databases_download_alphamissense-2901"><span class="linenos">2901</span></a>    <span class="n">alphamissense_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATIONS_FOLDER</span><span class="p">,</span>
</span><span id="databases_download_alphamissense-2902"><a href="#databases_download_alphamissense-2902"><span class="linenos">2902</span></a>    <span class="n">alphamissense_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ALPHAMISSENSE_URL</span><span class="p">,</span>
</span><span id="databases_download_alphamissense-2903"><a href="#databases_download_alphamissense-2903"><span class="linenos">2903</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_alphamissense-2904"><a href="#databases_download_alphamissense-2904"><span class="linenos">2904</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="databases_download_alphamissense-2905"><a href="#databases_download_alphamissense-2905"><span class="linenos">2905</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_alphamissense-2906"><a href="#databases_download_alphamissense-2906"><span class="linenos">2906</span></a><span class="sd">    The `databases_download_alphamissense` function downloads and converts AlphaMissense databases for a</span>
</span><span id="databases_download_alphamissense-2907"><a href="#databases_download_alphamissense-2907"><span class="linenos">2907</span></a><span class="sd">    list of assemblies.</span>
</span><span id="databases_download_alphamissense-2908"><a href="#databases_download_alphamissense-2908"><span class="linenos">2908</span></a>
</span><span id="databases_download_alphamissense-2909"><a href="#databases_download_alphamissense-2909"><span class="linenos">2909</span></a><span class="sd">    :param assemblies: `assemblies` is a list of assemblies for which the AlphaMissense database needs</span>
</span><span id="databases_download_alphamissense-2910"><a href="#databases_download_alphamissense-2910"><span class="linenos">2910</span></a><span class="sd">    to be downloaded. Each assembly represents a specific genome or genetic sequence</span>
</span><span id="databases_download_alphamissense-2911"><a href="#databases_download_alphamissense-2911"><span class="linenos">2911</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_alphamissense-2912"><a href="#databases_download_alphamissense-2912"><span class="linenos">2912</span></a><span class="sd">    :param alphamissense_folder: The `alphamissense_folder` parameter is a string that specifies the</span>
</span><span id="databases_download_alphamissense-2913"><a href="#databases_download_alphamissense-2913"><span class="linenos">2913</span></a><span class="sd">    folder where the AlphaMissense files will be downloaded and stored. It is set to</span>
</span><span id="databases_download_alphamissense-2914"><a href="#databases_download_alphamissense-2914"><span class="linenos">2914</span></a><span class="sd">    `DEFAULT_ANNOTATIONS_FOLDER` by default, which is likely a predefined constant or variable in your</span>
</span><span id="databases_download_alphamissense-2915"><a href="#databases_download_alphamissense-2915"><span class="linenos">2915</span></a><span class="sd">    code</span>
</span><span id="databases_download_alphamissense-2916"><a href="#databases_download_alphamissense-2916"><span class="linenos">2916</span></a><span class="sd">    :type alphamissense_folder: str</span>
</span><span id="databases_download_alphamissense-2917"><a href="#databases_download_alphamissense-2917"><span class="linenos">2917</span></a><span class="sd">    :param alphamissense_url: The `alphamissense_url` parameter is a string that specifies the URL where</span>
</span><span id="databases_download_alphamissense-2918"><a href="#databases_download_alphamissense-2918"><span class="linenos">2918</span></a><span class="sd">    the AlphaMissense files are located. It is used to construct the download URL for each assembly&#39;s</span>
</span><span id="databases_download_alphamissense-2919"><a href="#databases_download_alphamissense-2919"><span class="linenos">2919</span></a><span class="sd">    AlphaMissense file</span>
</span><span id="databases_download_alphamissense-2920"><a href="#databases_download_alphamissense-2920"><span class="linenos">2920</span></a><span class="sd">    :type alphamissense_url: str</span>
</span><span id="databases_download_alphamissense-2921"><a href="#databases_download_alphamissense-2921"><span class="linenos">2921</span></a><span class="sd">    :param threads: The `threads` parameter is an optional parameter that specifies the number of</span>
</span><span id="databases_download_alphamissense-2922"><a href="#databases_download_alphamissense-2922"><span class="linenos">2922</span></a><span class="sd">    threads to use for the conversion process. It determines the level of parallelism when converting</span>
</span><span id="databases_download_alphamissense-2923"><a href="#databases_download_alphamissense-2923"><span class="linenos">2923</span></a><span class="sd">    the AlphaMissense TSV file to the Parquet format. If not specified, the default value will be used</span>
</span><span id="databases_download_alphamissense-2924"><a href="#databases_download_alphamissense-2924"><span class="linenos">2924</span></a><span class="sd">    :type threads: int</span>
</span><span id="databases_download_alphamissense-2925"><a href="#databases_download_alphamissense-2925"><span class="linenos">2925</span></a><span class="sd">    :return: The function `databases_download_alphamissense` returns a boolean value `True`.</span>
</span><span id="databases_download_alphamissense-2926"><a href="#databases_download_alphamissense-2926"><span class="linenos">2926</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_alphamissense-2927"><a href="#databases_download_alphamissense-2927"><span class="linenos">2927</span></a>
</span><span id="databases_download_alphamissense-2928"><a href="#databases_download_alphamissense-2928"><span class="linenos">2928</span></a>    <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="databases_download_alphamissense-2929"><a href="#databases_download_alphamissense-2929"><span class="linenos">2929</span></a>
</span><span id="databases_download_alphamissense-2930"><a href="#databases_download_alphamissense-2930"><span class="linenos">2930</span></a>    <span class="c1"># Log</span>
</span><span id="databases_download_alphamissense-2931"><a href="#databases_download_alphamissense-2931"><span class="linenos">2931</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_alphamissense-2932"><a href="#databases_download_alphamissense-2932"><span class="linenos">2932</span></a>
</span><span id="databases_download_alphamissense-2933"><a href="#databases_download_alphamissense-2933"><span class="linenos">2933</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_alphamissense-2934"><a href="#databases_download_alphamissense-2934"><span class="linenos">2934</span></a>    <span class="n">alphamissense_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">alphamissense_folder</span><span class="p">)</span>
</span><span id="databases_download_alphamissense-2935"><a href="#databases_download_alphamissense-2935"><span class="linenos">2935</span></a>
</span><span id="databases_download_alphamissense-2936"><a href="#databases_download_alphamissense-2936"><span class="linenos">2936</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_alphamissense-2937"><a href="#databases_download_alphamissense-2937"><span class="linenos">2937</span></a>
</span><span id="databases_download_alphamissense-2938"><a href="#databases_download_alphamissense-2938"><span class="linenos">2938</span></a>        <span class="c1"># Files for AlphaMissense</span>
</span><span id="databases_download_alphamissense-2939"><a href="#databases_download_alphamissense-2939"><span class="linenos">2939</span></a>        <span class="n">alphamissense_tsv</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AlphaMissense_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span>
</span><span id="databases_download_alphamissense-2940"><a href="#databases_download_alphamissense-2940"><span class="linenos">2940</span></a>        <span class="n">alphamissense_tsv_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alphamissense_url</span><span class="p">,</span> <span class="n">alphamissense_tsv</span><span class="p">)</span>
</span><span id="databases_download_alphamissense-2941"><a href="#databases_download_alphamissense-2941"><span class="linenos">2941</span></a>        <span class="n">alphamissense_tsv_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2942"><a href="#databases_download_alphamissense-2942"><span class="linenos">2942</span></a>            <span class="n">alphamissense_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="n">alphamissense_tsv</span>
</span><span id="databases_download_alphamissense-2943"><a href="#databases_download_alphamissense-2943"><span class="linenos">2943</span></a>        <span class="p">)</span>
</span><span id="databases_download_alphamissense-2944"><a href="#databases_download_alphamissense-2944"><span class="linenos">2944</span></a>        <span class="n">alphamissense_tsv_dest_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">alphamissense_tsv_dest</span><span class="p">)</span>
</span><span id="databases_download_alphamissense-2945"><a href="#databases_download_alphamissense-2945"><span class="linenos">2945</span></a>        <span class="n">alphamissense_parquet</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AlphaMissense.parquet&quot;</span>
</span><span id="databases_download_alphamissense-2946"><a href="#databases_download_alphamissense-2946"><span class="linenos">2946</span></a>        <span class="n">alphamissense_parquet_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2947"><a href="#databases_download_alphamissense-2947"><span class="linenos">2947</span></a>            <span class="n">alphamissense_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="n">alphamissense_parquet</span>
</span><span id="databases_download_alphamissense-2948"><a href="#databases_download_alphamissense-2948"><span class="linenos">2948</span></a>        <span class="p">)</span>
</span><span id="databases_download_alphamissense-2949"><a href="#databases_download_alphamissense-2949"><span class="linenos">2949</span></a>
</span><span id="databases_download_alphamissense-2950"><a href="#databases_download_alphamissense-2950"><span class="linenos">2950</span></a>        <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_alphamissense-2951"><a href="#databases_download_alphamissense-2951"><span class="linenos">2951</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_tsv_dest_folder</span><span class="p">):</span>
</span><span id="databases_download_alphamissense-2952"><a href="#databases_download_alphamissense-2952"><span class="linenos">2952</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">alphamissense_tsv_dest_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_alphamissense-2953"><a href="#databases_download_alphamissense-2953"><span class="linenos">2953</span></a>
</span><span id="databases_download_alphamissense-2954"><a href="#databases_download_alphamissense-2954"><span class="linenos">2954</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2955"><a href="#databases_download_alphamissense-2955"><span class="linenos">2955</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alphamissense_tsv_url</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alphamissense_tsv_dest</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alphamissense_tsv_dest_folder</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_alphamissense-2956"><a href="#databases_download_alphamissense-2956"><span class="linenos">2956</span></a>        <span class="p">)</span>
</span><span id="databases_download_alphamissense-2957"><a href="#databases_download_alphamissense-2957"><span class="linenos">2957</span></a>
</span><span id="databases_download_alphamissense-2958"><a href="#databases_download_alphamissense-2958"><span class="linenos">2958</span></a>        <span class="c1"># Download AlphaMissense</span>
</span><span id="databases_download_alphamissense-2959"><a href="#databases_download_alphamissense-2959"><span class="linenos">2959</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_tsv_dest</span><span class="p">):</span>
</span><span id="databases_download_alphamissense-2960"><a href="#databases_download_alphamissense-2960"><span class="linenos">2960</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2961"><a href="#databases_download_alphamissense-2961"><span class="linenos">2961</span></a>                <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download &#39;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_alphamissense-2962"><a href="#databases_download_alphamissense-2962"><span class="linenos">2962</span></a>            <span class="p">)</span>
</span><span id="databases_download_alphamissense-2963"><a href="#databases_download_alphamissense-2963"><span class="linenos">2963</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2964"><a href="#databases_download_alphamissense-2964"><span class="linenos">2964</span></a>                <span class="n">alphamissense_tsv_url</span><span class="p">,</span> <span class="n">alphamissense_tsv_dest</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span>
</span><span id="databases_download_alphamissense-2965"><a href="#databases_download_alphamissense-2965"><span class="linenos">2965</span></a>            <span class="p">)</span>
</span><span id="databases_download_alphamissense-2966"><a href="#databases_download_alphamissense-2966"><span class="linenos">2966</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_alphamissense-2967"><a href="#databases_download_alphamissense-2967"><span class="linenos">2967</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2968"><a href="#databases_download_alphamissense-2968"><span class="linenos">2968</span></a>                <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_alphamissense-2969"><a href="#databases_download_alphamissense-2969"><span class="linenos">2969</span></a>            <span class="p">)</span>
</span><span id="databases_download_alphamissense-2970"><a href="#databases_download_alphamissense-2970"><span class="linenos">2970</span></a>
</span><span id="databases_download_alphamissense-2971"><a href="#databases_download_alphamissense-2971"><span class="linenos">2971</span></a>        <span class="c1"># Convert to Parquet</span>
</span><span id="databases_download_alphamissense-2972"><a href="#databases_download_alphamissense-2972"><span class="linenos">2972</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_tsv_dest</span><span class="p">):</span>
</span><span id="databases_download_alphamissense-2973"><a href="#databases_download_alphamissense-2973"><span class="linenos">2973</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alphamissense_parquet_dest</span><span class="p">):</span>
</span><span id="databases_download_alphamissense-2974"><a href="#databases_download_alphamissense-2974"><span class="linenos">2974</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2975"><a href="#databases_download_alphamissense-2975"><span class="linenos">2975</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Convert to &#39;</span><span class="si">{</span><span class="n">alphamissense_parquet</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_alphamissense-2976"><a href="#databases_download_alphamissense-2976"><span class="linenos">2976</span></a>                <span class="p">)</span>
</span><span id="databases_download_alphamissense-2977"><a href="#databases_download_alphamissense-2977"><span class="linenos">2977</span></a>                <span class="n">alphamissense_database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2978"><a href="#databases_download_alphamissense-2978"><span class="linenos">2978</span></a>                    <span class="n">database</span><span class="o">=</span><span class="n">alphamissense_tsv_dest</span><span class="p">,</span> <span class="n">conn_config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">}</span>
</span><span id="databases_download_alphamissense-2979"><a href="#databases_download_alphamissense-2979"><span class="linenos">2979</span></a>                <span class="p">)</span>
</span><span id="databases_download_alphamissense-2980"><a href="#databases_download_alphamissense-2980"><span class="linenos">2980</span></a>                <span class="n">alphamissense_database</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2981"><a href="#databases_download_alphamissense-2981"><span class="linenos">2981</span></a>                    <span class="n">output_database</span><span class="o">=</span><span class="n">alphamissense_parquet_dest</span><span class="p">,</span>
</span><span id="databases_download_alphamissense-2982"><a href="#databases_download_alphamissense-2982"><span class="linenos">2982</span></a>                    <span class="n">output_header</span><span class="o">=</span><span class="n">alphamissense_parquet_dest</span> <span class="o">+</span> <span class="s2">&quot;.hdr&quot;</span><span class="p">,</span>
</span><span id="databases_download_alphamissense-2983"><a href="#databases_download_alphamissense-2983"><span class="linenos">2983</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_alphamissense-2984"><a href="#databases_download_alphamissense-2984"><span class="linenos">2984</span></a>                <span class="p">)</span>
</span><span id="databases_download_alphamissense-2985"><a href="#databases_download_alphamissense-2985"><span class="linenos">2985</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_alphamissense-2986"><a href="#databases_download_alphamissense-2986"><span class="linenos">2986</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2987"><a href="#databases_download_alphamissense-2987"><span class="linenos">2987</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">alphamissense_parquet</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_alphamissense-2988"><a href="#databases_download_alphamissense-2988"><span class="linenos">2988</span></a>                <span class="p">)</span>
</span><span id="databases_download_alphamissense-2989"><a href="#databases_download_alphamissense-2989"><span class="linenos">2989</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_alphamissense-2990"><a href="#databases_download_alphamissense-2990"><span class="linenos">2990</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="databases_download_alphamissense-2991"><a href="#databases_download_alphamissense-2991"><span class="linenos">2991</span></a>                <span class="sa">f</span><span class="s2">&quot;Download AlphaMissense </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database &#39;</span><span class="si">{</span><span class="n">alphamissense_tsv</span><span class="si">}</span><span class="s2">&#39; DOES NOT exists&quot;</span>
</span><span id="databases_download_alphamissense-2992"><a href="#databases_download_alphamissense-2992"><span class="linenos">2992</span></a>            <span class="p">)</span>
</span><span id="databases_download_alphamissense-2993"><a href="#databases_download_alphamissense-2993"><span class="linenos">2993</span></a>
</span><span id="databases_download_alphamissense-2994"><a href="#databases_download_alphamissense-2994"><span class="linenos">2994</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_download_alphamissense">databases_download_alphamissense</a></code> function downloads and converts AlphaMissense databases for a
list of assemblies.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>assemblies</strong>:  <code>assemblies</code> is a list of assemblies for which the AlphaMissense database needs
to be downloaded. Each assembly represents a specific genome or genetic sequence</li>
<li><strong>alphamissense_folder</strong>:  The <code>alphamissense_folder</code> parameter is a string that specifies the
folder where the AlphaMissense files will be downloaded and stored. It is set to
<code>DEFAULT_ANNOTATIONS_FOLDER</code> by default, which is likely a predefined constant or variable in your
code</li>
<li><strong>alphamissense_url</strong>:  The <code>alphamissense_url</code> parameter is a string that specifies the URL where
the AlphaMissense files are located. It is used to construct the download URL for each assembly's
AlphaMissense file</li>
<li><strong>threads</strong>:  The <code>threads</code> parameter is an optional parameter that specifies the number of
threads to use for the conversion process. It determines the level of parallelism when converting
the AlphaMissense TSV file to the Parquet format. If not specified, the default value will be used</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The function <code><a href="#databases_download_alphamissense">databases_download_alphamissense</a></code> returns a boolean value <code>True</code>.</p>
</blockquote>
</div>


                </section>
                <section id="databases_download_exomiser">
                            <input id="databases_download_exomiser-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_exomiser</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">exomiser_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/lebechea/howard/databases/exomiser/current&#39;</span>,</span><span class="param">	<span class="n">exomiser_application_properties</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exomiser_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://data.monarchinitiative.org/exomiser&#39;</span>,</span><span class="param">	<span class="n">exomiser_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exomiser_phenotype_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exomiser_remm_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exomiser_remm_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;https://kircherlab.bihealth.org/download/ReMM&#39;</span>,</span><span class="param">	<span class="n">exomiser_cadd_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exomiser_cadd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;https://kircherlab.bihealth.org/download/CADD&#39;</span>,</span><span class="param">	<span class="n">exomiser_cadd_url_snv_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;whole_genome_SNVs.tsv.gz&#39;</span>,</span><span class="param">	<span class="n">exomiser_cadd_url_indel_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;InDels.tsv.gz&#39;</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="databases_download_exomiser-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_exomiser"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_exomiser-2997"><a href="#databases_download_exomiser-2997"><span class="linenos">2997</span></a><span class="k">def</span> <span class="nf">databases_download_exomiser</span><span class="p">(</span>
</span><span id="databases_download_exomiser-2998"><a href="#databases_download_exomiser-2998"><span class="linenos">2998</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="databases_download_exomiser-2999"><a href="#databases_download_exomiser-2999"><span class="linenos">2999</span></a>    <span class="n">exomiser_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_EXOMISER_FOLDER</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3000"><a href="#databases_download_exomiser-3000"><span class="linenos">3000</span></a>    <span class="n">exomiser_application_properties</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3001"><a href="#databases_download_exomiser-3001"><span class="linenos">3001</span></a>    <span class="n">exomiser_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_EXOMISER_URL</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3002"><a href="#databases_download_exomiser-3002"><span class="linenos">3002</span></a>    <span class="n">exomiser_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3003"><a href="#databases_download_exomiser-3003"><span class="linenos">3003</span></a>    <span class="n">exomiser_phenotype_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3004"><a href="#databases_download_exomiser-3004"><span class="linenos">3004</span></a>    <span class="n">exomiser_remm_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3005"><a href="#databases_download_exomiser-3005"><span class="linenos">3005</span></a>    <span class="n">exomiser_remm_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://kircherlab.bihealth.org/download/ReMM&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3006"><a href="#databases_download_exomiser-3006"><span class="linenos">3006</span></a>    <span class="n">exomiser_cadd_release</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3007"><a href="#databases_download_exomiser-3007"><span class="linenos">3007</span></a>    <span class="n">exomiser_cadd_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://kircherlab.bihealth.org/download/CADD&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3008"><a href="#databases_download_exomiser-3008"><span class="linenos">3008</span></a>    <span class="n">exomiser_cadd_url_snv_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whole_genome_SNVs.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3009"><a href="#databases_download_exomiser-3009"><span class="linenos">3009</span></a>    <span class="n">exomiser_cadd_url_indel_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;InDels.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3010"><a href="#databases_download_exomiser-3010"><span class="linenos">3010</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3011"><a href="#databases_download_exomiser-3011"><span class="linenos">3011</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3012"><a href="#databases_download_exomiser-3012"><span class="linenos">3012</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_exomiser-3013"><a href="#databases_download_exomiser-3013"><span class="linenos">3013</span></a><span class="sd">    The `databases_download_exomiser` function downloads and sets up the Exomiser database for the</span>
</span><span id="databases_download_exomiser-3014"><a href="#databases_download_exomiser-3014"><span class="linenos">3014</span></a><span class="sd">    specified assemblies.</span>
</span><span id="databases_download_exomiser-3015"><a href="#databases_download_exomiser-3015"><span class="linenos">3015</span></a>
</span><span id="databases_download_exomiser-3016"><a href="#databases_download_exomiser-3016"><span class="linenos">3016</span></a><span class="sd">    :param assemblies: A list of assemblies for which to download Exomiser databases. Each assembly is a</span>
</span><span id="databases_download_exomiser-3017"><a href="#databases_download_exomiser-3017"><span class="linenos">3017</span></a><span class="sd">    string representing a genome build, such as &quot;GRCh37&quot; or &quot;GRCh38&quot;</span>
</span><span id="databases_download_exomiser-3018"><a href="#databases_download_exomiser-3018"><span class="linenos">3018</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_exomiser-3019"><a href="#databases_download_exomiser-3019"><span class="linenos">3019</span></a><span class="sd">    :param exomiser_folder: The `exomiser_folder` parameter is a string that specifies the folder where</span>
</span><span id="databases_download_exomiser-3020"><a href="#databases_download_exomiser-3020"><span class="linenos">3020</span></a><span class="sd">    the Exomiser databases will be downloaded and stored. If the folder does not exist, it will be</span>
</span><span id="databases_download_exomiser-3021"><a href="#databases_download_exomiser-3021"><span class="linenos">3021</span></a><span class="sd">    created</span>
</span><span id="databases_download_exomiser-3022"><a href="#databases_download_exomiser-3022"><span class="linenos">3022</span></a><span class="sd">    :type exomiser_folder: str</span>
</span><span id="databases_download_exomiser-3023"><a href="#databases_download_exomiser-3023"><span class="linenos">3023</span></a><span class="sd">    :param exomiser_application_properties: The `exomiser_application_properties` parameter is a string</span>
</span><span id="databases_download_exomiser-3024"><a href="#databases_download_exomiser-3024"><span class="linenos">3024</span></a><span class="sd">    representing the path to the Exomiser application properties file. This file contains configuration</span>
</span><span id="databases_download_exomiser-3025"><a href="#databases_download_exomiser-3025"><span class="linenos">3025</span></a><span class="sd">    settings for the Exomiser tool. If this parameter is not provided, the function will attempt to</span>
</span><span id="databases_download_exomiser-3026"><a href="#databases_download_exomiser-3026"><span class="linenos">3026</span></a><span class="sd">    locate the application properties file automatically based on the Exomiser</span>
</span><span id="databases_download_exomiser-3027"><a href="#databases_download_exomiser-3027"><span class="linenos">3027</span></a><span class="sd">    :type exomiser_application_properties: str</span>
</span><span id="databases_download_exomiser-3028"><a href="#databases_download_exomiser-3028"><span class="linenos">3028</span></a><span class="sd">    :param exomiser_url: The `exomiser_url` parameter is the URL where the Exomiser database files can</span>
</span><span id="databases_download_exomiser-3029"><a href="#databases_download_exomiser-3029"><span class="linenos">3029</span></a><span class="sd">    be downloaded from. It is used to construct the download URLs for the phenotype and assembly files</span>
</span><span id="databases_download_exomiser-3030"><a href="#databases_download_exomiser-3030"><span class="linenos">3030</span></a><span class="sd">    :type exomiser_url: str</span>
</span><span id="databases_download_exomiser-3031"><a href="#databases_download_exomiser-3031"><span class="linenos">3031</span></a><span class="sd">    :param exomiser_release: The `exomiser_release` parameter is used to specify the version of the</span>
</span><span id="databases_download_exomiser-3032"><a href="#databases_download_exomiser-3032"><span class="linenos">3032</span></a><span class="sd">    Exomiser data to download. If it is set to &quot;default&quot;, &quot;auto&quot;, or &quot;config&quot;, the function will attempt</span>
</span><span id="databases_download_exomiser-3033"><a href="#databases_download_exomiser-3033"><span class="linenos">3033</span></a><span class="sd">    to retrieve the version from the `exomiser.application.properties` file. If it is</span>
</span><span id="databases_download_exomiser-3034"><a href="#databases_download_exomiser-3034"><span class="linenos">3034</span></a><span class="sd">    :type exomiser_release: str</span>
</span><span id="databases_download_exomiser-3035"><a href="#databases_download_exomiser-3035"><span class="linenos">3035</span></a><span class="sd">    :param exomiser_phenotype_release: The `exomiser_phenotype_release` parameter is used to specify the</span>
</span><span id="databases_download_exomiser-3036"><a href="#databases_download_exomiser-3036"><span class="linenos">3036</span></a><span class="sd">    release version of the Exomiser phenotype database. If not provided, it will default to the value</span>
</span><span id="databases_download_exomiser-3037"><a href="#databases_download_exomiser-3037"><span class="linenos">3037</span></a><span class="sd">    specified in the `application.properties` file or the latest available release</span>
</span><span id="databases_download_exomiser-3038"><a href="#databases_download_exomiser-3038"><span class="linenos">3038</span></a><span class="sd">    :type exomiser_phenotype_release: str</span>
</span><span id="databases_download_exomiser-3039"><a href="#databases_download_exomiser-3039"><span class="linenos">3039</span></a><span class="sd">    :param exomiser_remm_release: The `exomiser_remm_release` parameter is used to specify the version</span>
</span><span id="databases_download_exomiser-3040"><a href="#databases_download_exomiser-3040"><span class="linenos">3040</span></a><span class="sd">    of the ReMM (Regulatory Mendelian Mutation) database to download. If the value is set to &quot;default&quot;,</span>
</span><span id="databases_download_exomiser-3041"><a href="#databases_download_exomiser-3041"><span class="linenos">3041</span></a><span class="sd">    &quot;auto&quot;, or &quot;config&quot;, it will try to retrieve the version from the `application.properties`</span>
</span><span id="databases_download_exomiser-3042"><a href="#databases_download_exomiser-3042"><span class="linenos">3042</span></a><span class="sd">    :type exomiser_remm_release: str</span>
</span><span id="databases_download_exomiser-3043"><a href="#databases_download_exomiser-3043"><span class="linenos">3043</span></a><span class="sd">    :param exomiser_remm_url: The `exomiser_remm_url` parameter is the URL where the ReMM (Regulatory</span>
</span><span id="databases_download_exomiser-3044"><a href="#databases_download_exomiser-3044"><span class="linenos">3044</span></a><span class="sd">    Mendelian Mutation) database can be downloaded from. It is used in the function to construct the</span>
</span><span id="databases_download_exomiser-3045"><a href="#databases_download_exomiser-3045"><span class="linenos">3045</span></a><span class="sd">    download URL for the ReMM database files, defaults to https://kircherlab.bihealth.org/download/ReMM</span>
</span><span id="databases_download_exomiser-3046"><a href="#databases_download_exomiser-3046"><span class="linenos">3046</span></a><span class="sd">    :type exomiser_remm_url: str (optional)</span>
</span><span id="databases_download_exomiser-3047"><a href="#databases_download_exomiser-3047"><span class="linenos">3047</span></a><span class="sd">    :param exomiser_cadd_release: The `exomiser_cadd_release` parameter is used to specify the version</span>
</span><span id="databases_download_exomiser-3048"><a href="#databases_download_exomiser-3048"><span class="linenos">3048</span></a><span class="sd">    of the CADD (Combined Annotation Dependent Depletion) database to download. If the value is set to</span>
</span><span id="databases_download_exomiser-3049"><a href="#databases_download_exomiser-3049"><span class="linenos">3049</span></a><span class="sd">    &quot;default&quot;, &quot;auto&quot;, or &quot;config&quot;, it will try to retrieve the version from the `exom</span>
</span><span id="databases_download_exomiser-3050"><a href="#databases_download_exomiser-3050"><span class="linenos">3050</span></a><span class="sd">    :type exomiser_cadd_release: str</span>
</span><span id="databases_download_exomiser-3051"><a href="#databases_download_exomiser-3051"><span class="linenos">3051</span></a><span class="sd">    :param exomiser_cadd_url: The `exomiser_cadd_url` parameter is the URL where the CADD (Combined</span>
</span><span id="databases_download_exomiser-3052"><a href="#databases_download_exomiser-3052"><span class="linenos">3052</span></a><span class="sd">    Annotation Dependent Depletion) database files can be downloaded from. It is used to construct the</span>
</span><span id="databases_download_exomiser-3053"><a href="#databases_download_exomiser-3053"><span class="linenos">3053</span></a><span class="sd">    download URLs for the CADD database files, defaults to https://kircherlab.bihealth.org/download/CADD</span>
</span><span id="databases_download_exomiser-3054"><a href="#databases_download_exomiser-3054"><span class="linenos">3054</span></a><span class="sd">    :type exomiser_cadd_url: str (optional)</span>
</span><span id="databases_download_exomiser-3055"><a href="#databases_download_exomiser-3055"><span class="linenos">3055</span></a><span class="sd">    :param exomiser_cadd_url_snv_file: The parameter `exomiser_cadd_url_snv_file` is the name of the</span>
</span><span id="databases_download_exomiser-3056"><a href="#databases_download_exomiser-3056"><span class="linenos">3056</span></a><span class="sd">    file containing the SNV (Single Nucleotide Variant) data for the CADD (Combined Annotation Dependent</span>
</span><span id="databases_download_exomiser-3057"><a href="#databases_download_exomiser-3057"><span class="linenos">3057</span></a><span class="sd">    Depletion) database, defaults to whole_genome_SNVs.tsv.gz</span>
</span><span id="databases_download_exomiser-3058"><a href="#databases_download_exomiser-3058"><span class="linenos">3058</span></a><span class="sd">    :type exomiser_cadd_url_snv_file: str (optional)</span>
</span><span id="databases_download_exomiser-3059"><a href="#databases_download_exomiser-3059"><span class="linenos">3059</span></a><span class="sd">    :param exomiser_cadd_url_indel_file: The parameter `exomiser_cadd_url_indel_file` is the name of the</span>
</span><span id="databases_download_exomiser-3060"><a href="#databases_download_exomiser-3060"><span class="linenos">3060</span></a><span class="sd">    INDEL file that will be downloaded from the CADD database, defaults to InDels.tsv.gz</span>
</span><span id="databases_download_exomiser-3061"><a href="#databases_download_exomiser-3061"><span class="linenos">3061</span></a><span class="sd">    :type exomiser_cadd_url_indel_file: str (optional)</span>
</span><span id="databases_download_exomiser-3062"><a href="#databases_download_exomiser-3062"><span class="linenos">3062</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for parallel</span>
</span><span id="databases_download_exomiser-3063"><a href="#databases_download_exomiser-3063"><span class="linenos">3063</span></a><span class="sd">    processing. It determines how many tasks can be executed simultaneously. Increasing the number of</span>
</span><span id="databases_download_exomiser-3064"><a href="#databases_download_exomiser-3064"><span class="linenos">3064</span></a><span class="sd">    threads can potentially speed up the execution time of the function, especially if there are</span>
</span><span id="databases_download_exomiser-3065"><a href="#databases_download_exomiser-3065"><span class="linenos">3065</span></a><span class="sd">    multiple cores available on the machine</span>
</span><span id="databases_download_exomiser-3066"><a href="#databases_download_exomiser-3066"><span class="linenos">3066</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="databases_download_exomiser-3067"><a href="#databases_download_exomiser-3067"><span class="linenos">3067</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_exomiser-3068"><a href="#databases_download_exomiser-3068"><span class="linenos">3068</span></a>
</span><span id="databases_download_exomiser-3069"><a href="#databases_download_exomiser-3069"><span class="linenos">3069</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3070"><a href="#databases_download_exomiser-3070"><span class="linenos">3070</span></a>
</span><span id="databases_download_exomiser-3071"><a href="#databases_download_exomiser-3071"><span class="linenos">3071</span></a>    <span class="c1"># Variables</span>
</span><span id="databases_download_exomiser-3072"><a href="#databases_download_exomiser-3072"><span class="linenos">3072</span></a>    <span class="n">transcript_source_default</span> <span class="o">=</span> <span class="s2">&quot;refseq&quot;</span>
</span><span id="databases_download_exomiser-3073"><a href="#databases_download_exomiser-3073"><span class="linenos">3073</span></a>    <span class="n">exomiser_release_default</span> <span class="o">=</span> <span class="s2">&quot;2402&quot;</span>
</span><span id="databases_download_exomiser-3074"><a href="#databases_download_exomiser-3074"><span class="linenos">3074</span></a>
</span><span id="databases_download_exomiser-3075"><a href="#databases_download_exomiser-3075"><span class="linenos">3075</span></a>    <span class="c1"># Full Path</span>
</span><span id="databases_download_exomiser-3076"><a href="#databases_download_exomiser-3076"><span class="linenos">3076</span></a>    <span class="n">exomiser_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3077"><a href="#databases_download_exomiser-3077"><span class="linenos">3077</span></a>    <span class="n">exomiser_application_properties</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">exomiser_application_properties</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3078"><a href="#databases_download_exomiser-3078"><span class="linenos">3078</span></a>
</span><span id="databases_download_exomiser-3079"><a href="#databases_download_exomiser-3079"><span class="linenos">3079</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_folder=</span><span class="si">{</span><span class="n">exomiser_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3080"><a href="#databases_download_exomiser-3080"><span class="linenos">3080</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_application_properties=</span><span class="si">{</span><span class="n">exomiser_application_properties</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3081"><a href="#databases_download_exomiser-3081"><span class="linenos">3081</span></a>
</span><span id="databases_download_exomiser-3082"><a href="#databases_download_exomiser-3082"><span class="linenos">3082</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_exomiser-3083"><a href="#databases_download_exomiser-3083"><span class="linenos">3083</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3084"><a href="#databases_download_exomiser-3084"><span class="linenos">3084</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3085"><a href="#databases_download_exomiser-3085"><span class="linenos">3085</span></a>
</span><span id="databases_download_exomiser-3086"><a href="#databases_download_exomiser-3086"><span class="linenos">3086</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3087"><a href="#databases_download_exomiser-3087"><span class="linenos">3087</span></a>
</span><span id="databases_download_exomiser-3088"><a href="#databases_download_exomiser-3088"><span class="linenos">3088</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser [&#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3089"><a href="#databases_download_exomiser-3089"><span class="linenos">3089</span></a>
</span><span id="databases_download_exomiser-3090"><a href="#databases_download_exomiser-3090"><span class="linenos">3090</span></a>        <span class="c1"># application.properties as dict</span>
</span><span id="databases_download_exomiser-3091"><a href="#databases_download_exomiser-3091"><span class="linenos">3091</span></a>        <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">exomiser_application_properties</span>
</span><span id="databases_download_exomiser-3092"><a href="#databases_download_exomiser-3092"><span class="linenos">3092</span></a>        <span class="n">exomiser_application_properties_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_exomiser-3093"><a href="#databases_download_exomiser-3093"><span class="linenos">3093</span></a>
</span><span id="databases_download_exomiser-3094"><a href="#databases_download_exomiser-3094"><span class="linenos">3094</span></a>        <span class="c1"># Find exomiser_application_properties</span>
</span><span id="databases_download_exomiser-3095"><a href="#databases_download_exomiser-3095"><span class="linenos">3095</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_application_properties_assembly</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3096"><a href="#databases_download_exomiser-3096"><span class="linenos">3096</span></a>            <span class="c1"># Find application.properties on assembly folder</span>
</span><span id="databases_download_exomiser-3097"><a href="#databases_download_exomiser-3097"><span class="linenos">3097</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3098"><a href="#databases_download_exomiser-3098"><span class="linenos">3098</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3099"><a href="#databases_download_exomiser-3099"><span class="linenos">3099</span></a>            <span class="p">):</span>
</span><span id="databases_download_exomiser-3100"><a href="#databases_download_exomiser-3100"><span class="linenos">3100</span></a>                <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3101"><a href="#databases_download_exomiser-3101"><span class="linenos">3101</span></a>                    <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span>
</span><span id="databases_download_exomiser-3102"><a href="#databases_download_exomiser-3102"><span class="linenos">3102</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3103"><a href="#databases_download_exomiser-3103"><span class="linenos">3103</span></a>            <span class="c1"># Find application.properties with exomizer Jar</span>
</span><span id="databases_download_exomiser-3104"><a href="#databases_download_exomiser-3104"><span class="linenos">3104</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3105"><a href="#databases_download_exomiser-3105"><span class="linenos">3105</span></a>                <span class="n">exomiser_jar</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3106"><a href="#databases_download_exomiser-3106"><span class="linenos">3106</span></a>                    <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;exomiser-cli*.jar&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3107"><a href="#databases_download_exomiser-3107"><span class="linenos">3107</span></a>                    <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;exomiser&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3108"><a href="#databases_download_exomiser-3108"><span class="linenos">3108</span></a>                    <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;jar&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3109"><a href="#databases_download_exomiser-3109"><span class="linenos">3109</span></a>                    <span class="n">default_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_TOOLS_FOLDER</span><span class="si">}</span><span class="s2">/exomiser/current&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3110"><a href="#databases_download_exomiser-3110"><span class="linenos">3110</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3111"><a href="#databases_download_exomiser-3111"><span class="linenos">3111</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_jar</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3112"><a href="#databases_download_exomiser-3112"><span class="linenos">3112</span></a>                    <span class="n">exomiser_jar</span> <span class="o">=</span> <span class="n">get_bin</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3113"><a href="#databases_download_exomiser-3113"><span class="linenos">3113</span></a>                        <span class="nb">bin</span><span class="o">=</span><span class="s2">&quot;exomiser-cli*.jar&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3114"><a href="#databases_download_exomiser-3114"><span class="linenos">3114</span></a>                        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;exomiser&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3115"><a href="#databases_download_exomiser-3115"><span class="linenos">3115</span></a>                        <span class="n">bin_type</span><span class="o">=</span><span class="s2">&quot;jar&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3116"><a href="#databases_download_exomiser-3116"><span class="linenos">3116</span></a>                        <span class="n">default_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_TOOLS_FOLDER</span><span class="si">}</span><span class="s2">/exomiser&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3117"><a href="#databases_download_exomiser-3117"><span class="linenos">3117</span></a>                    <span class="p">)</span>
</span><span id="databases_download_exomiser-3118"><a href="#databases_download_exomiser-3118"><span class="linenos">3118</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_jar=</span><span class="si">{</span><span class="n">exomiser_jar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3119"><a href="#databases_download_exomiser-3119"><span class="linenos">3119</span></a>                <span class="k">if</span> <span class="n">exomiser_jar</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_jar</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3120"><a href="#databases_download_exomiser-3120"><span class="linenos">3120</span></a>                    <span class="n">exomiser_jar_dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">exomiser_jar</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3121"><a href="#databases_download_exomiser-3121"><span class="linenos">3121</span></a>                    <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3122"><a href="#databases_download_exomiser-3122"><span class="linenos">3122</span></a>                        <span class="n">exomiser_jar_dirname</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span>
</span><span id="databases_download_exomiser-3123"><a href="#databases_download_exomiser-3123"><span class="linenos">3123</span></a>                    <span class="p">)</span>
</span><span id="databases_download_exomiser-3124"><a href="#databases_download_exomiser-3124"><span class="linenos">3124</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3125"><a href="#databases_download_exomiser-3125"><span class="linenos">3125</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser_application_properties_assembly=</span><span class="si">{</span><span class="n">exomiser_application_properties_assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_exomiser-3126"><a href="#databases_download_exomiser-3126"><span class="linenos">3126</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3127"><a href="#databases_download_exomiser-3127"><span class="linenos">3127</span></a>
</span><span id="databases_download_exomiser-3128"><a href="#databases_download_exomiser-3128"><span class="linenos">3128</span></a>        <span class="k">if</span> <span class="n">exomiser_application_properties_assembly</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3129"><a href="#databases_download_exomiser-3129"><span class="linenos">3129</span></a>            <span class="n">exomiser_application_properties_assembly</span>
</span><span id="databases_download_exomiser-3130"><a href="#databases_download_exomiser-3130"><span class="linenos">3130</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3131"><a href="#databases_download_exomiser-3131"><span class="linenos">3131</span></a>            <span class="n">configs</span> <span class="o">=</span> <span class="n">Properties</span><span class="p">()</span>
</span><span id="databases_download_exomiser-3132"><a href="#databases_download_exomiser-3132"><span class="linenos">3132</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">exomiser_application_properties_assembly</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">read_prop</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3133"><a href="#databases_download_exomiser-3133"><span class="linenos">3133</span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">read_prop</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3134"><a href="#databases_download_exomiser-3134"><span class="linenos">3134</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="databases_download_exomiser-3135"><a href="#databases_download_exomiser-3135"><span class="linenos">3135</span></a>                <span class="n">exomiser_application_properties_dict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_download_exomiser-3136"><a href="#databases_download_exomiser-3136"><span class="linenos">3136</span></a>
</span><span id="databases_download_exomiser-3137"><a href="#databases_download_exomiser-3137"><span class="linenos">3137</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3138"><a href="#databases_download_exomiser-3138"><span class="linenos">3138</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser_application_properties_dict=</span><span class="si">{</span><span class="n">exomiser_application_properties_dict</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_exomiser-3139"><a href="#databases_download_exomiser-3139"><span class="linenos">3139</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3140"><a href="#databases_download_exomiser-3140"><span class="linenos">3140</span></a>
</span><span id="databases_download_exomiser-3141"><a href="#databases_download_exomiser-3141"><span class="linenos">3141</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_release</span> <span class="ow">or</span> <span class="n">exomiser_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="databases_download_exomiser-3142"><a href="#databases_download_exomiser-3142"><span class="linenos">3142</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3143"><a href="#databases_download_exomiser-3143"><span class="linenos">3143</span></a>            <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3144"><a href="#databases_download_exomiser-3144"><span class="linenos">3144</span></a>            <span class="s2">&quot;config&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3145"><a href="#databases_download_exomiser-3145"><span class="linenos">3145</span></a>        <span class="p">]:</span>
</span><span id="databases_download_exomiser-3146"><a href="#databases_download_exomiser-3146"><span class="linenos">3146</span></a>            <span class="n">exomiser_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3147"><a href="#databases_download_exomiser-3147"><span class="linenos">3147</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.data-version&quot;</span><span class="p">,</span> <span class="n">exomiser_release_default</span>
</span><span id="databases_download_exomiser-3148"><a href="#databases_download_exomiser-3148"><span class="linenos">3148</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3149"><a href="#databases_download_exomiser-3149"><span class="linenos">3149</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3150"><a href="#databases_download_exomiser-3150"><span class="linenos">3150</span></a>            <span class="n">exomiser_release_found</span> <span class="o">=</span> <span class="n">exomiser_release</span>
</span><span id="databases_download_exomiser-3151"><a href="#databases_download_exomiser-3151"><span class="linenos">3151</span></a>
</span><span id="databases_download_exomiser-3152"><a href="#databases_download_exomiser-3152"><span class="linenos">3152</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exomiser_phenotype_release</span> <span class="ow">or</span> <span class="n">exomiser_phenotype_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="databases_download_exomiser-3153"><a href="#databases_download_exomiser-3153"><span class="linenos">3153</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3154"><a href="#databases_download_exomiser-3154"><span class="linenos">3154</span></a>            <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3155"><a href="#databases_download_exomiser-3155"><span class="linenos">3155</span></a>            <span class="s2">&quot;config&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3156"><a href="#databases_download_exomiser-3156"><span class="linenos">3156</span></a>        <span class="p">]:</span>
</span><span id="databases_download_exomiser-3157"><a href="#databases_download_exomiser-3157"><span class="linenos">3157</span></a>            <span class="n">exomiser_phenotype_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3158"><a href="#databases_download_exomiser-3158"><span class="linenos">3158</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.phenotype.data-version&quot;</span><span class="p">,</span> <span class="n">exomiser_release_found</span>
</span><span id="databases_download_exomiser-3159"><a href="#databases_download_exomiser-3159"><span class="linenos">3159</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3160"><a href="#databases_download_exomiser-3160"><span class="linenos">3160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3161"><a href="#databases_download_exomiser-3161"><span class="linenos">3161</span></a>            <span class="n">exomiser_phenotype_release_found</span> <span class="o">=</span> <span class="n">exomiser_phenotype_release</span>
</span><span id="databases_download_exomiser-3162"><a href="#databases_download_exomiser-3162"><span class="linenos">3162</span></a>
</span><span id="databases_download_exomiser-3163"><a href="#databases_download_exomiser-3163"><span class="linenos">3163</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_release: </span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3164"><a href="#databases_download_exomiser-3164"><span class="linenos">3164</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_phenotype_release: </span><span class="si">{</span><span class="n">exomiser_phenotype_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3165"><a href="#databases_download_exomiser-3165"><span class="linenos">3165</span></a>
</span><span id="databases_download_exomiser-3166"><a href="#databases_download_exomiser-3166"><span class="linenos">3166</span></a>        <span class="c1"># Phenotype</span>
</span><span id="databases_download_exomiser-3167"><a href="#databases_download_exomiser-3167"><span class="linenos">3167</span></a>        <span class="n">exomiser_phenotype_filename</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3168"><a href="#databases_download_exomiser-3168"><span class="linenos">3168</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_phenotype_release_found</span><span class="si">}</span><span class="s2">_phenotype.zip&quot;</span>
</span><span id="databases_download_exomiser-3169"><a href="#databases_download_exomiser-3169"><span class="linenos">3169</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3170"><a href="#databases_download_exomiser-3170"><span class="linenos">3170</span></a>        <span class="n">exomiser_phenotype_filename_base</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3171"><a href="#databases_download_exomiser-3171"><span class="linenos">3171</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_phenotype_release_found</span><span class="si">}</span><span class="s2">_phenotype&quot;</span>
</span><span id="databases_download_exomiser-3172"><a href="#databases_download_exomiser-3172"><span class="linenos">3172</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3173"><a href="#databases_download_exomiser-3173"><span class="linenos">3173</span></a>        <span class="n">exomiser_phenotype_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3174"><a href="#databases_download_exomiser-3174"><span class="linenos">3174</span></a>            <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename</span>
</span><span id="databases_download_exomiser-3175"><a href="#databases_download_exomiser-3175"><span class="linenos">3175</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3176"><a href="#databases_download_exomiser-3176"><span class="linenos">3176</span></a>        <span class="n">exomiser_phenotype_file_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3177"><a href="#databases_download_exomiser-3177"><span class="linenos">3177</span></a>            <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename_base</span>
</span><span id="databases_download_exomiser-3178"><a href="#databases_download_exomiser-3178"><span class="linenos">3178</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3179"><a href="#databases_download_exomiser-3179"><span class="linenos">3179</span></a>        <span class="n">exomiser_download_phenotype_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3180"><a href="#databases_download_exomiser-3180"><span class="linenos">3180</span></a>            <span class="n">exomiser_url</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename</span>
</span><span id="databases_download_exomiser-3181"><a href="#databases_download_exomiser-3181"><span class="linenos">3181</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3182"><a href="#databases_download_exomiser-3182"><span class="linenos">3182</span></a>
</span><span id="databases_download_exomiser-3183"><a href="#databases_download_exomiser-3183"><span class="linenos">3183</span></a>        <span class="c1"># Download Zip file</span>
</span><span id="databases_download_exomiser-3184"><a href="#databases_download_exomiser-3184"><span class="linenos">3184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_phenotype_file</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3185"><a href="#databases_download_exomiser-3185"><span class="linenos">3185</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3186"><a href="#databases_download_exomiser-3186"><span class="linenos">3186</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_exomiser-3187"><a href="#databases_download_exomiser-3187"><span class="linenos">3187</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3188"><a href="#databases_download_exomiser-3188"><span class="linenos">3188</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3189"><a href="#databases_download_exomiser-3189"><span class="linenos">3189</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_phenotype_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3190"><a href="#databases_download_exomiser-3190"><span class="linenos">3190</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_phenotype_file</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3191"><a href="#databases_download_exomiser-3191"><span class="linenos">3191</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3192"><a href="#databases_download_exomiser-3192"><span class="linenos">3192</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3193"><a href="#databases_download_exomiser-3193"><span class="linenos">3193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3194"><a href="#databases_download_exomiser-3194"><span class="linenos">3194</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3195"><a href="#databases_download_exomiser-3195"><span class="linenos">3195</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_exomiser-3196"><a href="#databases_download_exomiser-3196"><span class="linenos">3196</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3197"><a href="#databases_download_exomiser-3197"><span class="linenos">3197</span></a>
</span><span id="databases_download_exomiser-3198"><a href="#databases_download_exomiser-3198"><span class="linenos">3198</span></a>        <span class="c1"># Extract Zip file</span>
</span><span id="databases_download_exomiser-3199"><a href="#databases_download_exomiser-3199"><span class="linenos">3199</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_phenotype_file_base</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3200"><a href="#databases_download_exomiser-3200"><span class="linenos">3200</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3201"><a href="#databases_download_exomiser-3201"><span class="linenos">3201</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Extract Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_exomiser-3202"><a href="#databases_download_exomiser-3202"><span class="linenos">3202</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3203"><a href="#databases_download_exomiser-3203"><span class="linenos">3203</span></a>            <span class="n">extract_file</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">exomiser_phenotype_file</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3204"><a href="#databases_download_exomiser-3204"><span class="linenos">3204</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3205"><a href="#databases_download_exomiser-3205"><span class="linenos">3205</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3206"><a href="#databases_download_exomiser-3206"><span class="linenos">3206</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Phenotype &#39;</span><span class="si">{</span><span class="n">exomiser_phenotype_filename</span><span class="si">}</span><span class="s2">&#39; already extracted&quot;</span>
</span><span id="databases_download_exomiser-3207"><a href="#databases_download_exomiser-3207"><span class="linenos">3207</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3208"><a href="#databases_download_exomiser-3208"><span class="linenos">3208</span></a>
</span><span id="databases_download_exomiser-3209"><a href="#databases_download_exomiser-3209"><span class="linenos">3209</span></a>        <span class="c1"># Assembly</span>
</span><span id="databases_download_exomiser-3210"><a href="#databases_download_exomiser-3210"><span class="linenos">3210</span></a>        <span class="n">exomiser_assembly_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.zip&quot;</span>
</span><span id="databases_download_exomiser-3211"><a href="#databases_download_exomiser-3211"><span class="linenos">3211</span></a>        <span class="n">exomiser_assembly_filename_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_exomiser-3212"><a href="#databases_download_exomiser-3212"><span class="linenos">3212</span></a>        <span class="n">exomiser_assembly_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3213"><a href="#databases_download_exomiser-3213"><span class="linenos">3213</span></a>            <span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">exomiser_assembly_filename</span>
</span><span id="databases_download_exomiser-3214"><a href="#databases_download_exomiser-3214"><span class="linenos">3214</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3215"><a href="#databases_download_exomiser-3215"><span class="linenos">3215</span></a>        <span class="n">exomiser_assembly_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3216"><a href="#databases_download_exomiser-3216"><span class="linenos">3216</span></a>        <span class="n">exomiser_download_assembly_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3217"><a href="#databases_download_exomiser-3217"><span class="linenos">3217</span></a>            <span class="n">exomiser_url</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">exomiser_assembly_filename</span>
</span><span id="databases_download_exomiser-3218"><a href="#databases_download_exomiser-3218"><span class="linenos">3218</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3219"><a href="#databases_download_exomiser-3219"><span class="linenos">3219</span></a>
</span><span id="databases_download_exomiser-3220"><a href="#databases_download_exomiser-3220"><span class="linenos">3220</span></a>        <span class="c1"># Download Zip file</span>
</span><span id="databases_download_exomiser-3221"><a href="#databases_download_exomiser-3221"><span class="linenos">3221</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_assembly_file</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3222"><a href="#databases_download_exomiser-3222"><span class="linenos">3222</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3223"><a href="#databases_download_exomiser-3223"><span class="linenos">3223</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_exomiser-3224"><a href="#databases_download_exomiser-3224"><span class="linenos">3224</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3225"><a href="#databases_download_exomiser-3225"><span class="linenos">3225</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3226"><a href="#databases_download_exomiser-3226"><span class="linenos">3226</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3227"><a href="#databases_download_exomiser-3227"><span class="linenos">3227</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_assembly_file</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3228"><a href="#databases_download_exomiser-3228"><span class="linenos">3228</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3229"><a href="#databases_download_exomiser-3229"><span class="linenos">3229</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3230"><a href="#databases_download_exomiser-3230"><span class="linenos">3230</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3231"><a href="#databases_download_exomiser-3231"><span class="linenos">3231</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3232"><a href="#databases_download_exomiser-3232"><span class="linenos">3232</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_exomiser-3233"><a href="#databases_download_exomiser-3233"><span class="linenos">3233</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3234"><a href="#databases_download_exomiser-3234"><span class="linenos">3234</span></a>
</span><span id="databases_download_exomiser-3235"><a href="#databases_download_exomiser-3235"><span class="linenos">3235</span></a>        <span class="c1"># Extract Zip file</span>
</span><span id="databases_download_exomiser-3236"><a href="#databases_download_exomiser-3236"><span class="linenos">3236</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3237"><a href="#databases_download_exomiser-3237"><span class="linenos">3237</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="n">exomiser_assembly_filename_base</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3238"><a href="#databases_download_exomiser-3238"><span class="linenos">3238</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3239"><a href="#databases_download_exomiser-3239"><span class="linenos">3239</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3240"><a href="#databases_download_exomiser-3240"><span class="linenos">3240</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Extract Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_exomiser-3241"><a href="#databases_download_exomiser-3241"><span class="linenos">3241</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3242"><a href="#databases_download_exomiser-3242"><span class="linenos">3242</span></a>            <span class="n">extract_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3243"><a href="#databases_download_exomiser-3243"><span class="linenos">3243</span></a>                <span class="n">file_path</span><span class="o">=</span><span class="n">exomiser_assembly_file</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3244"><a href="#databases_download_exomiser-3244"><span class="linenos">3244</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3245"><a href="#databases_download_exomiser-3245"><span class="linenos">3245</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3246"><a href="#databases_download_exomiser-3246"><span class="linenos">3246</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3247"><a href="#databases_download_exomiser-3247"><span class="linenos">3247</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3248"><a href="#databases_download_exomiser-3248"><span class="linenos">3248</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3249"><a href="#databases_download_exomiser-3249"><span class="linenos">3249</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Data &#39;</span><span class="si">{</span><span class="n">exomiser_assembly_filename</span><span class="si">}</span><span class="s2">&#39; already extracted&quot;</span>
</span><span id="databases_download_exomiser-3250"><a href="#databases_download_exomiser-3250"><span class="linenos">3250</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3251"><a href="#databases_download_exomiser-3251"><span class="linenos">3251</span></a>
</span><span id="databases_download_exomiser-3252"><a href="#databases_download_exomiser-3252"><span class="linenos">3252</span></a>        <span class="c1"># Link Phenotype to assembly</span>
</span><span id="databases_download_exomiser-3253"><a href="#databases_download_exomiser-3253"><span class="linenos">3253</span></a>        <span class="n">phenotype_assembly_link_src</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../</span><span class="si">{</span><span class="n">exomiser_phenotype_filename_base</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_exomiser-3254"><a href="#databases_download_exomiser-3254"><span class="linenos">3254</span></a>        <span class="n">phenotype_assembly_link_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3255"><a href="#databases_download_exomiser-3255"><span class="linenos">3255</span></a>            <span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="n">exomiser_phenotype_filename_base</span>
</span><span id="databases_download_exomiser-3256"><a href="#databases_download_exomiser-3256"><span class="linenos">3256</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3257"><a href="#databases_download_exomiser-3257"><span class="linenos">3257</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">phenotype_assembly_link_dest</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3258"><a href="#databases_download_exomiser-3258"><span class="linenos">3258</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3259"><a href="#databases_download_exomiser-3259"><span class="linenos">3259</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Create Data &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">phenotype_assembly_link_dest</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; Phenotype link...&quot;</span>
</span><span id="databases_download_exomiser-3260"><a href="#databases_download_exomiser-3260"><span class="linenos">3260</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3261"><a href="#databases_download_exomiser-3261"><span class="linenos">3261</span></a>
</span><span id="databases_download_exomiser-3262"><a href="#databases_download_exomiser-3262"><span class="linenos">3262</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">phenotype_assembly_link_src</span><span class="p">,</span> <span class="n">phenotype_assembly_link_dest</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3263"><a href="#databases_download_exomiser-3263"><span class="linenos">3263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3264"><a href="#databases_download_exomiser-3264"><span class="linenos">3264</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3265"><a href="#databases_download_exomiser-3265"><span class="linenos">3265</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database Data &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">phenotype_assembly_link_dest</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; Phenotype link already created&quot;</span>
</span><span id="databases_download_exomiser-3266"><a href="#databases_download_exomiser-3266"><span class="linenos">3266</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3267"><a href="#databases_download_exomiser-3267"><span class="linenos">3267</span></a>
</span><span id="databases_download_exomiser-3268"><a href="#databases_download_exomiser-3268"><span class="linenos">3268</span></a>        <span class="c1"># Generate properties for assembly</span>
</span><span id="databases_download_exomiser-3269"><a href="#databases_download_exomiser-3269"><span class="linenos">3269</span></a>        <span class="n">exomiser_application_properties_assembly_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3270"><a href="#databases_download_exomiser-3270"><span class="linenos">3270</span></a>            <span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="s2">&quot;application.properties&quot;</span>
</span><span id="databases_download_exomiser-3271"><a href="#databases_download_exomiser-3271"><span class="linenos">3271</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3272"><a href="#databases_download_exomiser-3272"><span class="linenos">3272</span></a>        <span class="n">exomiser_application_properties_assembly</span> <span class="o">=</span> <span class="n">Properties</span><span class="p">()</span>
</span><span id="databases_download_exomiser-3273"><a href="#databases_download_exomiser-3273"><span class="linenos">3273</span></a>
</span><span id="databases_download_exomiser-3274"><a href="#databases_download_exomiser-3274"><span class="linenos">3274</span></a>        <span class="c1"># data directory</span>
</span><span id="databases_download_exomiser-3275"><a href="#databases_download_exomiser-3275"><span class="linenos">3275</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="s2">&quot;exomiser.data-directory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3276"><a href="#databases_download_exomiser-3276"><span class="linenos">3276</span></a>            <span class="n">exomiser_assembly_folder</span>
</span><span id="databases_download_exomiser-3277"><a href="#databases_download_exomiser-3277"><span class="linenos">3277</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3278"><a href="#databases_download_exomiser-3278"><span class="linenos">3278</span></a>
</span><span id="databases_download_exomiser-3279"><a href="#databases_download_exomiser-3279"><span class="linenos">3279</span></a>        <span class="c1"># data version</span>
</span><span id="databases_download_exomiser-3280"><a href="#databases_download_exomiser-3280"><span class="linenos">3280</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="databases_download_exomiser-3281"><a href="#databases_download_exomiser-3281"><span class="linenos">3281</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.data-version&quot;</span>
</span><span id="databases_download_exomiser-3282"><a href="#databases_download_exomiser-3282"><span class="linenos">3282</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="n">exomiser_release_found</span>
</span><span id="databases_download_exomiser-3283"><a href="#databases_download_exomiser-3283"><span class="linenos">3283</span></a>
</span><span id="databases_download_exomiser-3284"><a href="#databases_download_exomiser-3284"><span class="linenos">3284</span></a>        <span class="c1"># phenotype data version</span>
</span><span id="databases_download_exomiser-3285"><a href="#databases_download_exomiser-3285"><span class="linenos">3285</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;exomiser.phenotype.data-version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3286"><a href="#databases_download_exomiser-3286"><span class="linenos">3286</span></a>            <span class="n">exomiser_phenotype_release_found</span>
</span><span id="databases_download_exomiser-3287"><a href="#databases_download_exomiser-3287"><span class="linenos">3287</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3288"><a href="#databases_download_exomiser-3288"><span class="linenos">3288</span></a>
</span><span id="databases_download_exomiser-3289"><a href="#databases_download_exomiser-3289"><span class="linenos">3289</span></a>        <span class="c1"># variant-white-list-path</span>
</span><span id="databases_download_exomiser-3290"><a href="#databases_download_exomiser-3290"><span class="linenos">3290</span></a>        <span class="n">variant_white_list_file</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3291"><a href="#databases_download_exomiser-3291"><span class="linenos">3291</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_clinvar_whitelist.tsv.gz&quot;</span>
</span><span id="databases_download_exomiser-3292"><a href="#databases_download_exomiser-3292"><span class="linenos">3292</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3293"><a href="#databases_download_exomiser-3293"><span class="linenos">3293</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3294"><a href="#databases_download_exomiser-3294"><span class="linenos">3294</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="n">variant_white_list_file</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3295"><a href="#databases_download_exomiser-3295"><span class="linenos">3295</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3296"><a href="#databases_download_exomiser-3296"><span class="linenos">3296</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="databases_download_exomiser-3297"><a href="#databases_download_exomiser-3297"><span class="linenos">3297</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.variant-white-list-path&quot;</span>
</span><span id="databases_download_exomiser-3298"><a href="#databases_download_exomiser-3298"><span class="linenos">3298</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_release_found</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">_clinvar_whitelist.tsv.gz&quot;</span>
</span><span id="databases_download_exomiser-3299"><a href="#databases_download_exomiser-3299"><span class="linenos">3299</span></a>
</span><span id="databases_download_exomiser-3300"><a href="#databases_download_exomiser-3300"><span class="linenos">3300</span></a>        <span class="c1"># transcript source</span>
</span><span id="databases_download_exomiser-3301"><a href="#databases_download_exomiser-3301"><span class="linenos">3301</span></a>        <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="databases_download_exomiser-3302"><a href="#databases_download_exomiser-3302"><span class="linenos">3302</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.transcript-source&quot;</span>
</span><span id="databases_download_exomiser-3303"><a href="#databases_download_exomiser-3303"><span class="linenos">3303</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="n">transcript_source_default</span>
</span><span id="databases_download_exomiser-3304"><a href="#databases_download_exomiser-3304"><span class="linenos">3304</span></a>
</span><span id="databases_download_exomiser-3305"><a href="#databases_download_exomiser-3305"><span class="linenos">3305</span></a>        <span class="c1"># REMM</span>
</span><span id="databases_download_exomiser-3306"><a href="#databases_download_exomiser-3306"><span class="linenos">3306</span></a>        <span class="n">exomiser_remm_download</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_exomiser-3307"><a href="#databases_download_exomiser-3307"><span class="linenos">3307</span></a>
</span><span id="databases_download_exomiser-3308"><a href="#databases_download_exomiser-3308"><span class="linenos">3308</span></a>        <span class="k">if</span> <span class="n">exomiser_remm_release</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3309"><a href="#databases_download_exomiser-3309"><span class="linenos">3309</span></a>            <span class="c1"># Search release if autodetection</span>
</span><span id="databases_download_exomiser-3310"><a href="#databases_download_exomiser-3310"><span class="linenos">3310</span></a>            <span class="k">if</span> <span class="n">exomiser_remm_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]:</span>
</span><span id="databases_download_exomiser-3311"><a href="#databases_download_exomiser-3311"><span class="linenos">3311</span></a>                <span class="n">exomiser_remm_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3312"><a href="#databases_download_exomiser-3312"><span class="linenos">3312</span></a>                    <span class="s2">&quot;remm.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3313"><a href="#databases_download_exomiser-3313"><span class="linenos">3313</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3314"><a href="#databases_download_exomiser-3314"><span class="linenos">3314</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_remm_release found: </span><span class="si">{</span><span class="n">exomiser_remm_release</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3315"><a href="#databases_download_exomiser-3315"><span class="linenos">3315</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3316"><a href="#databases_download_exomiser-3316"><span class="linenos">3316</span></a>                <span class="n">exomiser_remm_release_found</span> <span class="o">=</span> <span class="n">exomiser_remm_release</span>
</span><span id="databases_download_exomiser-3317"><a href="#databases_download_exomiser-3317"><span class="linenos">3317</span></a>            <span class="c1"># Force create of path and download</span>
</span><span id="databases_download_exomiser-3318"><a href="#databases_download_exomiser-3318"><span class="linenos">3318</span></a>            <span class="n">exomiser_remm_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_exomiser-3319"><a href="#databases_download_exomiser-3319"><span class="linenos">3319</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3320"><a href="#databases_download_exomiser-3320"><span class="linenos">3320</span></a>            <span class="c1"># Check REMM release</span>
</span><span id="databases_download_exomiser-3321"><a href="#databases_download_exomiser-3321"><span class="linenos">3321</span></a>            <span class="n">exomiser_remm_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3322"><a href="#databases_download_exomiser-3322"><span class="linenos">3322</span></a>                <span class="s2">&quot;remm.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3323"><a href="#databases_download_exomiser-3323"><span class="linenos">3323</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3324"><a href="#databases_download_exomiser-3324"><span class="linenos">3324</span></a>
</span><span id="databases_download_exomiser-3325"><a href="#databases_download_exomiser-3325"><span class="linenos">3325</span></a>        <span class="c1"># Check if path is mandatory in application.properties</span>
</span><span id="databases_download_exomiser-3326"><a href="#databases_download_exomiser-3326"><span class="linenos">3326</span></a>        <span class="k">if</span> <span class="n">exomiser_remm_release_found</span> <span class="ow">and</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3327"><a href="#databases_download_exomiser-3327"><span class="linenos">3327</span></a>            <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.remm-path&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3328"><a href="#databases_download_exomiser-3328"><span class="linenos">3328</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3329"><a href="#databases_download_exomiser-3329"><span class="linenos">3329</span></a>            <span class="n">exomiser_remm_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_exomiser-3330"><a href="#databases_download_exomiser-3330"><span class="linenos">3330</span></a>
</span><span id="databases_download_exomiser-3331"><a href="#databases_download_exomiser-3331"><span class="linenos">3331</span></a>        <span class="n">exomiser_assembly_remm_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="s2">&quot;remm&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3332"><a href="#databases_download_exomiser-3332"><span class="linenos">3332</span></a>        <span class="n">exomiser_remm_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3333"><a href="#databases_download_exomiser-3333"><span class="linenos">3333</span></a>            <span class="n">exomiser_assembly_remm_folder</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3334"><a href="#databases_download_exomiser-3334"><span class="linenos">3334</span></a>            <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3335"><a href="#databases_download_exomiser-3335"><span class="linenos">3335</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3336"><a href="#databases_download_exomiser-3336"><span class="linenos">3336</span></a>
</span><span id="databases_download_exomiser-3337"><a href="#databases_download_exomiser-3337"><span class="linenos">3337</span></a>        <span class="k">if</span> <span class="n">exomiser_remm_download</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3338"><a href="#databases_download_exomiser-3338"><span class="linenos">3338</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_assembly_remm_folder</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3339"><a href="#databases_download_exomiser-3339"><span class="linenos">3339</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_assembly_remm_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3340"><a href="#databases_download_exomiser-3340"><span class="linenos">3340</span></a>            <span class="n">exomiser_remm_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_remm_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="databases_download_exomiser-3341"><a href="#databases_download_exomiser-3341"><span class="linenos">3341</span></a>            <span class="n">exomiser_remm_path_md5</span> <span class="o">=</span> <span class="n">exomiser_remm_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tsv.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;.md5&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3342"><a href="#databases_download_exomiser-3342"><span class="linenos">3342</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3343"><a href="#databases_download_exomiser-3343"><span class="linenos">3343</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download REMM database &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_exomiser-3344"><a href="#databases_download_exomiser-3344"><span class="linenos">3344</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3345"><a href="#databases_download_exomiser-3345"><span class="linenos">3345</span></a>            <span class="n">exomiser_download_assembly_remm_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3346"><a href="#databases_download_exomiser-3346"><span class="linenos">3346</span></a>                <span class="n">exomiser_remm_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3347"><a href="#databases_download_exomiser-3347"><span class="linenos">3347</span></a>                <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3348"><a href="#databases_download_exomiser-3348"><span class="linenos">3348</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3349"><a href="#databases_download_exomiser-3349"><span class="linenos">3349</span></a>            <span class="n">exomiser_download_assembly_remm_tbi_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3350"><a href="#databases_download_exomiser-3350"><span class="linenos">3350</span></a>                <span class="n">exomiser_remm_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3351"><a href="#databases_download_exomiser-3351"><span class="linenos">3351</span></a>                <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz.tbi&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3352"><a href="#databases_download_exomiser-3352"><span class="linenos">3352</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3353"><a href="#databases_download_exomiser-3353"><span class="linenos">3353</span></a>            <span class="n">exomiser_download_assembly_remm_md5_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3354"><a href="#databases_download_exomiser-3354"><span class="linenos">3354</span></a>                <span class="n">exomiser_remm_url</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.md5&quot;</span>
</span><span id="databases_download_exomiser-3355"><a href="#databases_download_exomiser-3355"><span class="linenos">3355</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3356"><a href="#databases_download_exomiser-3356"><span class="linenos">3356</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3357"><a href="#databases_download_exomiser-3357"><span class="linenos">3357</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_remm_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3358"><a href="#databases_download_exomiser-3358"><span class="linenos">3358</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_remm_path</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3359"><a href="#databases_download_exomiser-3359"><span class="linenos">3359</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3360"><a href="#databases_download_exomiser-3360"><span class="linenos">3360</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3361"><a href="#databases_download_exomiser-3361"><span class="linenos">3361</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3362"><a href="#databases_download_exomiser-3362"><span class="linenos">3362</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_remm_tbi_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3363"><a href="#databases_download_exomiser-3363"><span class="linenos">3363</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_remm_path_tbi</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3364"><a href="#databases_download_exomiser-3364"><span class="linenos">3364</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3365"><a href="#databases_download_exomiser-3365"><span class="linenos">3365</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3366"><a href="#databases_download_exomiser-3366"><span class="linenos">3366</span></a>            <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3367"><a href="#databases_download_exomiser-3367"><span class="linenos">3367</span></a>                <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_remm_md5_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3368"><a href="#databases_download_exomiser-3368"><span class="linenos">3368</span></a>                <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_remm_path_md5</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3369"><a href="#databases_download_exomiser-3369"><span class="linenos">3369</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3370"><a href="#databases_download_exomiser-3370"><span class="linenos">3370</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3371"><a href="#databases_download_exomiser-3371"><span class="linenos">3371</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3372"><a href="#databases_download_exomiser-3372"><span class="linenos">3372</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database REMM not downloaded&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3373"><a href="#databases_download_exomiser-3373"><span class="linenos">3373</span></a>
</span><span id="databases_download_exomiser-3374"><a href="#databases_download_exomiser-3374"><span class="linenos">3374</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3375"><a href="#databases_download_exomiser-3375"><span class="linenos">3375</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">exomiser_remm_path</span><span class="si">}</span><span class="s2"> and os.path.exists(</span><span class="si">{</span><span class="n">exomiser_remm_path</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="databases_download_exomiser-3376"><a href="#databases_download_exomiser-3376"><span class="linenos">3376</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3377"><a href="#databases_download_exomiser-3377"><span class="linenos">3377</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3378"><a href="#databases_download_exomiser-3378"><span class="linenos">3378</span></a>            <span class="n">exomiser_remm_release_found</span>
</span><span id="databases_download_exomiser-3379"><a href="#databases_download_exomiser-3379"><span class="linenos">3379</span></a>            <span class="ow">and</span> <span class="n">exomiser_remm_path</span>
</span><span id="databases_download_exomiser-3380"><a href="#databases_download_exomiser-3380"><span class="linenos">3380</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3381"><a href="#databases_download_exomiser-3381"><span class="linenos">3381</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3382"><a href="#databases_download_exomiser-3382"><span class="linenos">3382</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3383"><a href="#databases_download_exomiser-3383"><span class="linenos">3383</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database REMM &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_remm_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_exomiser-3384"><a href="#databases_download_exomiser-3384"><span class="linenos">3384</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3385"><a href="#databases_download_exomiser-3385"><span class="linenos">3385</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="s2">&quot;remm.version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3386"><a href="#databases_download_exomiser-3386"><span class="linenos">3386</span></a>                <span class="n">exomiser_remm_release_found</span>
</span><span id="databases_download_exomiser-3387"><a href="#databases_download_exomiser-3387"><span class="linenos">3387</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3388"><a href="#databases_download_exomiser-3388"><span class="linenos">3388</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="databases_download_exomiser-3389"><a href="#databases_download_exomiser-3389"><span class="linenos">3389</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.remm-path&quot;</span>
</span><span id="databases_download_exomiser-3390"><a href="#databases_download_exomiser-3390"><span class="linenos">3390</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3391"><a href="#databases_download_exomiser-3391"><span class="linenos">3391</span></a>                <span class="p">[</span>
</span><span id="databases_download_exomiser-3392"><a href="#databases_download_exomiser-3392"><span class="linenos">3392</span></a>                    <span class="s2">&quot;${exomiser.data-directory}&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3393"><a href="#databases_download_exomiser-3393"><span class="linenos">3393</span></a>                    <span class="s2">&quot;remm&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3394"><a href="#databases_download_exomiser-3394"><span class="linenos">3394</span></a>                    <span class="sa">f</span><span class="s2">&quot;ReMM.v</span><span class="si">{</span><span class="n">exomiser_remm_release_found</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.tsv.gz&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3395"><a href="#databases_download_exomiser-3395"><span class="linenos">3395</span></a>                <span class="p">]</span>
</span><span id="databases_download_exomiser-3396"><a href="#databases_download_exomiser-3396"><span class="linenos">3396</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3397"><a href="#databases_download_exomiser-3397"><span class="linenos">3397</span></a>
</span><span id="databases_download_exomiser-3398"><a href="#databases_download_exomiser-3398"><span class="linenos">3398</span></a>        <span class="c1"># CADD</span>
</span><span id="databases_download_exomiser-3399"><a href="#databases_download_exomiser-3399"><span class="linenos">3399</span></a>        <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_exomiser-3400"><a href="#databases_download_exomiser-3400"><span class="linenos">3400</span></a>
</span><span id="databases_download_exomiser-3401"><a href="#databases_download_exomiser-3401"><span class="linenos">3401</span></a>        <span class="k">if</span> <span class="n">exomiser_cadd_release</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3402"><a href="#databases_download_exomiser-3402"><span class="linenos">3402</span></a>            <span class="k">if</span> <span class="n">exomiser_cadd_release</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]:</span>
</span><span id="databases_download_exomiser-3403"><a href="#databases_download_exomiser-3403"><span class="linenos">3403</span></a>                <span class="n">exomiser_cadd_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3404"><a href="#databases_download_exomiser-3404"><span class="linenos">3404</span></a>                    <span class="s2">&quot;cadd.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3405"><a href="#databases_download_exomiser-3405"><span class="linenos">3405</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3406"><a href="#databases_download_exomiser-3406"><span class="linenos">3406</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_cadd_release found: </span><span class="si">{</span><span class="n">exomiser_cadd_release</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3407"><a href="#databases_download_exomiser-3407"><span class="linenos">3407</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3408"><a href="#databases_download_exomiser-3408"><span class="linenos">3408</span></a>                <span class="n">exomiser_cadd_release_found</span> <span class="o">=</span> <span class="n">exomiser_cadd_release</span>
</span><span id="databases_download_exomiser-3409"><a href="#databases_download_exomiser-3409"><span class="linenos">3409</span></a>            <span class="c1"># Force create of path and download</span>
</span><span id="databases_download_exomiser-3410"><a href="#databases_download_exomiser-3410"><span class="linenos">3410</span></a>            <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_exomiser-3411"><a href="#databases_download_exomiser-3411"><span class="linenos">3411</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3412"><a href="#databases_download_exomiser-3412"><span class="linenos">3412</span></a>            <span class="c1"># Check CADD release</span>
</span><span id="databases_download_exomiser-3413"><a href="#databases_download_exomiser-3413"><span class="linenos">3413</span></a>            <span class="n">exomiser_cadd_release_found</span> <span class="o">=</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3414"><a href="#databases_download_exomiser-3414"><span class="linenos">3414</span></a>                <span class="s2">&quot;cadd.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3415"><a href="#databases_download_exomiser-3415"><span class="linenos">3415</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3416"><a href="#databases_download_exomiser-3416"><span class="linenos">3416</span></a>
</span><span id="databases_download_exomiser-3417"><a href="#databases_download_exomiser-3417"><span class="linenos">3417</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exomiser_cadd_release: </span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3418"><a href="#databases_download_exomiser-3418"><span class="linenos">3418</span></a>
</span><span id="databases_download_exomiser-3419"><a href="#databases_download_exomiser-3419"><span class="linenos">3419</span></a>        <span class="c1"># Check if path is mandatory in application.properties</span>
</span><span id="databases_download_exomiser-3420"><a href="#databases_download_exomiser-3420"><span class="linenos">3420</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3421"><a href="#databases_download_exomiser-3421"><span class="linenos">3421</span></a>            <span class="n">exomiser_cadd_release_found</span>
</span><span id="databases_download_exomiser-3422"><a href="#databases_download_exomiser-3422"><span class="linenos">3422</span></a>            <span class="ow">and</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3423"><a href="#databases_download_exomiser-3423"><span class="linenos">3423</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-snv-path&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3424"><a href="#databases_download_exomiser-3424"><span class="linenos">3424</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3425"><a href="#databases_download_exomiser-3425"><span class="linenos">3425</span></a>            <span class="ow">and</span> <span class="n">exomiser_application_properties_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3426"><a href="#databases_download_exomiser-3426"><span class="linenos">3426</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-in-del-path&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3427"><a href="#databases_download_exomiser-3427"><span class="linenos">3427</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3428"><a href="#databases_download_exomiser-3428"><span class="linenos">3428</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3429"><a href="#databases_download_exomiser-3429"><span class="linenos">3429</span></a>            <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_exomiser-3430"><a href="#databases_download_exomiser-3430"><span class="linenos">3430</span></a>
</span><span id="databases_download_exomiser-3431"><a href="#databases_download_exomiser-3431"><span class="linenos">3431</span></a>        <span class="k">if</span> <span class="n">exomiser_cadd_release_found</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3432"><a href="#databases_download_exomiser-3432"><span class="linenos">3432</span></a>            <span class="n">exomiser_assembly_cadd_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3433"><a href="#databases_download_exomiser-3433"><span class="linenos">3433</span></a>                <span class="n">exomiser_assembly_folder</span><span class="p">,</span> <span class="s2">&quot;cadd&quot;</span><span class="p">,</span> <span class="n">exomiser_cadd_release_found</span>
</span><span id="databases_download_exomiser-3434"><a href="#databases_download_exomiser-3434"><span class="linenos">3434</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3435"><a href="#databases_download_exomiser-3435"><span class="linenos">3435</span></a>            <span class="n">exomiser_cadd_snv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3436"><a href="#databases_download_exomiser-3436"><span class="linenos">3436</span></a>                <span class="n">exomiser_assembly_cadd_folder</span><span class="p">,</span> <span class="n">exomiser_cadd_url_snv_file</span>
</span><span id="databases_download_exomiser-3437"><a href="#databases_download_exomiser-3437"><span class="linenos">3437</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3438"><a href="#databases_download_exomiser-3438"><span class="linenos">3438</span></a>            <span class="n">exomiser_cadd_indel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3439"><a href="#databases_download_exomiser-3439"><span class="linenos">3439</span></a>                <span class="n">exomiser_assembly_cadd_folder</span><span class="p">,</span> <span class="n">exomiser_cadd_url_indel_file</span>
</span><span id="databases_download_exomiser-3440"><a href="#databases_download_exomiser-3440"><span class="linenos">3440</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3441"><a href="#databases_download_exomiser-3441"><span class="linenos">3441</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3442"><a href="#databases_download_exomiser-3442"><span class="linenos">3442</span></a>            <span class="n">exomiser_cadd_snv_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3443"><a href="#databases_download_exomiser-3443"><span class="linenos">3443</span></a>            <span class="n">exomiser_cadd_indel_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_exomiser-3444"><a href="#databases_download_exomiser-3444"><span class="linenos">3444</span></a>            <span class="n">exomiser_cadd_download</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_exomiser-3445"><a href="#databases_download_exomiser-3445"><span class="linenos">3445</span></a>
</span><span id="databases_download_exomiser-3446"><a href="#databases_download_exomiser-3446"><span class="linenos">3446</span></a>        <span class="k">if</span> <span class="n">exomiser_cadd_download</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3447"><a href="#databases_download_exomiser-3447"><span class="linenos">3447</span></a>            <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3448"><a href="#databases_download_exomiser-3448"><span class="linenos">3448</span></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3449"><a href="#databases_download_exomiser-3449"><span class="linenos">3449</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3450"><a href="#databases_download_exomiser-3450"><span class="linenos">3450</span></a>
</span><span id="databases_download_exomiser-3451"><a href="#databases_download_exomiser-3451"><span class="linenos">3451</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_assembly_cadd_folder</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3452"><a href="#databases_download_exomiser-3452"><span class="linenos">3452</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_assembly_cadd_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3453"><a href="#databases_download_exomiser-3453"><span class="linenos">3453</span></a>
</span><span id="databases_download_exomiser-3454"><a href="#databases_download_exomiser-3454"><span class="linenos">3454</span></a>            <span class="c1"># Genome build from gencode</span>
</span><span id="databases_download_exomiser-3455"><a href="#databases_download_exomiser-3455"><span class="linenos">3455</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3456"><a href="#databases_download_exomiser-3456"><span class="linenos">3456</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Search for assembly &#39;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&#39; into gencode...&quot;</span>
</span><span id="databases_download_exomiser-3457"><a href="#databases_download_exomiser-3457"><span class="linenos">3457</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3458"><a href="#databases_download_exomiser-3458"><span class="linenos">3458</span></a>            <span class="n">genome_build_switch_to_gencode</span> <span class="o">=</span> <span class="n">genome_build_switch</span><span class="p">(</span><span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3459"><a href="#databases_download_exomiser-3459"><span class="linenos">3459</span></a>
</span><span id="databases_download_exomiser-3460"><a href="#databases_download_exomiser-3460"><span class="linenos">3460</span></a>            <span class="c1"># SNV</span>
</span><span id="databases_download_exomiser-3461"><a href="#databases_download_exomiser-3461"><span class="linenos">3461</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3462"><a href="#databases_download_exomiser-3462"><span class="linenos">3462</span></a>                <span class="n">exomiser_cadd_snv_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_snv_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="databases_download_exomiser-3463"><a href="#databases_download_exomiser-3463"><span class="linenos">3463</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3464"><a href="#databases_download_exomiser-3464"><span class="linenos">3464</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download CADD database &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_exomiser-3465"><a href="#databases_download_exomiser-3465"><span class="linenos">3465</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3466"><a href="#databases_download_exomiser-3466"><span class="linenos">3466</span></a>                <span class="n">exomiser_download_assembly_cadd_snv_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3467"><a href="#databases_download_exomiser-3467"><span class="linenos">3467</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3468"><a href="#databases_download_exomiser-3468"><span class="linenos">3468</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3469"><a href="#databases_download_exomiser-3469"><span class="linenos">3469</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3470"><a href="#databases_download_exomiser-3470"><span class="linenos">3470</span></a>                    <span class="n">exomiser_cadd_url_snv_file</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3471"><a href="#databases_download_exomiser-3471"><span class="linenos">3471</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3472"><a href="#databases_download_exomiser-3472"><span class="linenos">3472</span></a>                <span class="n">exomiser_download_assembly_cadd_snv_tbi_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3473"><a href="#databases_download_exomiser-3473"><span class="linenos">3473</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3474"><a href="#databases_download_exomiser-3474"><span class="linenos">3474</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3475"><a href="#databases_download_exomiser-3475"><span class="linenos">3475</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3476"><a href="#databases_download_exomiser-3476"><span class="linenos">3476</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_url_snv_file</span><span class="si">}</span><span class="s2">.tbi&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3477"><a href="#databases_download_exomiser-3477"><span class="linenos">3477</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3478"><a href="#databases_download_exomiser-3478"><span class="linenos">3478</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3479"><a href="#databases_download_exomiser-3479"><span class="linenos">3479</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_snv_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3480"><a href="#databases_download_exomiser-3480"><span class="linenos">3480</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_snv_path</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3481"><a href="#databases_download_exomiser-3481"><span class="linenos">3481</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3482"><a href="#databases_download_exomiser-3482"><span class="linenos">3482</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3483"><a href="#databases_download_exomiser-3483"><span class="linenos">3483</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3484"><a href="#databases_download_exomiser-3484"><span class="linenos">3484</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_snv_tbi_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3485"><a href="#databases_download_exomiser-3485"><span class="linenos">3485</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_snv_path_tbi</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3486"><a href="#databases_download_exomiser-3486"><span class="linenos">3486</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3487"><a href="#databases_download_exomiser-3487"><span class="linenos">3487</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3488"><a href="#databases_download_exomiser-3488"><span class="linenos">3488</span></a>
</span><span id="databases_download_exomiser-3489"><a href="#databases_download_exomiser-3489"><span class="linenos">3489</span></a>            <span class="c1"># INDEL</span>
</span><span id="databases_download_exomiser-3490"><a href="#databases_download_exomiser-3490"><span class="linenos">3490</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3491"><a href="#databases_download_exomiser-3491"><span class="linenos">3491</span></a>                <span class="n">exomiser_cadd_indel_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_indel_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="databases_download_exomiser-3492"><a href="#databases_download_exomiser-3492"><span class="linenos">3492</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3493"><a href="#databases_download_exomiser-3493"><span class="linenos">3493</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Download CADD database &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_exomiser-3494"><a href="#databases_download_exomiser-3494"><span class="linenos">3494</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3495"><a href="#databases_download_exomiser-3495"><span class="linenos">3495</span></a>                <span class="n">exomiser_download_assembly_cadd_indel_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3496"><a href="#databases_download_exomiser-3496"><span class="linenos">3496</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3497"><a href="#databases_download_exomiser-3497"><span class="linenos">3497</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3498"><a href="#databases_download_exomiser-3498"><span class="linenos">3498</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3499"><a href="#databases_download_exomiser-3499"><span class="linenos">3499</span></a>                    <span class="n">exomiser_cadd_url_indel_file</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3500"><a href="#databases_download_exomiser-3500"><span class="linenos">3500</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3501"><a href="#databases_download_exomiser-3501"><span class="linenos">3501</span></a>                <span class="n">exomiser_download_assembly_cadd_indel_tbi_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3502"><a href="#databases_download_exomiser-3502"><span class="linenos">3502</span></a>                    <span class="n">exomiser_cadd_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3503"><a href="#databases_download_exomiser-3503"><span class="linenos">3503</span></a>                    <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3504"><a href="#databases_download_exomiser-3504"><span class="linenos">3504</span></a>                    <span class="n">genome_build_switch_to_gencode</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3505"><a href="#databases_download_exomiser-3505"><span class="linenos">3505</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_url_indel_file</span><span class="si">}</span><span class="s2">.gz.tbi&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3506"><a href="#databases_download_exomiser-3506"><span class="linenos">3506</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3507"><a href="#databases_download_exomiser-3507"><span class="linenos">3507</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3508"><a href="#databases_download_exomiser-3508"><span class="linenos">3508</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_indel_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3509"><a href="#databases_download_exomiser-3509"><span class="linenos">3509</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_indel_path</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3510"><a href="#databases_download_exomiser-3510"><span class="linenos">3510</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3511"><a href="#databases_download_exomiser-3511"><span class="linenos">3511</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3512"><a href="#databases_download_exomiser-3512"><span class="linenos">3512</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3513"><a href="#databases_download_exomiser-3513"><span class="linenos">3513</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">exomiser_download_assembly_cadd_indel_tbi_url</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3514"><a href="#databases_download_exomiser-3514"><span class="linenos">3514</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">exomiser_cadd_indel_path_tbi</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3515"><a href="#databases_download_exomiser-3515"><span class="linenos">3515</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3516"><a href="#databases_download_exomiser-3516"><span class="linenos">3516</span></a>                <span class="p">)</span>
</span><span id="databases_download_exomiser-3517"><a href="#databases_download_exomiser-3517"><span class="linenos">3517</span></a>
</span><span id="databases_download_exomiser-3518"><a href="#databases_download_exomiser-3518"><span class="linenos">3518</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3519"><a href="#databases_download_exomiser-3519"><span class="linenos">3519</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database CADD not downloaded&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3520"><a href="#databases_download_exomiser-3520"><span class="linenos">3520</span></a>
</span><span id="databases_download_exomiser-3521"><a href="#databases_download_exomiser-3521"><span class="linenos">3521</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3522"><a href="#databases_download_exomiser-3522"><span class="linenos">3522</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exomiser_cadd_release_found</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">exomiser_cadd_snv_path</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">exomiser_cadd_indel_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="databases_download_exomiser-3523"><a href="#databases_download_exomiser-3523"><span class="linenos">3523</span></a>        <span class="p">)</span>
</span><span id="databases_download_exomiser-3524"><a href="#databases_download_exomiser-3524"><span class="linenos">3524</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3525"><a href="#databases_download_exomiser-3525"><span class="linenos">3525</span></a>            <span class="n">exomiser_cadd_release_found</span>
</span><span id="databases_download_exomiser-3526"><a href="#databases_download_exomiser-3526"><span class="linenos">3526</span></a>            <span class="ow">and</span> <span class="n">exomiser_cadd_snv_path</span>
</span><span id="databases_download_exomiser-3527"><a href="#databases_download_exomiser-3527"><span class="linenos">3527</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3528"><a href="#databases_download_exomiser-3528"><span class="linenos">3528</span></a>            <span class="ow">and</span> <span class="n">exomiser_cadd_indel_path</span>
</span><span id="databases_download_exomiser-3529"><a href="#databases_download_exomiser-3529"><span class="linenos">3529</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3530"><a href="#databases_download_exomiser-3530"><span class="linenos">3530</span></a>        <span class="p">):</span>
</span><span id="databases_download_exomiser-3531"><a href="#databases_download_exomiser-3531"><span class="linenos">3531</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3532"><a href="#databases_download_exomiser-3532"><span class="linenos">3532</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database CADD &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_snv_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_exomiser-3533"><a href="#databases_download_exomiser-3533"><span class="linenos">3533</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3534"><a href="#databases_download_exomiser-3534"><span class="linenos">3534</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3535"><a href="#databases_download_exomiser-3535"><span class="linenos">3535</span></a>                <span class="sa">f</span><span class="s2">&quot;Download Exomiser </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2"> - Database CADD &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exomiser_cadd_indel_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_exomiser-3536"><a href="#databases_download_exomiser-3536"><span class="linenos">3536</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3537"><a href="#databases_download_exomiser-3537"><span class="linenos">3537</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span><span class="s2">&quot;cadd.version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_exomiser-3538"><a href="#databases_download_exomiser-3538"><span class="linenos">3538</span></a>                <span class="n">exomiser_cadd_release_found</span>
</span><span id="databases_download_exomiser-3539"><a href="#databases_download_exomiser-3539"><span class="linenos">3539</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3540"><a href="#databases_download_exomiser-3540"><span class="linenos">3540</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="databases_download_exomiser-3541"><a href="#databases_download_exomiser-3541"><span class="linenos">3541</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-snv-path&quot;</span>
</span><span id="databases_download_exomiser-3542"><a href="#databases_download_exomiser-3542"><span class="linenos">3542</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3543"><a href="#databases_download_exomiser-3543"><span class="linenos">3543</span></a>                <span class="p">[</span>
</span><span id="databases_download_exomiser-3544"><a href="#databases_download_exomiser-3544"><span class="linenos">3544</span></a>                    <span class="s2">&quot;${exomiser.data-directory}&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3545"><a href="#databases_download_exomiser-3545"><span class="linenos">3545</span></a>                    <span class="s2">&quot;cadd&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3546"><a href="#databases_download_exomiser-3546"><span class="linenos">3546</span></a>                    <span class="n">exomiser_cadd_release_found</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3547"><a href="#databases_download_exomiser-3547"><span class="linenos">3547</span></a>                    <span class="n">exomiser_cadd_url_snv_file</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3548"><a href="#databases_download_exomiser-3548"><span class="linenos">3548</span></a>                <span class="p">]</span>
</span><span id="databases_download_exomiser-3549"><a href="#databases_download_exomiser-3549"><span class="linenos">3549</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3550"><a href="#databases_download_exomiser-3550"><span class="linenos">3550</span></a>            <span class="n">exomiser_application_properties_assembly</span><span class="p">[</span>
</span><span id="databases_download_exomiser-3551"><a href="#databases_download_exomiser-3551"><span class="linenos">3551</span></a>                <span class="sa">f</span><span class="s2">&quot;exomiser.</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.cadd-in-del-path&quot;</span>
</span><span id="databases_download_exomiser-3552"><a href="#databases_download_exomiser-3552"><span class="linenos">3552</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_exomiser-3553"><a href="#databases_download_exomiser-3553"><span class="linenos">3553</span></a>                <span class="p">[</span>
</span><span id="databases_download_exomiser-3554"><a href="#databases_download_exomiser-3554"><span class="linenos">3554</span></a>                    <span class="s2">&quot;${exomiser.data-directory}&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3555"><a href="#databases_download_exomiser-3555"><span class="linenos">3555</span></a>                    <span class="s2">&quot;cadd&quot;</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3556"><a href="#databases_download_exomiser-3556"><span class="linenos">3556</span></a>                    <span class="n">exomiser_cadd_release_found</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3557"><a href="#databases_download_exomiser-3557"><span class="linenos">3557</span></a>                    <span class="n">exomiser_cadd_url_indel_file</span><span class="p">,</span>
</span><span id="databases_download_exomiser-3558"><a href="#databases_download_exomiser-3558"><span class="linenos">3558</span></a>                <span class="p">]</span>
</span><span id="databases_download_exomiser-3559"><a href="#databases_download_exomiser-3559"><span class="linenos">3559</span></a>            <span class="p">)</span>
</span><span id="databases_download_exomiser-3560"><a href="#databases_download_exomiser-3560"><span class="linenos">3560</span></a>
</span><span id="databases_download_exomiser-3561"><a href="#databases_download_exomiser-3561"><span class="linenos">3561</span></a>        <span class="c1"># Create application.properties</span>
</span><span id="databases_download_exomiser-3562"><a href="#databases_download_exomiser-3562"><span class="linenos">3562</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exomiser_application_properties_assembly_file</span><span class="p">):</span>
</span><span id="databases_download_exomiser-3563"><a href="#databases_download_exomiser-3563"><span class="linenos">3563</span></a>            <span class="k">if</span> <span class="n">exomiser_assembly_folder</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3564"><a href="#databases_download_exomiser-3564"><span class="linenos">3564</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">exomiser_assembly_folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3565"><a href="#databases_download_exomiser-3565"><span class="linenos">3565</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">exomiser_application_properties_assembly_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_exomiser-3566"><a href="#databases_download_exomiser-3566"><span class="linenos">3566</span></a>                <span class="n">exomiser_application_properties_assembly</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="databases_download_exomiser-3567"><a href="#databases_download_exomiser-3567"><span class="linenos">3567</span></a>
</span><span id="databases_download_exomiser-3568"><a href="#databases_download_exomiser-3568"><span class="linenos">3568</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_download_exomiser">databases_download_exomiser</a></code> function downloads and sets up the Exomiser database for the
specified assemblies.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>assemblies</strong>:  A list of assemblies for which to download Exomiser databases. Each assembly is a
string representing a genome build, such as "GRCh37" or "GRCh38"</li>
<li><strong>exomiser_folder</strong>:  The <code>exomiser_folder</code> parameter is a string that specifies the folder where
the Exomiser databases will be downloaded and stored. If the folder does not exist, it will be
created</li>
<li><strong>exomiser_application_properties</strong>:  The <code>exomiser_application_properties</code> parameter is a string
representing the path to the Exomiser application properties file. This file contains configuration
settings for the Exomiser tool. If this parameter is not provided, the function will attempt to
locate the application properties file automatically based on the Exomiser</li>
<li><strong>exomiser_url</strong>:  The <code>exomiser_url</code> parameter is the URL where the Exomiser database files can
be downloaded from. It is used to construct the download URLs for the phenotype and assembly files</li>
<li><strong>exomiser_release</strong>:  The <code>exomiser_release</code> parameter is used to specify the version of the
Exomiser data to download. If it is set to "default", "auto", or "config", the function will attempt
to retrieve the version from the <code>exomiser.application.properties</code> file. If it is</li>
<li><strong>exomiser_phenotype_release</strong>:  The <code>exomiser_phenotype_release</code> parameter is used to specify the
release version of the Exomiser phenotype database. If not provided, it will default to the value
specified in the <code>application.properties</code> file or the latest available release</li>
<li><strong>exomiser_remm_release</strong>:  The <code>exomiser_remm_release</code> parameter is used to specify the version
of the ReMM (Regulatory Mendelian Mutation) database to download. If the value is set to "default",
"auto", or "config", it will try to retrieve the version from the <code>application.properties</code></li>
<li><strong>exomiser_remm_url</strong>:  The <code>exomiser_remm_url</code> parameter is the URL where the ReMM (Regulatory
Mendelian Mutation) database can be downloaded from. It is used in the function to construct the
download URL for the ReMM database files, defaults to <a href="https://kircherlab.bihealth.org/download/ReMM">https://kircherlab.bihealth.org/download/ReMM</a></li>
<li><strong>exomiser_cadd_release</strong>:  The <code>exomiser_cadd_release</code> parameter is used to specify the version
of the CADD (Combined Annotation Dependent Depletion) database to download. If the value is set to
"default", "auto", or "config", it will try to retrieve the version from the `exom</li>
<li><strong>exomiser_cadd_url</strong>:  The <code>exomiser_cadd_url</code> parameter is the URL where the CADD (Combined
Annotation Dependent Depletion) database files can be downloaded from. It is used to construct the
download URLs for the CADD database files, defaults to <a href="https://kircherlab.bihealth.org/download/CADD">https://kircherlab.bihealth.org/download/CADD</a></li>
<li><strong>exomiser_cadd_url_snv_file</strong>:  The parameter <code>exomiser_cadd_url_snv_file</code> is the name of the
file containing the SNV (Single Nucleotide Variant) data for the CADD (Combined Annotation Dependent
Depletion) database, defaults to whole_genome_SNVs.tsv.gz</li>
<li><strong>exomiser_cadd_url_indel_file</strong>:  The parameter <code>exomiser_cadd_url_indel_file</code> is the name of the
INDEL file that will be downloaded from the CADD database, defaults to InDels.tsv.gz</li>
<li><strong>threads</strong>:  The <code>threads</code> parameter specifies the number of threads to use for parallel
processing. It determines how many tasks can be executed simultaneously. Increasing the number of
threads can potentially speed up the execution time of the function, especially if there are
multiple cores available on the machine</li>
</ul>
</div>


                </section>
                <section id="databases_download_dbsnp">
                            <input id="databases_download_dbsnp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_dbsnp</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">dbsnp_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/lebechea/howard/databases/exomiser/dbsnp&#39;</span>,</span><span class="param">	<span class="n">dbsnp_releases</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b156&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">dbsnp_release_default</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dbsnp_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;https://ftp.ncbi.nih.gov/snp/archive&#39;</span>,</span><span class="param">	<span class="n">dbsnp_url_files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dbsnp_url_files_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GCF_000001405&#39;</span>,</span><span class="param">	<span class="n">dbsnp_assemblies_map</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hg19&#39;</span><span class="p">:</span> <span class="s1">&#39;25&#39;</span><span class="p">,</span> <span class="s1">&#39;hg38&#39;</span><span class="p">:</span> <span class="s1">&#39;40&#39;</span><span class="p">}</span>,</span><span class="param">	<span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/lebechea/howard/databases/genomes/current&#39;</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">dbsnp_vcf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">dbsnp_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">dbsnp_parquet_explode_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="databases_download_dbsnp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_dbsnp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_dbsnp-3571"><a href="#databases_download_dbsnp-3571"><span class="linenos">3571</span></a><span class="k">def</span> <span class="nf">databases_download_dbsnp</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3572"><a href="#databases_download_dbsnp-3572"><span class="linenos">3572</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3573"><a href="#databases_download_dbsnp-3573"><span class="linenos">3573</span></a>    <span class="n">dbsnp_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_DBSNP_FOLDER</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3574"><a href="#databases_download_dbsnp-3574"><span class="linenos">3574</span></a>    <span class="n">dbsnp_releases</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;b156&quot;</span><span class="p">],</span>
</span><span id="databases_download_dbsnp-3575"><a href="#databases_download_dbsnp-3575"><span class="linenos">3575</span></a>    <span class="n">dbsnp_release_default</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3576"><a href="#databases_download_dbsnp-3576"><span class="linenos">3576</span></a>    <span class="n">dbsnp_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_DBSNP_URL</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3577"><a href="#databases_download_dbsnp-3577"><span class="linenos">3577</span></a>    <span class="n">dbsnp_url_files</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3578"><a href="#databases_download_dbsnp-3578"><span class="linenos">3578</span></a>    <span class="n">dbsnp_url_files_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GCF_000001405&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3579"><a href="#databases_download_dbsnp-3579"><span class="linenos">3579</span></a>    <span class="n">dbsnp_assemblies_map</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hg19&quot;</span><span class="p">:</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;hg38&quot;</span><span class="p">:</span> <span class="s2">&quot;40&quot;</span><span class="p">},</span>
</span><span id="databases_download_dbsnp-3580"><a href="#databases_download_dbsnp-3580"><span class="linenos">3580</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3581"><a href="#databases_download_dbsnp-3581"><span class="linenos">3581</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3582"><a href="#databases_download_dbsnp-3582"><span class="linenos">3582</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3583"><a href="#databases_download_dbsnp-3583"><span class="linenos">3583</span></a>    <span class="n">dbsnp_vcf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3584"><a href="#databases_download_dbsnp-3584"><span class="linenos">3584</span></a>    <span class="n">dbsnp_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3585"><a href="#databases_download_dbsnp-3585"><span class="linenos">3585</span></a>    <span class="n">dbsnp_parquet_explode_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3586"><a href="#databases_download_dbsnp-3586"><span class="linenos">3586</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3587"><a href="#databases_download_dbsnp-3587"><span class="linenos">3587</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3588"><a href="#databases_download_dbsnp-3588"><span class="linenos">3588</span></a><span class="sd">    The function `databases_download_dbsnp` downloads dbSNP files, generates VCF files, and converts</span>
</span><span id="databases_download_dbsnp-3589"><a href="#databases_download_dbsnp-3589"><span class="linenos">3589</span></a><span class="sd">    them to Parquet format.</span>
</span><span id="databases_download_dbsnp-3590"><a href="#databases_download_dbsnp-3590"><span class="linenos">3590</span></a>
</span><span id="databases_download_dbsnp-3591"><a href="#databases_download_dbsnp-3591"><span class="linenos">3591</span></a><span class="sd">    :param assemblies: A list of genome assemblies for which to download dbSNP data</span>
</span><span id="databases_download_dbsnp-3592"><a href="#databases_download_dbsnp-3592"><span class="linenos">3592</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_dbsnp-3593"><a href="#databases_download_dbsnp-3593"><span class="linenos">3593</span></a><span class="sd">    :param dbsnp_folder: The folder where the dbSNP files will be downloaded and stored</span>
</span><span id="databases_download_dbsnp-3594"><a href="#databases_download_dbsnp-3594"><span class="linenos">3594</span></a><span class="sd">    :type dbsnp_folder: str</span>
</span><span id="databases_download_dbsnp-3595"><a href="#databases_download_dbsnp-3595"><span class="linenos">3595</span></a><span class="sd">    :param dbsnp_releases: List of releases to download. Default:[&quot;b156&quot;]</span>
</span><span id="databases_download_dbsnp-3596"><a href="#databases_download_dbsnp-3596"><span class="linenos">3596</span></a><span class="sd">    :type dbsnp_releases: list</span>
</span><span id="databases_download_dbsnp-3597"><a href="#databases_download_dbsnp-3597"><span class="linenos">3597</span></a><span class="sd">    :param dbsnp_release_default: Default release to link in default folder. Default: first release in dbsnp_releases</span>
</span><span id="databases_download_dbsnp-3598"><a href="#databases_download_dbsnp-3598"><span class="linenos">3598</span></a><span class="sd">    :type dbsnp_release_default: str</span>
</span><span id="databases_download_dbsnp-3599"><a href="#databases_download_dbsnp-3599"><span class="linenos">3599</span></a><span class="sd">    :param dbsnp_url: The `dbsnp_url` parameter is a string that represents the base URL where the dbSNP</span>
</span><span id="databases_download_dbsnp-3600"><a href="#databases_download_dbsnp-3600"><span class="linenos">3600</span></a><span class="sd">    files are located. This URL is used to construct the full URL for downloading the dbSNP files</span>
</span><span id="databases_download_dbsnp-3601"><a href="#databases_download_dbsnp-3601"><span class="linenos">3601</span></a><span class="sd">    :type dbsnp_url: str</span>
</span><span id="databases_download_dbsnp-3602"><a href="#databases_download_dbsnp-3602"><span class="linenos">3602</span></a><span class="sd">    :param dbsnp_url_files: The `dbsnp_url_files` parameter is a dictionary that maps assembly names to</span>
</span><span id="databases_download_dbsnp-3603"><a href="#databases_download_dbsnp-3603"><span class="linenos">3603</span></a><span class="sd">    specific dbSNP URL files. It allows you to provide custom dbSNP URL files for specific assemblies</span>
</span><span id="databases_download_dbsnp-3604"><a href="#databases_download_dbsnp-3604"><span class="linenos">3604</span></a><span class="sd">    instead of using the default file naming convention</span>
</span><span id="databases_download_dbsnp-3605"><a href="#databases_download_dbsnp-3605"><span class="linenos">3605</span></a><span class="sd">    :type dbsnp_url_files: dict</span>
</span><span id="databases_download_dbsnp-3606"><a href="#databases_download_dbsnp-3606"><span class="linenos">3606</span></a><span class="sd">    :param dbsnp_url_files_prefix: The `dbsnp_url_files_prefix` parameter is a string that represents the</span>
</span><span id="databases_download_dbsnp-3607"><a href="#databases_download_dbsnp-3607"><span class="linenos">3607</span></a><span class="sd">    prefix of the dbSNP file name for a specific assembly. It is used to construct the full URL of the</span>
</span><span id="databases_download_dbsnp-3608"><a href="#databases_download_dbsnp-3608"><span class="linenos">3608</span></a><span class="sd">    dbSNP file to be downloaded. By default, the value is set to &quot;GCF_000001405&quot;</span>
</span><span id="databases_download_dbsnp-3609"><a href="#databases_download_dbsnp-3609"><span class="linenos">3609</span></a><span class="sd">    :type dbsnp_url_files_prefix: str (optional)</span>
</span><span id="databases_download_dbsnp-3610"><a href="#databases_download_dbsnp-3610"><span class="linenos">3610</span></a><span class="sd">    :param dbsnp_assemblies_map: The `dbsnp_assemblies_map` parameter is a dictionary that maps assembly</span>
</span><span id="databases_download_dbsnp-3611"><a href="#databases_download_dbsnp-3611"><span class="linenos">3611</span></a><span class="sd">    names to their corresponding dbSNP versions. It is used to construct the dbSNP file name based on</span>
</span><span id="databases_download_dbsnp-3612"><a href="#databases_download_dbsnp-3612"><span class="linenos">3612</span></a><span class="sd">    the assembly name. For example, if the assembly is &quot;hg19&quot;, the corresponding dbSNP version is &quot;</span>
</span><span id="databases_download_dbsnp-3613"><a href="#databases_download_dbsnp-3613"><span class="linenos">3613</span></a><span class="sd">    :type dbsnp_assemblies_map: dict</span>
</span><span id="databases_download_dbsnp-3614"><a href="#databases_download_dbsnp-3614"><span class="linenos">3614</span></a><span class="sd">    :param genomes_folder: The `genomes_folder` parameter is a string that specifies the folder where the</span>
</span><span id="databases_download_dbsnp-3615"><a href="#databases_download_dbsnp-3615"><span class="linenos">3615</span></a><span class="sd">    genome index files are located. These index files are used for generating the VCF file from the</span>
</span><span id="databases_download_dbsnp-3616"><a href="#databases_download_dbsnp-3616"><span class="linenos">3616</span></a><span class="sd">    downloaded dbSNP file</span>
</span><span id="databases_download_dbsnp-3617"><a href="#databases_download_dbsnp-3617"><span class="linenos">3617</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="databases_download_dbsnp-3618"><a href="#databases_download_dbsnp-3618"><span class="linenos">3618</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for downloading and</span>
</span><span id="databases_download_dbsnp-3619"><a href="#databases_download_dbsnp-3619"><span class="linenos">3619</span></a><span class="sd">    processing the dbSNP files, defaults to 1</span>
</span><span id="databases_download_dbsnp-3620"><a href="#databases_download_dbsnp-3620"><span class="linenos">3620</span></a><span class="sd">    :type threads: int (optional)</span>
</span><span id="databases_download_dbsnp-3621"><a href="#databases_download_dbsnp-3621"><span class="linenos">3621</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of max memory (in Gb) to use for sorting.</span>
</span><span id="databases_download_dbsnp-3622"><a href="#databases_download_dbsnp-3622"><span class="linenos">3622</span></a><span class="sd">    defaults to 1</span>
</span><span id="databases_download_dbsnp-3623"><a href="#databases_download_dbsnp-3623"><span class="linenos">3623</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="databases_download_dbsnp-3624"><a href="#databases_download_dbsnp-3624"><span class="linenos">3624</span></a><span class="sd">    :param dbsnp_vcf: A boolean flag indicating whether to generate a VCF file from the downloaded</span>
</span><span id="databases_download_dbsnp-3625"><a href="#databases_download_dbsnp-3625"><span class="linenos">3625</span></a><span class="sd">    dbSNP data. If set to True, the function will generate a VCF file. If set to False, the function</span>
</span><span id="databases_download_dbsnp-3626"><a href="#databases_download_dbsnp-3626"><span class="linenos">3626</span></a><span class="sd">    will not generate a VCF file, defaults to False</span>
</span><span id="databases_download_dbsnp-3627"><a href="#databases_download_dbsnp-3627"><span class="linenos">3627</span></a><span class="sd">    :type dbsnp_vcf: bool (optional)</span>
</span><span id="databases_download_dbsnp-3628"><a href="#databases_download_dbsnp-3628"><span class="linenos">3628</span></a><span class="sd">    :param dbsnpparquet: A boolean flag indicating whether to generate a Parquet file from the</span>
</span><span id="databases_download_dbsnp-3629"><a href="#databases_download_dbsnp-3629"><span class="linenos">3629</span></a><span class="sd">    downloaded dbSNP data. If set to True, a Parquet file will be generated; if set to False, no Parquet</span>
</span><span id="databases_download_dbsnp-3630"><a href="#databases_download_dbsnp-3630"><span class="linenos">3630</span></a><span class="sd">    file will be generated, defaults to False</span>
</span><span id="databases_download_dbsnp-3631"><a href="#databases_download_dbsnp-3631"><span class="linenos">3631</span></a><span class="sd">    :type dbsnp_parquet: bool (optional)</span>
</span><span id="databases_download_dbsnp-3632"><a href="#databases_download_dbsnp-3632"><span class="linenos">3632</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3633"><a href="#databases_download_dbsnp-3633"><span class="linenos">3633</span></a>
</span><span id="databases_download_dbsnp-3634"><a href="#databases_download_dbsnp-3634"><span class="linenos">3634</span></a>    <span class="c1"># Import Database object</span>
</span><span id="databases_download_dbsnp-3635"><a href="#databases_download_dbsnp-3635"><span class="linenos">3635</span></a>    <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="databases_download_dbsnp-3636"><a href="#databases_download_dbsnp-3636"><span class="linenos">3636</span></a>
</span><span id="databases_download_dbsnp-3637"><a href="#databases_download_dbsnp-3637"><span class="linenos">3637</span></a>    <span class="c1"># Log</span>
</span><span id="databases_download_dbsnp-3638"><a href="#databases_download_dbsnp-3638"><span class="linenos">3638</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3639"><a href="#databases_download_dbsnp-3639"><span class="linenos">3639</span></a>
</span><span id="databases_download_dbsnp-3640"><a href="#databases_download_dbsnp-3640"><span class="linenos">3640</span></a>    <span class="c1"># Database config</span>
</span><span id="databases_download_dbsnp-3641"><a href="#databases_download_dbsnp-3641"><span class="linenos">3641</span></a>    <span class="n">conn_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">}</span>
</span><span id="databases_download_dbsnp-3642"><a href="#databases_download_dbsnp-3642"><span class="linenos">3642</span></a>
</span><span id="databases_download_dbsnp-3643"><a href="#databases_download_dbsnp-3643"><span class="linenos">3643</span></a>    <span class="c1"># Genomes folder</span>
</span><span id="databases_download_dbsnp-3644"><a href="#databases_download_dbsnp-3644"><span class="linenos">3644</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3645"><a href="#databases_download_dbsnp-3645"><span class="linenos">3645</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="databases_download_dbsnp-3646"><a href="#databases_download_dbsnp-3646"><span class="linenos">3646</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;genomes_folder: </span><span class="si">{</span><span class="n">genomes_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3647"><a href="#databases_download_dbsnp-3647"><span class="linenos">3647</span></a>
</span><span id="databases_download_dbsnp-3648"><a href="#databases_download_dbsnp-3648"><span class="linenos">3648</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_dbsnp-3649"><a href="#databases_download_dbsnp-3649"><span class="linenos">3649</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3650"><a href="#databases_download_dbsnp-3650"><span class="linenos">3650</span></a>    <span class="n">dbsnp_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">dbsnp_folder</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3651"><a href="#databases_download_dbsnp-3651"><span class="linenos">3651</span></a>
</span><span id="databases_download_dbsnp-3652"><a href="#databases_download_dbsnp-3652"><span class="linenos">3652</span></a>    <span class="c1"># Default release</span>
</span><span id="databases_download_dbsnp-3653"><a href="#databases_download_dbsnp-3653"><span class="linenos">3653</span></a>    <span class="n">dbsnp_release_default_found</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_dbsnp-3654"><a href="#databases_download_dbsnp-3654"><span class="linenos">3654</span></a>    <span class="k">if</span> <span class="n">dbsnp_release_default</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3655"><a href="#databases_download_dbsnp-3655"><span class="linenos">3655</span></a>        <span class="n">dbsnp_release_default_found</span> <span class="o">=</span> <span class="n">dbsnp_release_default</span>
</span><span id="databases_download_dbsnp-3656"><a href="#databases_download_dbsnp-3656"><span class="linenos">3656</span></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbsnp_releases</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3657"><a href="#databases_download_dbsnp-3657"><span class="linenos">3657</span></a>        <span class="n">dbsnp_release_default_found</span> <span class="o">=</span> <span class="n">dbsnp_releases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_download_dbsnp-3658"><a href="#databases_download_dbsnp-3658"><span class="linenos">3658</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_release_default_found: </span><span class="si">{</span><span class="n">dbsnp_release_default_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3659"><a href="#databases_download_dbsnp-3659"><span class="linenos">3659</span></a>
</span><span id="databases_download_dbsnp-3660"><a href="#databases_download_dbsnp-3660"><span class="linenos">3660</span></a>    <span class="c1"># dbSNP assemblies map</span>
</span><span id="databases_download_dbsnp-3661"><a href="#databases_download_dbsnp-3661"><span class="linenos">3661</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbsnp_assemblies_map</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3662"><a href="#databases_download_dbsnp-3662"><span class="linenos">3662</span></a>        <span class="n">dbsnp_assemblies_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dbsnp_assemblies_map</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3663"><a href="#databases_download_dbsnp-3663"><span class="linenos">3663</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_assemblies_map: </span><span class="si">{</span><span class="n">dbsnp_assemblies_map</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3664"><a href="#databases_download_dbsnp-3664"><span class="linenos">3664</span></a>
</span><span id="databases_download_dbsnp-3665"><a href="#databases_download_dbsnp-3665"><span class="linenos">3665</span></a>    <span class="c1"># dbSNP URL files</span>
</span><span id="databases_download_dbsnp-3666"><a href="#databases_download_dbsnp-3666"><span class="linenos">3666</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbsnp_url_files</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3667"><a href="#databases_download_dbsnp-3667"><span class="linenos">3667</span></a>        <span class="n">dbsnp_url_files</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dbsnp_url_files</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3668"><a href="#databases_download_dbsnp-3668"><span class="linenos">3668</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_url_files: </span><span class="si">{</span><span class="n">dbsnp_url_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3669"><a href="#databases_download_dbsnp-3669"><span class="linenos">3669</span></a>
</span><span id="databases_download_dbsnp-3670"><a href="#databases_download_dbsnp-3670"><span class="linenos">3670</span></a>    <span class="c1"># Files to generate</span>
</span><span id="databases_download_dbsnp-3671"><a href="#databases_download_dbsnp-3671"><span class="linenos">3671</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_vcf: </span><span class="si">{</span><span class="n">dbsnp_vcf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3672"><a href="#databases_download_dbsnp-3672"><span class="linenos">3672</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dbsnp_parquet: </span><span class="si">{</span><span class="n">dbsnp_parquet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3673"><a href="#databases_download_dbsnp-3673"><span class="linenos">3673</span></a>
</span><span id="databases_download_dbsnp-3674"><a href="#databases_download_dbsnp-3674"><span class="linenos">3674</span></a>    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3675"><a href="#databases_download_dbsnp-3675"><span class="linenos">3675</span></a>
</span><span id="databases_download_dbsnp-3676"><a href="#databases_download_dbsnp-3676"><span class="linenos">3676</span></a>        <span class="c1"># Log</span>
</span><span id="databases_download_dbsnp-3677"><a href="#databases_download_dbsnp-3677"><span class="linenos">3677</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3678"><a href="#databases_download_dbsnp-3678"><span class="linenos">3678</span></a>
</span><span id="databases_download_dbsnp-3679"><a href="#databases_download_dbsnp-3679"><span class="linenos">3679</span></a>        <span class="c1"># Folder</span>
</span><span id="databases_download_dbsnp-3680"><a href="#databases_download_dbsnp-3680"><span class="linenos">3680</span></a>        <span class="n">dbsnp_folder_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbsnp_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3681"><a href="#databases_download_dbsnp-3681"><span class="linenos">3681</span></a>
</span><span id="databases_download_dbsnp-3682"><a href="#databases_download_dbsnp-3682"><span class="linenos">3682</span></a>        <span class="k">for</span> <span class="n">dbsnp_release</span> <span class="ow">in</span> <span class="n">dbsnp_releases</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3683"><a href="#databases_download_dbsnp-3683"><span class="linenos">3683</span></a>
</span><span id="databases_download_dbsnp-3684"><a href="#databases_download_dbsnp-3684"><span class="linenos">3684</span></a>            <span class="c1"># Log</span>
</span><span id="databases_download_dbsnp-3685"><a href="#databases_download_dbsnp-3685"><span class="linenos">3685</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3686"><a href="#databases_download_dbsnp-3686"><span class="linenos">3686</span></a>
</span><span id="databases_download_dbsnp-3687"><a href="#databases_download_dbsnp-3687"><span class="linenos">3687</span></a>            <span class="c1"># Folder</span>
</span><span id="databases_download_dbsnp-3688"><a href="#databases_download_dbsnp-3688"><span class="linenos">3688</span></a>            <span class="n">dbsnp_folder_assembly_release</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3689"><a href="#databases_download_dbsnp-3689"><span class="linenos">3689</span></a>                <span class="n">dbsnp_folder_assembly</span><span class="p">,</span> <span class="n">dbsnp_release</span>
</span><span id="databases_download_dbsnp-3690"><a href="#databases_download_dbsnp-3690"><span class="linenos">3690</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3691"><a href="#databases_download_dbsnp-3691"><span class="linenos">3691</span></a>
</span><span id="databases_download_dbsnp-3692"><a href="#databases_download_dbsnp-3692"><span class="linenos">3692</span></a>            <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_dbsnp-3693"><a href="#databases_download_dbsnp-3693"><span class="linenos">3693</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_folder_assembly_release</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3694"><a href="#databases_download_dbsnp-3694"><span class="linenos">3694</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">dbsnp_folder_assembly_release</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3695"><a href="#databases_download_dbsnp-3695"><span class="linenos">3695</span></a>
</span><span id="databases_download_dbsnp-3696"><a href="#databases_download_dbsnp-3696"><span class="linenos">3696</span></a>            <span class="c1"># Construct URL</span>
</span><span id="databases_download_dbsnp-3697"><a href="#databases_download_dbsnp-3697"><span class="linenos">3697</span></a>            <span class="k">if</span> <span class="n">dbsnp_url_files</span> <span class="ow">and</span> <span class="n">dbsnp_url_files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3698"><a href="#databases_download_dbsnp-3698"><span class="linenos">3698</span></a>                <span class="n">dbsnp_url_file</span> <span class="o">=</span> <span class="n">dbsnp_url_files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3699"><a href="#databases_download_dbsnp-3699"><span class="linenos">3699</span></a>            <span class="k">elif</span> <span class="n">dbsnp_assemblies_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3700"><a href="#databases_download_dbsnp-3700"><span class="linenos">3700</span></a>                <span class="n">dbsnp_url_file</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="databases_download_dbsnp-3701"><a href="#databases_download_dbsnp-3701"><span class="linenos">3701</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_url_files_prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dbsnp_assemblies_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span id="databases_download_dbsnp-3702"><a href="#databases_download_dbsnp-3702"><span class="linenos">3702</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3703"><a href="#databases_download_dbsnp-3703"><span class="linenos">3703</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3704"><a href="#databases_download_dbsnp-3704"><span class="linenos">3704</span></a>                <span class="n">dbsnp_url_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="databases_download_dbsnp-3705"><a href="#databases_download_dbsnp-3705"><span class="linenos">3705</span></a>
</span><span id="databases_download_dbsnp-3706"><a href="#databases_download_dbsnp-3706"><span class="linenos">3706</span></a>            <span class="k">if</span> <span class="n">dbsnp_url_file</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3707"><a href="#databases_download_dbsnp-3707"><span class="linenos">3707</span></a>                <span class="n">dbsnp_url_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3708"><a href="#databases_download_dbsnp-3708"><span class="linenos">3708</span></a>                    <span class="n">dbsnp_url</span><span class="p">,</span> <span class="n">dbsnp_release</span><span class="p">,</span> <span class="s2">&quot;VCF&quot;</span><span class="p">,</span> <span class="n">dbsnp_url_file</span>
</span><span id="databases_download_dbsnp-3709"><a href="#databases_download_dbsnp-3709"><span class="linenos">3709</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3710"><a href="#databases_download_dbsnp-3710"><span class="linenos">3710</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3711"><a href="#databases_download_dbsnp-3711"><span class="linenos">3711</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No dbSNP file from URL provided&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3712"><a href="#databases_download_dbsnp-3712"><span class="linenos">3712</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No dbSNP file from URL provided&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3713"><a href="#databases_download_dbsnp-3713"><span class="linenos">3713</span></a>
</span><span id="databases_download_dbsnp-3714"><a href="#databases_download_dbsnp-3714"><span class="linenos">3714</span></a>            <span class="c1"># Construct File</span>
</span><span id="databases_download_dbsnp-3715"><a href="#databases_download_dbsnp-3715"><span class="linenos">3715</span></a>            <span class="n">dbsnp_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3716"><a href="#databases_download_dbsnp-3716"><span class="linenos">3716</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_url_path</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3717"><a href="#databases_download_dbsnp-3717"><span class="linenos">3717</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3718"><a href="#databases_download_dbsnp-3718"><span class="linenos">3718</span></a>
</span><span id="databases_download_dbsnp-3719"><a href="#databases_download_dbsnp-3719"><span class="linenos">3719</span></a>            <span class="c1">### Download dbSNP</span>
</span><span id="databases_download_dbsnp-3720"><a href="#databases_download_dbsnp-3720"><span class="linenos">3720</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3721"><a href="#databases_download_dbsnp-3721"><span class="linenos">3721</span></a>
</span><span id="databases_download_dbsnp-3722"><a href="#databases_download_dbsnp-3722"><span class="linenos">3722</span></a>                <span class="c1"># Log</span>
</span><span id="databases_download_dbsnp-3723"><a href="#databases_download_dbsnp-3723"><span class="linenos">3723</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3724"><a href="#databases_download_dbsnp-3724"><span class="linenos">3724</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Download &#39;</span><span class="si">{</span><span class="n">dbsnp_url_file</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
</span><span id="databases_download_dbsnp-3725"><a href="#databases_download_dbsnp-3725"><span class="linenos">3725</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3726"><a href="#databases_download_dbsnp-3726"><span class="linenos">3726</span></a>
</span><span id="databases_download_dbsnp-3727"><a href="#databases_download_dbsnp-3727"><span class="linenos">3727</span></a>                <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_dbsnp-3728"><a href="#databases_download_dbsnp-3728"><span class="linenos">3728</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">)):</span>
</span><span id="databases_download_dbsnp-3729"><a href="#databases_download_dbsnp-3729"><span class="linenos">3729</span></a>                    <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3730"><a href="#databases_download_dbsnp-3730"><span class="linenos">3730</span></a>
</span><span id="databases_download_dbsnp-3731"><a href="#databases_download_dbsnp-3731"><span class="linenos">3731</span></a>                <span class="c1"># Download file</span>
</span><span id="databases_download_dbsnp-3732"><a href="#databases_download_dbsnp-3732"><span class="linenos">3732</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3733"><a href="#databases_download_dbsnp-3733"><span class="linenos">3733</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">dbsnp_url_path</span><span class="p">,</span> <span class="n">dest_file_path</span><span class="o">=</span><span class="n">dbsnp_file</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span>
</span><span id="databases_download_dbsnp-3734"><a href="#databases_download_dbsnp-3734"><span class="linenos">3734</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3735"><a href="#databases_download_dbsnp-3735"><span class="linenos">3735</span></a>
</span><span id="databases_download_dbsnp-3736"><a href="#databases_download_dbsnp-3736"><span class="linenos">3736</span></a>                <span class="c1"># Index tbi</span>
</span><span id="databases_download_dbsnp-3737"><a href="#databases_download_dbsnp-3737"><span class="linenos">3737</span></a>                <span class="n">dbsnp_url_path_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_url_path</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="databases_download_dbsnp-3738"><a href="#databases_download_dbsnp-3738"><span class="linenos">3738</span></a>                <span class="n">dbsnp_file_tbi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_file</span><span class="si">}</span><span class="s2">.tbi&quot;</span>
</span><span id="databases_download_dbsnp-3739"><a href="#databases_download_dbsnp-3739"><span class="linenos">3739</span></a>                <span class="n">download_file</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3740"><a href="#databases_download_dbsnp-3740"><span class="linenos">3740</span></a>                    <span class="n">url</span><span class="o">=</span><span class="n">dbsnp_url_path_tbi</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3741"><a href="#databases_download_dbsnp-3741"><span class="linenos">3741</span></a>                    <span class="n">dest_file_path</span><span class="o">=</span><span class="n">dbsnp_file_tbi</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3742"><a href="#databases_download_dbsnp-3742"><span class="linenos">3742</span></a>                    <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3743"><a href="#databases_download_dbsnp-3743"><span class="linenos">3743</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3744"><a href="#databases_download_dbsnp-3744"><span class="linenos">3744</span></a>
</span><span id="databases_download_dbsnp-3745"><a href="#databases_download_dbsnp-3745"><span class="linenos">3745</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3746"><a href="#databases_download_dbsnp-3746"><span class="linenos">3746</span></a>
</span><span id="databases_download_dbsnp-3747"><a href="#databases_download_dbsnp-3747"><span class="linenos">3747</span></a>                <span class="c1"># Log</span>
</span><span id="databases_download_dbsnp-3748"><a href="#databases_download_dbsnp-3748"><span class="linenos">3748</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3749"><a href="#databases_download_dbsnp-3749"><span class="linenos">3749</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Database </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">)</span><span class="si">}</span><span class="s2"> already downloaded&quot;</span>
</span><span id="databases_download_dbsnp-3750"><a href="#databases_download_dbsnp-3750"><span class="linenos">3750</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3751"><a href="#databases_download_dbsnp-3751"><span class="linenos">3751</span></a>
</span><span id="databases_download_dbsnp-3752"><a href="#databases_download_dbsnp-3752"><span class="linenos">3752</span></a>            <span class="c1">### Generate VCF and/or Parquet</span>
</span><span id="databases_download_dbsnp-3753"><a href="#databases_download_dbsnp-3753"><span class="linenos">3753</span></a>
</span><span id="databases_download_dbsnp-3754"><a href="#databases_download_dbsnp-3754"><span class="linenos">3754</span></a>            <span class="c1"># Construct VCF File</span>
</span><span id="databases_download_dbsnp-3755"><a href="#databases_download_dbsnp-3755"><span class="linenos">3755</span></a>            <span class="n">dbsnp_vcf_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.vcf.gz&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3756"><a href="#databases_download_dbsnp-3756"><span class="linenos">3756</span></a>            <span class="n">dbsnp_vcf_file_buffer</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3757"><a href="#databases_download_dbsnp-3757"><span class="linenos">3757</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.buffer.vcf.gz&quot;</span>
</span><span id="databases_download_dbsnp-3758"><a href="#databases_download_dbsnp-3758"><span class="linenos">3758</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3759"><a href="#databases_download_dbsnp-3759"><span class="linenos">3759</span></a>
</span><span id="databases_download_dbsnp-3760"><a href="#databases_download_dbsnp-3760"><span class="linenos">3760</span></a>            <span class="c1"># Construct File</span>
</span><span id="databases_download_dbsnp-3761"><a href="#databases_download_dbsnp-3761"><span class="linenos">3761</span></a>            <span class="n">dbsnp_parquet_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3762"><a href="#databases_download_dbsnp-3762"><span class="linenos">3762</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.parquet&quot;</span>
</span><span id="databases_download_dbsnp-3763"><a href="#databases_download_dbsnp-3763"><span class="linenos">3763</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3764"><a href="#databases_download_dbsnp-3764"><span class="linenos">3764</span></a>            <span class="n">dbsnp_parquet_file_buffer</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3765"><a href="#databases_download_dbsnp-3765"><span class="linenos">3765</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.buffer.parquet&quot;</span>
</span><span id="databases_download_dbsnp-3766"><a href="#databases_download_dbsnp-3766"><span class="linenos">3766</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3767"><a href="#databases_download_dbsnp-3767"><span class="linenos">3767</span></a>            <span class="n">dbsnp_parquet_hdr_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3768"><a href="#databases_download_dbsnp-3768"><span class="linenos">3768</span></a>                <span class="n">dbsnp_folder_assembly_release</span><span class="p">,</span> <span class="s2">&quot;dbsnp.parquet.hdr&quot;</span>
</span><span id="databases_download_dbsnp-3769"><a href="#databases_download_dbsnp-3769"><span class="linenos">3769</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3770"><a href="#databases_download_dbsnp-3770"><span class="linenos">3770</span></a>
</span><span id="databases_download_dbsnp-3771"><a href="#databases_download_dbsnp-3771"><span class="linenos">3771</span></a>            <span class="c1"># Files to generate or already generated</span>
</span><span id="databases_download_dbsnp-3772"><a href="#databases_download_dbsnp-3772"><span class="linenos">3772</span></a>            <span class="n">dbsnp_files_to_generate</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbsnp-3773"><a href="#databases_download_dbsnp-3773"><span class="linenos">3773</span></a>            <span class="n">dbsnp_files_already_generated</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbsnp-3774"><a href="#databases_download_dbsnp-3774"><span class="linenos">3774</span></a>
</span><span id="databases_download_dbsnp-3775"><a href="#databases_download_dbsnp-3775"><span class="linenos">3775</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_dbsnp-3776"><a href="#databases_download_dbsnp-3776"><span class="linenos">3776</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3777"><a href="#databases_download_dbsnp-3777"><span class="linenos">3777</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">dbsnp_vcf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">))</span>
</span><span id="databases_download_dbsnp-3778"><a href="#databases_download_dbsnp-3778"><span class="linenos">3778</span></a>                <span class="ow">or</span> <span class="p">(</span><span class="n">dbsnp_parquet</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">))</span>
</span><span id="databases_download_dbsnp-3779"><a href="#databases_download_dbsnp-3779"><span class="linenos">3779</span></a>            <span class="p">):</span>
</span><span id="databases_download_dbsnp-3780"><a href="#databases_download_dbsnp-3780"><span class="linenos">3780</span></a>
</span><span id="databases_download_dbsnp-3781"><a href="#databases_download_dbsnp-3781"><span class="linenos">3781</span></a>                <span class="k">if</span> <span class="n">dbsnp_vcf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3782"><a href="#databases_download_dbsnp-3782"><span class="linenos">3782</span></a>                    <span class="n">write_vcf</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_dbsnp-3783"><a href="#databases_download_dbsnp-3783"><span class="linenos">3783</span></a>                    <span class="n">dbsnp_files_to_generate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">))</span>
</span><span id="databases_download_dbsnp-3784"><a href="#databases_download_dbsnp-3784"><span class="linenos">3784</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3785"><a href="#databases_download_dbsnp-3785"><span class="linenos">3785</span></a>                    <span class="n">write_vcf</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_dbsnp-3786"><a href="#databases_download_dbsnp-3786"><span class="linenos">3786</span></a>                    <span class="k">if</span> <span class="n">dbsnp_vcf</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3787"><a href="#databases_download_dbsnp-3787"><span class="linenos">3787</span></a>                        <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3788"><a href="#databases_download_dbsnp-3788"><span class="linenos">3788</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3789"><a href="#databases_download_dbsnp-3789"><span class="linenos">3789</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbsnp-3790"><a href="#databases_download_dbsnp-3790"><span class="linenos">3790</span></a>
</span><span id="databases_download_dbsnp-3791"><a href="#databases_download_dbsnp-3791"><span class="linenos">3791</span></a>                <span class="k">if</span> <span class="n">dbsnp_parquet</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3792"><a href="#databases_download_dbsnp-3792"><span class="linenos">3792</span></a>                    <span class="n">write_parquet</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_dbsnp-3793"><a href="#databases_download_dbsnp-3793"><span class="linenos">3793</span></a>                    <span class="n">dbsnp_files_to_generate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">))</span>
</span><span id="databases_download_dbsnp-3794"><a href="#databases_download_dbsnp-3794"><span class="linenos">3794</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3795"><a href="#databases_download_dbsnp-3795"><span class="linenos">3795</span></a>                    <span class="n">write_parquet</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_dbsnp-3796"><a href="#databases_download_dbsnp-3796"><span class="linenos">3796</span></a>                    <span class="k">if</span> <span class="n">dbsnp_parquet</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3797"><a href="#databases_download_dbsnp-3797"><span class="linenos">3797</span></a>                        <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3798"><a href="#databases_download_dbsnp-3798"><span class="linenos">3798</span></a>                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3799"><a href="#databases_download_dbsnp-3799"><span class="linenos">3799</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbsnp-3800"><a href="#databases_download_dbsnp-3800"><span class="linenos">3800</span></a>
</span><span id="databases_download_dbsnp-3801"><a href="#databases_download_dbsnp-3801"><span class="linenos">3801</span></a>                <span class="c1"># Log</span>
</span><span id="databases_download_dbsnp-3802"><a href="#databases_download_dbsnp-3802"><span class="linenos">3802</span></a>                <span class="k">if</span> <span class="n">dbsnp_files_already_generated</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3803"><a href="#databases_download_dbsnp-3803"><span class="linenos">3803</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3804"><a href="#databases_download_dbsnp-3804"><span class="linenos">3804</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Files </span><span class="si">{</span><span class="n">dbsnp_files_already_generated</span><span class="si">}</span><span class="s2"> already generated&quot;</span>
</span><span id="databases_download_dbsnp-3805"><a href="#databases_download_dbsnp-3805"><span class="linenos">3805</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-3806"><a href="#databases_download_dbsnp-3806"><span class="linenos">3806</span></a>                <span class="k">if</span> <span class="n">dbsnp_files_to_generate</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3807"><a href="#databases_download_dbsnp-3807"><span class="linenos">3807</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3808"><a href="#databases_download_dbsnp-3808"><span class="linenos">3808</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Files </span><span class="si">{</span><span class="n">dbsnp_files_to_generate</span><span class="si">}</span><span class="s2"> generation...&quot;</span>
</span><span id="databases_download_dbsnp-3809"><a href="#databases_download_dbsnp-3809"><span class="linenos">3809</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-3810"><a href="#databases_download_dbsnp-3810"><span class="linenos">3810</span></a>
</span><span id="databases_download_dbsnp-3811"><a href="#databases_download_dbsnp-3811"><span class="linenos">3811</span></a>                <span class="c1"># Generate Header</span>
</span><span id="databases_download_dbsnp-3812"><a href="#databases_download_dbsnp-3812"><span class="linenos">3812</span></a>
</span><span id="databases_download_dbsnp-3813"><a href="#databases_download_dbsnp-3813"><span class="linenos">3813</span></a>                <span class="c1"># Genome index</span>
</span><span id="databases_download_dbsnp-3814"><a href="#databases_download_dbsnp-3814"><span class="linenos">3814</span></a>                <span class="n">genome_index</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3815"><a href="#databases_download_dbsnp-3815"><span class="linenos">3815</span></a>                    <span class="n">genomes_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.fa.fai&quot;</span>
</span><span id="databases_download_dbsnp-3816"><a href="#databases_download_dbsnp-3816"><span class="linenos">3816</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3817"><a href="#databases_download_dbsnp-3817"><span class="linenos">3817</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genome_index</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3818"><a href="#databases_download_dbsnp-3818"><span class="linenos">3818</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No genome index&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3819"><a href="#databases_download_dbsnp-3819"><span class="linenos">3819</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No genome index&quot;</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3820"><a href="#databases_download_dbsnp-3820"><span class="linenos">3820</span></a>
</span><span id="databases_download_dbsnp-3821"><a href="#databases_download_dbsnp-3821"><span class="linenos">3821</span></a>                <span class="c1"># Database</span>
</span><span id="databases_download_dbsnp-3822"><a href="#databases_download_dbsnp-3822"><span class="linenos">3822</span></a>                <span class="n">conn_config_db</span> <span class="o">=</span> <span class="n">conn_config</span>
</span><span id="databases_download_dbsnp-3823"><a href="#databases_download_dbsnp-3823"><span class="linenos">3823</span></a>                <span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3824"><a href="#databases_download_dbsnp-3824"><span class="linenos">3824</span></a>                    <span class="n">database</span><span class="o">=</span><span class="n">dbsnp_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;vcf&quot;</span><span class="p">,</span> <span class="n">conn_config</span><span class="o">=</span><span class="n">conn_config_db</span>
</span><span id="databases_download_dbsnp-3825"><a href="#databases_download_dbsnp-3825"><span class="linenos">3825</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3826"><a href="#databases_download_dbsnp-3826"><span class="linenos">3826</span></a>
</span><span id="databases_download_dbsnp-3827"><a href="#databases_download_dbsnp-3827"><span class="linenos">3827</span></a>                <span class="c1"># Header</span>
</span><span id="databases_download_dbsnp-3828"><a href="#databases_download_dbsnp-3828"><span class="linenos">3828</span></a>                <span class="n">header_file_tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_file</span><span class="si">}</span><span class="s2">.tmp.hdr&quot;</span>
</span><span id="databases_download_dbsnp-3829"><a href="#databases_download_dbsnp-3829"><span class="linenos">3829</span></a>                <span class="n">db_header</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">header_file</span><span class="o">=</span><span class="n">header_file_tmp</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3830"><a href="#databases_download_dbsnp-3830"><span class="linenos">3830</span></a>                <span class="n">db_header_file</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_header_file</span><span class="p">(</span><span class="n">header_file</span><span class="o">=</span><span class="n">header_file_tmp</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3831"><a href="#databases_download_dbsnp-3831"><span class="linenos">3831</span></a>                <span class="n">db_header_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_header_file</span><span class="p">(</span><span class="n">header_file</span><span class="o">=</span><span class="n">db_header_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3832"><a href="#databases_download_dbsnp-3832"><span class="linenos">3832</span></a>
</span><span id="databases_download_dbsnp-3833"><a href="#databases_download_dbsnp-3833"><span class="linenos">3833</span></a>                <span class="c1"># Header info/format...</span>
</span><span id="databases_download_dbsnp-3834"><a href="#databases_download_dbsnp-3834"><span class="linenos">3834</span></a>                <span class="n">db_header_list_new</span> <span class="o">=</span> <span class="n">db_header_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="databases_download_dbsnp-3835"><a href="#databases_download_dbsnp-3835"><span class="linenos">3835</span></a>                <span class="c1"># Header #CHROM line</span>
</span><span id="databases_download_dbsnp-3836"><a href="#databases_download_dbsnp-3836"><span class="linenos">3836</span></a>                <span class="n">db_header_list_chrom</span> <span class="o">=</span> <span class="p">[</span><span class="n">db_header_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="databases_download_dbsnp-3837"><a href="#databases_download_dbsnp-3837"><span class="linenos">3837</span></a>                <span class="c1"># Header Contig</span>
</span><span id="databases_download_dbsnp-3838"><a href="#databases_download_dbsnp-3838"><span class="linenos">3838</span></a>                <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3839"><a href="#databases_download_dbsnp-3839"><span class="linenos">3839</span></a>                    <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3840"><a href="#databases_download_dbsnp-3840"><span class="linenos">3840</span></a><span class="s2">                            SELECT</span>
</span><span id="databases_download_dbsnp-3841"><a href="#databases_download_dbsnp-3841"><span class="linenos">3841</span></a><span class="s2">                                    column0 AS chr,</span>
</span><span id="databases_download_dbsnp-3842"><a href="#databases_download_dbsnp-3842"><span class="linenos">3842</span></a><span class="s2">                                    concat(</span>
</span><span id="databases_download_dbsnp-3843"><a href="#databases_download_dbsnp-3843"><span class="linenos">3843</span></a><span class="s2">                                        &#39;##contig=&lt;ID=&#39;,</span>
</span><span id="databases_download_dbsnp-3844"><a href="#databases_download_dbsnp-3844"><span class="linenos">3844</span></a><span class="s2">                                        column0,</span>
</span><span id="databases_download_dbsnp-3845"><a href="#databases_download_dbsnp-3845"><span class="linenos">3845</span></a><span class="s2">                                        &#39;,length=&#39;,</span>
</span><span id="databases_download_dbsnp-3846"><a href="#databases_download_dbsnp-3846"><span class="linenos">3846</span></a><span class="s2">                                        column1,</span>
</span><span id="databases_download_dbsnp-3847"><a href="#databases_download_dbsnp-3847"><span class="linenos">3847</span></a><span class="s2">                                        &#39;&gt;</span><span class="se">\n</span><span class="s2">&#39;</span>
</span><span id="databases_download_dbsnp-3848"><a href="#databases_download_dbsnp-3848"><span class="linenos">3848</span></a><span class="s2">                                    ) AS contig</span>
</span><span id="databases_download_dbsnp-3849"><a href="#databases_download_dbsnp-3849"><span class="linenos">3849</span></a><span class="s2">                            FROM read_csv_auto(&#39;</span><span class="si">{</span><span class="n">genome_index</span><span class="si">}</span><span class="s2">&#39;)</span>
</span><span id="databases_download_dbsnp-3850"><a href="#databases_download_dbsnp-3850"><span class="linenos">3850</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3851"><a href="#databases_download_dbsnp-3851"><span class="linenos">3851</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3852"><a href="#databases_download_dbsnp-3852"><span class="linenos">3852</span></a>                <span class="n">db_header_list_chrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;chr&quot;</span><span class="p">])</span>
</span><span id="databases_download_dbsnp-3853"><a href="#databases_download_dbsnp-3853"><span class="linenos">3853</span></a>                <span class="n">db_header_list_contigs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;contig&quot;</span><span class="p">])</span>
</span><span id="databases_download_dbsnp-3854"><a href="#databases_download_dbsnp-3854"><span class="linenos">3854</span></a>
</span><span id="databases_download_dbsnp-3855"><a href="#databases_download_dbsnp-3855"><span class="linenos">3855</span></a>                <span class="c1"># Write new heaer with contigs</span>
</span><span id="databases_download_dbsnp-3856"><a href="#databases_download_dbsnp-3856"><span class="linenos">3856</span></a>                <span class="n">db_header_new</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_header_from_list</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3857"><a href="#databases_download_dbsnp-3857"><span class="linenos">3857</span></a>                    <span class="n">header_list</span><span class="o">=</span><span class="n">db_header_list_new</span>
</span><span id="databases_download_dbsnp-3858"><a href="#databases_download_dbsnp-3858"><span class="linenos">3858</span></a>                    <span class="o">+</span> <span class="n">db_header_list_contigs</span>
</span><span id="databases_download_dbsnp-3859"><a href="#databases_download_dbsnp-3859"><span class="linenos">3859</span></a>                    <span class="o">+</span> <span class="n">db_header_list_chrom</span>
</span><span id="databases_download_dbsnp-3860"><a href="#databases_download_dbsnp-3860"><span class="linenos">3860</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3861"><a href="#databases_download_dbsnp-3861"><span class="linenos">3861</span></a>                <span class="n">vcf</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">db_header_new</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3862"><a href="#databases_download_dbsnp-3862"><span class="linenos">3862</span></a>
</span><span id="databases_download_dbsnp-3863"><a href="#databases_download_dbsnp-3863"><span class="linenos">3863</span></a>                <span class="c1"># Header</span>
</span><span id="databases_download_dbsnp-3864"><a href="#databases_download_dbsnp-3864"><span class="linenos">3864</span></a>                <span class="n">header_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbsnp_vcf_file</span><span class="si">}</span><span class="s2">.hdr&quot;</span>
</span><span id="databases_download_dbsnp-3865"><a href="#databases_download_dbsnp-3865"><span class="linenos">3865</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">header_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3866"><a href="#databases_download_dbsnp-3866"><span class="linenos">3866</span></a>
</span><span id="databases_download_dbsnp-3867"><a href="#databases_download_dbsnp-3867"><span class="linenos">3867</span></a>                <span class="c1"># INFO fields</span>
</span><span id="databases_download_dbsnp-3868"><a href="#databases_download_dbsnp-3868"><span class="linenos">3868</span></a>                <span class="n">query_select_info_fields_array</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_dbsnp-3869"><a href="#databases_download_dbsnp-3869"><span class="linenos">3869</span></a>                <span class="k">if</span> <span class="n">write_parquet</span> <span class="ow">and</span> <span class="n">dbsnp_parquet_explode_infos</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3870"><a href="#databases_download_dbsnp-3870"><span class="linenos">3870</span></a>                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">db_header</span><span class="o">.</span><span class="n">infos</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3871"><a href="#databases_download_dbsnp-3871"><span class="linenos">3871</span></a>                        <span class="k">if</span> <span class="n">db_header</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Flag&quot;</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3872"><a href="#databases_download_dbsnp-3872"><span class="linenos">3872</span></a>                            <span class="n">query_select_info_fields_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3873"><a href="#databases_download_dbsnp-3873"><span class="linenos">3873</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3874"><a href="#databases_download_dbsnp-3874"><span class="linenos">3874</span></a><span class="s2">                                concat(&#39;;&#39;, INFO, &#39;;&#39;) LIKE &#39;%;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">;%&#39;</span>
</span><span id="databases_download_dbsnp-3875"><a href="#databases_download_dbsnp-3875"><span class="linenos">3875</span></a><span class="s2">                                AS </span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">                             </span>
</span><span id="databases_download_dbsnp-3876"><a href="#databases_download_dbsnp-3876"><span class="linenos">3876</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3877"><a href="#databases_download_dbsnp-3877"><span class="linenos">3877</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3878"><a href="#databases_download_dbsnp-3878"><span class="linenos">3878</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3879"><a href="#databases_download_dbsnp-3879"><span class="linenos">3879</span></a>                            <span class="n">query_select_info_fields_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3880"><a href="#databases_download_dbsnp-3880"><span class="linenos">3880</span></a>                                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3881"><a href="#databases_download_dbsnp-3881"><span class="linenos">3881</span></a><span class="s2">                                CASE</span>
</span><span id="databases_download_dbsnp-3882"><a href="#databases_download_dbsnp-3882"><span class="linenos">3882</span></a><span class="s2">                                    WHEN concat(&#39;;&#39;, INFO) NOT LIKE &#39;%;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">=%&#39; THEN NULL</span>
</span><span id="databases_download_dbsnp-3883"><a href="#databases_download_dbsnp-3883"><span class="linenos">3883</span></a><span class="s2">                                    ELSE REGEXP_EXTRACT(concat(&#39;;&#39;, INFO), &#39;;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">=([^;]*)&#39;,1)</span>
</span><span id="databases_download_dbsnp-3884"><a href="#databases_download_dbsnp-3884"><span class="linenos">3884</span></a><span class="s2">                                END AS </span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">                             </span>
</span><span id="databases_download_dbsnp-3885"><a href="#databases_download_dbsnp-3885"><span class="linenos">3885</span></a><span class="s2">                            &quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3886"><a href="#databases_download_dbsnp-3886"><span class="linenos">3886</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3887"><a href="#databases_download_dbsnp-3887"><span class="linenos">3887</span></a>                <span class="n">query_select_info_fields</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">query_select_info_fields_array</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3888"><a href="#databases_download_dbsnp-3888"><span class="linenos">3888</span></a>
</span><span id="databases_download_dbsnp-3889"><a href="#databases_download_dbsnp-3889"><span class="linenos">3889</span></a>                <span class="c1"># Chunk CSV</span>
</span><span id="databases_download_dbsnp-3890"><a href="#databases_download_dbsnp-3890"><span class="linenos">3890</span></a>                <span class="n">chunksize</span> <span class="o">=</span> <span class="mi">1000000</span>
</span><span id="databases_download_dbsnp-3891"><a href="#databases_download_dbsnp-3891"><span class="linenos">3891</span></a>                <span class="n">skiprows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db_header_list</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3892"><a href="#databases_download_dbsnp-3892"><span class="linenos">3892</span></a>                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="databases_download_dbsnp-3893"><a href="#databases_download_dbsnp-3893"><span class="linenos">3893</span></a>                    <span class="s2">&quot;CHROM_OLD&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3894"><a href="#databases_download_dbsnp-3894"><span class="linenos">3894</span></a>                    <span class="s2">&quot;POS&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3895"><a href="#databases_download_dbsnp-3895"><span class="linenos">3895</span></a>                    <span class="s2">&quot;ID&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3896"><a href="#databases_download_dbsnp-3896"><span class="linenos">3896</span></a>                    <span class="s2">&quot;REF&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3897"><a href="#databases_download_dbsnp-3897"><span class="linenos">3897</span></a>                    <span class="s2">&quot;ALT&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3898"><a href="#databases_download_dbsnp-3898"><span class="linenos">3898</span></a>                    <span class="s2">&quot;QUAL&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3899"><a href="#databases_download_dbsnp-3899"><span class="linenos">3899</span></a>                    <span class="s2">&quot;FILTER&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3900"><a href="#databases_download_dbsnp-3900"><span class="linenos">3900</span></a>                    <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3901"><a href="#databases_download_dbsnp-3901"><span class="linenos">3901</span></a>                <span class="p">]</span>
</span><span id="databases_download_dbsnp-3902"><a href="#databases_download_dbsnp-3902"><span class="linenos">3902</span></a>                <span class="n">chunk_csv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3903"><a href="#databases_download_dbsnp-3903"><span class="linenos">3903</span></a>                    <span class="n">dbsnp_file</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3904"><a href="#databases_download_dbsnp-3904"><span class="linenos">3904</span></a>                    <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3905"><a href="#databases_download_dbsnp-3905"><span class="linenos">3905</span></a>                    <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3906"><a href="#databases_download_dbsnp-3906"><span class="linenos">3906</span></a>                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3907"><a href="#databases_download_dbsnp-3907"><span class="linenos">3907</span></a>                    <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3908"><a href="#databases_download_dbsnp-3908"><span class="linenos">3908</span></a>                    <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3909"><a href="#databases_download_dbsnp-3909"><span class="linenos">3909</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-3910"><a href="#databases_download_dbsnp-3910"><span class="linenos">3910</span></a>                <span class="n">chunk_i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="databases_download_dbsnp-3911"><a href="#databases_download_dbsnp-3911"><span class="linenos">3911</span></a>
</span><span id="databases_download_dbsnp-3912"><a href="#databases_download_dbsnp-3912"><span class="linenos">3912</span></a>                <span class="c1"># Open CSV filewith pgzip compression</span>
</span><span id="databases_download_dbsnp-3913"><a href="#databases_download_dbsnp-3913"><span class="linenos">3913</span></a>                <span class="k">with</span> <span class="n">pgzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dbsnp_vcf_file_buffer</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">thread</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3914"><a href="#databases_download_dbsnp-3914"><span class="linenos">3914</span></a>
</span><span id="databases_download_dbsnp-3915"><a href="#databases_download_dbsnp-3915"><span class="linenos">3915</span></a>                    <span class="c1"># fetch chunk</span>
</span><span id="databases_download_dbsnp-3916"><a href="#databases_download_dbsnp-3916"><span class="linenos">3916</span></a>                    <span class="k">for</span> <span class="n">df_chunk</span> <span class="ow">in</span> <span class="n">chunk_csv</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3917"><a href="#databases_download_dbsnp-3917"><span class="linenos">3917</span></a>
</span><span id="databases_download_dbsnp-3918"><a href="#databases_download_dbsnp-3918"><span class="linenos">3918</span></a>                        <span class="c1"># Chunk i</span>
</span><span id="databases_download_dbsnp-3919"><a href="#databases_download_dbsnp-3919"><span class="linenos">3919</span></a>                        <span class="n">chunk_i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="databases_download_dbsnp-3920"><a href="#databases_download_dbsnp-3920"><span class="linenos">3920</span></a>
</span><span id="databases_download_dbsnp-3921"><a href="#databases_download_dbsnp-3921"><span class="linenos">3921</span></a>                        <span class="c1"># Write CSV</span>
</span><span id="databases_download_dbsnp-3922"><a href="#databases_download_dbsnp-3922"><span class="linenos">3922</span></a>                        <span class="k">if</span> <span class="n">write_vcf</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3923"><a href="#databases_download_dbsnp-3923"><span class="linenos">3923</span></a>                            <span class="c1"># Query</span>
</span><span id="databases_download_dbsnp-3924"><a href="#databases_download_dbsnp-3924"><span class="linenos">3924</span></a>                            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3925"><a href="#databases_download_dbsnp-3925"><span class="linenos">3925</span></a><span class="s2">                                SELECT </span>
</span><span id="databases_download_dbsnp-3926"><a href="#databases_download_dbsnp-3926"><span class="linenos">3926</span></a><span class="s2">                                        concat(</span>
</span><span id="databases_download_dbsnp-3927"><a href="#databases_download_dbsnp-3927"><span class="linenos">3927</span></a><span class="s2">                                            &#39;chr&#39;,</span>
</span><span id="databases_download_dbsnp-3928"><a href="#databases_download_dbsnp-3928"><span class="linenos">3928</span></a><span class="s2">                                            replace(replace(replace(regexp_extract(&quot;CHROM_OLD&quot;, &#39;NC_[0]*([0-9]*)_?&#39;, 1), &#39;23&#39;, &#39;X&#39;), &#39;24&#39;, &#39;Y&#39;), &#39;25&#39;, &#39;M&#39;)</span>
</span><span id="databases_download_dbsnp-3929"><a href="#databases_download_dbsnp-3929"><span class="linenos">3929</span></a><span class="s2">                                        ) AS &#39;#CHROM&#39;,</span>
</span><span id="databases_download_dbsnp-3930"><a href="#databases_download_dbsnp-3930"><span class="linenos">3930</span></a><span class="s2">                                        &quot;POS&quot;, &quot;ID&quot;, &quot;REF&quot;,</span>
</span><span id="databases_download_dbsnp-3931"><a href="#databases_download_dbsnp-3931"><span class="linenos">3931</span></a><span class="s2">                                        UNNEST(string_split(CAST(&quot;ALT&quot; AS VARCHAR), &#39;,&#39;)) AS &#39;ALT&#39;,</span>
</span><span id="databases_download_dbsnp-3932"><a href="#databases_download_dbsnp-3932"><span class="linenos">3932</span></a><span class="s2">                                        &quot;QUAL&quot;, &quot;FILTER&quot;, &quot;INFO&quot;</span>
</span><span id="databases_download_dbsnp-3933"><a href="#databases_download_dbsnp-3933"><span class="linenos">3933</span></a><span class="s2">                                FROM df_chunk</span>
</span><span id="databases_download_dbsnp-3934"><a href="#databases_download_dbsnp-3934"><span class="linenos">3934</span></a><span class="s2">                                WHERE list_contains(</span><span class="si">{</span><span class="n">db_header_list_chrs</span><span class="si">}</span><span class="s2">, &quot;#CHROM&quot;)</span>
</span><span id="databases_download_dbsnp-3935"><a href="#databases_download_dbsnp-3935"><span class="linenos">3935</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3936"><a href="#databases_download_dbsnp-3936"><span class="linenos">3936</span></a>                            <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3937"><a href="#databases_download_dbsnp-3937"><span class="linenos">3937</span></a>                            <span class="c1"># Use polars to parallelize csv write and an infile with pgzip to parallelise compression</span>
</span><span id="databases_download_dbsnp-3938"><a href="#databases_download_dbsnp-3938"><span class="linenos">3938</span></a>                            <span class="n">res</span><span class="o">.</span><span class="n">pl</span><span class="p">()</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">include_header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3939"><a href="#databases_download_dbsnp-3939"><span class="linenos">3939</span></a>
</span><span id="databases_download_dbsnp-3940"><a href="#databases_download_dbsnp-3940"><span class="linenos">3940</span></a>                        <span class="c1"># Write Parquet</span>
</span><span id="databases_download_dbsnp-3941"><a href="#databases_download_dbsnp-3941"><span class="linenos">3941</span></a>                        <span class="k">if</span> <span class="n">write_parquet</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3942"><a href="#databases_download_dbsnp-3942"><span class="linenos">3942</span></a>                            <span class="c1"># Query</span>
</span><span id="databases_download_dbsnp-3943"><a href="#databases_download_dbsnp-3943"><span class="linenos">3943</span></a>                            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3944"><a href="#databases_download_dbsnp-3944"><span class="linenos">3944</span></a><span class="s2">                                SELECT </span>
</span><span id="databases_download_dbsnp-3945"><a href="#databases_download_dbsnp-3945"><span class="linenos">3945</span></a><span class="s2">                                        concat(</span>
</span><span id="databases_download_dbsnp-3946"><a href="#databases_download_dbsnp-3946"><span class="linenos">3946</span></a><span class="s2">                                            &#39;chr&#39;,</span>
</span><span id="databases_download_dbsnp-3947"><a href="#databases_download_dbsnp-3947"><span class="linenos">3947</span></a><span class="s2">                                            replace(replace(replace(regexp_extract(&quot;CHROM_OLD&quot;, &#39;NC_[0]*([0-9]*)_?&#39;, 1), &#39;23&#39;, &#39;X&#39;), &#39;24&#39;, &#39;Y&#39;), &#39;25&#39;, &#39;M&#39;)</span>
</span><span id="databases_download_dbsnp-3948"><a href="#databases_download_dbsnp-3948"><span class="linenos">3948</span></a><span class="s2">                                        ) AS &#39;#CHROM&#39;,</span>
</span><span id="databases_download_dbsnp-3949"><a href="#databases_download_dbsnp-3949"><span class="linenos">3949</span></a><span class="s2">                                        &quot;POS&quot;, &quot;ID&quot;, &quot;REF&quot;,</span>
</span><span id="databases_download_dbsnp-3950"><a href="#databases_download_dbsnp-3950"><span class="linenos">3950</span></a><span class="s2">                                        UNNEST(string_split(CAST(&quot;ALT&quot; AS VARCHAR), &#39;,&#39;)) AS &#39;ALT&#39;,</span>
</span><span id="databases_download_dbsnp-3951"><a href="#databases_download_dbsnp-3951"><span class="linenos">3951</span></a><span class="s2">                                        &quot;QUAL&quot;, &quot;FILTER&quot;, &quot;INFO&quot;,</span>
</span><span id="databases_download_dbsnp-3952"><a href="#databases_download_dbsnp-3952"><span class="linenos">3952</span></a><span class="s2">                                        </span><span class="si">{</span><span class="n">query_select_info_fields</span><span class="si">}</span>
</span><span id="databases_download_dbsnp-3953"><a href="#databases_download_dbsnp-3953"><span class="linenos">3953</span></a><span class="s2">                                FROM df_chunk</span>
</span><span id="databases_download_dbsnp-3954"><a href="#databases_download_dbsnp-3954"><span class="linenos">3954</span></a><span class="s2">                                WHERE list_contains(</span><span class="si">{</span><span class="n">db_header_list_chrs</span><span class="si">}</span><span class="s2">, &quot;#CHROM&quot;)</span>
</span><span id="databases_download_dbsnp-3955"><a href="#databases_download_dbsnp-3955"><span class="linenos">3955</span></a><span class="s2">                                &quot;&quot;&quot;</span>
</span><span id="databases_download_dbsnp-3956"><a href="#databases_download_dbsnp-3956"><span class="linenos">3956</span></a>                            <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3957"><a href="#databases_download_dbsnp-3957"><span class="linenos">3957</span></a>                            <span class="c1"># Use pandas an to_parquet with append option ans fastparquet engine (no append with other df like polars or pyarrow)</span>
</span><span id="databases_download_dbsnp-3958"><a href="#databases_download_dbsnp-3958"><span class="linenos">3958</span></a>                            <span class="k">if</span> <span class="n">chunk_i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3959"><a href="#databases_download_dbsnp-3959"><span class="linenos">3959</span></a>                                <span class="n">append</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="databases_download_dbsnp-3960"><a href="#databases_download_dbsnp-3960"><span class="linenos">3960</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3961"><a href="#databases_download_dbsnp-3961"><span class="linenos">3961</span></a>                                <span class="n">append</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="databases_download_dbsnp-3962"><a href="#databases_download_dbsnp-3962"><span class="linenos">3962</span></a>                            <span class="n">res</span><span class="o">.</span><span class="n">df</span><span class="p">()</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3963"><a href="#databases_download_dbsnp-3963"><span class="linenos">3963</span></a>                                <span class="n">dbsnp_parquet_file_buffer</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3964"><a href="#databases_download_dbsnp-3964"><span class="linenos">3964</span></a>                                <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;fastparquet&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3965"><a href="#databases_download_dbsnp-3965"><span class="linenos">3965</span></a>                                <span class="n">append</span><span class="o">=</span><span class="n">append</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3966"><a href="#databases_download_dbsnp-3966"><span class="linenos">3966</span></a>                            <span class="p">)</span>
</span><span id="databases_download_dbsnp-3967"><a href="#databases_download_dbsnp-3967"><span class="linenos">3967</span></a>
</span><span id="databases_download_dbsnp-3968"><a href="#databases_download_dbsnp-3968"><span class="linenos">3968</span></a>                        <span class="c1"># Log</span>
</span><span id="databases_download_dbsnp-3969"><a href="#databases_download_dbsnp-3969"><span class="linenos">3969</span></a>                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3970"><a href="#databases_download_dbsnp-3970"><span class="linenos">3970</span></a>                            <span class="sa">f</span><span class="s2">&quot;chunk </span><span class="si">{</span><span class="n">chunk_i</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chunksize</span><span class="o">*</span><span class="n">chunk_i</span><span class="si">}</span><span class="s2"> lines processed&quot;</span>
</span><span id="databases_download_dbsnp-3971"><a href="#databases_download_dbsnp-3971"><span class="linenos">3971</span></a>                        <span class="p">)</span>
</span><span id="databases_download_dbsnp-3972"><a href="#databases_download_dbsnp-3972"><span class="linenos">3972</span></a>
</span><span id="databases_download_dbsnp-3973"><a href="#databases_download_dbsnp-3973"><span class="linenos">3973</span></a>                <span class="c1"># Header</span>
</span><span id="databases_download_dbsnp-3974"><a href="#databases_download_dbsnp-3974"><span class="linenos">3974</span></a>
</span><span id="databases_download_dbsnp-3975"><a href="#databases_download_dbsnp-3975"><span class="linenos">3975</span></a>                <span class="k">if</span> <span class="n">write_vcf</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3976"><a href="#databases_download_dbsnp-3976"><span class="linenos">3976</span></a>                    <span class="c1"># Concat and Compress CSV with header to VCF in BGZIP compression type</span>
</span><span id="databases_download_dbsnp-3977"><a href="#databases_download_dbsnp-3977"><span class="linenos">3977</span></a>                    <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-3978"><a href="#databases_download_dbsnp-3978"><span class="linenos">3978</span></a>                        <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="n">dbsnp_vcf_file_buffer</span><span class="p">],</span>
</span><span id="databases_download_dbsnp-3979"><a href="#databases_download_dbsnp-3979"><span class="linenos">3979</span></a>                        <span class="n">output_file</span><span class="o">=</span><span class="n">dbsnp_vcf_file</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3980"><a href="#databases_download_dbsnp-3980"><span class="linenos">3980</span></a>                        <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3981"><a href="#databases_download_dbsnp-3981"><span class="linenos">3981</span></a>                        <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3982"><a href="#databases_download_dbsnp-3982"><span class="linenos">3982</span></a>                        <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;bgzip&quot;</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3983"><a href="#databases_download_dbsnp-3983"><span class="linenos">3983</span></a>                        <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3984"><a href="#databases_download_dbsnp-3984"><span class="linenos">3984</span></a>                        <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_dbsnp-3985"><a href="#databases_download_dbsnp-3985"><span class="linenos">3985</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-3986"><a href="#databases_download_dbsnp-3986"><span class="linenos">3986</span></a>
</span><span id="databases_download_dbsnp-3987"><a href="#databases_download_dbsnp-3987"><span class="linenos">3987</span></a>                <span class="k">if</span> <span class="n">write_parquet</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3988"><a href="#databases_download_dbsnp-3988"><span class="linenos">3988</span></a>                    <span class="c1"># Move Parquet buffer to Parquet</span>
</span><span id="databases_download_dbsnp-3989"><a href="#databases_download_dbsnp-3989"><span class="linenos">3989</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">dbsnp_parquet_file_buffer</span><span class="p">,</span> <span class="n">dbsnp_parquet_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3990"><a href="#databases_download_dbsnp-3990"><span class="linenos">3990</span></a>                    <span class="c1"># Copy header file</span>
</span><span id="databases_download_dbsnp-3991"><a href="#databases_download_dbsnp-3991"><span class="linenos">3991</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">header_file</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">dbsnp_parquet_hdr_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-3992"><a href="#databases_download_dbsnp-3992"><span class="linenos">3992</span></a>
</span><span id="databases_download_dbsnp-3993"><a href="#databases_download_dbsnp-3993"><span class="linenos">3993</span></a>                <span class="c1"># Clean</span>
</span><span id="databases_download_dbsnp-3994"><a href="#databases_download_dbsnp-3994"><span class="linenos">3994</span></a>                <span class="n">remove_if_exists</span><span class="p">([</span><span class="n">header_file_tmp</span><span class="p">,</span> <span class="n">dbsnp_vcf_file_buffer</span><span class="p">])</span>
</span><span id="databases_download_dbsnp-3995"><a href="#databases_download_dbsnp-3995"><span class="linenos">3995</span></a>
</span><span id="databases_download_dbsnp-3996"><a href="#databases_download_dbsnp-3996"><span class="linenos">3996</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-3997"><a href="#databases_download_dbsnp-3997"><span class="linenos">3997</span></a>
</span><span id="databases_download_dbsnp-3998"><a href="#databases_download_dbsnp-3998"><span class="linenos">3998</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-3999"><a href="#databases_download_dbsnp-3999"><span class="linenos">3999</span></a>                    <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4000"><a href="#databases_download_dbsnp-4000"><span class="linenos">4000</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-4001"><a href="#databases_download_dbsnp-4001"><span class="linenos">4001</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-4002"><a href="#databases_download_dbsnp-4002"><span class="linenos">4002</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_vcf_file</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-4003"><a href="#databases_download_dbsnp-4003"><span class="linenos">4003</span></a>                    <span class="n">dbsnp_files_already_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4004"><a href="#databases_download_dbsnp-4004"><span class="linenos">4004</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dbsnp_parquet_file</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-4005"><a href="#databases_download_dbsnp-4005"><span class="linenos">4005</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-4006"><a href="#databases_download_dbsnp-4006"><span class="linenos">4006</span></a>                <span class="k">if</span> <span class="n">dbsnp_files_already_generated</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-4007"><a href="#databases_download_dbsnp-4007"><span class="linenos">4007</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4008"><a href="#databases_download_dbsnp-4008"><span class="linenos">4008</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Files </span><span class="si">{</span><span class="n">dbsnp_files_already_generated</span><span class="si">}</span><span class="s2"> already generated&quot;</span>
</span><span id="databases_download_dbsnp-4009"><a href="#databases_download_dbsnp-4009"><span class="linenos">4009</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-4010"><a href="#databases_download_dbsnp-4010"><span class="linenos">4010</span></a>
</span><span id="databases_download_dbsnp-4011"><a href="#databases_download_dbsnp-4011"><span class="linenos">4011</span></a>        <span class="c1"># Generate default release link</span>
</span><span id="databases_download_dbsnp-4012"><a href="#databases_download_dbsnp-4012"><span class="linenos">4012</span></a>        <span class="k">if</span> <span class="n">dbsnp_release_default_found</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-4013"><a href="#databases_download_dbsnp-4013"><span class="linenos">4013</span></a>            <span class="n">dbsnp_release_default_link_src</span> <span class="o">=</span> <span class="n">dbsnp_release_default_found</span>
</span><span id="databases_download_dbsnp-4014"><a href="#databases_download_dbsnp-4014"><span class="linenos">4014</span></a>            <span class="n">dbsnp_release_default_link_dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4015"><a href="#databases_download_dbsnp-4015"><span class="linenos">4015</span></a>                <span class="n">dbsnp_folder_assembly</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span>
</span><span id="databases_download_dbsnp-4016"><a href="#databases_download_dbsnp-4016"><span class="linenos">4016</span></a>            <span class="p">)</span>
</span><span id="databases_download_dbsnp-4017"><a href="#databases_download_dbsnp-4017"><span class="linenos">4017</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="databases_download_dbsnp-4018"><a href="#databases_download_dbsnp-4018"><span class="linenos">4018</span></a>                <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-4019"><a href="#databases_download_dbsnp-4019"><span class="linenos">4019</span></a>                <span class="ow">or</span> <span class="n">dbsnp_release_default</span>
</span><span id="databases_download_dbsnp-4020"><a href="#databases_download_dbsnp-4020"><span class="linenos">4020</span></a>            <span class="p">):</span>
</span><span id="databases_download_dbsnp-4021"><a href="#databases_download_dbsnp-4021"><span class="linenos">4021</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4022"><a href="#databases_download_dbsnp-4022"><span class="linenos">4022</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release_default_found</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Defined as default&quot;</span>
</span><span id="databases_download_dbsnp-4023"><a href="#databases_download_dbsnp-4023"><span class="linenos">4023</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-4024"><a href="#databases_download_dbsnp-4024"><span class="linenos">4024</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4025"><a href="#databases_download_dbsnp-4025"><span class="linenos">4025</span></a>                    <span class="n">dbsnp_release_default_link_dest</span>
</span><span id="databases_download_dbsnp-4026"><a href="#databases_download_dbsnp-4026"><span class="linenos">4026</span></a>                <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">):</span>
</span><span id="databases_download_dbsnp-4027"><a href="#databases_download_dbsnp-4027"><span class="linenos">4027</span></a>                    <span class="n">remove_if_exists</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-4028"><a href="#databases_download_dbsnp-4028"><span class="linenos">4028</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4029"><a href="#databases_download_dbsnp-4029"><span class="linenos">4029</span></a>                        <span class="n">dbsnp_release_default_link_src</span><span class="p">,</span> <span class="n">dbsnp_release_default_link_dest</span>
</span><span id="databases_download_dbsnp-4030"><a href="#databases_download_dbsnp-4030"><span class="linenos">4030</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-4031"><a href="#databases_download_dbsnp-4031"><span class="linenos">4031</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-4032"><a href="#databases_download_dbsnp-4032"><span class="linenos">4032</span></a>                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4033"><a href="#databases_download_dbsnp-4033"><span class="linenos">4033</span></a>                        <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Default release path is not a symlink. Change not allowed&quot;</span>
</span><span id="databases_download_dbsnp-4034"><a href="#databases_download_dbsnp-4034"><span class="linenos">4034</span></a>                    <span class="p">)</span>
</span><span id="databases_download_dbsnp-4035"><a href="#databases_download_dbsnp-4035"><span class="linenos">4035</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_dbsnp-4036"><a href="#databases_download_dbsnp-4036"><span class="linenos">4036</span></a>                <span class="n">dbsnp_release_default_already</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4037"><a href="#databases_download_dbsnp-4037"><span class="linenos">4037</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">dbsnp_release_default_link_dest</span><span class="p">)</span>
</span><span id="databases_download_dbsnp-4038"><a href="#databases_download_dbsnp-4038"><span class="linenos">4038</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-4039"><a href="#databases_download_dbsnp-4039"><span class="linenos">4039</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_dbsnp-4040"><a href="#databases_download_dbsnp-4040"><span class="linenos">4040</span></a>                    <span class="sa">f</span><span class="s2">&quot;Download dbSNP </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Release </span><span class="si">{</span><span class="p">[</span><span class="n">dbsnp_release_default_already</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Already defined as default&quot;</span>
</span><span id="databases_download_dbsnp-4041"><a href="#databases_download_dbsnp-4041"><span class="linenos">4041</span></a>                <span class="p">)</span>
</span><span id="databases_download_dbsnp-4042"><a href="#databases_download_dbsnp-4042"><span class="linenos">4042</span></a>
</span><span id="databases_download_dbsnp-4043"><a href="#databases_download_dbsnp-4043"><span class="linenos">4043</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>The function <code><a href="#databases_download_dbsnp">databases_download_dbsnp</a></code> downloads dbSNP files, generates VCF files, and converts
them to Parquet format.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>assemblies</strong>:  A list of genome assemblies for which to download dbSNP data</li>
<li><strong>dbsnp_folder</strong>:  The folder where the dbSNP files will be downloaded and stored</li>
<li><strong>dbsnp_releases: List of releases to download. Default</strong>: ["b156"]</li>
<li><strong>dbsnp_release_default: Default release to link in default folder. Default</strong>:  first release in dbsnp_releases</li>
<li><strong>dbsnp_url</strong>:  The <code>dbsnp_url</code> parameter is a string that represents the base URL where the dbSNP
files are located. This URL is used to construct the full URL for downloading the dbSNP files</li>
<li><strong>dbsnp_url_files</strong>:  The <code>dbsnp_url_files</code> parameter is a dictionary that maps assembly names to
specific dbSNP URL files. It allows you to provide custom dbSNP URL files for specific assemblies
instead of using the default file naming convention</li>
<li><strong>dbsnp_url_files_prefix</strong>:  The <code>dbsnp_url_files_prefix</code> parameter is a string that represents the
prefix of the dbSNP file name for a specific assembly. It is used to construct the full URL of the
dbSNP file to be downloaded. By default, the value is set to "GCF_000001405"</li>
<li><strong>dbsnp_assemblies_map</strong>:  The <code>dbsnp_assemblies_map</code> parameter is a dictionary that maps assembly
names to their corresponding dbSNP versions. It is used to construct the dbSNP file name based on
the assembly name. For example, if the assembly is "hg19", the corresponding dbSNP version is "</li>
<li><strong>genomes_folder</strong>:  The <code>genomes_folder</code> parameter is a string that specifies the folder where the
genome index files are located. These index files are used for generating the VCF file from the
downloaded dbSNP file</li>
<li><strong>threads</strong>:  The <code>threads</code> parameter specifies the number of threads to use for downloading and
processing the dbSNP files, defaults to 1</li>
<li><strong>memory</strong>:  The <code>memory</code> parameter specifies the amount of max memory (in Gb) to use for sorting.
defaults to 1</li>
<li><strong>dbsnp_vcf</strong>:  A boolean flag indicating whether to generate a VCF file from the downloaded
dbSNP data. If set to True, the function will generate a VCF file. If set to False, the function
will not generate a VCF file, defaults to False</li>
<li><strong>dbsnpparquet</strong>:  A boolean flag indicating whether to generate a Parquet file from the
downloaded dbSNP data. If set to True, a Parquet file will be generated; if set to False, no Parquet
file will be generated, defaults to False</li>
</ul>
</div>


                </section>
                <section id="databases_download_hgmd">
                            <input id="databases_download_hgmd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">databases_download_hgmd</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">hgmd_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">hgmd_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/Users/lebechea/howard/databases/annotations/current&#39;</span>,</span><span class="param">	<span class="n">output_basename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">to_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">to_tsv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="databases_download_hgmd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#databases_download_hgmd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="databases_download_hgmd-4046"><a href="#databases_download_hgmd-4046"><span class="linenos">4046</span></a><span class="k">def</span> <span class="nf">databases_download_hgmd</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4047"><a href="#databases_download_hgmd-4047"><span class="linenos">4047</span></a>    <span class="n">assemblies</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4048"><a href="#databases_download_hgmd-4048"><span class="linenos">4048</span></a>    <span class="n">hgmd_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4049"><a href="#databases_download_hgmd-4049"><span class="linenos">4049</span></a>    <span class="n">hgmd_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATIONS_FOLDER</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4050"><a href="#databases_download_hgmd-4050"><span class="linenos">4050</span></a>    <span class="n">output_basename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4051"><a href="#databases_download_hgmd-4051"><span class="linenos">4051</span></a>    <span class="n">threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4052"><a href="#databases_download_hgmd-4052"><span class="linenos">4052</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4053"><a href="#databases_download_hgmd-4053"><span class="linenos">4053</span></a>    <span class="n">genomes_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4054"><a href="#databases_download_hgmd-4054"><span class="linenos">4054</span></a>    <span class="n">to_parquet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4055"><a href="#databases_download_hgmd-4055"><span class="linenos">4055</span></a>    <span class="n">to_tsv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4056"><a href="#databases_download_hgmd-4056"><span class="linenos">4056</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4057"><a href="#databases_download_hgmd-4057"><span class="linenos">4057</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4058"><a href="#databases_download_hgmd-4058"><span class="linenos">4058</span></a><span class="sd">    The `databases_download_hgmd` function converts an HGMD database file into VCF, Parquet, and TSV</span>
</span><span id="databases_download_hgmd-4059"><a href="#databases_download_hgmd-4059"><span class="linenos">4059</span></a><span class="sd">    formats.</span>
</span><span id="databases_download_hgmd-4060"><a href="#databases_download_hgmd-4060"><span class="linenos">4060</span></a>
</span><span id="databases_download_hgmd-4061"><a href="#databases_download_hgmd-4061"><span class="linenos">4061</span></a><span class="sd">    :param assemblies: A list of assemblies for which the HGMD database should be downloaded and</span>
</span><span id="databases_download_hgmd-4062"><a href="#databases_download_hgmd-4062"><span class="linenos">4062</span></a><span class="sd">    converted. Only one assembly can be specified</span>
</span><span id="databases_download_hgmd-4063"><a href="#databases_download_hgmd-4063"><span class="linenos">4063</span></a><span class="sd">    :type assemblies: list</span>
</span><span id="databases_download_hgmd-4064"><a href="#databases_download_hgmd-4064"><span class="linenos">4064</span></a><span class="sd">    :param hgmd_file: The `hgmd_file` parameter is a string that represents the path to the HGMD</span>
</span><span id="databases_download_hgmd-4065"><a href="#databases_download_hgmd-4065"><span class="linenos">4065</span></a><span class="sd">    database file in VCF format. This file contains the variants and their associated information</span>
</span><span id="databases_download_hgmd-4066"><a href="#databases_download_hgmd-4066"><span class="linenos">4066</span></a><span class="sd">    :type hgmd_file: str</span>
</span><span id="databases_download_hgmd-4067"><a href="#databases_download_hgmd-4067"><span class="linenos">4067</span></a><span class="sd">    :param hgmd_folder: The `hgmd_folder` parameter is a string that represents the path to the folder</span>
</span><span id="databases_download_hgmd-4068"><a href="#databases_download_hgmd-4068"><span class="linenos">4068</span></a><span class="sd">    where the HGMD database files will be stored. If no value is provided, it will use the</span>
</span><span id="databases_download_hgmd-4069"><a href="#databases_download_hgmd-4069"><span class="linenos">4069</span></a><span class="sd">    `DEFAULT_ANNOTATIONS_FOLDER` constant as the default value</span>
</span><span id="databases_download_hgmd-4070"><a href="#databases_download_hgmd-4070"><span class="linenos">4070</span></a><span class="sd">    :type hgmd_folder: str</span>
</span><span id="databases_download_hgmd-4071"><a href="#databases_download_hgmd-4071"><span class="linenos">4071</span></a><span class="sd">    :param output_basename: The `output_basename` parameter is a string that specifies the base name for</span>
</span><span id="databases_download_hgmd-4072"><a href="#databases_download_hgmd-4072"><span class="linenos">4072</span></a><span class="sd">    the output files. If not provided, it will be set as the base name of the input HGMD file without</span>
</span><span id="databases_download_hgmd-4073"><a href="#databases_download_hgmd-4073"><span class="linenos">4073</span></a><span class="sd">    the assembly information</span>
</span><span id="databases_download_hgmd-4074"><a href="#databases_download_hgmd-4074"><span class="linenos">4074</span></a><span class="sd">    :type output_basename: str</span>
</span><span id="databases_download_hgmd-4075"><a href="#databases_download_hgmd-4075"><span class="linenos">4075</span></a><span class="sd">    :param threads: The `threads` parameter specifies the number of threads to use for processing the</span>
</span><span id="databases_download_hgmd-4076"><a href="#databases_download_hgmd-4076"><span class="linenos">4076</span></a><span class="sd">    HGMD database. It determines the level of parallelism and can help speed up the conversion process</span>
</span><span id="databases_download_hgmd-4077"><a href="#databases_download_hgmd-4077"><span class="linenos">4077</span></a><span class="sd">    :type threads: int</span>
</span><span id="databases_download_hgmd-4078"><a href="#databases_download_hgmd-4078"><span class="linenos">4078</span></a><span class="sd">    :param memory: The `memory` parameter specifies the amount of max memory (in Gb) to use for sorting.</span>
</span><span id="databases_download_hgmd-4079"><a href="#databases_download_hgmd-4079"><span class="linenos">4079</span></a><span class="sd">    defaults to 1</span>
</span><span id="databases_download_hgmd-4080"><a href="#databases_download_hgmd-4080"><span class="linenos">4080</span></a><span class="sd">    :type memory: int (optional)</span>
</span><span id="databases_download_hgmd-4081"><a href="#databases_download_hgmd-4081"><span class="linenos">4081</span></a><span class="sd">    :param genomes_folder: The `genomes_folder` parameter is a string that specifies the folder where</span>
</span><span id="databases_download_hgmd-4082"><a href="#databases_download_hgmd-4082"><span class="linenos">4082</span></a><span class="sd">    the genome files are located. If this parameter is not provided, it will default to a constant value</span>
</span><span id="databases_download_hgmd-4083"><a href="#databases_download_hgmd-4083"><span class="linenos">4083</span></a><span class="sd">    `DEFAULT_GENOME_FOLDER`</span>
</span><span id="databases_download_hgmd-4084"><a href="#databases_download_hgmd-4084"><span class="linenos">4084</span></a><span class="sd">    :type genomes_folder: str</span>
</span><span id="databases_download_hgmd-4085"><a href="#databases_download_hgmd-4085"><span class="linenos">4085</span></a><span class="sd">    :param to_parquet: The `to_parquet` parameter is a boolean value that specifies whether the HGMD</span>
</span><span id="databases_download_hgmd-4086"><a href="#databases_download_hgmd-4086"><span class="linenos">4086</span></a><span class="sd">    database should be converted to the Parquet format or not. If set to `True`, the database will be</span>
</span><span id="databases_download_hgmd-4087"><a href="#databases_download_hgmd-4087"><span class="linenos">4087</span></a><span class="sd">    converted to Parquet format. If set to `False`, the conversion will be skipped, defaults to True</span>
</span><span id="databases_download_hgmd-4088"><a href="#databases_download_hgmd-4088"><span class="linenos">4088</span></a><span class="sd">    :type to_parquet: bool (optional)</span>
</span><span id="databases_download_hgmd-4089"><a href="#databases_download_hgmd-4089"><span class="linenos">4089</span></a><span class="sd">    :param to_tsv: The `to_tsv` parameter is a boolean value that specifies whether the HGMD database</span>
</span><span id="databases_download_hgmd-4090"><a href="#databases_download_hgmd-4090"><span class="linenos">4090</span></a><span class="sd">    should be converted to TSV format or not. If set to `True`, the function will generate a TSV file</span>
</span><span id="databases_download_hgmd-4091"><a href="#databases_download_hgmd-4091"><span class="linenos">4091</span></a><span class="sd">    from the HGMD database. If set to `False`, the TSV conversion will be, defaults to True</span>
</span><span id="databases_download_hgmd-4092"><a href="#databases_download_hgmd-4092"><span class="linenos">4092</span></a><span class="sd">    :type to_tsv: bool (optional)</span>
</span><span id="databases_download_hgmd-4093"><a href="#databases_download_hgmd-4093"><span class="linenos">4093</span></a><span class="sd">    :return: a boolean value indicating whether the HGMD database conversion was successful or not.</span>
</span><span id="databases_download_hgmd-4094"><a href="#databases_download_hgmd-4094"><span class="linenos">4094</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4095"><a href="#databases_download_hgmd-4095"><span class="linenos">4095</span></a>
</span><span id="databases_download_hgmd-4096"><a href="#databases_download_hgmd-4096"><span class="linenos">4096</span></a>    <span class="c1"># Check assemblies</span>
</span><span id="databases_download_hgmd-4097"><a href="#databases_download_hgmd-4097"><span class="linenos">4097</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">assemblies</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">assemblies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">assemblies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4098"><a href="#databases_download_hgmd-4098"><span class="linenos">4098</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Uniq assembly is mandatory&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4099"><a href="#databases_download_hgmd-4099"><span class="linenos">4099</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Uniq assembly is mandatory&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4100"><a href="#databases_download_hgmd-4100"><span class="linenos">4100</span></a>
</span><span id="databases_download_hgmd-4101"><a href="#databases_download_hgmd-4101"><span class="linenos">4101</span></a>    <span class="c1"># Threads</span>
</span><span id="databases_download_hgmd-4102"><a href="#databases_download_hgmd-4102"><span class="linenos">4102</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">threads</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4103"><a href="#databases_download_hgmd-4103"><span class="linenos">4103</span></a>        <span class="n">threads</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
</span><span id="databases_download_hgmd-4104"><a href="#databases_download_hgmd-4104"><span class="linenos">4104</span></a>    <span class="n">threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4105"><a href="#databases_download_hgmd-4105"><span class="linenos">4105</span></a>
</span><span id="databases_download_hgmd-4106"><a href="#databases_download_hgmd-4106"><span class="linenos">4106</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_hgmd-4107"><a href="#databases_download_hgmd-4107"><span class="linenos">4107</span></a>    <span class="n">hgmd_file</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4108"><a href="#databases_download_hgmd-4108"><span class="linenos">4108</span></a>    <span class="n">hgmd_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">hgmd_folder</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4109"><a href="#databases_download_hgmd-4109"><span class="linenos">4109</span></a>
</span><span id="databases_download_hgmd-4110"><a href="#databases_download_hgmd-4110"><span class="linenos">4110</span></a>    <span class="c1"># Check HGMD file</span>
</span><span id="databases_download_hgmd-4111"><a href="#databases_download_hgmd-4111"><span class="linenos">4111</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">hgmd_file</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">):</span>
</span><span id="databases_download_hgmd-4112"><a href="#databases_download_hgmd-4112"><span class="linenos">4112</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HGMD file DOES NOT exist &#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4113"><a href="#databases_download_hgmd-4113"><span class="linenos">4113</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HGMD file DOES NOT exist &#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4114"><a href="#databases_download_hgmd-4114"><span class="linenos">4114</span></a>
</span><span id="databases_download_hgmd-4115"><a href="#databases_download_hgmd-4115"><span class="linenos">4115</span></a>    <span class="c1"># Log</span>
</span><span id="databases_download_hgmd-4116"><a href="#databases_download_hgmd-4116"><span class="linenos">4116</span></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Convert HGMD database </span><span class="si">{</span><span class="n">assemblies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4117"><a href="#databases_download_hgmd-4117"><span class="linenos">4117</span></a>
</span><span id="databases_download_hgmd-4118"><a href="#databases_download_hgmd-4118"><span class="linenos">4118</span></a>    <span class="c1"># genomes folder</span>
</span><span id="databases_download_hgmd-4119"><a href="#databases_download_hgmd-4119"><span class="linenos">4119</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">genomes_folder</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4120"><a href="#databases_download_hgmd-4120"><span class="linenos">4120</span></a>        <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">DEFAULT_GENOME_FOLDER</span>
</span><span id="databases_download_hgmd-4121"><a href="#databases_download_hgmd-4121"><span class="linenos">4121</span></a>
</span><span id="databases_download_hgmd-4122"><a href="#databases_download_hgmd-4122"><span class="linenos">4122</span></a>    <span class="c1"># Full path</span>
</span><span id="databases_download_hgmd-4123"><a href="#databases_download_hgmd-4123"><span class="linenos">4123</span></a>    <span class="n">genomes_folder</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">(</span><span class="n">genomes_folder</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4124"><a href="#databases_download_hgmd-4124"><span class="linenos">4124</span></a>
</span><span id="databases_download_hgmd-4125"><a href="#databases_download_hgmd-4125"><span class="linenos">4125</span></a>    <span class="c1"># Assembly</span>
</span><span id="databases_download_hgmd-4126"><a href="#databases_download_hgmd-4126"><span class="linenos">4126</span></a>    <span class="n">assembly</span> <span class="o">=</span> <span class="n">assemblies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="databases_download_hgmd-4127"><a href="#databases_download_hgmd-4127"><span class="linenos">4127</span></a>
</span><span id="databases_download_hgmd-4128"><a href="#databases_download_hgmd-4128"><span class="linenos">4128</span></a>    <span class="c1"># Create folder if not exists</span>
</span><span id="databases_download_hgmd-4129"><a href="#databases_download_hgmd-4129"><span class="linenos">4129</span></a>    <span class="n">hgmd_folder_assembly</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hgmd_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4130"><a href="#databases_download_hgmd-4130"><span class="linenos">4130</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">hgmd_folder_assembly</span><span class="p">):</span>
</span><span id="databases_download_hgmd-4131"><a href="#databases_download_hgmd-4131"><span class="linenos">4131</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">hgmd_folder_assembly</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4132"><a href="#databases_download_hgmd-4132"><span class="linenos">4132</span></a>
</span><span id="databases_download_hgmd-4133"><a href="#databases_download_hgmd-4133"><span class="linenos">4133</span></a>    <span class="c1"># Output basename</span>
</span><span id="databases_download_hgmd-4134"><a href="#databases_download_hgmd-4134"><span class="linenos">4134</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">output_basename</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4135"><a href="#databases_download_hgmd-4135"><span class="linenos">4135</span></a>        <span class="n">output_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.vcf.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4136"><a href="#databases_download_hgmd-4136"><span class="linenos">4136</span></a>
</span><span id="databases_download_hgmd-4137"><a href="#databases_download_hgmd-4137"><span class="linenos">4137</span></a>    <span class="n">output_vcf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hgmd_folder_assembly</span><span class="p">,</span> <span class="n">output_basename</span> <span class="o">+</span> <span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4138"><a href="#databases_download_hgmd-4138"><span class="linenos">4138</span></a>
</span><span id="databases_download_hgmd-4139"><a href="#databases_download_hgmd-4139"><span class="linenos">4139</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">):</span>
</span><span id="databases_download_hgmd-4140"><a href="#databases_download_hgmd-4140"><span class="linenos">4140</span></a>
</span><span id="databases_download_hgmd-4141"><a href="#databases_download_hgmd-4141"><span class="linenos">4141</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4142"><a href="#databases_download_hgmd-4142"><span class="linenos">4142</span></a>            <span class="sa">f</span><span class="s2">&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - File &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span>
</span><span id="databases_download_hgmd-4143"><a href="#databases_download_hgmd-4143"><span class="linenos">4143</span></a>        <span class="p">)</span>
</span><span id="databases_download_hgmd-4144"><a href="#databases_download_hgmd-4144"><span class="linenos">4144</span></a>
</span><span id="databases_download_hgmd-4145"><a href="#databases_download_hgmd-4145"><span class="linenos">4145</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4146"><a href="#databases_download_hgmd-4146"><span class="linenos">4146</span></a>
</span><span id="databases_download_hgmd-4147"><a href="#databases_download_hgmd-4147"><span class="linenos">4147</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4148"><a href="#databases_download_hgmd-4148"><span class="linenos">4148</span></a>            <span class="sa">f</span><span class="s2">&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - File &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">hgmd_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; processing...&quot;</span>
</span><span id="databases_download_hgmd-4149"><a href="#databases_download_hgmd-4149"><span class="linenos">4149</span></a>        <span class="p">)</span>
</span><span id="databases_download_hgmd-4150"><a href="#databases_download_hgmd-4150"><span class="linenos">4150</span></a>
</span><span id="databases_download_hgmd-4151"><a href="#databases_download_hgmd-4151"><span class="linenos">4151</span></a>        <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4152"><a href="#databases_download_hgmd-4152"><span class="linenos">4152</span></a>
</span><span id="databases_download_hgmd-4153"><a href="#databases_download_hgmd-4153"><span class="linenos">4153</span></a>            <span class="c1"># Import Database object</span>
</span><span id="databases_download_hgmd-4154"><a href="#databases_download_hgmd-4154"><span class="linenos">4154</span></a>            <span class="kn">from</span> <span class="nn">howard.objects.database</span> <span class="kn">import</span> <span class="n">Database</span>
</span><span id="databases_download_hgmd-4155"><a href="#databases_download_hgmd-4155"><span class="linenos">4155</span></a>            <span class="kn">from</span> <span class="nn">howard.objects.variants</span> <span class="kn">import</span> <span class="n">Variants</span>
</span><span id="databases_download_hgmd-4156"><a href="#databases_download_hgmd-4156"><span class="linenos">4156</span></a>
</span><span id="databases_download_hgmd-4157"><a href="#databases_download_hgmd-4157"><span class="linenos">4157</span></a>            <span class="c1"># Database</span>
</span><span id="databases_download_hgmd-4158"><a href="#databases_download_hgmd-4158"><span class="linenos">4158</span></a>            <span class="n">database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">hgmd_file</span><span class="p">,</span> <span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4159"><a href="#databases_download_hgmd-4159"><span class="linenos">4159</span></a>
</span><span id="databases_download_hgmd-4160"><a href="#databases_download_hgmd-4160"><span class="linenos">4160</span></a>            <span class="c1"># Create duckDB connexion</span>
</span><span id="databases_download_hgmd-4161"><a href="#databases_download_hgmd-4161"><span class="linenos">4161</span></a>            <span class="n">db_copy</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">})</span>
</span><span id="databases_download_hgmd-4162"><a href="#databases_download_hgmd-4162"><span class="linenos">4162</span></a>
</span><span id="databases_download_hgmd-4163"><a href="#databases_download_hgmd-4163"><span class="linenos">4163</span></a>            <span class="c1"># Set max expression depth for big sub databases (e.g. gnomAD, ALL)</span>
</span><span id="databases_download_hgmd-4164"><a href="#databases_download_hgmd-4164"><span class="linenos">4164</span></a>            <span class="n">db_copy</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET max_expression_depth TO 10000&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4165"><a href="#databases_download_hgmd-4165"><span class="linenos">4165</span></a>
</span><span id="databases_download_hgmd-4166"><a href="#databases_download_hgmd-4166"><span class="linenos">4166</span></a>            <span class="c1"># Log</span>
</span><span id="databases_download_hgmd-4167"><a href="#databases_download_hgmd-4167"><span class="linenos">4167</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4168"><a href="#databases_download_hgmd-4168"><span class="linenos">4168</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Check chromosomes and number of variants...&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4169"><a href="#databases_download_hgmd-4169"><span class="linenos">4169</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4170"><a href="#databases_download_hgmd-4170"><span class="linenos">4170</span></a>
</span><span id="databases_download_hgmd-4171"><a href="#databases_download_hgmd-4171"><span class="linenos">4171</span></a>            <span class="c1"># Check chomosomes and total number of variants</span>
</span><span id="databases_download_hgmd-4172"><a href="#databases_download_hgmd-4172"><span class="linenos">4172</span></a>            <span class="n">query_chromosomes</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4173"><a href="#databases_download_hgmd-4173"><span class="linenos">4173</span></a><span class="s2">                        SELECT distinct concat(&#39;chr&#39;, &quot;#CHROM&quot;) AS chromosome, count(*) AS nb_variants</span>
</span><span id="databases_download_hgmd-4174"><a href="#databases_download_hgmd-4174"><span class="linenos">4174</span></a><span class="s2">                        FROM read_csv(&#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;, AUTO_DETECT=TRUE, ALL_VARCHAR=1, SEP=&#39;</span><span class="se">\t</span><span class="s2">&#39;)</span>
</span><span id="databases_download_hgmd-4175"><a href="#databases_download_hgmd-4175"><span class="linenos">4175</span></a><span class="s2">                        GROUP BY &quot;#CHROM&quot;</span>
</span><span id="databases_download_hgmd-4176"><a href="#databases_download_hgmd-4176"><span class="linenos">4176</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4177"><a href="#databases_download_hgmd-4177"><span class="linenos">4177</span></a>            <span class="n">chromosomes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4178"><a href="#databases_download_hgmd-4178"><span class="linenos">4178</span></a>                <span class="nb">list</span><span class="p">(</span><span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;chromosome&quot;</span><span class="p">])</span>
</span><span id="databases_download_hgmd-4179"><a href="#databases_download_hgmd-4179"><span class="linenos">4179</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4180"><a href="#databases_download_hgmd-4180"><span class="linenos">4180</span></a>            <span class="n">nb_variants</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_chromosomes</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()[</span><span class="s2">&quot;nb_variants&quot;</span><span class="p">])</span>
</span><span id="databases_download_hgmd-4181"><a href="#databases_download_hgmd-4181"><span class="linenos">4181</span></a>
</span><span id="databases_download_hgmd-4182"><a href="#databases_download_hgmd-4182"><span class="linenos">4182</span></a>            <span class="c1"># Log</span>
</span><span id="databases_download_hgmd-4183"><a href="#databases_download_hgmd-4183"><span class="linenos">4183</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4184"><a href="#databases_download_hgmd-4184"><span class="linenos">4184</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chromosomes</span><span class="p">)</span><span class="si">}</span><span class="s2"> chromosomes&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4185"><a href="#databases_download_hgmd-4185"><span class="linenos">4185</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4186"><a href="#databases_download_hgmd-4186"><span class="linenos">4186</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4187"><a href="#databases_download_hgmd-4187"><span class="linenos">4187</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Found </span><span class="si">{</span><span class="n">nb_variants</span><span class="si">}</span><span class="s2"> variants&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4188"><a href="#databases_download_hgmd-4188"><span class="linenos">4188</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4189"><a href="#databases_download_hgmd-4189"><span class="linenos">4189</span></a>
</span><span id="databases_download_hgmd-4190"><a href="#databases_download_hgmd-4190"><span class="linenos">4190</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate files...&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4191"><a href="#databases_download_hgmd-4191"><span class="linenos">4191</span></a>
</span><span id="databases_download_hgmd-4192"><a href="#databases_download_hgmd-4192"><span class="linenos">4192</span></a>            <span class="c1"># Chromosome sizes</span>
</span><span id="databases_download_hgmd-4193"><a href="#databases_download_hgmd-4193"><span class="linenos">4193</span></a>            <span class="n">genomes_sizes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="databases_download_hgmd-4194"><a href="#databases_download_hgmd-4194"><span class="linenos">4194</span></a>            <span class="n">genomes_sizes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4195"><a href="#databases_download_hgmd-4195"><span class="linenos">4195</span></a>                <span class="n">genomes_folder</span><span class="p">,</span> <span class="n">assembly</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">.fa.sizes&quot;</span>
</span><span id="databases_download_hgmd-4196"><a href="#databases_download_hgmd-4196"><span class="linenos">4196</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4197"><a href="#databases_download_hgmd-4197"><span class="linenos">4197</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">):</span>
</span><span id="databases_download_hgmd-4198"><a href="#databases_download_hgmd-4198"><span class="linenos">4198</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">genomes_sizes_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4199"><a href="#databases_download_hgmd-4199"><span class="linenos">4199</span></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4200"><a href="#databases_download_hgmd-4200"><span class="linenos">4200</span></a>                        <span class="n">genomes_sizes</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="databases_download_hgmd-4201"><a href="#databases_download_hgmd-4201"><span class="linenos">4201</span></a>
</span><span id="databases_download_hgmd-4202"><a href="#databases_download_hgmd-4202"><span class="linenos">4202</span></a>            <span class="c1">### Header</span>
</span><span id="databases_download_hgmd-4203"><a href="#databases_download_hgmd-4203"><span class="linenos">4203</span></a>
</span><span id="databases_download_hgmd-4204"><a href="#databases_download_hgmd-4204"><span class="linenos">4204</span></a>            <span class="c1"># Init</span>
</span><span id="databases_download_hgmd-4205"><a href="#databases_download_hgmd-4205"><span class="linenos">4205</span></a>            <span class="n">header_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="databases_download_hgmd-4206"><a href="#databases_download_hgmd-4206"><span class="linenos">4206</span></a>            <span class="n">header_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;header.hdr&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4207"><a href="#databases_download_hgmd-4207"><span class="linenos">4207</span></a>            <span class="n">database_header</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get_header_file</span><span class="p">()</span>
</span><span id="databases_download_hgmd-4208"><a href="#databases_download_hgmd-4208"><span class="linenos">4208</span></a>
</span><span id="databases_download_hgmd-4209"><a href="#databases_download_hgmd-4209"><span class="linenos">4209</span></a>            <span class="c1"># Read header file to dict</span>
</span><span id="databases_download_hgmd-4210"><a href="#databases_download_hgmd-4210"><span class="linenos">4210</span></a>            <span class="k">with</span> <span class="n">mgzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">database_header</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4211"><a href="#databases_download_hgmd-4211"><span class="linenos">4211</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4212"><a href="#databases_download_hgmd-4212"><span class="linenos">4212</span></a>                    <span class="c1"># log.debug(line)</span>
</span><span id="databases_download_hgmd-4213"><a href="#databases_download_hgmd-4213"><span class="linenos">4213</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
</span><span id="databases_download_hgmd-4214"><a href="#databases_download_hgmd-4214"><span class="linenos">4214</span></a>                        <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="databases_download_hgmd-4215"><a href="#databases_download_hgmd-4215"><span class="linenos">4215</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4216"><a href="#databases_download_hgmd-4216"><span class="linenos">4216</span></a>                        <span class="k">break</span>
</span><span id="databases_download_hgmd-4217"><a href="#databases_download_hgmd-4217"><span class="linenos">4217</span></a>
</span><span id="databases_download_hgmd-4218"><a href="#databases_download_hgmd-4218"><span class="linenos">4218</span></a>            <span class="c1"># Remove last line with #CHROM</span>
</span><span id="databases_download_hgmd-4219"><a href="#databases_download_hgmd-4219"><span class="linenos">4219</span></a>            <span class="n">header_list</span> <span class="o">=</span> <span class="n">header_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="databases_download_hgmd-4220"><a href="#databases_download_hgmd-4220"><span class="linenos">4220</span></a>
</span><span id="databases_download_hgmd-4221"><a href="#databases_download_hgmd-4221"><span class="linenos">4221</span></a>            <span class="c1"># Append INFO MC</span>
</span><span id="databases_download_hgmd-4222"><a href="#databases_download_hgmd-4222"><span class="linenos">4222</span></a>            <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4223"><a href="#databases_download_hgmd-4223"><span class="linenos">4223</span></a>                <span class="s1">&#39;##INFO=&lt;ID=MC,Number=1,Type=String,Description=&quot;HGMD Accession number&quot;&gt;&#39;</span>
</span><span id="databases_download_hgmd-4224"><a href="#databases_download_hgmd-4224"><span class="linenos">4224</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4225"><a href="#databases_download_hgmd-4225"><span class="linenos">4225</span></a>
</span><span id="databases_download_hgmd-4226"><a href="#databases_download_hgmd-4226"><span class="linenos">4226</span></a>            <span class="c1"># Add chromosomes</span>
</span><span id="databases_download_hgmd-4227"><a href="#databases_download_hgmd-4227"><span class="linenos">4227</span></a>            <span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="n">chromosomes</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4228"><a href="#databases_download_hgmd-4228"><span class="linenos">4228</span></a>                <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4229"><a href="#databases_download_hgmd-4229"><span class="linenos">4229</span></a>                    <span class="sa">f</span><span class="s2">&quot;##contig=&lt;ID=</span><span class="si">{</span><span class="n">chromosome</span><span class="si">}</span><span class="s2">,length=</span><span class="si">{</span><span class="n">genomes_sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chromosome</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">,assembly=</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="databases_download_hgmd-4230"><a href="#databases_download_hgmd-4230"><span class="linenos">4230</span></a>                <span class="p">)</span>
</span><span id="databases_download_hgmd-4231"><a href="#databases_download_hgmd-4231"><span class="linenos">4231</span></a>
</span><span id="databases_download_hgmd-4232"><a href="#databases_download_hgmd-4232"><span class="linenos">4232</span></a>            <span class="c1"># Add last line with #CHROM</span>
</span><span id="databases_download_hgmd-4233"><a href="#databases_download_hgmd-4233"><span class="linenos">4233</span></a>            <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#CHROM</span><span class="se">\t</span><span class="s2">POS</span><span class="se">\t</span><span class="s2">ID</span><span class="se">\t</span><span class="s2">REF</span><span class="se">\t</span><span class="s2">ALT</span><span class="se">\t</span><span class="s2">QUAL</span><span class="se">\t</span><span class="s2">FILTER</span><span class="se">\t</span><span class="s2">INFO&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4234"><a href="#databases_download_hgmd-4234"><span class="linenos">4234</span></a>
</span><span id="databases_download_hgmd-4235"><a href="#databases_download_hgmd-4235"><span class="linenos">4235</span></a>            <span class="c1"># Write header</span>
</span><span id="databases_download_hgmd-4236"><a href="#databases_download_hgmd-4236"><span class="linenos">4236</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">header_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4237"><a href="#databases_download_hgmd-4237"><span class="linenos">4237</span></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">header_list</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4238"><a href="#databases_download_hgmd-4238"><span class="linenos">4238</span></a>                    <span class="c1"># write each item on a new line</span>
</span><span id="databases_download_hgmd-4239"><a href="#databases_download_hgmd-4239"><span class="linenos">4239</span></a>                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4240"><a href="#databases_download_hgmd-4240"><span class="linenos">4240</span></a>
</span><span id="databases_download_hgmd-4241"><a href="#databases_download_hgmd-4241"><span class="linenos">4241</span></a>            <span class="c1">### Variants</span>
</span><span id="databases_download_hgmd-4242"><a href="#databases_download_hgmd-4242"><span class="linenos">4242</span></a>
</span><span id="databases_download_hgmd-4243"><a href="#databases_download_hgmd-4243"><span class="linenos">4243</span></a>            <span class="c1"># Init</span>
</span><span id="databases_download_hgmd-4244"><a href="#databases_download_hgmd-4244"><span class="linenos">4244</span></a>            <span class="n">variants_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;variants.vcf&quot;</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4245"><a href="#databases_download_hgmd-4245"><span class="linenos">4245</span></a>
</span><span id="databases_download_hgmd-4246"><a href="#databases_download_hgmd-4246"><span class="linenos">4246</span></a>            <span class="c1"># Query COPY TO</span>
</span><span id="databases_download_hgmd-4247"><a href="#databases_download_hgmd-4247"><span class="linenos">4247</span></a>            <span class="n">query_variants</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4248"><a href="#databases_download_hgmd-4248"><span class="linenos">4248</span></a><span class="s2">                COPY (</span>
</span><span id="databases_download_hgmd-4249"><a href="#databases_download_hgmd-4249"><span class="linenos">4249</span></a><span class="s2">                        SELECT</span>
</span><span id="databases_download_hgmd-4250"><a href="#databases_download_hgmd-4250"><span class="linenos">4250</span></a><span class="s2">                            concat(&#39;chr&#39;, &quot;#CHROM&quot;) AS &#39;#CHROM&#39;,</span>
</span><span id="databases_download_hgmd-4251"><a href="#databases_download_hgmd-4251"><span class="linenos">4251</span></a><span class="s2">                            POS,</span>
</span><span id="databases_download_hgmd-4252"><a href="#databases_download_hgmd-4252"><span class="linenos">4252</span></a><span class="s2">                            ID,</span>
</span><span id="databases_download_hgmd-4253"><a href="#databases_download_hgmd-4253"><span class="linenos">4253</span></a><span class="s2">                            REF,</span>
</span><span id="databases_download_hgmd-4254"><a href="#databases_download_hgmd-4254"><span class="linenos">4254</span></a><span class="s2">                            ALT,</span>
</span><span id="databases_download_hgmd-4255"><a href="#databases_download_hgmd-4255"><span class="linenos">4255</span></a><span class="s2">                            QUAL,</span>
</span><span id="databases_download_hgmd-4256"><a href="#databases_download_hgmd-4256"><span class="linenos">4256</span></a><span class="s2">                            FILTER,</span>
</span><span id="databases_download_hgmd-4257"><a href="#databases_download_hgmd-4257"><span class="linenos">4257</span></a><span class="s2">                            concat(</span>
</span><span id="databases_download_hgmd-4258"><a href="#databases_download_hgmd-4258"><span class="linenos">4258</span></a><span class="s2">                                replace(INFO, &#39;&quot;&#39;, &#39;&#39;),</span>
</span><span id="databases_download_hgmd-4259"><a href="#databases_download_hgmd-4259"><span class="linenos">4259</span></a><span class="s2">                                &#39;;&#39;,</span>
</span><span id="databases_download_hgmd-4260"><a href="#databases_download_hgmd-4260"><span class="linenos">4260</span></a><span class="s2">                                &#39;MC=&#39;,</span>
</span><span id="databases_download_hgmd-4261"><a href="#databases_download_hgmd-4261"><span class="linenos">4261</span></a><span class="s2">                                ID</span>
</span><span id="databases_download_hgmd-4262"><a href="#databases_download_hgmd-4262"><span class="linenos">4262</span></a><span class="s2">                                ) AS &#39;INFO&#39;</span>
</span><span id="databases_download_hgmd-4263"><a href="#databases_download_hgmd-4263"><span class="linenos">4263</span></a><span class="s2">                        FROM read_csv(&#39;</span><span class="si">{</span><span class="n">hgmd_file</span><span class="si">}</span><span class="s2">&#39;, AUTO_DETECT=TRUE, ALL_VARCHAR=1, SEP=&#39;</span><span class="se">\t</span><span class="s2">&#39;, SAMPLE_SIZE=10000000)</span>
</span><span id="databases_download_hgmd-4264"><a href="#databases_download_hgmd-4264"><span class="linenos">4264</span></a><span class="s2">                    )</span>
</span><span id="databases_download_hgmd-4265"><a href="#databases_download_hgmd-4265"><span class="linenos">4265</span></a><span class="s2">                TO &#39;</span><span class="si">{</span><span class="n">variants_file</span><span class="si">}</span><span class="s2">&#39; (FORMAT csv, delimiter &#39;</span><span class="se">\t</span><span class="s2">&#39;, HEADER 0)</span>
</span><span id="databases_download_hgmd-4266"><a href="#databases_download_hgmd-4266"><span class="linenos">4266</span></a><span class="s2">                    &quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4267"><a href="#databases_download_hgmd-4267"><span class="linenos">4267</span></a>            <span class="n">db_copy</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_variants</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4268"><a href="#databases_download_hgmd-4268"><span class="linenos">4268</span></a>
</span><span id="databases_download_hgmd-4269"><a href="#databases_download_hgmd-4269"><span class="linenos">4269</span></a>            <span class="c1"># Create HGMD VCF</span>
</span><span id="databases_download_hgmd-4270"><a href="#databases_download_hgmd-4270"><span class="linenos">4270</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4271"><a href="#databases_download_hgmd-4271"><span class="linenos">4271</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate VCF file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_vcf</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4272"><a href="#databases_download_hgmd-4272"><span class="linenos">4272</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4273"><a href="#databases_download_hgmd-4273"><span class="linenos">4273</span></a>            <span class="n">concat_and_compress_files</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4274"><a href="#databases_download_hgmd-4274"><span class="linenos">4274</span></a>                <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">header_file</span><span class="p">,</span> <span class="n">variants_file</span><span class="p">],</span>
</span><span id="databases_download_hgmd-4275"><a href="#databases_download_hgmd-4275"><span class="linenos">4275</span></a>                <span class="n">output_file</span><span class="o">=</span><span class="n">output_vcf</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4276"><a href="#databases_download_hgmd-4276"><span class="linenos">4276</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4277"><a href="#databases_download_hgmd-4277"><span class="linenos">4277</span></a>                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4278"><a href="#databases_download_hgmd-4278"><span class="linenos">4278</span></a>                <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4279"><a href="#databases_download_hgmd-4279"><span class="linenos">4279</span></a>                <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4280"><a href="#databases_download_hgmd-4280"><span class="linenos">4280</span></a>                <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;bgzip&quot;</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4281"><a href="#databases_download_hgmd-4281"><span class="linenos">4281</span></a>            <span class="p">)</span>
</span><span id="databases_download_hgmd-4282"><a href="#databases_download_hgmd-4282"><span class="linenos">4282</span></a>
</span><span id="databases_download_hgmd-4283"><a href="#databases_download_hgmd-4283"><span class="linenos">4283</span></a>            <span class="c1"># Create HGMD Parquet</span>
</span><span id="databases_download_hgmd-4284"><a href="#databases_download_hgmd-4284"><span class="linenos">4284</span></a>            <span class="k">if</span> <span class="n">to_parquet</span> <span class="ow">or</span> <span class="n">to_tsv</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4285"><a href="#databases_download_hgmd-4285"><span class="linenos">4285</span></a>                <span class="n">output_parquet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4286"><a href="#databases_download_hgmd-4286"><span class="linenos">4286</span></a>                    <span class="n">hgmd_folder_assembly</span><span class="p">,</span> <span class="n">output_basename</span> <span class="o">+</span> <span class="s2">&quot;.parquet&quot;</span>
</span><span id="databases_download_hgmd-4287"><a href="#databases_download_hgmd-4287"><span class="linenos">4287</span></a>                <span class="p">)</span>
</span><span id="databases_download_hgmd-4288"><a href="#databases_download_hgmd-4288"><span class="linenos">4288</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4289"><a href="#databases_download_hgmd-4289"><span class="linenos">4289</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate Parquet file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_parquet</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4290"><a href="#databases_download_hgmd-4290"><span class="linenos">4290</span></a>                <span class="p">)</span>
</span><span id="databases_download_hgmd-4291"><a href="#databases_download_hgmd-4291"><span class="linenos">4291</span></a>                <span class="n">hgmd_database_to_parquet</span> <span class="o">=</span> <span class="n">Variants</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4292"><a href="#databases_download_hgmd-4292"><span class="linenos">4292</span></a>                    <span class="nb">input</span><span class="o">=</span><span class="n">output_vcf</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4293"><a href="#databases_download_hgmd-4293"><span class="linenos">4293</span></a>                    <span class="n">output</span><span class="o">=</span><span class="n">output_parquet</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4294"><a href="#databases_download_hgmd-4294"><span class="linenos">4294</span></a>                    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">},</span>
</span><span id="databases_download_hgmd-4295"><a href="#databases_download_hgmd-4295"><span class="linenos">4295</span></a>                    <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;explode_infos&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="databases_download_hgmd-4296"><a href="#databases_download_hgmd-4296"><span class="linenos">4296</span></a>                    <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4297"><a href="#databases_download_hgmd-4297"><span class="linenos">4297</span></a>                <span class="p">)</span>
</span><span id="databases_download_hgmd-4298"><a href="#databases_download_hgmd-4298"><span class="linenos">4298</span></a>                <span class="n">hgmd_database_to_parquet</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4299"><a href="#databases_download_hgmd-4299"><span class="linenos">4299</span></a>                <span class="n">hgmd_database_to_parquet</span><span class="o">.</span><span class="n">export_output</span><span class="p">(</span><span class="n">export_header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4300"><a href="#databases_download_hgmd-4300"><span class="linenos">4300</span></a>
</span><span id="databases_download_hgmd-4301"><a href="#databases_download_hgmd-4301"><span class="linenos">4301</span></a>            <span class="c1"># Create HGMD TSV</span>
</span><span id="databases_download_hgmd-4302"><a href="#databases_download_hgmd-4302"><span class="linenos">4302</span></a>            <span class="k">if</span> <span class="n">to_tsv</span><span class="p">:</span>
</span><span id="databases_download_hgmd-4303"><a href="#databases_download_hgmd-4303"><span class="linenos">4303</span></a>                <span class="n">output_tsv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4304"><a href="#databases_download_hgmd-4304"><span class="linenos">4304</span></a>                    <span class="n">hgmd_folder_assembly</span><span class="p">,</span> <span class="n">output_basename</span> <span class="o">+</span> <span class="s2">&quot;.tsv&quot;</span>
</span><span id="databases_download_hgmd-4305"><a href="#databases_download_hgmd-4305"><span class="linenos">4305</span></a>                <span class="p">)</span>
</span><span id="databases_download_hgmd-4306"><a href="#databases_download_hgmd-4306"><span class="linenos">4306</span></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4307"><a href="#databases_download_hgmd-4307"><span class="linenos">4307</span></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Convert HGMD database </span><span class="si">{</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Generate TSV file &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;&quot;&quot;</span>
</span><span id="databases_download_hgmd-4308"><a href="#databases_download_hgmd-4308"><span class="linenos">4308</span></a>                <span class="p">)</span>
</span><span id="databases_download_hgmd-4309"><a href="#databases_download_hgmd-4309"><span class="linenos">4309</span></a>                <span class="n">hgmd_database_to_tsv</span> <span class="o">=</span> <span class="n">Variants</span><span class="p">(</span>
</span><span id="databases_download_hgmd-4310"><a href="#databases_download_hgmd-4310"><span class="linenos">4310</span></a>                    <span class="nb">input</span><span class="o">=</span><span class="n">output_parquet</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4311"><a href="#databases_download_hgmd-4311"><span class="linenos">4311</span></a>                    <span class="n">output</span><span class="o">=</span><span class="n">output_tsv</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4312"><a href="#databases_download_hgmd-4312"><span class="linenos">4312</span></a>                    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">threads</span><span class="p">},</span>
</span><span id="databases_download_hgmd-4313"><a href="#databases_download_hgmd-4313"><span class="linenos">4313</span></a>                    <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;explode_infos&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="databases_download_hgmd-4314"><a href="#databases_download_hgmd-4314"><span class="linenos">4314</span></a>                    <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="databases_download_hgmd-4315"><a href="#databases_download_hgmd-4315"><span class="linenos">4315</span></a>                <span class="p">)</span>
</span><span id="databases_download_hgmd-4316"><a href="#databases_download_hgmd-4316"><span class="linenos">4316</span></a>                <span class="n">hgmd_database_to_tsv</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4317"><a href="#databases_download_hgmd-4317"><span class="linenos">4317</span></a>                <span class="n">hgmd_database_to_tsv</span><span class="o">.</span><span class="n">export_output</span><span class="p">(</span><span class="n">export_header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="databases_download_hgmd-4318"><a href="#databases_download_hgmd-4318"><span class="linenos">4318</span></a>
</span><span id="databases_download_hgmd-4319"><a href="#databases_download_hgmd-4319"><span class="linenos">4319</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#databases_download_hgmd">databases_download_hgmd</a></code> function converts an HGMD database file into VCF, Parquet, and TSV
formats.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>assemblies</strong>:  A list of assemblies for which the HGMD database should be downloaded and
converted. Only one assembly can be specified</li>
<li><strong>hgmd_file</strong>:  The <code>hgmd_file</code> parameter is a string that represents the path to the HGMD
database file in VCF format. This file contains the variants and their associated information</li>
<li><strong>hgmd_folder</strong>:  The <code>hgmd_folder</code> parameter is a string that represents the path to the folder
where the HGMD database files will be stored. If no value is provided, it will use the
<code>DEFAULT_ANNOTATIONS_FOLDER</code> constant as the default value</li>
<li><strong>output_basename</strong>:  The <code>output_basename</code> parameter is a string that specifies the base name for
the output files. If not provided, it will be set as the base name of the input HGMD file without
the assembly information</li>
<li><strong>threads</strong>:  The <code>threads</code> parameter specifies the number of threads to use for processing the
HGMD database. It determines the level of parallelism and can help speed up the conversion process</li>
<li><strong>memory</strong>:  The <code>memory</code> parameter specifies the amount of max memory (in Gb) to use for sorting.
defaults to 1</li>
<li><strong>genomes_folder</strong>:  The <code>genomes_folder</code> parameter is a string that specifies the folder where
the genome files are located. If this parameter is not provided, it will default to a constant value
<code>DEFAULT_GENOME_FOLDER</code></li>
<li><strong>to_parquet</strong>:  The <code>to_parquet</code> parameter is a boolean value that specifies whether the HGMD
database should be converted to the Parquet format or not. If set to <code>True</code>, the database will be
converted to Parquet format. If set to <code>False</code>, the conversion will be skipped, defaults to True</li>
<li><strong>to_tsv</strong>:  The <code>to_tsv</code> parameter is a boolean value that specifies whether the HGMD database
should be converted to TSV format or not. If set to <code>True</code>, the function will generate a TSV file
from the HGMD database. If set to <code>False</code>, the TSV conversion will be, defaults to True</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>a boolean value indicating whether the HGMD database conversion was successful or not.</p>
</blockquote>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>